{"version":3,"sources":["components/Storage/Card/SideBar/SideBar.module.scss","components/common/Accordion.module.scss","components/Storage/Card/Table/Header/ActionHeader/ActionHeader.module.scss","components/Storage/Card/Table/Header/StorageHeader/StorageHeader.module.scss","components/Storage/common/StorageFileIcon/StorageIcon.module.scss","components/Firestore/Collection.module.scss","components/Storage/Card/SideBar/FileLocation/FileLocation.module.scss","components/Storage/Card/StorageCard.module.scss","components/Auth/UserFormDialog/UserFormDialog.module.scss","components/Auth/UsersCard/header/AuthFilter.module.scss","components/Auth/UsersCard/header/AuthHeader.module.scss","components/Home/StatusLabel.module.scss","components/Storage/Card/TableDropzoneWrapper/TableDropzoneWrapper.module.scss","store/config/index.ts","components/Auth/OneAccountPerEmailCard/OneAccountPerEmailCard.module.scss","components/Auth/OneAccountPerEmailCard/OneAccountPerEmailDialog.module.scss","components/Auth/UsersCard/UsersCard.module.scss","components/Auth/UsersCard/table/ProviderCell.module.scss","components/Database/DataViewer/ImportDialog.module.scss","components/Firestore/DocumentListItem.module.scss","components/Storage/Canvas/BucketPicker/BucketPicker.module.scss","components/Storage/Canvas/Canvas.module.scss","components/Storage/Canvas/DeleteAllButton/DeleteAllButton.module.scss","components/Storage/Card/SideBar/CustomMetadata/CustomMetadata.module.scss","components/Storage/Card/SideBar/StoragePreview/StoragePreview.module.scss","components/Storage/Card/Table/Header/StorageHeader/UploadButton/UploadButton.module.scss","components/Storage/Card/Table/ZeroState/ZeroState.module.scss","components/Storage/index.module.scss","components/Auth/index.module.scss","colors.tsx","store/auth/actions.tsx","components/common/EmulatorConfigProvider.tsx","components/common/icons.tsx","components/common/EmulatorDisabled.tsx","components/common/Spinner.tsx","store/utils.ts","store/auth/reducer.tsx","components/common/rest_api.ts","components/Auth/api.ts","store/auth/sagas.ts","store/index.ts","store/auth/selectors.ts","themes.tsx","components/Auth/OneAccountPerEmailCard/OneAccountPerEmailDialog.tsx","components/Auth/OneAccountPerEmailCard/OneAccountPerEmailCard.tsx","components/common/Callout.tsx","components/common/DialogQueue.tsx","components/Auth/UsersCard/ClearAll.tsx","components/Auth/UsersCard/confirmClearAllData.tsx","components/common/Field.tsx","components/Auth/UserFormDialog/controls/customClaimsValidation.ts","components/Auth/UserFormDialog/controls/CustomAttributes.tsx","components/Auth/UserFormDialog/controls/ImageUrlInput.tsx","components/Auth/UserFormDialog/controls/EmailPassword.tsx","components/Auth/UserFormDialog/controls/PhoneControl.tsx","components/Auth/UserFormDialog/controls/SignInMethod.tsx","components/Auth/UserFormDialog/UserForm.tsx","components/common/CardActionBar.tsx","components/Auth/UsersCard/header/AuthFilter.tsx","components/Auth/UsersCard/header/RefreshButton.tsx","components/Auth/UsersCard/header/AuthHeader.tsx","components/Auth/UsersCard/table/AuthZeroState.tsx","components/Auth/UsersCard/table/confirmDeleteUser.tsx","components/Auth/UsersCard/table/NoResults.tsx","components/Auth/types.ts","components/Auth/UsersCard/table/ProviderCell.tsx","components/Auth/UsersCard/table/UsersTable.tsx","components/Auth/UsersCard/UsersCard.tsx","components/Auth/index.tsx","firebase.ts","components/common/BreadCrumbs.tsx","components/common/InteractiveBreadCrumbBar.tsx","components/Database/api.ts","components/Database/DataViewer/common/view_model.ts","components/common/FileField.tsx","components/Database/DataViewer/ImportDialog.tsx","components/Database/DataViewer/common/fetch.ts","components/Firestore/models.ts","components/Firestore/utils.ts","components/Firestore/DocumentEditor/actions.ts","components/Firestore/DocumentEditor/BooleanEditor.tsx","components/Firestore/DocumentEditor/GeoPointEditor.tsx","components/Firestore/DocumentEditor/JsonEditor.tsx","components/Firestore/DocumentEditor/NumberEditor.tsx","components/Firestore/DocumentEditor/types.ts","components/Firestore/DocumentEditor/ReferenceEditor.tsx","components/Firestore/DocumentEditor/utils.ts","components/Firestore/DocumentEditor/store.tsx","components/Firestore/DocumentEditor/StringEditor.tsx","components/Firestore/DocumentEditor/TimestampEditor.tsx","components/Firestore/DocumentEditor/index.tsx","components/Firestore/DocumentPreview/InlineEditor.tsx","components/Database/DataViewer/NodeLink.tsx","components/Database/DataViewer/ValueDisplay.tsx","components/Database/DataViewer/NodeLeaf.tsx","components/Database/DataViewer/CloneDialog.tsx","components/Database/DataViewer/InlineQuery.tsx","components/Database/DataViewer/RenameDialog.tsx","components/Database/DataViewer/NodeTabularDisplay.tsx","components/Database/DataViewer/NodeActions.tsx","components/Database/DataViewer/NodeParent.tsx","components/Database/DataViewer/NodeContainer.tsx","components/Database/Database.tsx","components/Database/DatabasePicker.tsx","components/Database/DatabaseContainer.tsx","components/Database/index.tsx","components/Firestore/dialogs/clearAll.tsx","components/common/CopyButton.tsx","components/Firestore/actions.tsx","components/Firestore/store.tsx","components/Firestore/CollectionFilter/ConditionEntry.tsx","components/Firestore/CollectionFilter/ConditionEntries.tsx","components/Firestore/CollectionFilter/SortRadioGroup.tsx","components/Firestore/CollectionFilter/CollectionFilter.tsx","components/Firestore/dialogs/AddDocumentDialog.tsx","components/Firestore/DocumentListItem.tsx","components/common/useRequest.ts","components/Firestore/FirestoreEmulatedApiProvider.tsx","components/Firestore/PanelHeader.tsx","components/Firestore/useAutoSelect.tsx","components/Firestore/Collection.tsx","components/Firestore/dialogs/AddCollectionDialog.tsx","components/Firestore/dialogs/deleteCollection.tsx","components/Firestore/CollectionList.tsx","components/Firestore/dialogs/DeleteDocumentDialog.tsx","components/Firestore/dialogs/deleteDocumentFields.tsx","components/Firestore/DocumentPreview/api.tsx","components/Firestore/DocumentPreview/store.tsx","reconnectingWebSocket.ts","components/Firestore/DocumentPreview/FieldPreview.tsx","components/Firestore/DocumentPreview/index.tsx","components/Firestore/Document.tsx","components/Firestore/Requests/CopyPathNotification/index.tsx","components/Firestore/Requests/FirestoreRequestsProvider.tsx","components/Firestore/Requests/utils.ts","components/Firestore/Requests/RequestDetails/CodeViewer/AdminRequest.tsx","components/Firestore/Requests/RequestDetails/CodeViewer/mode.ts","components/Firestore/Requests/RequestDetails/CodeViewer/index.tsx","components/Firestore/Requests/RequestPath/index.tsx","components/Firestore/Requests/RequestDetails/Header/index.tsx","components/Firestore/Requests/RequestDetails/InspectionSection/InspectionBlock.tsx","components/Firestore/Requests/RequestDetails/InspectionSection/index.tsx","components/Firestore/Requests/RequestDetails/index.tsx","components/Firestore/Requests/RequestsCard/Table/NoResults.tsx","components/Firestore/Requests/RequestsCard/Table/TableRow.tsx","components/LogViewer/HighlightedJSON.tsx","components/Firestore/Requests/RequestsCard/Table/ZeroState.tsx","components/Firestore/Requests/RequestsCard/Table/index.tsx","components/Firestore/Requests/index.tsx","components/Firestore/index.tsx","components/Storage/common/constants.tsx","components/Home/LocalWarningCallout.tsx","components/common/constants.ts","components/Home/StatusLabel.tsx","components/Home/index.tsx","components/LogViewer/CompiledGetterCache.ts","components/LogViewer/QueryBar.tsx","components/LogViewer/History.tsx","components/LogViewer/index.tsx","components/Storage/api/useBucket.tsx","components/Storage/api/useBuckets.tsx","components/Storage/Canvas/BucketPicker/BucketPicker.tsx","components/common/asserts.ts","components/Storage/common/fileToStorageFile.ts","components/Storage/api/useCreateFolder.tsx","components/Storage/api/usePath.tsx","components/Storage/api/useStorageFiles.tsx","components/Storage/Canvas/DeleteAllButton/confirmDeleteAllFiles.tsx","components/Storage/Canvas/DeleteAllButton/DeleteAllButton.tsx","components/Storage/Canvas/Canvas.tsx","components/Storage/common/useMultiselect.ts","components/common/formatBytes.ts","components/Storage/common/StorageFileIcon/StorageFileIcon.tsx","components/common/Accordion.tsx","components/Storage/Card/SideBar/CustomMetadata/CustomMetadata.tsx","components/Storage/Card/SideBar/FileLocation/FileLocation.tsx","components/Storage/api/useTokens.tsx","components/Storage/Card/SideBar/StoragePreview/usePreviewUrl.ts","components/Storage/Card/SideBar/StoragePreview/StoragePreview.tsx","components/Storage/Card/SideBar/SideBar.tsx","components/Storage/Card/Table/Header/ActionHeader/ActionHeader.tsx","components/Storage/Card/Table/Header/StorageHeader/CreateFolder/CreateFolderDialog/CreateFolderDialog.tsx","components/Storage/Card/Table/Header/StorageHeader/CreateFolder/CreateFolder.tsx","components/Storage/Card/Table/Header/StorageHeader/UploadButton/UploadButton.tsx","components/Storage/Card/Table/Header/StorageHeader/StorageHeader.tsx","components/Storage/common/StorageFileIcon/StorageFolderIcon.tsx","components/Storage/Card/Table/ZeroState/ZeroState.tsx","components/Storage/Card/Table/Table.tsx","components/Storage/Card/TableDropzoneWrapper/TableDropzoneWrapper.tsx","components/Storage/Card/StorageCard.tsx","components/Storage/Card/useSelectedFile/useSelectedFile.tsx","components/Storage/providers/StorageFirebaseAppProvider.tsx","components/Storage/index.tsx","routes.ts","components/common/Logo.tsx","components/App/AppBar.tsx","components/App/AppDisconnected.tsx","components/App/index.tsx","index.tsx","configureStore.ts","components/Firestore/CollectionFilter/CollectionFilter.module.scss","components/Auth/UserFormDialog/controls/controls.module.scss","components/Storage/Card/Table/Table.module.scss","components/Auth/UsersCard/table/UsersTable.module.scss"],"names":["module","exports","hostAndPort","host","port","indexOf","primary","textBlackTertiary","grey100","updateAuthConfig","createAction","createUserRequest","createUserSuccess","updateUserRequest","updateUserSuccess","setUserDisabledRequest","setUserDisabledSuccess","deleteUserRequest","deleteUserSuccess","updateFilter","nukeUsersRequest","nukeUsersSuccess","authFetchUsersRequest","authFetchUsersSuccess","authFetchUsersError","setAllowDuplicateEmailsRequest","setAllowDuplicateEmailsSuccess","getAllowDuplicateEmailsRequest","openAuthUserDialog","setAuthUserDialogLoading","setAuthUserDialogError","clearAuthUserDialogData","emulatorConfigContext","React","createContext","undefined","CONFIG_API","useOnChangePromise","data","useState","oldData","deferred","makeDeferred","state","setState","useEffect","oldDeferred","resolve","promise","EmulatorConfigProvider","refreshInterval","children","useSwr","configFetcher","refreshWhenOffline","onErrorRetry","_","__","___","revalidate","retryCount","setTimeout","mutate","Provider","value","config","useConfig","context","useContext","Error","useEmulatorConfig","emulator","emulatorConfig","useIsEmulatorDisabled","useConfigOptional","jsonFetcher","url","a","fetch","response","ok","status","json","result","projectId","Object","entries","key","fixHostname","firestore","webSocketHost","Promise","res","window","location","hostname","FirestoreIcon","svgIcon","xmlns","viewBox","fill","d","fillRule","AuthIcon","DatabaseIcon","FunctionsIcon","HostingIcon","StorageIcon","PubSubIcon","cx","cy","r","DatabaseCircleIcon","clipRule","stroke","strokeOpacity","HintIcon","svgElement","size","props","icon","strategy","EmulatorDisabled","productName","desktop","tablet","phone","span","align","className","src","alt","use","tag","href","EmulatorOutdated","Spinner","message","cover","scrim","classnames","hasError","map","dataMapper","mapResult","remoteResult","loading","createRemoteDataLoaded","squash","mappers","onNone","onError","error","onData","handle","authReducer","createReducer","users","filter","allowDuplicateEmails","handleAction","authActions","produce","draft","payload","user","localId","u","disabled","authUserDialogData","ResponseError","RestApi","accessToken","method","headers","this","getToken","body","JSON","stringify","Authorization","jsonRequest","file","toFormData","append","text","formData","FormData","importUser","match","passwordHash","PASSWORD_HASH_REGEX","password","providerUserInfo","AuthApi","baseUrl","baseEmulatorUrl","deleteRequest","userInfo","length","fetchUser","patchRequest","signIn","fetchAuthUsers","initAuth","deleteUser","createUser","updateUser","setUserDisabled","setAllowDuplicateEmails","getAllowDuplicateEmails","nukeUsers","configureAuthSaga","authSaga","call","authApi","put","AUTH_API_CONTEXT","setContext","auth","all","takeLatest","getType","customAttributes","keepDialogOpen","disableUser","getContext","api","rootSaga","fork","rootReducer","combineReducers","createStructuredSelector","selectors","reselect","Type","getAuth","getAuthUsers","createSelector","getAuthUserDialog","getCurrentEditedUser","isEditingUser","getUsers","defaultValue","sort","b","Number","Date","createdAt","getAllEmails","Set","email","e","getAllPhoneNumbers","phoneNumber","hasUsers","getFilter","getFilteredUsers","displayName","join","toLocaleUpperCase","includes","getShowZeroState","getShowZeroResults","filteredUsers","getShowTable","mapStateToProps","connect","dispatch","onClose","setValue","renderToPortal","open","onSubmit","preventDefault","styles","description","checked","onChange","onClick","action","type","theme","unelevated","setOpen","wrapper","target","rel","outlined","tipTheme","background","primaryRgb","textIconOnBackground","textPrimaryOnBackground","textSecondaryOnBackground","teal700","teal800","successTheme","navy300","navy600","noteTheme","amber800","deepOrange900","cautionTheme","onPrimary","red700","red800","errorTheme","THEME_MAP","CAUTION","NOTE","SUCCESS","TIP","WARNING","CustomThemeProvider","wrap","options","DEFAULT_ICON_MAP","Callout","actions","aside","iconName","asideClass","classes","aria-hidden","createDialogQueue","dialogs","confirm","alert","prompt","clearAllData","clearAllButton","title","acceptLabel","cancelLabel","footer","isDefaultAction","danger","Field","fieldClassName","label","tip","fullwidth","textFieldProps","randomId","id","subtextId","htmlFor","aria-describedby","invalid","aria-invalid","role","SelectField","selectProps","assert","assertion","BadRequestError","validateSerializedCustomClaims","claims","parsed","parse","Array","isArray","FORBIDDEN_CUSTOM_CLAIMS","reservedField","validateCustomClaims","validate","attributes","forbiddenClaim","ImagePreviewStatus","CUSTOM_ATTRIBUTES_CONTROL_NAME","CustomAttributes","errors","register","customAttributesWrapper","inputRef","name","textarea","placeholder","ImageUrlInput","watch","triggerValidation","ImageConstructor","Image","previewUrl","setPreviewUrl","image","useRef","imageUrlRef","NONE","photoUrl","img","current","onload","LOADING","LOADED","onerror","ERROR","trim","imageWrapper","aria-busy","aria-live","data-testid","EMAIL_REGEX","getErrorText","emailpassword","allEmails","isEditing","setError","clearError","editedUserEmail","authKindLabel","emailWrapper","has","pattern","minLength","PHONE_REGEX","allPhoneNumbers","editedUserPhoneNumber","ERROR_AT_LEAST_ONE_METHOD_REQUIRED","SignInMethod","form","formState","isTouched","touched","isOnlyError","values","signInWrapper","signInHeader","useForm","defaultValues","mode","save","useCallback","handleSubmit","reset","canSubmit","isValid","submit","CardActionBar","surface","CardActionBarActions","style","flex","f","clear","filterEl","useLayoutEffect","focus","filterForm","input","aria-label","ripple","filterTextField","trailingIcon","onKeyDown","keyCode","keycode","refresh","AuthHeader","onOpenNewUserDialog","barActions","addUserButton","AuthZeroState","noResultsWrapper","confirmDeleteUser","NoResults","providerToIconMap","oidc","saml","ProviderCell","iconWrapper","providerInfo","provider","providerId","UsersTableRow","onEditUser","toggleUserDisabled","onDeleteUser","menuOpen","setMenuOpen","formattedCreatedAt","toLocaleDateString","formattedSignedIn","lastLoginAt","width","onOpen","shouldShowTable","shouldShowZeroResults","shouldShowZeroState","tableWrapper","AuthRoute","fallback","AuthWrapper","z","AuthRouteSuspended","initDatabase","namespace","databaseURL","app","firebase","initializeApp","Math","random","applyAdminAuth","db","database","console","log","cleanup","delete","useEmulatedFirebaseApp","initialize","setApp","catch","mockAuthComponent","Component","getUid","addAuthTokenListener","listener","removeAuthTokenListener","_addOrOverwriteComponent","EMPTY_KEYS","BreadCrumbs","base","path","onEdit","homeElement","normalizedPath","startsWith","substr","keys","split","hrefs","reduce","acc","prevLink","push","to","i","decodeURIComponent","InteractiveBreadCrumbBar","onNavigate","inputPrefix","breadCrumbProps","setIsEditing","handleCancel","useKey","eventTypes","when","select","onBlur","currentTarget","DatabaseApi","ref","params","URLSearchParams","ns","access_token","writeSizeLimit","disableTriggers","set","getUploadPath","toString","postFile","URL","pathname","replace","ChildrenDisplayType","FileField","onFiles","accept","useDropzone","onDrop","isDragActive","getRootProps","getInputProps","isDragReject","ImportDialog","reference","onComplete","droppedFile","functionsEmulatorRunning","functions","setFile","executeFunctions","setExecuteFunctions","isImporting","setIsImporting","importFile","container","required","files","event","DEFAULT_PAGE_SIZE","DEFAULT_QUERY_PARAMS","limit","jsonIshValue","getDbRootUrl","NO_CHILDREN","ADMIN_AUTH_HEADERS","createViewModel","canDoRealtime$","query","ReplaySubject","next","viewModel$","pipe","switchMap","queryParams","concatMap","realtime","from","once","snap","hasChildren","toObservable","applyQuery","val","isRealtime","isLoading","realtimeToViewModel","realtimeRef","operator","orderBy","limitToFirst","equalTo","endAt","startAt","getRestQueryParams","shallow","restUrl","defer","fetchNonRealtime","nonRealtimeToViewModel","Observable","o","handler","on","snapshot","off","orderByChild","rootUrl","encodeURIComponent","FieldType","isSingleValueCollectionFilter","cf","isMultiValueCollectionFilter","isSortableCollectionFilter","NUMBER_REGEX","getParentPath","slice","lastFieldName","getFieldType","NULL","Timestamp","TIMESTAMP","ARRAY","DocumentReference","REFERENCE","GeoPoint","GEOPOINT","Blob","BLOB","MAP","isBoolean","isTimestamp","isNumber","isMap","isPrimitive","withFieldSet","parent","get","withFieldRemoved","splice","summarize","maxLen","summarizeArray","summarizeMap","base64","toBase64","BOOLEAN","summarizeLatLng","latitude","longitude","NUMBER","STRING","summarizeDate","toDate","date","array","summarizeElement","output","element","summarizeValue","compareFirestoreKeys","lat","abs","long","fieldA","fieldB","localeCompare","addToMap","addToArray","removeFromMap","removeFromArray","updateName","updateType","updateValue","BooleanEditor","GeoPointEditor","String","setLatitude","setLongitude","useFormContext","unregister","latitudeName","longitudeName","min","max","geoPoint","step","JsonEditor","initialValue","handleChange","NumberEditor","parseFloat","DocumentPath","isFirestoreMap","isFirestoreArray","isNativePrimitive","isMapField","field","isArrayField","isJSONField","assertStoreHasRoot","store","uuid","assertIsMapField","assertIsArrayField","ReferenceEditor","useFirestore","doc","getUniqueId","normalize","mapChildren","fields","child","valueId","normalizeMap","arrayChildren","normalizeArray","normalizePrimitive","denormalize","curr","defaultValueForPrimitiveType","fromDate","getDescendantIds","ids","c","documentStoreContext","reducer","normalized","find","childId","childField","isJson","assertIsPrimitiveField","storeReducer","handlers","DocumentStore","useDocumentStore","useStore","useDispatch","useField","StringEditor","dateToLocale","year","getFullYear","month","getMonth","padStart","dateOfMonth","getDate","hours","getHours","minutes","getMinutes","seconds","getSeconds","TimestampEditor","setDate","isNaN","toMillis","getTime","timestamp","FIRESTORE_FIELD_TYPES","FIRESTORE_ARRAY_FIELD_TYPES","ft","RTDB_FIELD_TYPES","supportedFieldTypeSet","FieldEditor","isRtdb","areNamesMutable","areFieldsMutable","startingIndex","supportNestedArrays","allowedChildTypes","readonly","allowedTypes","index","valueEditor","isGeoPoint","ChildTypeSelect","getDocumentFieldType","NameEditor","formName","siblingNames","useMemo","isUnique","every","DocumentEditor","areRootNamesMutable","areRootFieldsMutable","rtdb","initialState","useReducer","methods","denormalizedStore","errorCount","InlineEditor","onCancel","onSave","areRootKeysMutable","internalValue","setInternalValue","onClickOutside","onEscapeKey","scrollLock","stopPropagation","NodeLink","dbRef","absolutePath","useRouteMatch","withoutPath","matchPath","strict","useHrefWithinSameRoute","Link","ValueDisplay","otherProps","trimmedValue","getClass","NodeLeaf","isAdding","setIsAdding","handleEdit","handleEditSuccess","handleAddSuccess","handleDelete","remove","showAddButton","content","getAbsoluteRefPath","CloneDialog","hasQuery","originalKey","newDestinationPath","setNewDestinationPath","setForm","setIsLoading","isCloningWithFiltered","setCloningFiltered","forEach","loadData","updateField","root","InlineQuery","setValues","keyInputRef","valueInputRef","toParams","TableType","RenameDialog","isOpen","newKey","update","getNextDisplayType","Table","TreeView","getToggleIcon","ACTIVE_ICON","color","NodeActions","displayType","onDisplayTypeChange","updateQuery","onExpandRequested","isMenuOpen","showQueryUi","setShowQueryUi","cloneDialogIsOpen","setCloneDialogIsOpen","renameDialogIsOpen","setRenameDialogIsOpen","isActive","isRoot","pushId","removeNode","potentialQuery","onIcon","NodeTabularDisplay","hasMoreRows","onLoadMore","rows","table","setTable","buildTable","header","row","idx","colIndex","pkId","KeyValue","getColumnValue","colSpan","getTableType","getHeaders","parseInt","KeyObject","NodeParent","isViewRoot","isExpanded","setIsExpanded","setDisplayType","hasMore","loadMore","currentPageSize","toggleExpansion","NodeContainer","viewModel","setViewModel","querySubject","setQuerySubject","silent","print","timeout","mapTo","catchError","of","shareReplay","bufferSize","refCount","canDoRealtime","sub","subscribe","vm","unsubscribe","setQueryParams","q","getPrefix","substring","Database","setRef","setApi","history","useHistory","importDialogOpen","setImportDialogOpen","setDroppedFile","urlBase","newPath","DatabaseDropZone","noClick","isDragAccept","DatabaseListItem","navigation","activated","DatabasePicker","databases","secondaryDbs","pickerClassName","DatabaseContainer","dbs","setDbs","hasNewDbs","fetchDatabases","statusText","databaseInfos","DatabaseContainerWrapper","initialData","DatabaseRoute","DatabaseRouteContent","exact","render","dbPath","DatabaseRouteSuspended","promptClearAll","useClipboard","isTextCopied","setIsTextCopied","writeText","navigator","clipboard","then","CopyButton","textToCopy","addCollectionFilter","removeCollectionFilter","INIT_STATE","collectionFilters","firestoreStoreContext","FirestoreStore","initState","useFirestoreStore","useCollectionFilter","ConditionEntry","memo","getConditionEntryType","fieldType","setFieldType","conditionEntry","evt","conditionEntryType","as","conditionEntryValue","rules","BooleanCondition","selectValue","ConditionEntries","useFieldArray","conditionEntries","conditionName","removeFilter","hidden","SortRadioGroup","CollectionFilter","collectionFilter","formMethods","nest","preview","defaultOpen","CollectionFilterTheme","ConditionPreview","Preview","collectionId","pop","previewFilter","ConditionSelect","FilterItem","expanded","setExpanded","listItem","headerTitle","metaIcon","AddDocumentStep","collectionRef","setId","setData","getValue","invalidData","AddDocumentDialog","onValue","dialogProps","document","setDocument","detail","DocumentListItem","docId","queryFieldValue","missing","listItemClass","classNames","NavLink","activeClassName","useFetcher","onSuccess","useRequest","fetcher","suspense","FIRESTORE_OPTIONS","FirestoreEmulatedApiProvider","disableDevTools","useEmulator","firebaseApp","FirestoreDevTools","windowWithFirestore","useFirestoreRestApi","databaseId","DOCUMENT_PATH_RE","useRecursiveDelete","encodedPath","encodePath","uri","PanelHeader","FIRESTORE_DATA_URL","FIRESTORE_DATA_URL_PATH_LENGTH","useAutoSelect","list","useLocation","autoSelect","setAutoSelect","isRootOrRootCollection","hasNothingSelected","firstChild","NO_DOCS","CollectionLoading","collection","Presentation","Step","Collection","addDocument","docs","missingDocs","recursiveDelete","setIsMenuOpen","isFilterOpen","setIsFilterOpen","isAddDocumentDialogOpen","setAddDocumentDialogOpen","handleDeleteCollection","badge","dense","Button","twoLine","docRef","newDocumentId","setNewDocumentId","filteredCollection","where","applyCollectionFilter","collectionSnapshot","useFirestoreCollection","documents","createTime","exec","useMissingDocuments","redirectIfAutoSelectable","AddCollectionStep","documentRef","AddCollectionDialog","COLLECTION","setStep","setCollectionId","DOCUMENT","RootCollectionList","rootCollections","collectionIds","useRootCollections","collections","SubCollectionList","subCollections","useSubCollections","CollectionList","isAddCollectionDialogOpen","setAddCollectionDialogOpen","addCollection","newCollection","encodedCollectionId","encodedReferencePath","coll","routeMatchUrl","CollectionListItem","DeleteDocumentDialog","onConfirm","recursive","setRecursive","promptDeleteDocumentFields","DELETE_FIELD","FieldValue","documentData","adjustPayloadForArray","addFieldToMissingDocument","exists","fieldPath","cur","parentPath","pathToUpdate","FieldPath","childPath","isEqual","DocumentStateContext","DocumentProvider","useDocumentState","useFieldState","documentState","ExpressionValueStateContext","ExpressionValueStateProvider","summarizeExp","boolValue","summarizeNumber","intValue","floatValue","stringValue","fromBase64String","bytesValue","durationValue","timestampValue","latlngValue","listValue","mapValue","summarizePath","pathValue","causeMessage","warn","segments","seg","simple","capture","boundValue","variableName","globCapture","summarizeSegment","summarizeConstraint","unknown","simpleConstraints","firstCondition","conditions","constraint","comparator","valueStr","COMPARATOR_DISP","WebSocketState","EQ","NEQ","GT","GTE","LT","LTE","FieldPreview","maxSummaryLen","childComponent","ChildComponent","exprState","childPaths","summary","toISOString","typeDisp","constraintValue","useFieldInfo","EditableFieldPreview","parentState","isAddingField","setIsAddingField","deleteField","DocumentWarning","DocumentPreview","useFirestoreDoc","docExists","docEmpty","Doc","collectionById","Root","Document","isDeleteDocumentDialogOpen","setDeleteDocumentDialogOpen","handleDeleteFields","CopyPathNotification","showCopyNotification","setShowCopyNotification","ReconnectingWebSocket","wsUrl","DISCONNECTED","interval","ws","setInterval","WebSocket","PENDING","onopen","CONNECTED","onclose","onmessage","msg","clearInterval","close","firestoreRequestsContext","FirestoreRequestsProvider","requests","setRequests","webSocketPort","webSocket","newEvaluation","isCurrentProject","evaluation","rulesReleaseName","useFirestoreRequests","ICON_SELECTOR","allow","deny","admin","OUTCOME_DATA","usePathContainerWidth","pathContainerRef","pathContainerWidth","setPathContainerWidth","getPathContainerWidth","offsetWidth","debouncedHandleWindowResize","debounce","addEventListener","removeEventListener","CodeViewerAdminRequest","FIREBASE_RULES_KEYWORD_REGEX","FIREBASE_RULES_VARIABLE_REGEX","FIREBASE_RULES_ATOM_REGEX","FIREBASE_RULES_COMMENT_REGEX","FIREBASE_RULES_OPERATOR_REGEX","FIREBASE_RULES_NUMBER_REGEX","FIREBASE_RULES_MISC_REGEX","FIREBASE_RULES_STRING_REGEX","MODE_FIREBASE_RULES","defineFirebaseRulesMode","CodeMirror","defineSimpleMode","start","regex","token","comment","meta","dontIndentStates","lineComment","CODE_VIEWER_CUSTOM_STYLES","CODE_MIRROR_OPTIONS","tabSize","indentUnit","lineNumbers","keyMap","readOnly","gutters","RulesCodeViewer","firestoreRules","linesOutcome","isAdminRequest","display","cm","fromTextArea","setSize","line","rulesOutcome","outcome","setGutterMarker","marker","createElement","textContent","getMarkerElement","addLineClass","RequestPath","resourcePath","requestPathContainerWidth","pathTextRef","copyButtonRef","prevPathContainerWidth","setPrevPathContainerWidth","pathTextElement","copyButtonElement","fullRequestPath","pathHtmlElement","pathTextString","pathTextWidth","copyIconButtonWidth","totalPathCharacters","pathCharacterPxWidth","pathHtmlElementAvailableWidth","newPathMaxCharacters","floor","newPathStart","newTruncatedPathString","truncateRequestPathFromLeft","enterDelay","copyPathToClipboard","RequestDetailsHeader","requestTimeComplete","requestTimeFormatted","requestMethod","outcomeData","INSPECT_BLOCK_CLASS","InspectionBlock","isMainBlock","textIconOnLight","InspectionSection","inspectionExpressions","nullValue","getLinesOutcome","granularAllowOutcomes","issues","getInspectionExpressions","rulesContext","inspections","request","resource","RequestDetails","selectedRequest","requestId","requestDate","time","toLocaleString","toLocaleTimeString","hour12","getDetailsRequestData","RequestDetailsWrapper","req","RequestsNoResults","HierarchyReferenceMode","RequestTableRow","getTableRowRequestData","RequestsZeroState","TABLE_CLASS","RequestsTable","filteredRequests","RequestsTableWrapper","evaluations","filteredEvaluations","Requests","useIsFirestoreRequestsAvailable","FirestoreRoute","firestoreRoutes","Firestore","isRefreshing","setIsRefreshing","eject","useEjector","showCollectionShell","showDocumentShell","subTabs","activeTabIndex","findIndex","handleNavigate","handleClearData","FirestoreDataCard","FirestoreRequestsCard","FirestoreRouteSuspended","storagePath","DISMISS_KEY","LocalWarningCallout","useLocalStorage","writeStorage","INACTIVE_ICON","StatusLabel","Home","Overview","linkTo","testId","linkLabel","storage","hosting","linkToExternal","pubsub","EmulatorCard","CompiledGetterCache","getters","obj","Function","err","toHierarchyStep","DOT","BRACKET","toHierarchyJS","hierarchy","INCREMENT","HighlightedJSON","appendToQuery","compiledGetters","lines","isObject","pluck","getOrCompile","elements","quote_count","isStart","isEnd","endsWith","isEmptyArray","isEmptyObj","isKeyedObjStart","isKeyedArrayStart","isKeylessArrayStart","isKeylessObjStart","isLiteral","isObjEnd","isArrayEnd","splat","indent","v","hierarchy_chain","new_indent","queryFields","parseQuery","escapedQuery","isEscaped","char","sections","t","filters","queryChunks","position","quoted_section","section","isKeyPair","pairKey","search","QueryBar","setQuery","temporaryQuery","setTemporaryQuery","parsedQuery","spellCheck","FilterTag","tagButton","metadata","function","History","logs","originalFieldPath","toLowerCase","fieldValue","isQueryMatch","messagesEndRef","scrollIntoView","formattedQueryLines","filtersToQueryString","getUserData","level","toUpperCase","LogViewer","qs","useQuery","setLogs","logging","useBucket","useParams","bucket","useBuckets","items","useSWR","BucketPicker","buckets","setBucket","bucketPicker","fileToStorageFile","folder","contentType","fullPath","uploading","updated","toUTCString","timeCreated","customMetadata","EMPTY_FOLDER_DATA","usePath","fileRef","getMetadata","importFolder","useStorageFiles","useStorage","setPath","createFolder","useCreateFolder","getLocation","getCurrentRef","refFromURL","bucketHasAnyFiles","listAll","prefixes","deleteFile","deleteFolder","prefixesPromise","prefix","filesPromise","deleteAllFiles","uploadFiles","deleteFiles","paths","getDownloadURL","click","uploadedFiles","folderName","names","oldFiles","newFiles","openAllFiles","pathsSet","remainingFiles","DeleteAllButton","DeleteAllButtonWithHooks","DeleteAllButtonUnwrapped","StorageCanvas","canvasWrapper","useMultiselect","selectedValue","setSelected","useSelected","selected","stack","setStack","removeFromStack","item","toggleAllItems","shouldSelect","add","addToStack","allSelected","allIndeterminate","isSelected","toggleSingle","toggleContinuous","item1","item2","index1","index2","numberOfItems","firstIndex","findBetween","clearAll","toggleAll","formatBytes","bytes","threshold","round","units","formattedBytes","num","parts","toFixed","formatNumber","MIME_TYPE_ICON_MAP","getFileIcon","StorageFileIcon","Accordion","isAccordionExpanded","setIsAccordionExpanded","contentId","headerId","accordion","tabIndex","aria-controls","aria-expanded","aria-labelledby","CustomMetadata","Fragment","FileLocation","downloadTokens","tokens","createToken","deleteToken","useTokens","MIME_TYPES_FOR_PREVIEW","shouldShowPreview","StoragePreview","StoragePreviewUnwrapped","usePreviewUrl","formatDate","dateString","SideBar","closeSidebar","sideBarWrapper","headerWrapper","headerTitleWrapper","fileName","openFileLink","ActionHeader","selection","areFoldersSelected","some","selectionIncludesFolders","actionBar","actionHeaderWrapper","actionHeaderLabel","openButton","deleteButton","CreateFolderDialog","s","setName","maxLength","CreateFolder","shouldShowDialog","setShouldShowDialog","UploadButton","uploadButton","StorageHeader","bucketRoot","storageHeaderActionBarWrapper","storageHeaderWrapper","breadcrumbWrapper","StorageFolderIcon","ZeroState","zeroStateWrapper","StorageTable","selectFile","selectedFile","hasFormControl","checkboxColumn","indeterminate","lastModified","columnUploading","StorageFileTableRow","fileNameId","navigate","link","TableDropzoneWrapper","noKeyboard","dropzoneWrapper","dropWrapper","StorageCard","setSelectedFile","useSelectedFile","gridWrapper","tableCell","FIREBASE_APP_OPTIONS","StorageFirebaseAppProvider","StorageWrapper","storageWrapper","StorageRoute","StorageRouteSuspended","routes","component","showInNav","Auth","LogsViewer","Logo","height","x1","y1","x2","y2","gradientTransform","gradientUnits","offset","stopColor","stopOpacity","clipPath","opacity","fillOpacity","AppBar","navRoutes","tabs","onSurface","fixed","AppDisconnected","preventOutsideDismiss","App","composeEnhancers","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","compose","sagaMiddleware","createSagaMiddleware","createStore","applyMiddleware","run","configureStore","RouterWithInit","ReactDOM","unstable_createBlockingRoot","getElementById","StrictMode","secondary"],"mappings":"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","file":"static/js/main.26defe06.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"sideBarWrapper\":\"SideBar_sideBarWrapper__2U4fA\",\"metadata\":\"SideBar_metadata___54TG\",\"headerTitleWrapper\":\"SideBar_headerTitleWrapper__36Cab\",\"headerWrapper\":\"SideBar_headerWrapper__1g-KA\",\"fileName\":\"SideBar_fileName__2RdXQ\",\"openFileLink\":\"SideBar_openFileLink__3atYO\",\"location\":\"SideBar_location__3lF4q\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"accordion\":\"Accordion_accordion__twLFS\",\"header\":\"Accordion_header__15Xue\",\"content\":\"Accordion_content__OG25e\",\"icon\":\"Accordion_icon__1VWct\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"actionHeaderWrapper\":\"ActionHeader_actionHeaderWrapper__839fT\",\"actionHeaderLabel\":\"ActionHeader_actionHeaderLabel__eo4Zi\",\"actionBar\":\"ActionHeader_actionBar__2g6vj\",\"openButton\":\"ActionHeader_openButton__1VI3W\",\"deleteButton\":\"ActionHeader_deleteButton__3qlcp\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"storageHeaderWrapper\":\"StorageHeader_storageHeaderWrapper__37Mrt\",\"breadcrumbWrapper\":\"StorageHeader_breadcrumbWrapper__2_8zz\",\"wrapper\":\"StorageHeader_wrapper__2TGQ0\",\"storageHeaderActionBarWrapper\":\"StorageHeader_storageHeaderActionBarWrapper__4UmmL\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"icon\":\"StorageIcon_icon__3v1AK\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"query-panel\":\"Collection_query-panel__1MziT\",\"button-wrapper\":\"Collection_button-wrapper__3gNP-\",\"badge\":\"Collection_badge__B5KHa\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"metadata\":\"FileLocation_metadata__pnhC3\",\"token\":\"FileLocation_token__1vQVl\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"tableWrapper\":\"StorageCard_tableWrapper__thHA2\",\"gridWrapper\":\"StorageCard_gridWrapper__2KCyf\",\"tableCell\":\"StorageCard_tableCell__3fLyU\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"image\":\"UserFormDialog_image__1Z6Cw\",\"loading\":\"UserFormDialog_loading__nfVD8\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"filterForm\":\"AuthFilter_filterForm__W0zqx\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"barActions\":\"AuthHeader_barActions__3eROi\",\"addUserButton\":\"AuthHeader_addUserButton__35cpq\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"StatusLabel_container__2Y6KW\",\"icon\":\"StatusLabel_icon__34nuE\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"dropzoneWrapper\":\"TableDropzoneWrapper_dropzoneWrapper__2KM6n\",\"dropWrapper\":\"TableDropzoneWrapper_dropWrapper__22gIh\"};","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport * from './types';\n\nexport function hostAndPort(host: string, port: number | string): string {\n  // Correctly put IPv6 addresses in brackets.\n  return host.indexOf(':') >= 0 ? `[${host}]:${port}` : `${host}:${port}`;\n}\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"OneAccountPerEmailCard_wrapper__3fZZe\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"description\":\"OneAccountPerEmailDialog_description__HG1Vb\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"clearAllButton\":\"UsersCard_clearAllButton__23izn\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"iconWrapper\":\"ProviderCell_iconWrapper__2KYaU\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"ImportDialog_container__3M_uy\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"missing\":\"DocumentListItem_missing__2gbCW\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"bucketPicker\":\"BucketPicker_bucketPicker__bpVJM\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"canvasWrapper\":\"Canvas_canvasWrapper__3idKa\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"deleteAllFiles\":\"DeleteAllButton_deleteAllFiles__3f148\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"list\":\"CustomMetadata_list__3jAMI\",\"metadata\":\"CustomMetadata_metadata__277Xi\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"preview\":\"StoragePreview_preview__1ISx6\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"uploadButton\":\"UploadButton_uploadButton__3NOLi\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"zeroStateWrapper\":\"ZeroState_zeroStateWrapper__115-W\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"storageWrapper\":\"Storage_storageWrapper__3CLAv\",\"spinnerWrapper\":\"Storage_spinnerWrapper__Q6i7e\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"sign-in-quota\":\"Auth_sign-in-quota__XoMrq\"};","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nexport const background = '#F6F7F9';\nexport const primary = '#681DA8'; // Google Purple 900.\nexport const secondary = 'rgba(0, 0, 0, .54)';\nexport const textBlackTertiary = 'rgba(0, 0, 0, .38)';\n\nexport const grey100 = '#F5F5F5';\n\nexport const navBarPrimary = '#D7AEFB'; // Google Purple 200.\nexport const navBarSurface = '#0c2d48'; // Navy 700\nexport const navBarOnSurface = '#FFF';\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createAction } from 'typesafe-actions';\n\nimport { AddAuthUserPayload, AuthUser } from '../../components/Auth/types';\nimport { AuthConfig } from '../config';\nimport { RemoteResult } from '../utils';\n\nexport const updateAuthConfig = createAction('@auth/UPDATE_AUTH_CONFIG')<{\n  projectId: string;\n  auth: AuthConfig;\n} | null>();\n\nexport const createUserRequest = createAction('@auth/CREATE_USER_REQUEST')<{\n  user: AddAuthUserPayload;\n  keepDialogOpen?: boolean;\n}>();\n\nexport const createUserSuccess = createAction('@auth/CREATE_USER_SUCCESS')<{\n  user: AuthUser;\n}>();\n\nexport const updateUserRequest = createAction('@auth/UPDATE_USER_REQUEST')<{\n  user: AddAuthUserPayload;\n  localId: string;\n}>();\n\nexport const updateUserSuccess = createAction('@auth/UPDATE_USER_SUCCESS')<{\n  user: AuthUser;\n}>();\n\nexport const setUserDisabledRequest = createAction(\n  '@auth/SET_USER_DISABLED_REQUEST'\n)<{\n  localId: string;\n  disabled: boolean;\n}>();\n\nexport const setUserDisabledSuccess = createAction(\n  '@auth/SET_USER_DISABLED_SUCCESS'\n)<{\n  localId: string;\n  disabled: boolean;\n}>();\n\nexport const deleteUserRequest = createAction('@auth/DELETE_USER_REQUEST')<{\n  localId: string;\n}>();\n\nexport const deleteUserSuccess = createAction('@auth/DELETE_USER_SUCCESS')<{\n  localId: string;\n}>();\n\nexport const updateFilter = createAction('@auth/UPDATE_FILTER')<{\n  filter: string;\n}>();\n\nexport const nukeUsersRequest = createAction('@auth/NUKE_USERS_REQUEST')();\n\nexport const nukeUsersSuccess = createAction('@auth/NUKE_USERS_SUCCESS')();\n\nexport const authFetchUsersRequest = createAction(\n  '@auth/AUTH_FETCH_USERS_REQUEST'\n)();\n\nexport const authFetchUsersSuccess = createAction(\n  '@auth/AUTH_FETCH_USERS_SUCCESS'\n)<AuthUser[]>();\n\nexport const authFetchUsersError = createAction(\n  '@auth/AUTH_FETCH_USERS_ERROR'\n)<{ message: string }>();\n\nexport const setAllowDuplicateEmailsRequest = createAction(\n  '@auth/SET_ALLOW_DUPLICATE_EMAILS_REQUEST'\n)<boolean>();\n\nexport const setAllowDuplicateEmailsSuccess = createAction(\n  '@auth/SET_ALLOW_DUPLICATE_EMAILS_SUCCESS'\n)<boolean>();\n\nexport const getAllowDuplicateEmailsRequest = createAction(\n  '@auth/GET_ALLOW_DUPLICATE_EMAILS_REQUEST'\n)();\n\nexport const getAllowDuplicateEmailsSuccess = createAction(\n  '@auth/GET_ALLOW_DUPLICATE_EMAILS_SUCCESS'\n)<boolean>();\n\nexport const openAuthUserDialog = createAction(\n  '@auth/SET_AUTH_USER_DIALOG_DATA'\n)<RemoteResult<AuthUser | undefined>>();\n\nexport const setAuthUserDialogLoading = createAction(\n  '@auth/SET_AUTH_USER_DIALOG_DATA_LOADING'\n)<boolean>();\n\nexport const setAuthUserDialogError = createAction(\n  '@auth/SET_AUTH_USER_DIALOG_DATA_ERRORS'\n)<string | undefined>();\n\nexport const clearAuthUserDialogData = createAction(\n  '@auth/CLEAR_AUTH_USER_DIALOG_DATA'\n)();\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useEffect, useState } from 'react';\nimport useSwr, { mutate } from 'swr';\n\nimport { Config, Emulator, hostAndPort } from '../../store/config';\n\nconst emulatorConfigContext = React.createContext<\n  | {\n      config?: Config | null;\n      promise: Promise<Config | null | undefined>;\n    }\n  | undefined\n>(undefined);\n\nconst CONFIG_API = '/api/config';\n\n/**\n * Returns a promise that resolves when the data changes.\n *\n * Note: When the argument passed !== previously passed, the previously returned\n * promise is resolved and a new pending promise is returned (resolved on the\n * next change).\n *\n * @example\n *   const data = useMyAwesomeDataThatMayChange();\n *   const promise = useOnChangePromise(data);\n *   if (!someCondition(data)) throw promise; // use with <Suspense>\n */\nexport function useOnChangePromise<T>(data: T): Promise<T> {\n  // Use only one single state to prevent accidental partial updates.\n  const [state, setState] = useState(() => ({\n    oldData: data,\n    deferred: makeDeferred<T>(),\n  }));\n\n  useEffect(() => {\n    if (data !== state.oldData) {\n      const oldDeferred = state.deferred;\n      setState({\n        oldData: data,\n        deferred: makeDeferred<T>(),\n      });\n      oldDeferred.resolve(data);\n    }\n  }, [data, state, setState]);\n  return state.deferred.promise;\n}\n\nexport const EmulatorConfigProvider: React.FC<{ refreshInterval: number }> = ({\n  refreshInterval,\n  children,\n}) => {\n  // We don't use suspense here since the provider should never be suspended --\n  // it merely creates a context for hooks (e.g. useConfig) who do suspend.\n  const { data } = useSwr<Config | null>(CONFIG_API, configFetcher, {\n    // Keep refreshing config to detect when emulators are stopped or restarted\n    // with a different config (e.g. different emulators or host / ports).\n    refreshInterval,\n\n    // Emulator UI works fully offline. Even if the browser cannot reach LAN or\n    // any router, this page and the CONFIG_API will still work if they are on\n    // the same physical device (e.g. localhost/127.0.0.1/containers/VMs). See:\n    // https://developer.mozilla.org/en-US/docs/Web/API/NavigatorOnLine/onLine\n    refreshWhenOffline: true,\n    onErrorRetry(_, __, ___, revalidate, { retryCount }) {\n      if (retryCount < 2) {\n        // If the Emulator Hub is running locally, we are very unlikely to get\n        // any errors at all. However, an occasional blip may happen when using\n        // Emulator UI remotely (or through port forwarding). Let's retry once.\n        // Note that swr will keep `data` while retrying, so UI won't unload.\n        // (This overwrites swr's built-in exponential backoff timeouts.)\n        setTimeout(() => revalidate({ retryCount }), refreshInterval);\n      } else {\n        // We cannot reach the discovery API for 2+ times. This usually means\n        // Emulator Hub is stopped or unreachable. swr won't clear data on error\n        // so we manually set data to null to represent this situation.\n        // Tell swr to revalidate (retry the fetch). No need for setTimeout.\n        mutate(CONFIG_API, null, /* shouldRevalidate= */ true);\n      }\n    },\n  });\n\n  const promise = useOnChangePromise(data);\n\n  return (\n    <emulatorConfigContext.Provider\n      value={{\n        config: data,\n        promise,\n      }}\n    >\n      {children}\n    </emulatorConfigContext.Provider>\n  );\n};\n\nexport const TestEmulatorConfigProvider: React.FC<{\n  config: Config | null | undefined;\n}> = ({ config, children }) => {\n  const promise = useOnChangePromise(config);\n  return (\n    <emulatorConfigContext.Provider\n      value={{\n        config,\n        promise,\n      }}\n    >\n      {children}\n    </emulatorConfigContext.Provider>\n  );\n};\n\nexport function useConfig(): Config {\n  const context = React.useContext(emulatorConfigContext);\n  if (context === undefined) {\n    throw new Error('useConfig must be used within a <EmulatorConfigProvider>');\n  }\n  if (context.config === undefined) {\n    // Loading. Throw the promise to suspend rendering (to support <Suspense>).\n    throw context.promise;\n  } else if (context.config == null) {\n    // Emulator Suite is disconnected / unreachable.\n    throw context.promise;\n  } else {\n    return context.config;\n  }\n}\n\nexport function useEmulatorConfig<E extends Emulator>(\n  emulator: E\n): NonNullable<Config[E]> {\n  const config = useConfig();\n  const emulatorConfig = config[emulator];\n  const promise = useOnChangePromise(emulatorConfig);\n  if (emulatorConfig === undefined) {\n    // Emulator Suite is running, but the specified emulator is not running.\n    throw promise;\n  }\n  // Needed to convince TypeScript that emulatorConfig is not undefined.\n  return emulatorConfig as NonNullable<Config[E]>;\n}\n\nexport function useIsEmulatorDisabled(emulator?: Emulator): boolean {\n  const config = useConfigOptional();\n  if (config === undefined) {\n    // Still loading, we cannot tell if emulator is disabled.\n    return false;\n  }\n  if (config === null) {\n    // The whole suite is disconnected, so we show all emulators as disabled.\n    return true;\n  }\n  if (emulator && !config[emulator]) {\n    return true;\n  }\n  return false;\n}\n\n/**\n * Try getting Config, but return null if disconnected or undefined if loading.\n * Should be used very sparingly. Prefer useConfig() for most cases.\n */\nexport function useConfigOptional(): Config | undefined | null {\n  const context = React.useContext(emulatorConfigContext);\n  if (context === undefined) {\n    throw new Error(\n      'useConfigOptional must be used within a <EmulatorConfigProvider>'\n    );\n  }\n  return context.config;\n}\n\nasync function jsonFetcher<T>(url: string): Promise<T> {\n  const response = await fetch(url);\n  if (!response.ok) {\n    throw new Error(`Got HTTP status code ${response.status}`);\n  }\n  return response.json();\n}\n\nasync function configFetcher(url: string): Promise<Config> {\n  const json = (await jsonFetcher(url)) as any;\n  const result: Config = {\n    projectId: json.projectId as string,\n  };\n  for (const [key, value] of Object.entries<any>(json)) {\n    if (key === 'projectId') {\n      continue;\n    }\n    const host = fixHostname(value.host as string);\n    result[key as Emulator] = {\n      ...value,\n      host,\n      hostAndPort: hostAndPort(host, value.port as number),\n    };\n  }\n\n  if (result.firestore?.webSocketHost) {\n    result.firestore.webSocketHost = fixHostname(\n      result.firestore.webSocketHost\n    );\n  }\n  return result;\n}\n\nexport function makeDeferred<T>() {\n  let resolve!: (value: T) => void;\n  const promise = new Promise<T>((res) => {\n    resolve = res;\n  });\n  return { promise, resolve };\n}\n\n/**\n * Return a connectable hostname, replacing wildcard 0.0.0.0 or :: with the best\n * effort guess but keep the others unchanged.\n *\n * For emulators listening using wildcard, we assume that they can be connected\n * using the same hostname as the current page (but different ports of course).\n * This works for local setup as well as running the suite (emulators + UI)\n * remotely and connect from another device. It does not work for some setups\n * e.g. when Emulator UI is proxied but not the individual emulators.\n */\nfunction fixHostname(host: string): string {\n  // We should never return 0.0.0.0 or :: since they won't work in some OSes:\n  // https://github.com/firebase/firebase-tools-ui/issues/286\n  if (host === '0.0.0.0') {\n    host = window.location.hostname;\n    // Replace localhost with IPv4 loopback since some browsers / OSes may\n    // resolve it to IPv6 and connection may fail. Ditto for IPv6 cases below.\n    if (!host || host === 'localhost') {\n      host = '127.0.0.1';\n    }\n  } else if (host === '::') {\n    host = window.location.hostname;\n    if (!host || host === 'localhost') {\n      host = '::1';\n    }\n  }\n  return host;\n}\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Icon, IconProps } from '@rmwc/icon';\nimport { ComponentProps } from '@rmwc/types';\nimport React from 'react';\n\n// Firebase products from https://firebase.google.com/brand-guidelines?hl=en\n// To adapt those icons and make them work nicely, follow steps below:\n// 1. Copy and paste full SVG source code (including the <svg> element).\n//    Prefer files with suffix \"(7- Raw Icon, Dark).svg\".\n// 2. Remove width and height from <svg> and add viewBox=\"0 0 192 192\" to make\n//    the icon resizable. (Replace 192 with actual width and height values.)\n// 3. Change fill=\"#000\" etc. to fill=\"currentColor\" everywhere for theming.\n// 4. Change kabab-case-attrs to snakeCaseAttrs to keep React happy.\n\nexport const FirestoreIcon = svgIcon(\n  <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 192 192\">\n    <g fill=\"none\">\n      <path d=\"M0 0h192v192H0z\" />\n      <path\n        d=\"M96 104l-72 32v-32l72-32 72 32v28-6 10zm0-88l72 32v32L96 48 24 80V48zm27 116l36 16-63 28v-32z\"\n        fill=\"currentColor\"\n        fillRule=\"evenodd\"\n      />\n    </g>\n  </svg>\n);\n\nexport const AuthIcon = svgIcon(\n  <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\">\n    <path\n      d=\"M10.8 7.79999C10.8 9.45684 9.45681 10.8 7.79995 10.8C6.1431 10.8 4.79995 9.45684 4.79995 7.79999C4.79995\n      6.14313 6.1431 4.79999 7.79995 4.79999C9.45681 4.79999 10.8 6.14313 10.8 7.79999ZM1.19995\n      16.68V19.2H14.4V16.68C14.4 14.2745 11.445 13.2 7.79995 13.2C4.15487 13.2 1.19995\n      14.2745 1.19995 16.68ZM16.2 10.8C17.8568 10.8 19.2 9.45684 19.2 7.79999C19.2 6.14313 17.8568 4.79999 16.2\n      4.79999C14.5431 4.79999 13.2 6.14313 13.2 7.79999C13.2 9.45684 14.5431 10.8 16.2 10.8ZM22.8 19.2H15.6V16.68C15.6\n      15.25 14.9331 14.1526 13.7752 13.3811C14.5258 13.2593 15.3439 13.2 16.2 13.2C19.845 13.2 22.8 14.2745 22.8\n      16.68V19.2Z\"\n      fill=\"currentColor\"\n      fillRule=\"evenodd\"\n    />\n  </svg>\n);\n\nexport const DatabaseIcon = svgIcon(\n  <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 192 192\">\n    <g fill=\"none\">\n      <path d=\"M0 0h192v192H0z\" />\n      <path\n        d=\"M24 120h144v32.016c0 8.832-7.144 15.984-15.96 15.984H39.96C31.144 168 24 160.816 24 152.016zm0-80.064C24 31.136 31.144 24 39.96 24h112.08c8.816 0 15.96 7.2 15.96 15.936v56.128c0 8.8-7.144 15.936-15.96 15.936H39.96C31.144 112 24 104.8 24 96.064zM40 40h112v24H40zm0 44.04C40 81.8 41.712 80 44.04 80h7.92C54.2 80 56 81.712 56 84.04v7.92C56 94.2 54.288 96 51.96 96h-7.92C41.8 96 40 94.288 40 91.96zm0 56c0-2.24 1.712-4.04 4.04-4.04h7.92c2.24 0 4.04 1.712 4.04 4.04v7.92c0 2.24-1.712 4.04-4.04 4.04h-7.92c-2.24 0-4.04-1.712-4.04-4.04z\"\n        fill=\"currentColor\"\n        fillRule=\"evenodd\"\n      />\n    </g>\n  </svg>\n);\n\nexport const FunctionsIcon = svgIcon(\n  <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 192 192\">\n    <g fill=\"none\">\n      <path d=\"M0 0h192v192H0z\" />\n      <path\n        d=\"M160.056 134.048v-76.08l-26.944-26.944 16.952-16.96L184 48v86.16l-.056.032v9.832l-33.904 33.912L133.112 161zm-128.112-.024l26.944 26.952-16.952 16.96L8 144V57.84l.056-.032v-9.832L41.96 14.064 58.888 31 31.944 57.952v76.08zm28.064-26c-6.647 0-12.036-5.389-12.036-12.036 0-6.647 5.389-12.036 12.036-12.036 6.645 0 12.032 5.387 12.032 12.032 0 6.645-5.387 12.032-12.032 12.032zm35.984 0c-6.647 0-12.036-5.389-12.036-12.036 0-6.647 5.389-12.036 12.036-12.036 6.645 0 12.032 5.387 12.032 12.032 0 6.645-5.387 12.032-12.032 12.032zm35.984 0c-6.647 0-12.036-5.389-12.036-12.036 0-6.647 5.389-12.036 12.036-12.036 6.645 0 12.032 5.387 12.032 12.032 0 6.645-5.387 12.032-12.032 12.032z\"\n        fill=\"currentColor\"\n        fillRule=\"evenodd\"\n      />\n    </g>\n  </svg>\n);\n\nexport const HostingIcon = svgIcon(\n  <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 192 192\">\n    <path\n      d=\"M96 16c-44.16 0-80 35.84-80 80s35.84 80 80 80 80-35.84 80-80-35.84-80-80-80zm-8 143.44c-31.6-3.92-56-30.8-56-63.44 0-4.96.64-9.68 1.68-14.32L72 120v8c0 8.8 7.2 16 16 16zm55.2-20.32c-2.08-6.48-8-11.12-15.2-11.12h-8v-24c0-4.4-3.6-8-8-8H64V80h16c4.4 0 8-3.6 8-8V56h16c8.8 0 16-7.2 16-16v-3.28c23.44 9.52 40 32.48 40 59.28 0 16.64-6.4 31.76-16.8 43.12z\"\n      fillRule=\"evenodd\"\n      fill=\"currentColor\"\n    />\n  </svg>\n);\n\nexport const StorageIcon = svgIcon(\n  <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 192 192\">\n    <path\n      fill=\"currentColor\"\n      d=\"M80 32H32c-8.8 0-15.92 7.2-15.92 16L16 144c0 8.8 7.2 16 16 16h128c8.8 0 16-7.2 16-16V64c0-8.8-7.2-16-16-16H96zm11.6 93.68L117.328 96 152 136H48l26-32z\"\n    />\n  </svg>\n);\n\nexport const PubSubIcon = svgIcon(\n  <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\">\n    <g>\n      <path\n        d=\"M19.83,9.7a1.72,1.72,0,1,0-2.36-.63A1.73,1.73,0,0,0,19.83,9.7Z\"\n        fill=\"currentColor\"\n      />\n      <path\n        d=\"M4.17,9.7a1.72,1.72,0,1,0-.63-2.35A1.72,1.72,0,0,0,4.17,9.7Z\"\n        fill=\"currentColor\"\n      />\n      <circle cx=\"12\" cy=\"20.28\" r=\"1.72\" fill=\"currentColor\" />\n      <path\n        d=\"M20.06,14.36a2.19,2.19,0,0,0-2.46.19l-2.9-1.68a2.67,2.67,0,0,0,.08-.64,2.77,2.77,0,0,0-2-2.65V6.22a2.19,2.19,0,1,0-1.6,0V9.58a2.77,2.77,0,0,0-2,2.65,2.67,2.67,0,0,0,.08.64L6.4,14.55a2.2,2.2,0,1,0,.79,1.38l2.9-1.68a2.75,2.75,0,0,0,3.82,0l2.9,1.68a2.18,2.18,0,1,0,3.25-1.57Z\"\n        fill=\"currentColor\"\n      />\n    </g>\n  </svg>\n);\n\n// Other icons below:\n\n// TODO: Re-implement outer circle using CSS and dedupe with DatabaseIcon.\nexport const DatabaseCircleIcon = svgIcon(\n  <svg viewBox=\"0 0 38 38\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n    <path\n      fillRule=\"evenodd\"\n      clipRule=\"evenodd\"\n      d=\"M19 37C28.9411 37 37 28.9411 37 19C37 9.05887 28.9411 1 19 1C9.05887 1 1 9.05887 1 19C1 28.9411 9.05887 37 19 37Z\"\n      fill=\"white\"\n      stroke=\"black\"\n      strokeOpacity=\"0.12\"\n    />\n    <path\n      fillRule=\"evenodd\"\n      clipRule=\"evenodd\"\n      d=\"M10 22H28V26.002C28.0005 26.5315 27.7906 27.0396 27.4164 27.4143C27.0423 27.7891 26.5345 27.9997 26.005 28H11.995C10.8929 27.9978 10.0005 27.1041 10 26.002V22ZM10 11.992C10 10.892 10.893 10 11.995 10H26.005C27.107 10 28 10.9 28 11.992V19.008C28 20.108 27.107 21 26.005 21H11.995C10.893 21 10 20.1 10 19.008V11.992ZM12 12H26V15H12V12ZM12 17.505C12 17.225 12.214 17 12.505 17H13.495C13.775 17 14 17.214 14 17.505V18.495C14 18.775 13.786 19 13.495 19H12.505C12.3704 19.0022 12.2407 18.9497 12.1455 18.8545C12.0503 18.7593 11.9978 18.6296 12 18.495V17.505ZM12 24.505C12 24.225 12.214 24 12.505 24H13.495C13.775 24 14 24.214 14 24.505V25.495C14 25.775 13.786 26 13.495 26H12.505C12.3704 26.0022 12.2407 25.9497 12.1455 25.8545C12.0503 25.7593 11.9978 25.6296 12 25.495V24.505Z\"\n      fill=\"currentColor\"\n    />\n  </svg>\n);\n\nexport const HintIcon = svgIcon(\n  <svg viewBox=\"0 0 10 14\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n    <path\n      d=\"M2.99998 13C2.99998 13.3667 3.29998 13.6667 3.66665 13.6667H6.33331C6.69998 13.6667 6.99998 13.3667 6.99998 13V12.3334H2.99998V13ZM4.99998 0.333374C2.42665 0.333374 0.333313 2.42671 0.333313 5.00004C0.333313 6.58671 1.12665 7.98004 2.33331 8.82671V10.3334C2.33331 10.7 2.63331 11 2.99998 11H6.99998C7.36665 11 7.66665 10.7 7.66665 10.3334V8.82671C8.87331 7.98004 9.66665 6.58671 9.66665 5.00004C9.66665 2.42671 7.57331 0.333374 4.99998 0.333374ZM6.89998 7.73337L6.33331 8.13337V9.66671H3.66665V8.13337L3.09998 7.73337C2.65831 7.42718 2.29727 7.01867 2.04768 6.54271C1.79809 6.06675 1.66736 5.53747 1.66665 5.00004C1.66665 3.16004 3.15998 1.66671 4.99998 1.66671C6.83998 1.66671 8.33331 3.16004 8.33331 5.00004C8.33331 6.08671 7.79998 7.10671 6.89998 7.73337Z\"\n      fill=\"currentColor\"\n    />\n  </svg>\n);\n\nfunction svgIcon(\n  svgElement: JSX.Element\n): React.FC<\n  { size?: string } & ComponentProps<Omit<IconProps, 'size'>, {}, 'svg'>\n> {\n  return ({ size = 'small', ...props }) => {\n    return (\n      <Icon\n        icon={{\n          strategy: 'component',\n          size,\n          icon: svgElement,\n        }}\n        {...props}\n      />\n    );\n  };\n}\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport './EmulatorDisabled.scss';\n\nimport { Card } from '@rmwc/card';\nimport { GridCell } from '@rmwc/grid';\nimport { Typography } from '@rmwc/typography';\nimport React from 'react';\n\nimport { HintIcon } from './icons';\n\nexport const EmulatorDisabled: React.FC<{\n  productName: string;\n}> = ({ productName }) => (\n  <>\n    <GridCell desktop={2} tablet={0} phone={0}>\n      {/* Spacing */}\n    </GridCell>\n    <GridCell span={8} align=\"middle\">\n      <Card className=\"EmulatorDisabled\">\n        <div className=\"EmulatorDisabled-graphics\">\n          <img src=\"/assets/img/database.png\" alt=\"\" />\n        </div>\n        <div className=\"EmulatorDisabled-description\">\n          <Typography use=\"headline6\" tag=\"h3\">\n            The {productName} Emulator is currently not running.\n          </Typography>\n          <Typography use=\"body1\" tag=\"p\">\n            If you are not using {productName} in your testing, everything is\n            fine. If you want to use {productName} in your testing, then the\n            best way to set it up and start it is to run the following command\n            to initialize the {productName} Emulator:{' '}\n            <code>firebase init emulators</code>. Followed by:{' '}\n            <code>firebase emulators:start</code>.\n          </Typography>\n          <Typography use=\"body1\" tag=\"p\">\n            <a href=\"https://firebase.google.com/docs/emulator-suite/install_and_configure#configure_emulator_suite\">\n              <HintIcon size=\"xsmall\" /> Learn more\n            </a>\n          </Typography>\n        </div>\n      </Card>\n    </GridCell>\n  </>\n);\n\nexport const EmulatorOutdated: React.FC<{\n  productName: string;\n}> = ({ productName }) => (\n  <div className=\"EmulatorDisabled\">\n    <div className=\"EmulatorDisabled-graphics\">\n      <img src=\"/assets/img/database.png\" alt=\"\" />\n    </div>\n    <div className=\"EmulatorDisabled-description\">\n      <Typography use=\"headline6\" tag=\"h3\">\n        Please update your {productName} Emulator.\n      </Typography>\n      <Typography use=\"body1\" tag=\"p\">\n        This feature requires the latest {productName} Emulator. Please{' '}\n        <a href=\"https://firebase.google.com/docs/cli#update-cli\">\n          upgrade your Firebase CLI\n        </a>{' '}\n        to the latest version and refresh this page.\n      </Typography>\n    </div>\n  </div>\n);\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './Spinner.scss';\n\nimport { CircularProgress } from '@rmwc/circular-progress';\nimport { GridCell } from '@rmwc/grid';\nimport { Typography } from '@rmwc/typography';\nimport classnames from 'classnames';\nimport React from 'react';\n\nexport const Spinner: React.FC<\n  {\n    message?: string;\n    span?: number;\n    cover?: boolean;\n    scrim?: boolean;\n    size?: 'xsmall' | 'small' | 'medium' | 'large' | 'xlarge' | number;\n  } & React.HTMLProps<HTMLDivElement>\n> = ({ message, size, span, cover, scrim, ...props }) => {\n  const children = (\n    <>\n      <CircularProgress size={size ?? 'xlarge'} />\n      {message && (\n        <Typography use=\"body2\" tag=\"p\">\n          {message}\n        </Typography>\n      )}\n    </>\n  );\n  if (span === undefined) {\n    return (\n      <div className={classnames('Spinner', { cover, scrim })} {...props}>\n        {children}\n      </div>\n    );\n  } else {\n    return (\n      <GridCell span={span} align=\"middle\" className=\"Spinner\" {...props}>\n        {children}\n      </GridCell>\n    );\n  }\n};\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { isDraft, original } from 'immer';\nimport deepEquals from 'lodash.isequal';\n\nexport interface ErrorInfo {\n  message: string;\n}\n\n/* Represents result of a task, either success (with data) or error. */\nexport type Result<T, E = ErrorInfo> = DataResult<T> | ErrorResult<E>;\nexport type DataResult<T> = { data: T };\nexport type ErrorResult<E> = { error: E };\n\n// Type helper to extract the type of T.data.\nexport type DataTypeOf<T extends Result<any, any>> = T extends Result<\n  infer D,\n  any\n>\n  ? D\n  : any;\n\nexport type DataTypeIfPresent<\n  T extends Result<any, any> | undefined\n> = T extends DataResult<infer D> ? D : never;\n\n// Type helper to extract the type of T.error.\nexport type ErrorTypeOf<T extends Result<any, any>> = T extends Result<\n  any,\n  infer E\n>\n  ? E\n  : any;\n\nexport type ErrorTypeIfPresent<\n  T extends Result<any, any> | undefined\n> = T extends ErrorResult<infer E> ? E : never;\n\nexport function hasData<T, E>(\n  result: Result<T, E> | undefined\n): result is DataResult<T> {\n  return result !== undefined && 'data' in result;\n}\n\nexport function hasError<T, E>(\n  result: Result<T, E> | undefined\n): result is ErrorResult<E> {\n  return result !== undefined && 'error' in result;\n}\n\n// Transform data if present or return error unchanged.\nexport function map<T, E, R>(\n  result: Result<T, E>,\n  dataMapper: (data: T) => R\n): Result<R, E>;\n\n// Transform data if present or return error / undefined unchanged.\nexport function map<T, E, R>(\n  result: Result<T, E> | undefined,\n  dataMapper: (data: T) => R\n): Result<R, E> | undefined;\n\n// (Implementation of overloaded function. Not exposed.)\nexport function map<T, E, R>(\n  result: Result<T, E> | undefined,\n  dataMapper: (data: T) => R\n): Result<R, E> | undefined {\n  if (result === undefined) return undefined;\n  return 'error' in result ? result : { data: dataMapper(result.data) };\n}\n\n// Represents a piece of remote info, which may be\n// - No info and not loading (initial)\n// - No info and loading (fetching)\n// - Has info and not loading (completed)\n// - Has info and loading (refreshing)\nexport type Remote<T> = { result?: T; loading: boolean };\n\nexport type RemoteResult<T, E = ErrorInfo> = Remote<Result<T, E>>;\n\n// Transform result.data if present or return result.error unchanged.\nexport function mapResult<T, E, R>(\n  remoteResult: RemoteResult<T, E>,\n  dataMapper: (data: T) => R\n): RemoteResult<R, E> {\n  return {\n    loading: remoteResult.loading,\n    result: map(remoteResult.result, dataMapper),\n  };\n}\n\nexport function createRemoteDataLoaded<T>(data: T): RemoteResult<T> {\n  return {\n    loading: false,\n    result: { data },\n  };\n}\n\nexport type DataTypeOfEach<\n  T extends ReadonlyArray<Result<any, any> | undefined>\n> = {\n  [P in keyof T]: T[P] extends Result<any, any> | undefined\n    ? DataTypeIfPresent<T[P]>\n    : T[P];\n};\n\n/**\n * Combine data of the remote results, or return first error encountered.\n *\n * If there are no errors but any result is undefined, return undefined.\n */\nexport function combineData<\n  Arr extends ReadonlyArray<Result<any, any> | undefined>\n>(\n  ...results: Arr\n): Result<DataTypeOfEach<Arr>, ErrorTypeIfPresent<Arr[number]>> | undefined {\n  for (const result of results) {\n    if (hasError(result)) {\n      return result;\n    }\n  }\n  for (const result of results) {\n    if (result === undefined) {\n      return undefined;\n    }\n  }\n\n  return {\n    data: (results.map(\n      (result) => (result as DataResult<unknown>).data\n    ) as unknown) as DataTypeOfEach<Arr>,\n  };\n}\n\n// Handle missing / data / error cases of a result and return a single value.\nexport function handle<T, E, R>(\n  result: Result<T, E> | undefined,\n  mappers: {\n    onNone: () => R;\n    onData: (data: T) => R;\n    onError: (error: E) => R;\n  }\n): R {\n  if (result === undefined) {\n    return mappers.onNone();\n  } else {\n    if (hasError(result)) {\n      return mappers.onError(result.error);\n    } else {\n      return mappers.onData(result.data);\n    }\n  }\n}\n\n// Same as handle, but for remote result, also passes loading state to the callbacks.\nexport function squash<T, E, R>(\n  remoteResult: RemoteResult<T, E>,\n  mappers: {\n    onNone: (loading: boolean) => R;\n    onData: (data: T, loading: boolean) => R;\n    onError: (error: E, loading: boolean) => R;\n  }\n): R {\n  return handle(remoteResult.result, {\n    onNone: () => mappers.onNone(remoteResult.loading),\n    onData: (data) => mappers.onData(data, remoteResult.loading),\n    onError: (error) => mappers.onError(error, remoteResult.loading),\n  });\n}\n\nexport function squashOrDefaut<T>(\n  remoteResult: RemoteResult<T, unknown>,\n  defaultValue: T\n) {\n  return squash(remoteResult, {\n    onNone: () => defaultValue,\n    onData: (a) => a,\n    onError: () => defaultValue,\n  });\n}\n\n// Set parent[key] to newValue unless exising value is deeply equal.\n// Can be used to set an immer draft property to a nested external object.\nexport function replaceIfChanged<Parent, Key extends keyof Parent>(\n  parent: Parent,\n  key: Key,\n  newValue: Parent[Key]\n): void {\n  const oldValue = isDraft(parent) ? original(parent)![key] : parent[key];\n  if (!deepEquals(oldValue, newValue)) {\n    parent[key] = newValue;\n  }\n}\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport produce from 'immer';\nimport { Action, createReducer } from 'typesafe-actions';\n\nimport { AuthState, AuthUser } from '../../components/Auth/types';\nimport { mapResult } from '../utils';\nimport * as authActions from './actions';\n\nconst INIT_STATE = {\n  users: { loading: true },\n  filter: '',\n  allowDuplicateEmails: false,\n};\n\nexport const authReducer = createReducer<AuthState, Action>(INIT_STATE)\n  .handleAction(\n    authActions.createUserSuccess,\n    produce((draft, { payload }) => {\n      draft.users = mapResult(draft.users, (users: AuthUser[]) => [\n        ...users,\n        payload.user,\n      ]);\n    })\n  )\n  .handleAction(\n    authActions.updateUserSuccess,\n    produce((draft: AuthState, { payload }) => {\n      draft.users = mapResult(draft.users, (users) =>\n        users.map((user: AuthUser) => {\n          return user.localId === payload.user.localId ? payload.user : user;\n        })\n      );\n    })\n  )\n  .handleAction(\n    authActions.nukeUsersSuccess,\n    produce((draft) => {\n      draft.users = mapResult(draft.users, () => []);\n    })\n  )\n  .handleAction(\n    authActions.setAllowDuplicateEmailsSuccess,\n    produce((draft, { payload }) => {\n      draft.allowDuplicateEmails = payload;\n    })\n  )\n  .handleAction(\n    authActions.setUserDisabledSuccess,\n    produce((draft, { payload }) => {\n      draft.users = mapResult(draft.users, (users: AuthUser[]) => {\n        return users.map((u: AuthUser) =>\n          u.localId === payload.localId\n            ? { ...u, disabled: payload.disabled }\n            : u\n        );\n      });\n    })\n  )\n  .handleAction(\n    authActions.deleteUserSuccess,\n    produce((draft, { payload }) => {\n      draft.users = mapResult(draft.users, (users: AuthUser[]) =>\n        users.filter((u: AuthUser) => u.localId !== payload.localId)\n      );\n    })\n  )\n  .handleAction(\n    authActions.updateFilter,\n    produce((draft, { payload: { filter } }) => {\n      draft.filter = filter;\n    })\n  )\n  .handleAction(\n    authActions.openAuthUserDialog,\n    produce((draft, { payload: authUserDialogData }) => {\n      draft.authUserDialogData = authUserDialogData;\n    })\n  )\n  .handleAction(\n    authActions.setAuthUserDialogLoading,\n    produce((draft, { payload: loading }) => {\n      if (draft.authUserDialogData) {\n        draft.authUserDialogData.loading = loading;\n      }\n    })\n  )\n  .handleAction(\n    authActions.setAuthUserDialogError,\n    produce((draft, { payload: error }) => {\n      if (draft.authUserDialogData && draft.authUserDialogData.result) {\n        draft.authUserDialogData.result.error = error;\n      }\n    })\n  )\n  .handleAction(\n    authActions.clearAuthUserDialogData,\n    produce((draft) => {\n      draft.authUserDialogData = undefined;\n    })\n  )\n  .handleAction(\n    authActions.authFetchUsersSuccess,\n    produce((draft: AuthState, { payload }) => {\n      draft.users = {\n        loading: false,\n        result: { data: payload },\n      };\n    })\n  )\n  .handleAction(\n    authActions.authFetchUsersError,\n    produce((draft: AuthState, { payload }) => {\n      draft.users = {\n        loading: false,\n        result: { error: payload },\n      };\n    })\n  );\n","/**\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\ntype RequestMethod = 'GET' | 'POST' | 'PUT' | 'DELETE' | 'PATCH';\n\nexport class ResponseError extends Error {\n  constructor(\n    message: string,\n    readonly response: Response,\n    readonly json?: {}\n  ) {\n    super(message);\n  }\n}\n\n/** Simple REST api helpers */\nexport abstract class RestApi {\n  protected getToken() {\n    return { accessToken: 'owner' };\n  }\n\n  protected async jsonRequest(\n    url: string,\n    data: {},\n    method: RequestMethod = 'GET',\n    headers: Record<string, string> = { 'Content-Type': 'application/json' }\n  ) {\n    const { accessToken } = this.getToken();\n\n    const res = await fetch(url, {\n      method,\n      body: JSON.stringify(data),\n      headers: {\n        Authorization: 'Bearer ' + accessToken,\n        ...headers,\n      },\n    });\n\n    const json = await res.json();\n\n    if (res.status >= 400 && res.status < 600) {\n      throw new ResponseError(json.error.message, res, json);\n    }\n\n    return { res, json };\n  }\n\n  protected async deleteRequest(url: string) {\n    const { accessToken } = this.getToken();\n\n    const res = await fetch(url, {\n      method: 'DELETE',\n      headers: {\n        Authorization: 'Bearer ' + accessToken,\n      },\n    });\n\n    const json = await res.json();\n\n    if (res.status >= 400 && res.status < 600) {\n      throw new ResponseError(json.error.message, res, json);\n    }\n\n    return { res, json };\n  }\n\n  protected async patchRequest(url: string, data: {}) {\n    return this.jsonRequest(url, data, 'PATCH');\n  }\n\n  /** Upload a file with multipart/form-data */\n  protected async postFile(\n    url: string,\n    file: File,\n    method: RequestMethod = 'POST'\n  ) {\n    const body = toFormData(file);\n\n    const { accessToken } = this.getToken();\n    body.append('auth', accessToken);\n\n    // We cannot set the Content-Type header here, since that will\n    // break multipart/form-data payload.\n    // Furthermore, setting non-simple headers may cause a CORS pre-flight\n    // request. RTDB Emulator, for one, doesn't handle those correctly.\n    // See: https://fetch.spec.whatwg.org/#simple-header\n    const res = await fetch(url, { method, body });\n\n    const text = await res.text();\n\n    if (res.status >= 400 && res.status < 600) {\n      throw new ResponseError(text, res);\n    }\n\n    return { res, text };\n  }\n}\n\n/** build `multipart/form-data` payload */\nfunction toFormData(file: File) {\n  const formData = new FormData();\n  formData.append('upload', file);\n  return formData;\n}\n","/**\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { RestApi } from '../common/rest_api';\nimport { AddAuthUserPayload, AuthUser } from './types';\n\nconst importUser = (user: AuthUser & ApiAuthUserFields) => {\n  const match = user.passwordHash?.match(PASSWORD_HASH_REGEX);\n\n  return {\n    password: match ? match[1] : '',\n    ...user,\n    providerUserInfo: user.providerUserInfo || [],\n  };\n};\n\nexport interface ApiAuthUserFields {\n  passwordHash: string;\n}\n\nexport default class AuthApi extends RestApi {\n  // Note: Always use API paths that contain `projectId` for consistency.\n  // Unprefixed versions (e.g. /v1/accounts:signUp) are intended for non-admin\n  // clients and infers projectId, which can lead to unexpected mismatches.\n\n  // https://cloud.google.com/identity-platform/docs/reference/rest/v1/projects.accounts\n  private readonly baseUrl = `http://${this.hostAndPort}/identitytoolkit.googleapis.com/v1/projects/${this.projectId}`;\n  private readonly baseEmulatorUrl = `http://${this.hostAndPort}/emulator/v1/projects/${this.projectId}`;\n\n  constructor(\n    private readonly hostAndPort: string,\n    private readonly projectId: string\n  ) {\n    super();\n  }\n\n  async nukeUsers() {\n    await this.deleteRequest(`${this.baseEmulatorUrl}/accounts`);\n    return [];\n  }\n\n  async fetchUsers(): Promise<AuthUser[]> {\n    const { json } = await this.jsonRequest(\n      `${this.baseUrl}/accounts:query`,\n      {},\n      'POST'\n    );\n\n    return json.userInfo.map(importUser);\n  }\n\n  async fetchUser(localId: string): Promise<AuthUser> {\n    const { json } = await this.jsonRequest(\n      `${this.baseUrl}/accounts:lookup`,\n      { localId: [localId] },\n      'POST'\n    );\n\n    if (!json.users || !json.users.length) {\n      throw new Error(\n        `User \"${localId}\" not found in Project \"${this.projectId}\"!`\n      );\n    }\n    return importUser(json.users[0]);\n  }\n\n  async createUser(user: AddAuthUserPayload): Promise<AuthUser> {\n    const { json } = await this.jsonRequest(\n      `${this.baseUrl}/accounts`,\n      { ...user },\n      'POST'\n    );\n\n    return this.fetchUser(json.localId);\n  }\n\n  async updateConfig(\n    allowDuplicateEmails: boolean\n  ): Promise<{ signIn: { allowDuplicateEmails: boolean } }> {\n    const { json } = await this.patchRequest(`${this.baseEmulatorUrl}/config`, {\n      signIn: { allowDuplicateEmails },\n    });\n\n    return json;\n  }\n\n  async getConfig(): Promise<AuthUser> {\n    const { signIn } = await (\n      await fetch(`${this.baseEmulatorUrl}/config`)\n    ).json();\n\n    return signIn.allowDuplicateEmails;\n  }\n\n  async updateUser(\n    user: AddAuthUserPayload & { localId: string }\n  ): Promise<AuthUser> {\n    const { json } = await this.jsonRequest(\n      `${this.baseUrl}/accounts:update`,\n      user,\n      'POST'\n    );\n\n    return this.fetchUser(json.localId);\n  }\n\n  async deleteUser(user: AuthUser): Promise<void> {\n    await this.jsonRequest(`${this.baseUrl}/accounts:delete`, user, 'POST');\n  }\n}\n\nconst PASSWORD_HASH_REGEX = /^fakeHash:salt=[\\w\\d]+:password=(.*)$/;\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  all,\n  call,\n  getContext,\n  put,\n  setContext,\n  takeLatest,\n} from 'redux-saga/effects';\nimport { ActionType, getType } from 'typesafe-actions';\n\nimport AuthApi from '../../components/Auth/api';\nimport { AuthUser } from '../../components/Auth/types';\nimport {\n  authFetchUsersError,\n  authFetchUsersRequest,\n  authFetchUsersSuccess,\n  clearAuthUserDialogData,\n  createUserRequest,\n  createUserSuccess,\n  deleteUserRequest,\n  deleteUserSuccess,\n  getAllowDuplicateEmailsRequest,\n  nukeUsersRequest,\n  nukeUsersSuccess,\n  setAllowDuplicateEmailsRequest,\n  setAllowDuplicateEmailsSuccess,\n  setAuthUserDialogError,\n  setAuthUserDialogLoading,\n  setUserDisabledRequest,\n  setUserDisabledSuccess,\n  updateAuthConfig,\n  updateUserRequest,\n  updateUserSuccess,\n} from './actions';\n\n// TODO(kirjs): Figure out what's the deal with all those new anys.\nexport function* fetchAuthUsers(): any {\n  const authApi = yield call(configureAuthSaga);\n  try {\n    const users = yield call([authApi, 'fetchUsers']);\n    yield put(authFetchUsersSuccess(users));\n  } catch (e) {\n    yield put(authFetchUsersError({ message: 'Error when fetching users' }));\n  }\n}\n\nexport const AUTH_API_CONTEXT = 'AUTH_API_CONTEXT';\n\nexport function* initAuth({ payload }: ActionType<typeof updateAuthConfig>) {\n  if (!payload) {\n    return;\n  }\n  yield setContext({\n    [AUTH_API_CONTEXT]: new AuthApi(\n      payload.auth.hostAndPort,\n      payload.projectId\n    ),\n  });\n  yield all([\n    takeLatest(getType(authFetchUsersRequest), fetchAuthUsers),\n    takeLatest(getType(createUserRequest), createUser),\n    takeLatest(getType(nukeUsersRequest), nukeUsers),\n    takeLatest(getType(deleteUserRequest), deleteUser),\n    takeLatest(getType(updateUserRequest), updateUser),\n    takeLatest(getType(setUserDisabledRequest), setUserDisabled),\n    takeLatest(\n      getType(setAllowDuplicateEmailsRequest),\n      setAllowDuplicateEmails\n    ),\n    takeLatest(\n      getType(getAllowDuplicateEmailsRequest),\n      getAllowDuplicateEmails\n    ),\n    put(authFetchUsersRequest()),\n    put(getAllowDuplicateEmailsRequest()),\n  ]);\n}\n\nexport function* deleteUser({ payload }: ReturnType<typeof deleteUserRequest>) {\n  const authApi: AuthApi = yield call(configureAuthSaga);\n\n  yield call([authApi, 'deleteUser'] as any, {\n    localId: payload.localId,\n  });\n  yield put(deleteUserSuccess({ localId: payload.localId }));\n}\n\nexport function* createUser({ payload }: ReturnType<typeof createUserRequest>) {\n  const authApi: AuthApi = yield call(configureAuthSaga);\n\n  try {\n    yield put(setAuthUserDialogLoading(true));\n\n    let user: AuthUser = yield call([authApi, 'createUser'], payload.user);\n\n    // Auth API doesn't allow setting customAttributes on creation, so we set\n    // it immediately via an update request.\n    if (payload.user.customAttributes) {\n      user = yield call([authApi, 'updateUser'], {\n        localId: user.localId,\n        customAttributes: payload.user.customAttributes,\n      });\n    }\n\n    yield put(createUserSuccess({ user }));\n\n    if (!payload.keepDialogOpen) {\n      yield put(clearAuthUserDialogData());\n    }\n  } catch (e) {\n    yield put(setAuthUserDialogError(e.message));\n  } finally {\n    yield put(setAuthUserDialogLoading(false));\n  }\n}\n\nexport function* updateUser({ payload }: ReturnType<typeof updateUserRequest>) {\n  const authApi: AuthApi = yield call(configureAuthSaga);\n  try {\n    yield put(setAuthUserDialogLoading(true));\n    const user: AuthUser = yield call([authApi, 'updateUser'], {\n      ...payload.user,\n      localId: payload.localId,\n    });\n    yield put(updateUserSuccess({ user }));\n    yield put(clearAuthUserDialogData());\n  } catch (e) {\n    yield put(setAuthUserDialogError(e.message));\n  } finally {\n    yield put(setAuthUserDialogLoading(false));\n  }\n}\n\nexport function* setUserDisabled({\n  payload,\n}: ReturnType<typeof setUserDisabledRequest>) {\n  const authApi: AuthApi = yield call(configureAuthSaga);\n  yield call([authApi, 'updateUser'] as any, {\n    disableUser: payload.disabled,\n    localId: payload.localId,\n  });\n  yield put(setUserDisabledSuccess(payload));\n}\n\nexport function* setAllowDuplicateEmails({\n  payload,\n}: ReturnType<typeof setAllowDuplicateEmailsRequest>) {\n  const authApi: AuthApi = yield call(configureAuthSaga);\n  yield call([authApi, 'updateConfig'], payload);\n  yield put(setAllowDuplicateEmailsSuccess(payload));\n}\n\nexport function* getAllowDuplicateEmails() {\n  const authApi: AuthApi = yield call(configureAuthSaga);\n  const config: boolean = yield call([authApi, 'getConfig']);\n  yield put(setAllowDuplicateEmailsSuccess(config));\n}\n\nexport function* nukeUsers() {\n  const authApi: AuthApi = yield call(configureAuthSaga);\n  yield call([authApi, 'nukeUsers']);\n  yield put(nukeUsersSuccess());\n}\n\nexport function* configureAuthSaga(): Generator {\n  const api = yield getContext(AUTH_API_CONTEXT);\n  return api;\n}\n\nexport function* authSaga() {\n  yield takeLatest(getType(updateAuthConfig), initAuth);\n}\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { combineReducers } from 'redux';\nimport { all, fork } from 'redux-saga/effects';\nimport * as reselect from 'reselect';\n\nimport { AuthState } from '../components/Auth/types';\nimport { authReducer } from './auth/reducer';\nimport { authSaga } from './auth/sagas';\n\n// DEPRECATED, do not add more Redux states / reducers. Instead, use `swr` for\n// simple fetches and polling, and consider keeping state locally using hooks.\nexport interface AppState {\n  auth: AuthState; // still kept in Redux for historical reasons.\n}\n\nexport function* rootSaga() {\n  yield all([fork(authSaga)]);\n}\n\nexport const rootReducer = combineReducers<AppState>({\n  auth: authReducer,\n});\n\nexport function createStructuredSelector<T>(\n  selectors: { [K in keyof T]: reselect.Selector<AppState, T[K]> }\n) {\n  return reselect.createStructuredSelector<AppState, T>(selectors);\n}\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createSelector } from 'reselect';\n\nimport { AuthState, AuthUser } from '../../components/Auth/types';\nimport { AppState } from '../index';\nimport { hasData, squashOrDefaut } from '../utils';\n\nexport const getAuth = (state: AppState) => state.auth;\n\nexport const getAuthUsers = createSelector(getAuth, (state: AuthState) => {\n  return state.users;\n});\n\nexport const getAuthUserDialog = createSelector(getAuth, (state: AuthState) => {\n  return state.authUserDialogData;\n});\n\nexport const getCurrentEditedUser = createSelector(\n  getAuthUserDialog,\n  (authUserDialogData) => {\n    return authUserDialogData && hasData(authUserDialogData.result)\n      ? authUserDialogData.result.data\n      : undefined;\n  }\n);\n\nexport const isEditingUser = createSelector(getCurrentEditedUser, (user) => {\n  return !!user;\n});\n\nexport const getAuthUsersResult = createSelector(getAuthUsers, (users) => {\n  return users.result;\n});\n\nexport const getUsers = createSelector(getAuthUsers, (users) => {\n  return [...squashOrDefaut(users, [])].sort(\n    (a, b) => Number(new Date(b.createdAt)) - Number(new Date(a.createdAt || 0))\n  );\n});\n\nexport const getAllEmails = createSelector(getUsers, (users) => {\n  return new Set(users.map((u) => u.email).filter((e) => !!e));\n});\n\nexport const getAllPhoneNumbers = createSelector(getUsers, (users) => {\n  return new Set(users.map((u) => u.phoneNumber).filter((e) => !!e));\n});\n\nexport const hasUsers = createSelector(\n  getUsers,\n  (users: unknown[]) => users.length > 0\n);\n\nexport const getFilter = createSelector(\n  getAuth,\n  (state: AuthState) => state.filter\n);\n\nexport const getAllowDuplicateEmails = createSelector(\n  getAuth,\n  (state: AuthState) => state.allowDuplicateEmails\n);\n\nexport const getFilteredUsers = createSelector(\n  getUsers,\n  getFilter,\n  (users: AuthUser[], filter: string) => {\n    if (!filter) {\n      return users;\n    }\n    return users.filter((u) => {\n      return [u.localId, u.displayName, u.email || '', u.phoneNumber || '']\n        .join('\\n')\n        .toLocaleUpperCase()\n        .includes(filter.toLocaleUpperCase());\n    });\n  }\n);\nexport const getShowZeroState = createSelector(\n  getUsers,\n  (users) => users.length === 0\n);\nexport const getShowZeroResults = createSelector(\n  getUsers,\n  getFilteredUsers,\n  (users, filteredUsers) => users.length > 0 && filteredUsers.length === 0\n);\nexport const getShowTable = createSelector(\n  getUsers,\n  getFilteredUsers,\n  (users, filteredUsers) => filteredUsers.length > 0\n);\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ThemeProvider } from '@rmwc/theme';\nimport React from 'react';\n\nimport { primary } from './colors';\n\n/** Error color used in global theme */\nexport const error = '#d32f2f'; // Red 700\n\nconst purple50 = '#f3e5f5';\nexport const tipTheme = {\n  background: purple50,\n  primary,\n  primaryRgb: '104, 29, 168',\n  textIconOnBackground: primary,\n  textPrimaryOnBackground: primary,\n  textSecondaryOnBackground: `rgba(${primary}, 0.7)`,\n};\n\nconst teal50 = '#e0f2f1';\nconst teal700 = '#00796b';\nconst teal800 = '#00695c';\nexport const successTheme = {\n  background: teal50,\n  primary: teal700,\n  primaryRgb: '0, 121, 107',\n  textIconOnBackground: teal700,\n  textPrimaryOnBackground: teal800,\n  textSecondaryOnBackground: `rgba(${teal800}, 0.7)`,\n};\n\nconst navy20 = '#e5eaf0';\nconst navy300 = '#476282';\nconst navy600 = '#1b3a57';\nexport const noteTheme = {\n  background: navy20,\n  primary: navy300,\n  primaryRgb: '71, 98, 130',\n  textIconOnBackground: navy300,\n  textPrimaryOnBackground: navy600,\n  textSecondaryOnBackground: `rgba(${navy600}, 0.7)`,\n};\n\nconst orange50 = '#fff3e0';\nconst amber800 = '#ff8f00';\nconst deepOrange900 = '#bf360c';\nexport const cautionTheme = {\n  background: orange50,\n  primary: amber800,\n  primaryRgb: '255, 143, 0',\n  onPrimary: 'white',\n  textIconOnBackground: amber800,\n  textPrimaryOnBackground: deepOrange900,\n  textSecondaryOnBackground: `rgba(${deepOrange900}, 0.7)`,\n};\n\nconst deepOrange50 = '#fbe9e7';\nconst red700 = '#d32f2f';\nconst red800 = '#c62828';\nexport const errorTheme = {\n  background: deepOrange50,\n  primary: red700,\n  primaryRgb: '211, 47, 47',\n  textIconOnBackground: red700,\n  textPrimaryOnBackground: red800,\n  textSecondaryOnBackground: `rgba(${red800}, 0.7)`,\n};\n\n/** Possible theme types */\nexport enum Type {\n  CAUTION = 'caution',\n  NOTE = 'note',\n  SUCCESS = 'success',\n  TIP = 'tip',\n  WARNING = 'warning',\n}\n\nconst THEME_MAP: Record<string, Record<string, string>> = {\n  [Type.CAUTION]: cautionTheme,\n  [Type.NOTE]: noteTheme,\n  [Type.SUCCESS]: successTheme,\n  [Type.TIP]: tipTheme,\n  [Type.WARNING]: errorTheme,\n};\n\nexport type CustomThemeType =\n  | 'caution'\n  | 'note'\n  | 'success'\n  | 'tip'\n  | 'warning';\n\ninterface Props {\n  use: CustomThemeType;\n  wrap?: boolean;\n}\n\nexport const CustomThemeProvider: React.FC<Props> = ({\n  use,\n  wrap,\n  children,\n}) => (\n  <ThemeProvider options={THEME_MAP[use]} wrap={wrap}>\n    {children}\n  </ThemeProvider>\n);\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Dialog,\n  DialogActions,\n  DialogButton,\n  DialogContent,\n  DialogTitle,\n} from '@rmwc/dialog';\nimport { Radio } from '@rmwc/radio';\nimport { Typography } from '@rmwc/typography';\nimport React from 'react';\nimport { MapDispatchToPropsFunction, connect } from 'react-redux';\n\nimport { createStructuredSelector } from '../../../store';\nimport { setAllowDuplicateEmailsRequest } from '../../../store/auth/actions';\nimport { getAllowDuplicateEmails } from '../../../store/auth/selectors';\nimport styles from './OneAccountPerEmailDialog.module.scss';\n\ninterface OneAccountPerEmailDialogProps {\n  onClose: () => void;\n}\n\ntype Props = PropsFromDispatch & PropsFromStore & OneAccountPerEmailDialogProps;\n\nexport const OneAccountPerEmailDialog: React.FC<Props> = ({\n  allowDuplicateEmails,\n  onClose,\n  setAllowDuplicateEmails,\n}) => {\n  const [value, setValue] = React.useState(allowDuplicateEmails);\n\n  return (\n    <Dialog renderToPortal open onClose={onClose}>\n      <DialogTitle>Account email address settings</DialogTitle>\n      <form\n        onSubmit={(e: React.FormEvent<unknown>) => {\n          e.preventDefault();\n          setAllowDuplicateEmails(value);\n          onClose();\n        }}\n      >\n        <DialogContent>\n          <Typography use=\"body2\" className={styles.description}>\n            This setting either prevents or allows users to create multiple\n            accounts using the same email address if they sign in to your app\n            using different authentication providers.\n          </Typography>\n          <Radio\n            value=\"false\"\n            checked={!value}\n            onChange={() => setValue(false)}\n            onClick={() => setValue(false)}\n          >\n            Prevent creation of multiple accounts with the same email address\n          </Radio>\n\n          <Radio\n            value=\"true\"\n            checked={value}\n            onChange={() => setValue(true)}\n            onClick={() => setValue(true)}\n          >\n            Allow creation of multiple accounts with the same email address\n          </Radio>\n        </DialogContent>\n        <DialogActions>\n          <DialogButton action=\"close\" type=\"button\" theme=\"secondary\">\n            Cancel\n          </DialogButton>\n          <DialogButton type=\"submit\" unelevated>\n            Save\n          </DialogButton>\n        </DialogActions>\n      </form>\n    </Dialog>\n  );\n};\n\nexport const mapStateToProps = createStructuredSelector({\n  allowDuplicateEmails: getAllowDuplicateEmails,\n});\n\nexport type PropsFromStore = ReturnType<typeof mapStateToProps>;\n\nexport interface PropsFromDispatch {\n  setAllowDuplicateEmails: typeof setAllowDuplicateEmailsRequest;\n}\n\nexport const mapDispatchToProps: MapDispatchToPropsFunction<\n  PropsFromDispatch,\n  {}\n> = (dispatch) => ({\n  setAllowDuplicateEmails: (value: boolean) =>\n    dispatch(setAllowDuplicateEmailsRequest(value)),\n});\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(OneAccountPerEmailDialog);\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Button } from '@rmwc/button';\nimport { Card } from '@rmwc/card';\nimport { Typography } from '@rmwc/typography';\nimport React, { useState } from 'react';\nimport { connect } from 'react-redux';\n\nimport { createStructuredSelector } from '../../../store';\nimport { getAllowDuplicateEmails } from '../../../store/auth/selectors';\nimport styles from './OneAccountPerEmailCard.module.scss';\nimport OneAccountPerEmailDialog from './OneAccountPerEmailDialog';\n\nexport type OneAccountPerEmailCardProps = PropsFromStore;\nexport const OneAccountPerEmailCard: React.FC<OneAccountPerEmailCardProps> = ({\n  allowDuplicateEmails,\n}) => {\n  const [open, setOpen] = useState(false);\n\n  return (\n    <>\n      <Card className={styles.wrapper}>\n        {allowDuplicateEmails ? (\n          <div>\n            <Typography\n              use=\"headline6\"\n              tag=\"div\"\n              theme=\"textPrimaryOnBackground\"\n            >\n              Multiple accounts per email address\n            </Typography>\n            <Typography use=\"body2\" theme=\"textPrimaryOnBackground\">\n              Allowing users to create multiple accounts for authentication\n              providers that use the same email address.{' '}\n              <a\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n                href=\"https://support.google.com/firebase/answer/6400716\"\n              >\n                Learn more\n              </a>\n            </Typography>\n          </div>\n        ) : (\n          <div>\n            <Typography\n              use=\"headline6\"\n              tag=\"div\"\n              theme=\"textPrimaryOnBackground\"\n            >\n              One account per email address\n            </Typography>\n            <Typography use=\"body2\" theme=\"textPrimaryOnBackground\">\n              Preventing users from creating multiple accounts using the same\n              email address with different authentication providers.\n            </Typography>\n          </div>\n        )}\n\n        <div>\n          <Button outlined={true} onClick={() => setOpen(true)}>\n            Change\n          </Button>\n        </div>\n      </Card>\n      {open && <OneAccountPerEmailDialog onClose={() => setOpen(false)} />}\n    </>\n  );\n};\nexport const mapStateToProps = createStructuredSelector({\n  allowDuplicateEmails: getAllowDuplicateEmails,\n});\n\nexport type PropsFromStore = ReturnType<typeof mapStateToProps>;\nexport default connect(mapStateToProps)(OneAccountPerEmailCard);\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './Callout.scss';\n\nimport { Icon } from '@rmwc/icon';\nimport { Theme, ThemeProvider } from '@rmwc/theme';\nimport { Typography } from '@rmwc/typography';\nimport React, { ReactNode } from 'react';\n\nimport { CustomThemeProvider, CustomThemeType, Type } from '../../themes';\n\nexport interface CalloutProps {\n  /** Custom icon to override the default */\n  icon?: string;\n  /** Show a lighter version of the callout */\n  aside?: true;\n  /** The color scheme of the callout. Defaults to 'note' */\n  type?: CustomThemeType;\n\n  /** Action buttons */\n  actions?: ReactNode;\n}\n\nconst DEFAULT_ICON_MAP: Record<string, string> = {\n  [Type.CAUTION]: 'error',\n  [Type.NOTE]: 'info',\n  [Type.SUCCESS]: 'check_circle',\n  [Type.TIP]: 'star',\n  [Type.WARNING]: 'warning',\n};\n\nexport const Callout: React.FC<CalloutProps> = ({\n  children,\n  actions,\n  icon,\n  aside,\n  type = Type.NOTE,\n}) => {\n  const iconName = icon || DEFAULT_ICON_MAP[type];\n  const asideClass = aside ? ' Callout-aside' : '';\n  const classes = `Callout Callout-${type}${asideClass}`;\n\n  return (\n    <CustomThemeProvider use={type} wrap>\n      <Theme\n        className={classes}\n        use={aside ? [] : ['onPrimary', 'primaryBg']}\n        tag=\"div\"\n      >\n        <div className=\"Callout-body\">\n          <div className=\"Callout-message\">\n            {iconName && (\n              <Icon\n                icon={iconName}\n                aria-hidden=\"true\"\n                className=\"Callout-icon\"\n              />\n            )}\n            <Typography use=\"subtitle2\">{children}</Typography>\n          </div>\n        </div>\n        {/* Make \"white\" the new primary, just to invert buttons from props */}\n        <ThemeProvider wrap options={aside ? {} : { primary: '#fff' }}>\n          <div className=\"Callout-actions\">{actions}</div>\n        </ThemeProvider>\n      </Theme>\n    </CustomThemeProvider>\n  );\n};\n","/**\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createDialogQueue } from '@rmwc/dialog';\n\nexport const { dialogs, alert, confirm, prompt } = createDialogQueue();\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Button } from '@rmwc/button';\nimport React from 'react';\nimport { MapDispatchToPropsFunction, connect } from 'react-redux';\n\nimport { createStructuredSelector } from '../../../store';\nimport { nukeUsersRequest } from '../../../store/auth/actions';\nimport { hasUsers } from '../../../store/auth/selectors';\nimport { CustomThemeProvider } from '../../../themes';\nimport { confirmClearAll } from './confirmClearAllData';\nimport styles from './UsersCard.module.scss';\n\nexport type Props = PropsFromState & PropsFromDispatch;\nexport const ClearAll: React.FC<Props> = ({ hasUsers, clearAllData }) => {\n  return (\n    <>\n      {hasUsers && (\n        <div className={styles.clearAllButton}>\n          <CustomThemeProvider use=\"warning\" wrap>\n            <Button\n              unelevated\n              onClick={async () => {\n                if (await confirmClearAll()) {\n                  clearAllData();\n                }\n              }}\n            >\n              Clear all data\n            </Button>\n          </CustomThemeProvider>\n        </div>\n      )}\n    </>\n  );\n};\n\nexport interface PropsFromDispatch {\n  clearAllData: typeof nukeUsersRequest;\n}\n\nexport const mapStateToProps = createStructuredSelector({\n  hasUsers: hasUsers,\n});\nexport type PropsFromState = ReturnType<typeof mapStateToProps>;\n\nexport const mapDispatchToProps: MapDispatchToPropsFunction<\n  PropsFromDispatch,\n  {}\n> = (dispatch) => ({\n  clearAllData: () => dispatch(nukeUsersRequest()),\n});\n\nexport default connect(mapStateToProps, mapDispatchToProps)(ClearAll);\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DialogButton } from '@rmwc/dialog';\nimport React from 'react';\n\nimport { Callout } from '../../common/Callout';\nimport { confirm } from '../../common/DialogQueue';\n\nexport const confirmClearAll = () =>\n  confirm({\n    title: 'Clear all data',\n    body: (\n      <div className=\"Firestore--dialog-body\">\n        <Callout aside type=\"warning\">\n          This will delete all users\n        </Callout>\n      </div>\n    ),\n    // hide standard buttons so as to use `danger` button\n    acceptLabel: null,\n    cancelLabel: null,\n    footer: (\n      <>\n        <DialogButton action=\"close\" type=\"button\" theme=\"secondary\">\n          Cancel\n        </DialogButton>\n        <DialogButton unelevated action=\"accept\" isDefaultAction danger>\n          Delete\n        </DialogButton>\n      </>\n    ),\n  });\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './Field.scss';\n\nimport { randomId } from '@rmwc/base';\nimport { Select, SelectProps } from '@rmwc/select';\nimport { TextField, TextFieldHTMLProps, TextFieldProps } from '@rmwc/textfield';\nimport { HTMLProps } from '@rmwc/types';\nimport { Typography } from '@rmwc/typography';\nimport classnames from 'classnames';\nimport React, { useState } from 'react';\n\ntype Props = {\n  fieldClassName?: string;\n  tip?: string;\n  error?: React.ReactNode | string;\n} & TextFieldProps &\n  TextFieldHTMLProps;\n\nexport const Field: React.FC<Props> = ({\n  fieldClassName,\n  label,\n  // strip fullwidth or outlined, always use outlined\n  fullwidth,\n  outlined,\n  tip,\n  error,\n  ...textFieldProps\n}) => {\n  const [id] = useState(randomId('field'));\n  const [subtextId] = useState(randomId('field-subtext'));\n  return (\n    <div className={classnames('Field', fieldClassName)}>\n      <Typography\n        className=\"Field-label\"\n        use=\"body2\"\n        theme=\"secondary\"\n        tag=\"label\"\n        htmlFor={id}\n      >\n        {label}\n      </Typography>\n      <TextField\n        outlined\n        aria-describedby={subtextId}\n        invalid={!!error}\n        aria-invalid={!!error}\n        {...textFieldProps}\n        tag=\"div\"\n        id={id}\n      />\n      <div className=\"Field-subtext\" id={subtextId}>\n        {error ? (\n          <Typography\n            className=\"Field-tip\"\n            role=\"alert\"\n            use=\"body2\"\n            theme=\"error\"\n          >\n            {error}\n          </Typography>\n        ) : (\n          tip && (\n            <Typography className=\"Field-tip\" use=\"body2\" theme=\"secondary\">\n              {tip}\n            </Typography>\n          )\n        )}\n      </div>\n    </div>\n  );\n};\n\ntype SelectFieldProps = {\n  fieldClassName?: string;\n  tip?: string;\n  error?: string;\n} & SelectProps &\n  HTMLProps<HTMLSelectElement>;\n\nexport const SelectField: React.FC<SelectFieldProps> = ({\n  fieldClassName,\n  label,\n  // strip outlined bool, always use outlined\n  outlined,\n  tip,\n  theme, // TODO: 5.0 theme, incompatible with 6.0 remove at 6.0\n  error,\n  ...selectProps\n}) => {\n  const [id] = useState(randomId());\n  return (\n    <div className={classnames('Field', fieldClassName)}>\n      <Typography\n        className=\"Field-label\"\n        use=\"body2\"\n        theme=\"secondary\"\n        tag=\"label\"\n        htmlFor={id}\n      >\n        {label}\n      </Typography>\n      <Select outlined {...selectProps} id={id} />\n      <div className=\"Field-subtext\">\n        {error ? (\n          <Typography className=\"Field-tip\" use=\"body2\" theme=\"error\">\n            {error}\n          </Typography>\n        ) : (\n          tip && (\n            <Typography className=\"Field-tip\" use=\"body2\" theme=\"secondary\">\n              {tip}\n            </Typography>\n          )\n        )}\n      </div>\n    </div>\n  );\n};\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// This assert is not exported and is intentionally inconsistent with the rest of the app.\nfunction assert(assertion: unknown, error: string): asserts assertion {\n  if (!assertion) {\n    throw new Error(error);\n  }\n}\n\nconst BadRequestError = Error;\n\n/**\n * The code below has been copy-pasted from firebase-tools repo as is.\n * https://github.com/firebase/firebase-tools/blob/14977a2df4f046c6439167e9037373363db648a2/src/emulator/auth/operations.ts#L1350\n */\nconst CUSTOM_ATTRIBUTES_MAX_LENGTH = 1000;\n\nexport function validateSerializedCustomClaims(claims: string): void {\n  assert(claims.length <= CUSTOM_ATTRIBUTES_MAX_LENGTH, 'CLAIMS_TOO_LARGE');\n\n  let parsed;\n  try {\n    parsed = JSON.parse(claims);\n  } catch {\n    throw new BadRequestError('INVALID_CLAIMS');\n  }\n  validateCustomClaims(parsed);\n}\n\n// https://firebase.google.com/docs/auth/admin/create-custom-tokens#create_custom_tokens_using_the_firebase_admin_sdk\nconst FORBIDDEN_CUSTOM_CLAIMS = [\n  'iss',\n  'aud',\n  'sub',\n  'iat',\n  'exp',\n  'nbf',\n  'jti',\n  'nonce',\n  'azp',\n  'acr',\n  'amr',\n  'cnf',\n  'auth_time',\n  'firebase',\n  'at_hash',\n  'c_hash',\n];\n\nfunction validateCustomClaims(\n  claims: unknown\n): asserts claims is Record<string, unknown> {\n  // Only JSON objects (maps) are valid. Others are not.\n  assert(\n    typeof claims === 'object' && claims != null && !Array.isArray(claims),\n    'INVALID_CLAIMS'\n  );\n  for (const reservedField of FORBIDDEN_CUSTOM_CLAIMS) {\n    assert(!(reservedField in claims), `FORBIDDEN_CLAIM : ${reservedField}`);\n  }\n}\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Typography } from '@rmwc/typography';\nimport React from 'react';\nimport { FormContextValues } from 'react-hook-form/dist/contextTypes';\n\nimport { Field } from '../../../common/Field';\nimport { AddAuthUserPayload } from '../../types';\nimport styles from './controls.module.scss';\nimport { validateSerializedCustomClaims } from './customClaimsValidation';\n\nfunction validate(attributes: string) {\n  if (attributes === '') {\n    return true;\n  }\n\n  try {\n    // We're reusing server validation.\n    validateSerializedCustomClaims(attributes);\n    return true;\n  } catch (e) {\n    if (e.message === 'INVALID_CLAIMS') {\n      return 'Custom claims must be a valid JSON object';\n    }\n    if (e.message === 'CLAIMS_TOO_LARGE') {\n      return 'Custom claims length must not exceed 1000 characters';\n    }\n    const forbiddenClaim = e.message.match(/FORBIDDEN_CLAIM : (\\w+)$/);\n    if (forbiddenClaim && forbiddenClaim[1]) {\n      return 'Custom claims must not have forbidden key: ' + forbiddenClaim[1];\n    }\n  }\n}\n\nconst CUSTOM_ATTRIBUTES_CONTROL_NAME = 'customAttributes';\n\nexport const CustomAttributes: React.FC<\n  FormContextValues<AddAuthUserPayload>\n> = ({ errors, register }) => {\n  const label = (\n    <label>\n      <Typography use=\"subtitle2\" tag=\"div\" theme=\"textPrimaryOnBackground\">\n        Custom claims (optional)\n      </Typography>\n    </label>\n  );\n  return (\n    <div className={styles.customAttributesWrapper}>\n      <Field\n        inputRef={register({ validate })}\n        error={errors[CUSTOM_ATTRIBUTES_CONTROL_NAME]?.message}\n        name={CUSTOM_ATTRIBUTES_CONTROL_NAME}\n        label={label}\n        textarea\n        placeholder={`Enter valid json, e.g. {\"role\":\"admin\"}`}\n      />\n      <Typography use=\"body2\">\n        These custom key:value attributes can be used with Rules to implement\n        various access control strategies (e.g. based on roles).{' '}\n        <a\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n          href=\"https://firebase.google.com/docs/auth/admin/custom-claims\"\n        >\n          Learn more\n        </a>\n      </Typography>\n    </div>\n  );\n};\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { CircularProgress } from '@rmwc/circular-progress';\nimport React, { useEffect, useRef, useState } from 'react';\nimport { FormContextValues } from 'react-hook-form/dist/contextTypes';\n\nimport { Field } from '../../../common/Field';\nimport { AddAuthUserPayload } from '../../types';\nimport styles from '../UserFormDialog.module.scss';\n\nenum ImagePreviewStatus {\n  NONE = 'NONE',\n  LOADING = 'LOADING',\n  LOADED = 'LOADED',\n  ERROR = 'ERROR',\n}\n\nexport type ImageUrlInputProps = FormContextValues<AddAuthUserPayload> & {\n  ImageConstructor?: typeof Image;\n};\n\nexport const ImageUrlInput: React.FC<ImageUrlInputProps> = ({\n  register,\n  watch,\n  triggerValidation,\n  ImageConstructor,\n}) => {\n  ImageConstructor = ImageConstructor || Image;\n  const [previewUrl, setPreviewUrl] = useState('');\n  const image = useRef(new ImageConstructor());\n  const imageUrlRef = useRef('');\n  const status = useRef(ImagePreviewStatus.NONE);\n  const photoUrl = watch('photoUrl') || '';\n\n  useEffect(() => {\n    const img = image.current;\n\n    img.onload = () => {\n      if (status.current === ImagePreviewStatus.LOADING) {\n        status.current = ImagePreviewStatus.LOADED;\n        setPreviewUrl(imageUrlRef.current);\n        triggerValidation('photoUrl');\n      }\n    };\n    img.onerror = () => {\n      if (status.current === ImagePreviewStatus.LOADING) {\n        status.current = ImagePreviewStatus.ERROR;\n        setPreviewUrl('');\n        triggerValidation('photoUrl');\n      }\n    };\n\n    return () => {\n      img.onload = null;\n      img.onerror = null;\n    };\n  }, [triggerValidation]);\n\n  useEffect(() => {\n    if (photoUrl.trim() !== '') {\n      status.current = ImagePreviewStatus.LOADING;\n      imageUrlRef.current = photoUrl;\n      image.current.src = photoUrl;\n    } else {\n      status.current = ImagePreviewStatus.NONE;\n    }\n    triggerValidation('photoUrl');\n  }, [photoUrl, triggerValidation]);\n\n  const validate = () => {\n    return (\n      status.current === ImagePreviewStatus.LOADED ||\n      status.current === ImagePreviewStatus.NONE\n    );\n  };\n\n  return (\n    <>\n      <Field\n        name=\"photoUrl\"\n        label=\"User photo URL (optional)\"\n        placeholder=\"Enter URL\"\n        error={\n          status.current === ImagePreviewStatus.ERROR && 'Error loading image'\n        }\n        type=\"text\"\n        inputRef={register({ validate })}\n      />\n      {status.current === ImagePreviewStatus.LOADED && (\n        <img className={styles.image} src={previewUrl} alt=\"Profile preview\" />\n      )}\n      {status.current === ImagePreviewStatus.LOADING && (\n        <div\n          className={styles.imageWrapper}\n          aria-busy=\"true\"\n          aria-live=\"polite\"\n          data-testid=\"spinner\"\n        >\n          <CircularProgress size=\"large\" />\n        </div>\n      )}\n    </>\n  );\n};\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Typography } from '@rmwc/typography';\nimport React, { useEffect } from 'react';\nimport { FormContextValues } from 'react-hook-form/dist/contextTypes';\nimport { connect } from 'react-redux';\n\nimport { createStructuredSelector } from '../../../../store';\nimport { getAllEmails, isEditingUser } from '../../../../store/auth/selectors';\nimport { Field } from '../../../common/Field';\nimport { AddAuthUserPayload } from '../../types';\nimport styles from './controls.module.scss';\n\n// Consistent with the Auth JS SDK and the Auth Emulator.\nconst EMAIL_REGEX = /^[^@]+@[^@]+$/;\nconst PASSWORD_MIN_LENGTH = 6;\n\nfunction getErrorText(errors: any) {\n  if (errors.email) {\n    if (errors.email.type === 'pattern') {\n      return 'Invalid email';\n    }\n    if (errors.email.type === 'validate') {\n      return 'User with this email already exists';\n    }\n  }\n\n  if (errors.emailpassword) {\n    return 'Both email and password should be present';\n  }\n  if (errors.password) {\n    return `Password should be at least ${PASSWORD_MIN_LENGTH} characters`;\n  }\n}\n\nexport type EmailPasswordProps = PropsFromState & { editedUserEmail?: string };\nexport const EmailPassword: React.FC<\n  EmailPasswordProps & FormContextValues<AddAuthUserPayload>\n> = ({\n  register,\n  watch,\n  setError,\n  clearError,\n  errors,\n  allEmails,\n  editedUserEmail,\n  isEditing,\n}) => {\n  const email = watch('email');\n  const password = watch('password');\n\n  useEffect(() => {\n    if (\n      (email === '' && password === '') ||\n      (email !== '' && (password !== '' || isEditing))\n    ) {\n      clearError('emailpassword' as any);\n    } else {\n      setError('emailpassword' as any, 'both');\n    }\n  }, [email, password, clearError, setError, isEditing]);\n\n  function validate(value: string) {\n    return value === editedUserEmail || !allEmails.has(value);\n  }\n\n  return (\n    <>\n      <Typography\n        use=\"body1\"\n        tag=\"div\"\n        className={styles.authKindLabel}\n        theme=\"textPrimaryOnBackground\"\n      >\n        Email authentication\n      </Typography>\n      <div className={styles.emailWrapper}>\n        <Field\n          name=\"email\"\n          placeholder=\"Enter email\"\n          label=\"Email\"\n          type=\"text\"\n          inputRef={register({ validate, pattern: EMAIL_REGEX })}\n        />\n        <Field\n          name=\"password\"\n          type=\"text\"\n          label=\"Password\"\n          placeholder=\"Enter password\"\n          inputRef={register({ minLength: PASSWORD_MIN_LENGTH })}\n        />\n      </div>\n      <Typography\n        className={styles.error}\n        use=\"body2\"\n        role=\"alert\"\n        theme=\"error\"\n      >\n        {getErrorText(errors)}\n      </Typography>\n    </>\n  );\n};\n\nexport const mapStateToProps = createStructuredSelector({\n  allEmails: getAllEmails,\n  isEditing: isEditingUser,\n});\nexport type PropsFromState = ReturnType<typeof mapStateToProps>;\n\nexport default connect(mapStateToProps)(EmailPassword);\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Typography } from '@rmwc/typography';\nimport React from 'react';\nimport { FormContextValues } from 'react-hook-form/dist/contextTypes';\nimport { connect } from 'react-redux';\n\nimport { createStructuredSelector } from '../../../../store';\nimport { getAllPhoneNumbers } from '../../../../store/auth/selectors';\nimport { Field } from '../../../common/Field';\nimport { AddAuthUserPayload } from '../../types';\nimport styles from './controls.module.scss';\n\n// Consistent with the back-end validation. We want to be as loose as possible in\n// the emulator to avoid false negatives.\nconst PHONE_REGEX = /^\\+/;\n\nexport type PhoneControlProps = PropsFromState & {\n  editedUserPhoneNumber?: string;\n};\n\nexport const PhoneControl: React.FC<\n  PhoneControlProps & FormContextValues<AddAuthUserPayload>\n> = ({ register, errors, allPhoneNumbers, editedUserPhoneNumber }) => {\n  function validate(value: string) {\n    return editedUserPhoneNumber === value || !allPhoneNumbers.has(value);\n  }\n\n  function getErrorText() {\n    if (errors.phoneNumber) {\n      if (errors.phoneNumber.type === 'pattern') {\n        return 'Phone number must be in international format and start with a \"+\"';\n      }\n      if (errors.phoneNumber.type === 'validate') {\n        return 'User with this phone number already exists';\n      }\n    }\n  }\n\n  return (\n    <>\n      <Typography\n        use=\"body1\"\n        tag=\"div\"\n        className={styles.authKindLabel}\n        theme=\"textPrimaryOnBackground\"\n      >\n        Phone authentication\n      </Typography>\n      <Field\n        name=\"phoneNumber\"\n        label=\"Phone\"\n        placeholder=\"Enter phone number\"\n        type=\"tel\"\n        error={getErrorText()}\n        inputRef={register({ pattern: PHONE_REGEX, validate })}\n      />\n    </>\n  );\n};\n\nexport const mapStateToProps = createStructuredSelector({\n  allPhoneNumbers: getAllPhoneNumbers,\n});\nexport type PropsFromState = ReturnType<typeof mapStateToProps>;\n\nexport default connect(mapStateToProps)(PhoneControl);\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ListDivider } from '@rmwc/list';\nimport { Typography } from '@rmwc/typography';\nimport React, { useEffect } from 'react';\nimport { FormContextValues } from 'react-hook-form/dist/contextTypes';\n\nimport { AddAuthUserPayload } from '../../types';\nimport styles from './controls.module.scss';\nimport EmailPassword from './EmailPassword';\nimport PhoneControl from './PhoneControl';\n\nconst ERROR_AT_LEAST_ONE_METHOD_REQUIRED = 'atLeastOneMethodRequired';\n\nexport type SignInMethodProps = {\n  user?: AddAuthUserPayload;\n};\nexport const SignInMethod: React.FC<\n  SignInMethodProps & FormContextValues<AddAuthUserPayload>\n> = (form) => {\n  const { watch, setError, clearError, formState, errors, user } = form;\n  const email = watch('email');\n  const password = watch('password');\n  const phoneNumber = watch('phoneNumber');\n\n  useEffect(() => {\n    const hasEmail = email !== '';\n    const hasPhone = !!phoneNumber;\n\n    if (hasEmail || hasPhone) {\n      // According to docs ClearError should accept arbitrary key\n      // to allow cross-field validation, but it's not the case here for some\n      // reason.\n      clearError(ERROR_AT_LEAST_ONE_METHOD_REQUIRED as any);\n    } else {\n      setError(ERROR_AT_LEAST_ONE_METHOD_REQUIRED as any);\n    }\n  }, [email, password, clearError, setError, phoneNumber, errors]);\n\n  const isTouched =\n    formState.touched['email'] || formState.touched['phoneNumber'];\n  const isOnlyError =\n    ERROR_AT_LEAST_ONE_METHOD_REQUIRED in errors &&\n    Object.values(errors).length === 1;\n\n  return (\n    <div className={styles.signInWrapper}>\n      <ListDivider tag=\"div\" />\n      <div className={styles.signInHeader}>\n        <Typography use=\"body1\" theme=\"textPrimaryOnBackground\">\n          Authentication method\n        </Typography>\n        {isTouched && isOnlyError ? (\n          <Typography use=\"body2\" theme=\"error\" tag=\"div\" role=\"alert\">\n            One method is required. Please enter either an email/password or\n            phone number.\n          </Typography>\n        ) : (\n          <Typography use=\"body2\" tag=\"div\">\n            Enter details for at least one of the following methods:\n          </Typography>\n        )}\n      </div>\n      <EmailPassword {...form} editedUserEmail={user?.email} />\n      <PhoneControl {...form} editedUserPhoneNumber={user?.phoneNumber} />\n    </div>\n  );\n};\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Button } from '@rmwc/button';\nimport {\n  Dialog,\n  DialogActions,\n  DialogButton,\n  DialogContent,\n  DialogTitle,\n} from '@rmwc/dialog';\nimport React, { useCallback } from 'react';\nimport { useForm } from 'react-hook-form';\nimport { MapDispatchToPropsFunction, connect } from 'react-redux';\n\nimport { createStructuredSelector } from '../../../store';\nimport {\n  clearAuthUserDialogData,\n  createUserRequest,\n  updateUserRequest,\n} from '../../../store/auth/actions';\nimport {\n  getAuthUserDialog,\n  getCurrentEditedUser,\n} from '../../../store/auth/selectors';\nimport { hasError } from '../../../store/utils';\nimport { Callout } from '../../common/Callout';\nimport { Field } from '../../common/Field';\nimport { AddAuthUserPayload } from '../types';\nimport { CustomAttributes } from './controls/CustomAttributes';\nimport { ImageUrlInput } from './controls/ImageUrlInput';\nimport { SignInMethod } from './controls/SignInMethod';\n\nexport type UserFormProps = PropsFromState & PropsFromDispatch;\nexport const UserForm: React.FC<UserFormProps> = ({\n  authUserDialogData,\n  clearAuthUserDialogData,\n  updateUser,\n  createUser,\n  user,\n}) => {\n  const isEditing = !!user;\n  const localId = user?.localId!;\n\n  const form = useForm<AddAuthUserPayload>({\n    defaultValues: user,\n    mode: 'onChange',\n  });\n\n  const save = useCallback(\n    (user: AddAuthUserPayload, keepDialogOpen?: boolean) => {\n      if (isEditing) {\n        updateUser({ user, localId });\n      } else {\n        createUser({ user, keepDialogOpen });\n      }\n    },\n    [isEditing, updateUser, createUser, localId]\n  );\n\n  const { register, handleSubmit, formState, reset, errors } = form;\n\n  const canSubmit = !authUserDialogData?.loading && formState.isValid;\n\n  const submit = useCallback(\n    (user: AddAuthUserPayload) => {\n      // Take into account multi-field errors.\n      if (Object.values(errors).length === 0) {\n        save(user);\n      }\n    },\n    [errors, save]\n  );\n\n  return (\n    <Dialog renderToPortal open onClose={clearAuthUserDialogData}>\n      <DialogTitle>\n        {user ? `Edit User ${user.displayName}` : 'Add a user'}\n      </DialogTitle>\n\n      <form onSubmit={handleSubmit(submit)} data-testid=\"user-form\">\n        <DialogContent>\n          <Field\n            name=\"displayName\"\n            label=\"Display name (optional)\"\n            type=\"text\"\n            placeholder=\"Enter display name\"\n            error={errors?.displayName && 'Display name is required'}\n            inputRef={register({})}\n          />\n\n          <ImageUrlInput {...form} />\n          <CustomAttributes {...form} />\n          <SignInMethod {...form} user={user} />\n          {hasError(authUserDialogData?.result) && (\n            <Callout type=\"warning\">\n              Error: {authUserDialogData?.result.error}\n            </Callout>\n          )}\n        </DialogContent>\n        <DialogActions>\n          <DialogButton action=\"close\" type=\"button\" theme=\"secondary\">\n            Cancel\n          </DialogButton>\n          {!isEditing && (\n            <Button\n              onClick={handleSubmit((result) => {\n                save(result, /* keepDialogOpen */ true);\n                reset(user);\n              })}\n              disabled={!canSubmit}\n              type=\"button\"\n            >\n              Save and create another\n            </Button>\n          )}\n\n          <DialogButton disabled={!canSubmit} type=\"submit\" unelevated>\n            Save\n          </DialogButton>\n        </DialogActions>\n      </form>\n    </Dialog>\n  );\n};\n\nexport interface PropsFromDispatch {\n  clearAuthUserDialogData: typeof clearAuthUserDialogData;\n  updateUser: typeof updateUserRequest;\n  createUser: typeof createUserRequest;\n}\n\nexport const mapStateToProps = createStructuredSelector({\n  authUserDialogData: getAuthUserDialog,\n  user: getCurrentEditedUser,\n});\nexport type PropsFromState = ReturnType<typeof mapStateToProps>;\n\nexport const mapDispatchToProps: MapDispatchToPropsFunction<\n  PropsFromDispatch,\n  {}\n> = (dispatch) => {\n  return {\n    clearAuthUserDialogData: () => dispatch(clearAuthUserDialogData()),\n    updateUser: (d) => dispatch(updateUserRequest(d)),\n    createUser: (d) => dispatch(createUserRequest(d)),\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(UserForm);\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './CardActionBar.scss';\n\nimport { Theme, ThemeProvider } from '@rmwc/theme';\nimport classnames from 'classnames';\nimport React from 'react';\n\nimport { grey100 } from '../../colors';\n\nexport const CardActionBar: React.FC<{ className?: string }> = ({\n  className,\n  children,\n}) => {\n  return (\n    <ThemeProvider\n      options={{ surface: grey100 }}\n      className={classnames('CardActionBar', className)}\n    >\n      <Theme use={['surface']} className=\"CardActionBar-container\" tag=\"div\">\n        {children}\n      </Theme>\n    </ThemeProvider>\n  );\n};\n\nexport const CardActionBarActions: React.FC = ({ children }) => {\n  return (\n    <>\n      <span style={{ flex: '1 auto' }} />\n      <div className=\"CardActionBar-actions\">{children}</div>\n    </>\n  );\n};\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { TextField } from '@rmwc/textfield';\nimport keycode from 'keycode';\nimport React, { useLayoutEffect, useRef } from 'react';\nimport { MapDispatchToPropsFunction, connect } from 'react-redux';\n\nimport { createStructuredSelector } from '../../../../store';\nimport { updateFilter } from '../../../../store/auth/actions';\nimport { getFilter } from '../../../../store/auth/selectors';\nimport styles from './AuthFilter.module.scss';\n\nexport const AuthFilter: React.FC<AuthFilterProps> = ({\n  filter,\n  updateFilter,\n}) => {\n  const clear = () => updateFilter({ filter: '' });\n  const filterEl = useRef<HTMLInputElement>(null);\n\n  // Focus on init and also on clear.\n  useLayoutEffect(() => {\n    if (filter === '') {\n      filterEl.current?.focus();\n    }\n  }, [filter]);\n\n  return (\n    <>\n      <form\n        role=\"search\"\n        className={styles.filterForm}\n        onSubmit={(e) => {\n          e.preventDefault();\n        }}\n      >\n        <TextField\n          onChange={(input: React.ChangeEvent<HTMLInputElement>) => {\n            updateFilter({ filter: input.target.value });\n          }}\n          placeholder=\"Search by user UID, email address, phone number, or display name\"\n          value={filter}\n          aria-label=\"filter\"\n          fullwidth\n          type=\"text\"\n          inputRef={filterEl}\n          outlined={false}\n          ripple={false}\n          icon=\"search\"\n          className={styles.filterTextField}\n          trailingIcon={\n            filter && {\n              icon: 'close',\n              role: 'button',\n              'aria-label': 'clear',\n              onClick: clear,\n              onKeyDown: (e: React.KeyboardEvent) => {\n                if (\n                  e.keyCode === keycode('spacebar') ||\n                  e.keyCode === keycode('enter')\n                ) {\n                  clear();\n                  e.preventDefault();\n                }\n              },\n            }\n          }\n        />\n      </form>\n    </>\n  );\n};\n\nexport interface PropsFromStore {\n  filter: string;\n}\n\nexport type AuthFilterProps = PropsFromStore & PropsFromDispatch;\n\nexport const mapStateToProps = createStructuredSelector({\n  filter: getFilter,\n});\n\nexport interface PropsFromDispatch {\n  updateFilter: typeof updateFilter;\n}\n\nexport const mapDispatchToProps: MapDispatchToPropsFunction<\n  PropsFromDispatch,\n  {}\n> = (dispatch) => ({\n  updateFilter: (f) => dispatch(updateFilter(f)),\n});\n\nexport default connect(mapStateToProps, mapDispatchToProps)(AuthFilter);\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { IconButton } from '@rmwc/icon-button';\nimport React from 'react';\nimport { MapDispatchToPropsFunction, connect } from 'react-redux';\n\nimport { authFetchUsersRequest } from '../../../../store/auth/actions';\n\nexport const RefreshButton: React.FC<PropsFromDispatch> = ({ refresh }) => {\n  return (\n    <IconButton\n      onClick={refresh}\n      icon=\"refresh\"\n      label=\"Refresh\"\n      theme=\"secondary\"\n    />\n  );\n};\n\nexport interface PropsFromDispatch {\n  refresh: typeof authFetchUsersRequest;\n}\n\nexport const mapDispatchToProps: MapDispatchToPropsFunction<\n  PropsFromDispatch,\n  {}\n> = (dispatch) => {\n  return {\n    refresh: () => dispatch(authFetchUsersRequest()),\n  };\n};\n\nexport default connect(null, mapDispatchToProps)(RefreshButton);\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Button } from '@rmwc/button';\nimport React from 'react';\n\nimport {\n  CardActionBar,\n  CardActionBarActions,\n} from '../../../common/CardActionBar';\nimport AuthFilter from './AuthFilter';\nimport styles from './AuthHeader.module.scss';\nimport RefreshButton from './RefreshButton';\n\nexport interface AuthHeaderProps {\n  onOpenNewUserDialog: () => void;\n}\n\nexport const AuthHeader: React.FC<AuthHeaderProps> = ({\n  onOpenNewUserDialog,\n}) => {\n  return (\n    <>\n      <CardActionBar>\n        <AuthFilter />\n        <div className={styles.barActions}>\n          <CardActionBarActions>\n            <RefreshButton />\n            <Button\n              className={styles.addUserButton}\n              unelevated\n              onClick={() => onOpenNewUserDialog()}\n            >\n              Add user\n            </Button>\n          </CardActionBarActions>\n        </div>\n      </CardActionBar>\n    </>\n  );\n};\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Typography } from '@rmwc/typography';\nimport React from 'react';\n\nimport styles from './UsersTable.module.scss';\n\nexport const AuthZeroState: React.FC = () => {\n  return (\n    <Typography\n      use=\"body2\"\n      className={styles.noResultsWrapper}\n      theme=\"textSecondaryOnBackground\"\n    >\n      No users for this project yet\n    </Typography>\n  );\n};\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DialogButton } from '@rmwc/dialog';\nimport React from 'react';\n\nimport { Callout } from '../../../common/Callout';\nimport { confirm } from '../../../common/DialogQueue';\nimport { AuthUser } from '../../types';\n\nexport const confirmDeleteUser = (user: AuthUser) =>\n  confirm({\n    title: 'Delete user',\n    body: (\n      <div className=\"Firestore--dialog-body\">\n        <Callout aside type=\"warning\">\n          This will delete user with uid {user.localId}\n        </Callout>\n      </div>\n    ),\n    // hide standard buttons so as to use `danger` button\n    acceptLabel: null,\n    cancelLabel: null,\n    footer: (\n      <>\n        <DialogButton action=\"close\" type=\"button\" theme=\"secondary\">\n          Cancel\n        </DialogButton>\n        <DialogButton unelevated action=\"accept\" isDefaultAction danger>\n          Delete\n        </DialogButton>\n      </>\n    ),\n  });\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Typography } from '@rmwc/typography';\nimport React from 'react';\n\nimport styles from './UsersTable.module.scss';\n\nexport const NoResults: React.FC = () => {\n  return (\n    <Typography\n      use=\"body2\"\n      aria-live=\"polite\"\n      theme=\"textSecondaryOnBackground\"\n      className={styles.noResultsWrapper}\n    >\n      No results\n    </Typography>\n  );\n};\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { RemoteResult } from '../../store/utils';\n\n/** View model for Auth custom attributes */\nexport interface CustomAttribute {\n  role: string;\n  value: string;\n}\n\n/**\n * Field names are consistent with:\n * https://github.com/FirebasePrivate/firebase-tools/blob/d6b584da9f852313064d32dd219a6f23b7800d66/src/emulator/auth/schema.ts#L1670-L1779\n */\nexport interface AddAuthUserPayload {\n  customAttributes?: string;\n  displayName?: string;\n  photoUrl?: string;\n  screenName?: string;\n  email?: string;\n  password?: string;\n  phoneNumber?: string;\n}\n\nexport const providerToIconMap = {\n  'gc.apple.com': 'assets/provider-icons/auth_service_game_center.svg',\n  'apple.com': 'assets/provider-icons/auth_service_apple.svg',\n  'facebook.com': 'assets/provider-icons/auth_service_facebook.svg',\n  'github.com': 'assets/provider-icons/auth_service_github.svg',\n  'google.com': 'assets/provider-icons/auth_service_google.svg',\n  'microsoft.com': 'assets/provider-icons/auth_service_mslive.svg',\n  'playgames.google.com': 'assets/provider-icons/auth_service_play_games.svg',\n  'twitter.com': 'assets/provider-icons/auth_service_twitter.svg',\n  'yahoo.com': 'assets/provider-icons/auth_service_yahoo.svg',\n  phone: 'assets/provider-icons/auth_service_phone.svg',\n  password: 'assets/provider-icons/auth_service_email.svg',\n  oidc: 'assets/provider-icons/auth_service_oidc.svg',\n  saml: 'assets/provider-icons/auth_service_saml.svg',\n};\n\nexport interface AuthProviderInfo {\n  providerId: keyof typeof providerToIconMap;\n}\n\nexport interface AuthUser extends AddAuthUserPayload {\n  localId: string;\n  createdAt: string;\n  lastLoginAt: string;\n  disabled: boolean;\n  providerUserInfo: AuthProviderInfo[];\n}\n\nexport interface AuthState {\n  authUserDialogData?: RemoteResult<AuthUser | undefined>;\n  users: RemoteResult<AuthUser[]>;\n  filter: string;\n  allowDuplicateEmails: boolean;\n}\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Icon } from '@rmwc/icon';\nimport { Theme } from '@rmwc/theme';\nimport React from 'react';\n\nimport { AuthUser, providerToIconMap } from '../../types';\nimport styles from './ProviderCell.module.scss';\n\nexport interface ProviderCellProps {\n  user: AuthUser;\n}\n\nexport const ProviderCell: React.FC<ProviderCellProps> = ({\n  user,\n}: ProviderCellProps) => {\n  return (\n    <Theme use=\"secondary\">\n      <div className={styles.iconWrapper}>\n        {user.providerUserInfo.map((providerInfo) => {\n          let provider = providerInfo.providerId;\n          if (provider.match(/^saml\\./)) {\n            provider = 'saml';\n          } else if (provider.match(/^oidc\\./)) {\n            provider = 'oidc';\n          }\n          return (\n            providerToIconMap[provider] && (\n              <Icon\n                icon={providerToIconMap[provider]}\n                key={providerInfo.providerId}\n                aria-label={providerInfo.providerId}\n              />\n            )\n          );\n        })}\n      </div>\n    </Theme>\n  );\n};\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  DataTable,\n  DataTableBody,\n  DataTableCell,\n  DataTableContent,\n  DataTableHead,\n  DataTableHeadCell,\n  DataTableRow,\n} from '@rmwc/data-table';\nimport { IconButton } from '@rmwc/icon-button';\nimport { MenuItem, SimpleMenu } from '@rmwc/menu';\nimport React, { useState } from 'react';\nimport { MapDispatchToPropsFunction, connect } from 'react-redux';\n\nimport { createStructuredSelector } from '../../../../store';\nimport {\n  deleteUserRequest,\n  openAuthUserDialog,\n  setUserDisabledRequest,\n} from '../../../../store/auth/actions';\nimport {\n  getFilteredUsers,\n  getShowTable,\n  getShowZeroResults,\n  getShowZeroState,\n} from '../../../../store/auth/selectors';\nimport { RemoteResult, createRemoteDataLoaded } from '../../../../store/utils';\nimport { AuthUser } from '../../types';\nimport { AuthZeroState } from './AuthZeroState';\nimport { confirmDeleteUser } from './confirmDeleteUser';\nimport { NoResults } from './NoResults';\nimport { ProviderCell } from './ProviderCell';\nimport styles from './UsersTable.module.scss';\n\nexport type UsersTableProps = PropsFromDispatch & PropsFromStore;\n\ninterface UserTableRowProps {\n  user: AuthUser;\n  onEditUser: () => void;\n  toggleUserDisabled: () => void;\n  onDeleteUser: () => void;\n}\n\nexport const UsersTableRow: React.FC<UserTableRowProps> = ({\n  user,\n  onEditUser,\n  toggleUserDisabled,\n  onDeleteUser,\n}) => {\n  /*\n   * Simple menu is broken when rendered in portal (it doesn't close)\n   *\n   * So here we're opening and closing it manually. see:\n   * https://github.com/jamesmfriedman/rmwc/issues/627#issuecomment-643238936\n   */\n  const [menuOpen, setMenuOpen] = useState(false);\n  const formattedCreatedAt = new Date(\n    Number(user.createdAt)\n  ).toLocaleDateString();\n  const formattedSignedIn =\n    user.lastLoginAt && new Date(Number(user.lastLoginAt)).toLocaleDateString();\n\n  return (\n    <DataTableRow className={user.disabled ? styles.disabled : ''}>\n      <DataTableCell>\n        {user.displayName || user.email || user.phoneNumber}\n      </DataTableCell>\n      <DataTableCell>{<ProviderCell user={user} />}</DataTableCell>\n      <DataTableCell>{formattedCreatedAt}</DataTableCell>\n      <DataTableCell>{formattedSignedIn}</DataTableCell>\n      <DataTableCell>{user.localId}</DataTableCell>\n      <DataTableCell style={{ width: '20px' }}>\n        <SimpleMenu\n          open={menuOpen}\n          onOpen={() => setMenuOpen(true)}\n          onClose={() => setMenuOpen(false)}\n          handle={\n            <IconButton theme=\"secondary\" icon=\"more_vert\" label=\"Open menu\" />\n          }\n          renderToPortal\n        >\n          <MenuItem\n            onClick={() => {\n              setMenuOpen(false);\n              onEditUser();\n            }}\n          >\n            Edit user\n          </MenuItem>\n          <MenuItem\n            onClick={() => {\n              setMenuOpen(false);\n              toggleUserDisabled();\n            }}\n          >\n            {user.disabled ? 'Enable user' : 'Disable user'}\n          </MenuItem>\n          <MenuItem\n            onClick={() => {\n              setMenuOpen(false);\n              onDeleteUser();\n            }}\n          >\n            Delete user\n          </MenuItem>\n        </SimpleMenu>\n      </DataTableCell>\n    </DataTableRow>\n  );\n};\n\nexport const UsersTable: React.FC<UsersTableProps> = ({\n  filteredUsers,\n  setUserDisabled,\n  deleteUser,\n  shouldShowTable,\n  openAuthUserDialog,\n  shouldShowZeroResults,\n  shouldShowZeroState,\n}) => {\n  return (\n    <>\n      <DataTable className={styles.tableWrapper}>\n        <DataTableContent>\n          <DataTableHead>\n            <DataTableRow>\n              <DataTableHeadCell>Identifier</DataTableHeadCell>\n              <DataTableHeadCell>Provider</DataTableHeadCell>\n              <DataTableHeadCell>Created</DataTableHeadCell>\n              <DataTableHeadCell>Signed In</DataTableHeadCell>\n              <DataTableHeadCell>User UID</DataTableHeadCell>\n            </DataTableRow>\n          </DataTableHead>\n          <DataTableBody>\n            {shouldShowTable &&\n              filteredUsers.map((user) => (\n                <UsersTableRow\n                  key={user.localId}\n                  user={user}\n                  onEditUser={() => {\n                    openAuthUserDialog(createRemoteDataLoaded(user));\n                  }}\n                  toggleUserDisabled={() => {\n                    setUserDisabled({\n                      localId: user.localId,\n                      disabled: !user.disabled,\n                    });\n                  }}\n                  onDeleteUser={async () => {\n                    if (await confirmDeleteUser(user)) {\n                      deleteUser(user);\n                    }\n                  }}\n                />\n              ))}\n          </DataTableBody>\n        </DataTableContent>\n      </DataTable>\n      {shouldShowZeroResults && <NoResults />}\n      {shouldShowZeroState && <AuthZeroState />}\n    </>\n  );\n};\n\nexport const mapStateToProps = createStructuredSelector({\n  shouldShowTable: getShowTable,\n  shouldShowZeroResults: getShowZeroResults,\n  shouldShowZeroState: getShowZeroState,\n  filteredUsers: getFilteredUsers,\n});\n\nexport type PropsFromStore = ReturnType<typeof mapStateToProps>;\n\nexport interface PropsFromDispatch {\n  setUserDisabled: typeof setUserDisabledRequest;\n  deleteUser: typeof deleteUserRequest;\n  openAuthUserDialog: typeof openAuthUserDialog;\n}\n\nexport const mapDispatchToProps: MapDispatchToPropsFunction<\n  PropsFromDispatch,\n  {}\n> = (dispatch) => {\n  return {\n    setUserDisabled: (d) => dispatch(setUserDisabledRequest(d)),\n    deleteUser: (d) => dispatch(deleteUserRequest(d)),\n    openAuthUserDialog: (data: RemoteResult<AuthUser | undefined>) =>\n      dispatch(openAuthUserDialog(data)),\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(UsersTable);\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Card } from '@rmwc/card';\nimport React from 'react';\nimport { MapDispatchToPropsFunction, connect } from 'react-redux';\n\nimport { createStructuredSelector } from '../../../store';\nimport { openAuthUserDialog } from '../../../store/auth/actions';\nimport { getAuthUserDialog } from '../../../store/auth/selectors';\nimport { RemoteResult, createRemoteDataLoaded } from '../../../store/utils';\nimport { AuthUser } from '../types';\nimport UserForm from '../UserFormDialog/UserForm';\nimport { AuthHeader } from './header/AuthHeader';\nimport UsersTable from './table/UsersTable';\n\nexport type UserCardProps = PropsFromDispatch & PropsFromState;\nexport const UsersCard: React.FC<UserCardProps> = ({\n  openAuthUserDialog,\n  authUserDialogData,\n}) => {\n  return (\n    <Card>\n      <AuthHeader\n        onOpenNewUserDialog={() =>\n          openAuthUserDialog(createRemoteDataLoaded(undefined))\n        }\n      />\n      <UsersTable />\n      {authUserDialogData && <UserForm />}\n    </Card>\n  );\n};\n\nexport interface PropsFromDispatch {\n  openAuthUserDialog: typeof openAuthUserDialog;\n}\n\nexport const mapStateToProps = createStructuredSelector({\n  authUserDialogData: getAuthUserDialog,\n});\nexport type PropsFromState = ReturnType<typeof mapStateToProps>;\n\nexport const mapDispatchToProps: MapDispatchToPropsFunction<\n  PropsFromDispatch,\n  {}\n> = (dispatch) => {\n  return {\n    openAuthUserDialog: (data: RemoteResult<AuthUser | undefined>) =>\n      dispatch(openAuthUserDialog(data)),\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(UsersCard);\n","/**\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './index.module.scss';\n\nimport { Elevation } from '@rmwc/elevation';\nimport { GridCell } from '@rmwc/grid';\nimport React, { Suspense, useEffect } from 'react';\nimport { connect } from 'react-redux';\n\nimport { updateAuthConfig } from '../../store/auth/actions';\nimport { AuthConfig } from '../../store/config/types';\nimport {\n  useConfig,\n  useEmulatorConfig,\n  useIsEmulatorDisabled,\n} from '../common/EmulatorConfigProvider';\nimport { EmulatorDisabled } from '../common/EmulatorDisabled';\nimport { Spinner } from '../common/Spinner';\nimport OneAccountPerEmailCard from './OneAccountPerEmailCard/OneAccountPerEmailCard';\nimport ClearAll from './UsersCard/ClearAll';\nimport UsersCard from './UsersCard/UsersCard';\n\nexport const AuthRoute: React.FC = () => {\n  return (\n    <Suspense fallback={<AuthRouteSuspended />}>\n      <AuthWrapper />\n    </Suspense>\n  );\n};\n\nexport default AuthRoute;\n\nexport interface AuthProps {\n  updateAuthConfig(config: { auth: AuthConfig; projectId: string }): void;\n}\n\nexport const Auth: React.FC<AuthProps> = ({ updateAuthConfig }) => {\n  const auth = useEmulatorConfig('auth');\n  const { projectId } = useConfig();\n\n  useEffect(() => {\n    updateAuthConfig({ auth, projectId });\n  }, [auth, projectId, updateAuthConfig]);\n\n  return (\n    <GridCell span={12} className=\"Auth\">\n      <ClearAll />\n      <Elevation z=\"2\" wrap>\n        <UsersCard />\n      </Elevation>\n      <Elevation z=\"2\" wrap>\n        <OneAccountPerEmailCard />\n      </Elevation>\n    </GridCell>\n  );\n};\n\nexport const AuthWrapper = connect(null, { updateAuthConfig })(Auth);\n\nexport const AuthRouteDisabled: React.FC = () => (\n  <EmulatorDisabled productName=\"Auth\" />\n);\n\nconst AuthRouteSuspended: React.FC = () => {\n  const isDisabled = useIsEmulatorDisabled('auth');\n  return isDisabled ? (\n    <EmulatorDisabled productName=\"Auth\" />\n  ) : (\n    <Spinner span={12} message=\"Auth Emulator Loading...\" />\n  );\n};\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport 'firebase/database';\nimport 'firebase/firestore';\n// Force the browser build even in Node.js + jsdom unit tests because jsdom's\n// File/Blob impl is incomplete (https://github.com/jsdom/jsdom/issues/2555)\n// and thus not recognized by node-fetch, used by the Node build of Storage SDK.\n// The browser build works because it uses XHR (also mocked by jsdom).\nimport '@firebase/storage/dist/index.browser.cjs.js';\n\nimport { _FirebaseApp } from '@firebase/app-types/private';\nimport { FirebaseAuthInternal } from '@firebase/auth-interop-types';\nimport { Component, ComponentType } from '@firebase/component';\nimport firebase from 'firebase/app';\nimport { useEffect, useState } from 'react';\n\nimport { useConfig } from './components/common/EmulatorConfigProvider';\nimport { DatabaseConfig } from './store/config';\n\ninterface WindowWithDb extends Window {\n  database?: firebase.database.Database;\n  firestore?: firebase.firestore.Firestore;\n}\n\nexport function initDatabase(\n  config: DatabaseConfig,\n  namespace: string\n): [firebase.database.Database, { cleanup: () => Promise<void> }] {\n  const databaseURL = `http://${config.hostAndPort}/?ns=${namespace}`;\n  const app = firebase.initializeApp(\n    { databaseURL },\n    `Database Component: ${databaseURL} ${Math.random()}`\n  );\n\n  applyAdminAuth(app);\n\n  const db = app.database();\n  // only log the first time\n  if (!(window as WindowWithDb).database) {\n    console.log(`🔥 Realtime Database is available at window.database.\n\n    Try:\n    database.ref().set({hello: 'world!'});\n    database.ref().once('value').then( snap => console.log(snap.val()) );`);\n  }\n  (window as WindowWithDb).database = db;\n  return [db, { cleanup: () => app.delete() }];\n}\n\n/**\n * Get a JS SDK App instance with emulator Admin auth enabled.\n *\n * NOTE: Please make sure parameters are relatively stable (referentially equal\n * most of the time) or App may be recreated very often (expensive and bad UX)!\n *\n * For example, config should almost certainly be wrapped in useMemo, and\n * initialize wrapped in useCallback. (Or just use MODULE-LEVEL constants.)\n *\n * @param name a debug tag for the component using the app\n * @param config config passed into initializeApp. (useMemo recommended!)\n * @param initialize function for app setup. Should contain app.foo.useEmulator\n *   to avoid ever hitting production. (useCallback recommended!)\n * @returns the created app or undefined (only briefly, will fix itself). You\n *   may skip rendering children (return null) during the undefined period.\n */\nexport function useEmulatedFirebaseApp(\n  name: string,\n  config?: object,\n  initialize?: (app: firebase.app.App) => void\n): firebase.app.App | undefined {\n  const { projectId } = useConfig();\n  const [app, setApp] = useState<firebase.app.App | undefined>();\n\n  useEffect(() => {\n    if (!app) {\n      const app = firebase.initializeApp(\n        { ...config, projectId },\n        `${name} component::${Math.random()}`\n      );\n      applyAdminAuth(app);\n      initialize?.(app);\n      setApp(app);\n    }\n\n    return () => {\n      if (app) {\n        setApp(undefined);\n        // Errors may happen if app is already deleted. Ignore them.\n        app.delete().catch(() => {});\n      }\n    };\n  }, [app, name, config, projectId, initialize]);\n\n  return app;\n}\n\nfunction applyAdminAuth(app: firebase.app.App): void {\n  const accessToken = 'owner'; // Accepted as admin by emulators.\n  const mockAuthComponent = new Component(\n    'auth-internal',\n    () =>\n      ({\n        getToken: async () => ({ accessToken: accessToken }),\n        getUid: () => null,\n        addAuthTokenListener: (listener) => {\n          // Call listener once immediately with predefined\n          // accessToken.\n          listener(accessToken);\n        },\n        removeAuthTokenListener: () => {},\n      } as FirebaseAuthInternal),\n    'PRIVATE' as ComponentType\n  );\n\n  ((app as unknown) as _FirebaseApp)._addOrOverwriteComponent(\n    mockAuthComponent\n  );\n}\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './BreadCrumbs.scss';\n\nimport { IconButton } from '@rmwc/icon-button';\nimport { IconPropT } from '@rmwc/types';\nimport { Typography } from '@rmwc/typography';\nimport classnames from 'classnames';\nimport React from 'react';\nimport { Link } from 'react-router-dom';\n\nexport interface Props {\n  /** The base url to prepend when creating Router links */\n  base: string;\n  path: string;\n  onEdit?: () => void;\n  homeElement?: IconPropT;\n}\n\nconst EMPTY_KEYS: string[] = [];\n\nexport const BreadCrumbs: React.FC<Props> = ({\n  base,\n  path,\n  onEdit,\n  children,\n  homeElement = <IconButton icon={'home'} />,\n}) => {\n  const normalizedPath = path.startsWith('/') ? path.substr(1) : path;\n  const keys = normalizedPath ? normalizedPath.split('/') : EMPTY_KEYS;\n\n  const hrefs = keys.reduce<string[]>((acc, key) => {\n    const prevLink = acc.length ? acc[acc.length - 1] : base;\n    acc.push(`${prevLink}/${key}`);\n    return acc;\n  }, []);\n\n  return (\n    <ul role=\"navigation\" className=\"BreadCrumbs\">\n      <li className=\"BreadCrumbs-crumb BreadCrumbs-homeCrumb\">\n        <Link to={base}>\n          <Typography use=\"body2\" theme=\"secondary\">\n            {homeElement}\n          </Typography>\n        </Link>\n      </li>\n\n      {keys.map((key, i) => (\n        <li\n          key={hrefs[i]}\n          className={classnames('BreadCrumbs-crumb', 'BreadCrumbs-link', {\n            'BreadCrumbs-active': i === keys.length - 1,\n          })}\n        >\n          <Link to={hrefs[i]}>{decodeURIComponent(key)}</Link>\n        </li>\n      ))}\n\n      <li\n        className=\"BreadCrumbs-edit\"\n        aria-label=\"Edit URL\"\n        onClick={() => onEdit && onEdit()}\n      >\n        <IconButton icon=\"edit\" label=\"edit\" />\n      </li>\n      <li>{children}</li>\n    </ul>\n  );\n};\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './InteractiveBreadCrumbBar.scss';\n\nimport { Elevation } from '@rmwc/elevation';\nimport { IconButton } from '@rmwc/icon-button';\nimport { TextField } from '@rmwc/textfield';\nimport { Typography } from '@rmwc/typography';\nimport useKey from '@rooks/use-key';\nimport React, {\n  FormEvent,\n  useEffect,\n  useLayoutEffect,\n  useRef,\n  useState,\n} from 'react';\n\nimport { Props as BreadCrumbProps, BreadCrumbs } from './BreadCrumbs';\nimport { CardActionBar } from './CardActionBar';\n\ninterface Props extends BreadCrumbProps {\n  /** The input prefix to show before the editable input */\n  inputPrefix?: string;\n  onNavigate: (path: string) => void;\n}\n\nexport const InteractiveBreadCrumbBar: React.FC<Props> = ({\n  onNavigate,\n  children,\n  inputPrefix,\n  path,\n  ...breadCrumbProps\n}) => {\n  const [isEditing, setIsEditing] = useState(false);\n  const [value, setValue] = useState(path);\n\n  // Update input's path value if path prop changes\n  useEffect(() => setValue(path), [path]);\n\n  const handleSubmit = (e: FormEvent) => {\n    e.preventDefault();\n    const normalizedPath = value.startsWith('/') ? value.substr(1) : value;\n    onNavigate(normalizedPath);\n    setIsEditing(false);\n  };\n\n  const handleEdit = () => {\n    setIsEditing(true);\n  };\n\n  const handleCancel = () => {\n    setIsEditing(false);\n    setValue(path);\n  };\n\n  const inputRef = useRef<HTMLInputElement>(null);\n  useKey(['Escape'], handleCancel, {\n    eventTypes: ['keypress', 'keydown', 'keyup'],\n    target: inputRef,\n    when: true,\n  });\n\n  useLayoutEffect(() => {\n    if (inputRef.current) {\n      inputRef.current.select();\n    }\n  }, [isEditing, inputRef]);\n\n  return (\n    <div className=\"InteractiveBreadCrumbBar\">\n      {isEditing ? (\n        <Elevation z={1} wrap>\n          <form\n            className=\"InteractiveBreadCrumbBar-form\"\n            onSubmit={handleSubmit}\n          >\n            {inputPrefix && (\n              <Typography\n                use=\"body2\"\n                className=\"InteractiveBreadCrumbBar-prefix\"\n                theme=\"secondary\"\n              >\n                {inputPrefix}\n              </Typography>\n            )}\n            <TextField\n              aria-label=\"Document path\"\n              fullwidth\n              className=\"value\"\n              type=\"text\"\n              onBlur={handleCancel}\n              value={value}\n              onChange={(e) => setValue(e.currentTarget.value)}\n              inputRef={inputRef}\n            />\n            <IconButton\n              label=\"Cancel\"\n              type=\"button\"\n              icon=\"close\"\n              onClick={handleCancel}\n              theme=\"secondary\"\n            />\n          </form>\n        </Elevation>\n      ) : (\n        <CardActionBar className=\"top\">\n          <BreadCrumbs path={path} {...breadCrumbProps} onEdit={handleEdit}>\n            {children}\n          </BreadCrumbs>\n        </CardActionBar>\n      )}\n    </div>\n  );\n};\n","/**\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport firebase from 'firebase';\n\nimport { initDatabase } from '../../firebase';\nimport { DatabaseConfig } from '../../store/config';\nimport { RestApi } from '../common/rest_api';\n\nexport class DatabaseApi extends RestApi {\n  private readonly baseUrl: string;\n  private cleanup: () => Promise<void>;\n  readonly database: firebase.database.Database;\n\n  constructor(config: DatabaseConfig, private readonly namespace: string) {\n    super();\n    const [database, { cleanup }] = initDatabase(config, this.namespace);\n    this.database = database;\n    this.cleanup = cleanup;\n    this.baseUrl = `http://${config.hostAndPort}`;\n  }\n\n  delete(): Promise<void> {\n    return this.cleanup();\n  }\n\n  /**\n   * Import a file at a specific path within the current database.\n   */\n  async importFile(\n    ref: firebase.database.Reference,\n    file: File,\n    options: { disableTriggers?: boolean } = {}\n  ) {\n    const params = new URLSearchParams({\n      ns: this.namespace,\n      // Pass token in query since headers triggers CORS.\n      access_token: 'owner',\n      writeSizeLimit: 'unlimited',\n    });\n    if (options.disableTriggers) {\n      params.set('disableTriggers', 'true');\n    }\n    const path = getUploadPath(ref) + `?${params.toString()}`;\n    return await this.postFile(`${this.baseUrl}/${path}`, file);\n  }\n}\n\n/** Get absolute path for file upload (the path with `.upload` appended) */\nfunction getUploadPath(ref: firebase.database.Reference) {\n  const absolutePath = new URL(ref.toString()).pathname;\n  // trim leading and trailing slashes\n  let path = absolutePath.replace(/^\\//, '').replace(/\\/$/, '');\n  if (path !== '') {\n    path = path + '/';\n  }\n  path += '.upload';\n  return path;\n}\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport firebase from 'firebase';\n\n/**\n * Max nodes shown underneath each\n */\nexport const DEFAULT_PAGE_SIZE = 50;\n\nexport const NO_CHILDREN: string[] = [];\n\nexport interface ViewModel {\n  isLoading: boolean;\n  isRealtime?: boolean;\n  value?: string;\n  children: string[];\n  query?: firebase.database.Query;\n}\n\nexport interface QueryParams {\n  key?: string;\n  operator?: '>=' | '==' | '<=';\n  value?: string;\n  limit?: number;\n}\n\nexport const DEFAULT_QUERY_PARAMS: QueryParams = {\n  limit: DEFAULT_PAGE_SIZE,\n};\n\nexport enum ChildrenDisplayType {\n  Table = 'table',\n  TreeView = 'tree',\n}\n\n/** Try to json parse a value, else assume string. */\nexport function jsonIshValue(value: string) {\n  try {\n    return JSON.parse(value);\n  } catch (e) {\n    return value;\n  }\n}\n\n/** Extra internal props on db Reference. */\ninterface RefWithInternals extends firebase.database.Reference {\n  database: firebase.database.Database;\n}\n\n/** Use some internals to determine the full url with `?ns=x` param. */\nexport function getDbRootUrl(ref: firebase.database.Reference) {\n  const options = (ref as RefWithInternals).database.app.options as Record<\n    string,\n    string\n  >;\n  return options['databaseURL'];\n}\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './Field.scss';\nimport './FileField.scss';\n\nimport { randomId } from '@rmwc/base';\nimport { Button } from '@rmwc/button';\nimport { HTMLProps } from '@rmwc/types';\nimport { Typography } from '@rmwc/typography';\nimport React, { useState } from 'react';\nimport { useDropzone } from 'react-dropzone';\n\ntype FileFieldProps = {\n  tip?: string;\n  error?: string;\n  onFiles?: (files: File[]) => void;\n} & HTMLProps<HTMLInputElement>;\n\nconst DROP_MESSAGE = 'Drop file(s) here';\nconst INVALID_FILE_MESSAGE = 'File type is not accepted';\n\nexport const FileField: React.FC<FileFieldProps> = ({\n  label,\n  tip,\n  error,\n  onFiles,\n  value,\n  accept,\n}) => {\n  const [id] = useState(randomId());\n\n  const {\n    isDragActive,\n    getRootProps,\n    getInputProps,\n    isDragReject,\n  } = useDropzone({\n    onDrop: onFiles,\n    accept,\n  });\n\n  return (\n    <div className=\"Field\">\n      {/* hidden input */}\n      <Typography\n        className=\"Field-label\"\n        use=\"body2\"\n        theme=\"secondary\"\n        tag=\"label\"\n        htmlFor={id}\n      >\n        {label}\n      </Typography>\n\n      <div\n        className=\"Field-filename\"\n        {...getRootProps()}\n        data-testid=\"dropzone\"\n      >\n        <input {...getInputProps({ id })} />\n        <Typography use=\"body2\" theme=\"secondary\">\n          {isDragActive\n            ? isDragReject\n              ? INVALID_FILE_MESSAGE\n              : DROP_MESSAGE\n            : value}\n        </Typography>\n        <Button type=\"button\">Browse</Button>\n      </div>\n      <div className=\"Field-subtext\">\n        {error ? (\n          <Typography\n            className=\"Field-tip\"\n            use=\"body2\"\n            theme=\"error\"\n            role=\"alert\"\n          >\n            {error}\n          </Typography>\n        ) : (\n          tip && (\n            <Typography className=\"Field-tip\" use=\"body2\" theme=\"secondary\">\n              {tip}\n            </Typography>\n          )\n        )}\n      </div>\n    </div>\n  );\n};\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Checkbox } from '@rmwc/checkbox';\nimport {\n  Dialog,\n  DialogActions,\n  DialogButton,\n  DialogContent,\n  DialogTitle,\n} from '@rmwc/dialog';\nimport firebase from 'firebase';\nimport * as React from 'react';\nimport { useState } from 'react';\n\nimport { Callout } from '../../common/Callout';\nimport { useConfig } from '../../common/EmulatorConfigProvider';\nimport { Field } from '../../common/Field';\nimport { FileField } from '../../common/FileField';\nimport { Spinner } from '../../common/Spinner';\nimport { DatabaseApi } from '../api';\nimport styles from './ImportDialog.module.scss';\n\nexport interface Props {\n  api: DatabaseApi;\n  reference: firebase.database.Reference;\n  droppedFile?: File;\n  onComplete: (reference?: firebase.database.Reference, file?: File) => void;\n}\n\nexport const ImportDialog: React.FC<Props> = ({\n  api,\n  reference,\n  onComplete,\n  droppedFile,\n}) => {\n  const functionsEmulatorRunning = !!useConfig().functions;\n  const [file, setFile] = useState<File | undefined>(droppedFile);\n  const [executeFunctions, setExecuteFunctions] = useState(false);\n  const [isImporting, setIsImporting] = useState(false);\n  const [error, setError] = useState();\n\n  const onSubmit = async (e: React.FormEvent<HTMLFormElement>) => {\n    e.preventDefault();\n    if (file) {\n      try {\n        setIsImporting(true);\n        await api.importFile(reference, file, {\n          disableTriggers: !functionsEmulatorRunning || !executeFunctions,\n        });\n        onComplete(reference, file);\n      } catch (err) {\n        setError(err.message);\n      }\n      setIsImporting(false);\n    }\n  };\n\n  const path = new URL(reference.toString()).pathname;\n\n  return (\n    <Dialog renderToPortal open onClose={() => onComplete()}>\n      <form onSubmit={onSubmit} className={styles.container}>\n        <DialogTitle>Import JSON</DialogTitle>\n        <DialogContent onSubmit={onSubmit}>\n          <Callout aside type=\"warning\">\n            All data at this location will be overwritten\n          </Callout>\n          <Field\n            disabled\n            name=\"location\"\n            label=\"Data location\"\n            value={path}\n            type=\"text\"\n          />\n          <FileField\n            name=\"file\"\n            accept=\"application/json\"\n            label=\"Data (JSON)\"\n            required\n            value={file?.name || 'Drop a file, or click to select'}\n            onFiles={(files) => setFile(files[0])}\n            error={error}\n          />\n          {functionsEmulatorRunning && (\n            <div>\n              <Checkbox\n                label=\"Also execute database triggers in the Functions emulator\"\n                checked={executeFunctions}\n                onChange={(event) => {\n                  setExecuteFunctions(event.currentTarget.checked);\n                }}\n              />\n            </div>\n          )}\n        </DialogContent>\n        <DialogActions>\n          <DialogButton action=\"close\" type=\"button\" theme=\"secondary\">\n            Cancel\n          </DialogButton>\n          <DialogButton type=\"submit\" unelevated>\n            Import\n          </DialogButton>\n        </DialogActions>\n      </form>\n      {isImporting && <Spinner cover scrim message=\"Importing...\" />}\n    </Dialog>\n  );\n};\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport firebase from 'firebase';\nimport { Observable, ReplaySubject, defer, from, of } from 'rxjs';\nimport {\n  catchError,\n  concatMap,\n  map,\n  mapTo,\n  shareReplay,\n  switchMap,\n} from 'rxjs/operators';\n\nimport {\n  DEFAULT_PAGE_SIZE,\n  QueryParams,\n  ViewModel,\n  getDbRootUrl,\n} from './view_model';\n\n/**\n * Timeout for silent call, which should determine if the data is\n * safely loadable at the current node\n */\nconst REST_TIMEOUT = `1s`;\n\nconst NO_CHILDREN: string[] = [];\n\n// Accepted as admin by Realtime Database Emulator.\nconst ADMIN_AUTH_HEADERS = { Authorization: 'Bearer owner' };\n\n/**\n * Creates an observable view model and query subject. The view model will\n * update when the query emits/changes.\n */\nexport function createViewModel(\n  ref: firebase.database.Reference,\n  canDoRealtime$: Observable<boolean>\n) {\n  const query = new ReplaySubject<QueryParams>(1);\n  query.next({ limit: DEFAULT_PAGE_SIZE });\n  const viewModel$ = query.pipe(\n    switchMap((queryParams) => {\n      return canDoRealtime$.pipe(\n        concatMap((realtime) =>\n          realtime\n            ? realtimeToViewModel(ref, queryParams)\n            : nonRealtimeToViewModel(ref, queryParams)\n        )\n      );\n    })\n  );\n  return { query, viewModel$ };\n}\n\n/**\n * Checks if realtime is possible at the node. Only checks once for the current\n * node.\n */\nexport function canDoRealtime(\n  realtimeRef: firebase.database.Reference\n): Observable<boolean> {\n  const silent = restUrl(realtimeRef, {\n    print: 'silent',\n    timeout: REST_TIMEOUT,\n  });\n  return defer(() => fetch(silent, { headers: ADMIN_AUTH_HEADERS })).pipe(\n    mapTo(true),\n    catchError(() => of(false)),\n    shareReplay({ bufferSize: 1, refCount: true })\n  );\n}\n\nfunction realtimeToViewModel(\n  ref: firebase.database.Reference,\n  queryParams: QueryParams\n) {\n  let query: firebase.database.Query;\n  return once(ref).pipe(\n    switchMap((snap) => {\n      // The \"default\" query contains limitToFirst(50), so we can not blindly\n      // apply the query to leaf nodes. leafNodeRef.limitToFirst(n) will yield\n      // null data.\n      if (snap.hasChildren()) {\n        query = applyQuery(ref, queryParams);\n        return toObservable(query);\n      }\n      return toObservable(ref);\n    }),\n    map(\n      (snap): ViewModel => ({\n        value: snap.hasChildren() ? undefined : snap.val(),\n        children: snap.hasChildren() ? Object.keys(snap.val()) : NO_CHILDREN,\n        isRealtime: true,\n        isLoading: false,\n        query,\n      })\n    )\n  );\n}\n\nfunction nonRealtimeToViewModel(\n  ref: firebase.database.Reference,\n  queryParams: QueryParams\n): Observable<ViewModel> {\n  return fetchNonRealtime(ref, queryParams).pipe(\n    map(\n      (children): ViewModel => ({\n        children,\n        isLoading: false,\n        isRealtime: false,\n      })\n    )\n  );\n}\n\nfunction once(query: firebase.database.Query) {\n  return from(query.once('value'));\n}\n\nfunction toObservable(query: firebase.database.Query) {\n  return new Observable<firebase.database.DataSnapshot>((o) => {\n    const handler = query.on('value', (snapshot) => o.next(snapshot));\n    return () => query.off('value', handler);\n  });\n}\n\nexport function applyQuery(\n  ref: firebase.database.Reference,\n  params: QueryParams\n): firebase.database.Query {\n  const { key, operator, value, limit } = params;\n  // Check the existence value instead of it being falsy. This prevents bugs\n  // where the \"value\" is actually false.\n  // ex: { key: \"completed\", operator: \"==\", value: \"false\" }\n  if (key != null && operator != null && value != null) {\n    let query = ref.orderByChild(key).limitToFirst(limit || DEFAULT_PAGE_SIZE);\n    switch (operator) {\n      case '==':\n        return query.equalTo(value);\n      case '<=':\n        return query.endAt(value);\n      case '>=':\n        return query.startAt(value);\n    }\n  }\n  return ref.limitToFirst(limit || DEFAULT_PAGE_SIZE);\n}\n\n/** Use REST to fetch the children for a node */\nfunction fetchNonRealtime(\n  realtimeRef: firebase.database.Reference,\n  query: QueryParams\n): Observable<string[]> {\n  const params = getRestQueryParams(query);\n  const shallow = restUrl(realtimeRef, { ...params, shallow: 'true' });\n  return defer(() => fetch(shallow, { headers: ADMIN_AUTH_HEADERS })).pipe(\n    map((r) => r.json()),\n    map((data) => Object.keys(data))\n  );\n}\n\ninterface RestQueryParams {\n  orderBy?: string;\n  limitToFirst: string;\n  equalTo?: string;\n  endAt?: string;\n  startAt?: string;\n}\n\nfunction getRestQueryParams(query: QueryParams): RestQueryParams {\n  const { key, operator, value, limit } = query;\n\n  const params: RestQueryParams = {\n    orderBy: key,\n    limitToFirst: `${limit || DEFAULT_PAGE_SIZE}`,\n  };\n\n  if (key && operator && value) {\n    switch (operator) {\n      case '==':\n        params.equalTo = value;\n        break;\n      case '<=':\n        params.endAt = value;\n        break;\n      case '>=':\n        params.startAt = value;\n        break;\n    }\n  }\n\n  return params;\n}\n\nfunction restUrl(\n  ref: firebase.database.Reference,\n  params: Record<string, string | undefined>\n): string {\n  const rootUrl = getDbRootUrl(ref);\n\n  // TODO(yuchenshi): Find some cross-browser and lightweight way to parse query.\n  if (rootUrl.indexOf('?ns=') >= 0) {\n    const ns = rootUrl.split('?ns=')[1];\n    params = { ...params, ns };\n  }\n\n  const query = Object.entries(params)\n    .filter(([key, value]) => !!value)\n    .map(([key, value]) => `${key}=${encodeURIComponent(value!)}`)\n    .join('&');\n  return `${ref.toString()}.json?${query}`;\n}\n","/**\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport firebase from 'firebase';\n\nexport interface DocumentCollectionDatabaseApi<U, V> {\n  projectId: string;\n  databaseId: string;\n\n  database: U;\n\n  delete(): Promise<void>;\n\n  getCollections(docRef?: V): Promise<firebase.firestore.CollectionReference[]>;\n}\n\nexport type FirestoreApi = DocumentCollectionDatabaseApi<\n  firebase.firestore.Firestore,\n  firebase.firestore.DocumentReference\n>;\n\n/** Field types supported by Firestore  */\nexport enum FieldType {\n  ARRAY = 'array',\n  BLOB = 'blob',\n  BOOLEAN = 'boolean',\n  GEOPOINT = 'geopoint',\n  JSON = 'json',\n  MAP = 'map',\n  NULL = 'null',\n  NUMBER = 'number',\n  REFERENCE = 'reference',\n  STRING = 'string',\n  TIMESTAMP = 'timestamp',\n}\n\nexport type FirestoreAny = FirestoreMap | FirestoreArray | FirestorePrimitive;\n\nexport type FirestorePrimitive =\n  | string\n  | number\n  | boolean\n  | null\n  | firebase.firestore.DocumentReference\n  | firebase.firestore.GeoPoint\n  | firebase.firestore.Blob\n  | firebase.firestore.Timestamp\n  | firebase.firestore.FieldValue;\n\nexport type FirestoreArray = Array<FirestorePrimitive | FirestoreMap>;\n\nexport type FirestoreMap = {\n  [field: string]: FirestoreAny;\n};\n\n/** Collection filter */\nexport type CollectionFilterSort = 'ascending' | 'descending';\n\ninterface Filter<T extends firebase.firestore.WhereFilterOp | undefined> {\n  field: string;\n  operator: T;\n}\n\ntype ConditionValue = number | boolean | string;\n\ninterface SingleValueCondition {\n  value: ConditionValue;\n}\n\ninterface MultiValueCondition {\n  values: ConditionValue[];\n}\n\ninterface SortableCondition {\n  sort?: 'asc' | 'desc';\n}\n\ntype Unspecified = Filter<undefined> & SortableCondition;\ntype Equal = Filter<'=='> & SingleValueCondition;\ntype NotEqual = Filter<'!='> & SingleValueCondition;\ntype GreaterThan = Filter<'>'> & SingleValueCondition & SortableCondition;\ntype GreaterThanEqual = Filter<'>='> & SingleValueCondition & SortableCondition;\ntype LessThanEqual = Filter<'<='> & SingleValueCondition & SortableCondition;\ntype LessThan = Filter<'<'> & SingleValueCondition & SortableCondition;\ntype In = Filter<'in'> & MultiValueCondition;\ntype NotIn = Filter<'not-in'> & MultiValueCondition;\ntype ArrayContains = Filter<'array-contains'> & SingleValueCondition;\ntype ArrayContainsAny = Filter<'array-contains-any'> & MultiValueCondition;\n\nexport type CollectionFilter =\n  | Unspecified\n  | Equal\n  | NotEqual\n  | GreaterThan\n  | GreaterThanEqual\n  | LessThanEqual\n  | LessThan\n  | In\n  | NotIn\n  | ArrayContains\n  | ArrayContainsAny;\n\nexport function isSingleValueCollectionFilter(\n  cf: CollectionFilter\n): cf is Extract<CollectionFilter, SingleValueCondition> {\n  return (\n    cf.operator === '==' ||\n    cf.operator === '!=' ||\n    cf.operator === '>' ||\n    cf.operator === '>=' ||\n    cf.operator === '<=' ||\n    cf.operator === '<' ||\n    cf.operator === 'array-contains'\n  );\n}\n\nexport function isMultiValueCollectionFilter(\n  cf: CollectionFilter\n): cf is Extract<CollectionFilter, MultiValueCondition> {\n  return (\n    cf.operator === 'in' ||\n    cf.operator === 'not-in' ||\n    cf.operator === 'array-contains-any'\n  );\n}\n\nexport function isSortableCollectionFilter(\n  cf: CollectionFilter\n): cf is Extract<CollectionFilter, SortableCondition> {\n  return (\n    !cf.operator ||\n    cf.operator === '>' ||\n    cf.operator === '>=' ||\n    cf.operator === '<=' ||\n    cf.operator === '<'\n  );\n}\n\nexport interface MissingDocument {\n  path: string;\n}\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport firebase from 'firebase';\nimport produce from 'immer';\nimport get from 'lodash.get';\n\nimport {\n  FieldType,\n  FirestoreAny,\n  FirestoreArray,\n  FirestoreMap,\n  FirestorePrimitive,\n} from './models';\n\n/** Firestore supported numbers */\nexport const NUMBER_REGEX = /^-?([\\d]*\\.?\\d+|Infinity|NaN)$/;\n\nexport function getParentPath(path: string[]) {\n  return path.slice(0, path.length - 1);\n}\n\nexport function lastFieldName(path: string[]): string {\n  if (!path.length)\n    throw new Error(`${path} is empty and has no _last_ field name`);\n  return path[path.length - 1];\n}\n\nexport function getFieldType(value: FirestoreAny): FieldType {\n  if (value === null) {\n    return FieldType.NULL;\n  }\n\n  if (value instanceof firebase.firestore.Timestamp) {\n    return FieldType.TIMESTAMP;\n  }\n\n  if (value instanceof Array) {\n    return FieldType.ARRAY;\n  }\n\n  if (value instanceof firebase.firestore.DocumentReference) {\n    return FieldType.REFERENCE;\n  }\n\n  if (value instanceof firebase.firestore.GeoPoint) {\n    return FieldType.GEOPOINT;\n  }\n\n  if (value instanceof firebase.firestore.Blob) {\n    return FieldType.BLOB;\n  }\n\n  if (typeof value === 'object') {\n    return FieldType.MAP;\n  }\n\n  return typeof value as FieldType;\n}\n\nexport function isBoolean(value: FirestoreAny): value is boolean {\n  return typeof value === 'boolean';\n}\n\nexport function isReference(\n  value: FirestoreAny\n): value is firebase.firestore.DocumentReference {\n  return value instanceof firebase.firestore.DocumentReference;\n}\n\nexport function isTimestamp(\n  value: FirestoreAny\n): value is firebase.firestore.Timestamp {\n  return value instanceof firebase.firestore.Timestamp;\n}\n\nexport function isString(value: FirestoreAny): value is string {\n  return typeof value === 'string';\n}\n\nexport function isNumber(value: FirestoreAny): value is number {\n  return typeof value === 'number';\n}\n\nexport function isGeoPoint(\n  value: FirestoreAny\n): value is firebase.firestore.GeoPoint {\n  return value instanceof firebase.firestore.GeoPoint;\n}\n\nexport function isMap(value: any): value is FirestoreMap {\n  return getFieldType(value) === FieldType.MAP;\n}\n\nexport function isArray(value: any): value is FirestoreArray {\n  return getFieldType(value) === FieldType.ARRAY;\n}\n\nexport function isPrimitive(value: any): value is FirestorePrimitive {\n  return !isMap(value) && !isArray(value);\n}\n\n/*\n  Return a copy of base with the field (specified by path) updated to value.\n  This function also works with array elements. base is never modified.\n*/\nexport const withFieldSet = produce((draft, path: string[], value: any) => {\n  const parent = get(draft, getParentPath(path)) || draft;\n  if (isMap(parent)) {\n    parent[lastFieldName(path)] = value;\n  } else if (isArray(parent)) {\n    parent[Number(lastFieldName(path))] = value;\n  } else {\n    return value;\n  }\n});\n\n/*\n  Return a copy of base with the field (specified by path) deleted.\n  This function also works with removing array elements. base is never modified.\n*/\nexport const withFieldRemoved = produce((draft, path: string[]) => {\n  const parent = get(draft, getParentPath(path)) || draft;\n  if (isMap(parent)) {\n    delete parent[lastFieldName(path)];\n  } else if (isArray(parent)) {\n    parent.splice(Number(lastFieldName(path)), 1);\n  }\n});\n\n// Give a brief text summary of the data.\n// Note: maxLen is soft (at least for now). End result may still be longer.\nexport function summarize(data: FirestoreAny, maxLen: number): string {\n  switch (getFieldType(data)) {\n    case FieldType.ARRAY:\n      return summarizeArray(data as FirestoreAny[], maxLen, summarize);\n    case FieldType.MAP:\n      return summarizeMap(\n        data as Record<string, FirestoreAny>,\n        maxLen,\n        summarize\n      );\n    case FieldType.BLOB:\n      const base64 = (data as firebase.firestore.Blob).toBase64();\n      if (base64.length < maxLen) return base64;\n      else return base64.substr(0, maxLen) + '...';\n    case FieldType.BOOLEAN:\n      return (data as boolean).toString();\n    case FieldType.GEOPOINT:\n      const value = data as firebase.firestore.GeoPoint;\n      return summarizeLatLng(value.latitude, value.longitude);\n    case FieldType.NULL:\n      return 'null';\n    case FieldType.NUMBER:\n      return (data as number).toString();\n    case FieldType.REFERENCE:\n      return (data as firebase.firestore.DocumentReference).path;\n    case FieldType.STRING:\n      return `\"${data as string}\"`;\n    case FieldType.TIMESTAMP:\n      return summarizeDate(\n        (data as firebase.firestore.Timestamp).toDate(),\n        maxLen\n      );\n    case FieldType.JSON:\n      throw new Error('JSON field type is input only');\n  }\n}\n\nexport function summarizeDate(date: Date, maxLen: number): string {\n  // TODO: Better date time formatting.\n  // Note: Not using toLocaleString() since it does not stringify timezone.\n  return date.toString();\n}\n\nexport function summarizeArray<E = FirestoreAny>(\n  array: E[],\n  maxLen: number,\n  summarizeElement: (element: E, maxLen: number) => string\n): string {\n  let output = '[';\n  for (const element of array) {\n    if (output.length > 1) output += ', ';\n    if (output.length > maxLen) {\n      output += '...';\n      break;\n    }\n    output += summarizeElement(element, maxLen - output.length);\n  }\n  output += ']';\n  return output;\n}\n\nexport function summarizeMap<V = FirestoreAny>(\n  map: Record<string, V>,\n  maxLen: number,\n  summarizeValue: (value: V, maxLen: number) => string\n): string {\n  let output = '{';\n  for (const [key, value] of Object.entries(map).sort((a, b) =>\n    compareFirestoreKeys(a[0], b[0])\n  )) {\n    if (output.length > 1) output += ', ';\n    if (output.length > maxLen) {\n      output += '...';\n      break;\n    }\n    output += `${key}: ${summarizeValue(value, maxLen - output.length)}`;\n  }\n  output += '}';\n  return output;\n}\n\nexport function summarizeLatLng(latitude: number, longitude: number) {\n  return `[${latStr(latitude)}, ${longStr(longitude)}]`;\n}\n\nfunction latStr(lat: number): string {\n  return `${Math.abs(lat)}° ${lat >= 0 ? 'N' : 'S'}`;\n}\n\nfunction longStr(long: number): string {\n  return `${Math.abs(long)}° ${long >= 0 ? 'E' : 'W'}`;\n}\n\nexport function compareFirestoreKeys(fieldA: string, fieldB: string): number {\n  // TODO: Use UTF-8 encoded byte order instead of localCompare to match Firestore production behavior https://firebase.google.com/docs/firestore/manage-data/data-types\n  return fieldA.localeCompare(fieldB);\n}\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createAction } from 'typesafe-actions';\n\nimport { FieldType } from '../models';\nimport { JSONField, PrimitiveValue } from './types';\n\nexport const addToMap = createAction('@document/addToMap')<{\n  uuid: number;\n  name: string;\n  value: PrimitiveValue;\n}>();\nexport const addToArray = createAction('@document/addToArray')<{\n  uuid: number;\n  value: PrimitiveValue;\n}>();\n// TODO\nexport const removeFromMap = createAction('@document/removeFromMap')<{\n  uuid: number;\n  childId: number;\n}>();\n// TODO\nexport const removeFromArray = createAction('@document/removeFromArray')<{\n  uuid: number;\n  childId: number;\n}>();\nexport const updateName = createAction('@document/updateName')<{\n  uuid: number;\n  childId: number;\n  name: string;\n}>();\nexport const updateType = createAction('@document/updateType')<{\n  uuid: number;\n  type: FieldType;\n}>();\nexport const updateValue = createAction('@document/updateValue')<{\n  uuid: number;\n  value: PrimitiveValue | JSONField['value'];\n}>();\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { SelectField } from '../../common/Field';\n\nconst BooleanEditor: React.FC<{\n  value: boolean;\n  onChange: (value: boolean) => void;\n}> = ({ value, onChange }) => {\n  return (\n    <SelectField\n      label=\"Value\"\n      value={value.toString()}\n      options={['true', 'false']}\n      onChange={(e) => {\n        onChange(e.currentTarget.value === 'true');\n      }}\n    />\n  );\n};\n\nexport default BooleanEditor;\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport firebase from 'firebase';\nimport React, { useEffect, useState } from 'react';\nimport { useFormContext } from 'react-hook-form';\n\nimport { Field } from '../../common/Field';\n\nconst GeoPointEditor: React.FC<{\n  name: string;\n  value: firebase.firestore.GeoPoint;\n  onChange: (value: firebase.firestore.GeoPoint) => void;\n}> = ({ name, value, onChange }) => {\n  const [latitude, setLatitude] = useState(String(value.latitude));\n  const [longitude, setLongitude] = useState(String(value.longitude));\n  const {\n    errors,\n    formState: { touched },\n    register,\n    unregister,\n    setValue,\n  } = useFormContext();\n\n  const latitudeName = `${name}-lat`;\n  const longitudeName = `${name}-long`;\n\n  useEffect(() => {\n    register(latitudeName, {\n      required: 'Required',\n      min: {\n        value: -90,\n        message: 'Must be >= -90',\n      },\n      max: {\n        value: 90,\n        message: 'Must be <= -90',\n      },\n    });\n\n    register(longitudeName, {\n      required: 'Required',\n      min: {\n        value: -180,\n        message: 'Must be >= -180',\n      },\n      max: {\n        value: 180,\n        message: 'Must be <= -180',\n      },\n    });\n\n    return () => unregister([latitudeName, longitudeName]);\n  }, [register, unregister, latitudeName, longitudeName]);\n\n  useEffect(() => {\n    const lat = Number(latitude);\n    const long = Number(longitude);\n    if (value.latitude === lat && value.longitude === long) {\n      return;\n    }\n\n    try {\n      // Update the parent when _both_ fields are valid\n      const geoPoint = new firebase.firestore.GeoPoint(lat, long);\n      onChange(geoPoint);\n    } catch {}\n  }, [value, latitude, longitude, onChange]);\n\n  return (\n    <div className=\"FieldEditor-geo-point\">\n      <Field\n        label=\"Latitude\"\n        type=\"number\"\n        step=\"any\"\n        defaultValue={latitude}\n        onChange={(e) => {\n          setValue(latitudeName, e.currentTarget.value, true);\n          setLatitude(e.currentTarget.value);\n        }}\n        error={touched[latitudeName] && errors[latitudeName]?.message}\n      />\n\n      <Field\n        label=\"Longitude\"\n        type=\"number\"\n        step=\"any\"\n        defaultValue={longitude}\n        onChange={(e) => {\n          setValue(longitudeName, e.currentTarget.value, true);\n          setLongitude(e.currentTarget.value);\n        }}\n        error={touched[longitudeName] && errors[longitudeName]?.message}\n      />\n    </div>\n  );\n};\n\nexport default GeoPointEditor;\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useEffect, useState } from 'react';\nimport { useFormContext } from 'react-hook-form';\n\nimport { Field } from '../../common/Field';\nimport { FirestoreAny } from '../models';\n\nconst JsonEditor: React.FC<{\n  value: FirestoreAny;\n  onChange: (value: FirestoreAny) => void;\n  name: string;\n}> = ({ value, onChange, name }) => {\n  const [initialValue] = useState(JSON.stringify(value));\n  const {\n    errors,\n    formState: { touched },\n    register,\n    unregister,\n    setValue,\n    triggerValidation,\n  } = useFormContext();\n\n  useEffect(() => {\n    register(name, {\n      validate: (e) => {\n        try {\n          JSON.parse(e);\n          return true;\n        } catch {\n          return 'Must be valid JSON';\n        }\n      },\n    });\n\n    return () => unregister(name);\n  }, [register, unregister, name]);\n\n  async function handleChange(value: string) {\n    if (await triggerValidation(name)) {\n      onChange(JSON.parse(value));\n    }\n  }\n\n  return (\n    <Field\n      label=\"JSON\"\n      defaultValue={initialValue}\n      onChange={(e) => {\n        setValue(name, e.currentTarget.value);\n        handleChange(e.currentTarget.value);\n      }}\n      error={touched[name] && errors[name]?.message}\n    />\n  );\n};\n\nexport default JsonEditor;\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useEffect } from 'react';\nimport { useFormContext } from 'react-hook-form';\n\nimport { Field } from '../../common/Field';\nimport { NUMBER_REGEX } from '../utils';\n\nconst NumberEditor: React.FC<{\n  value: number;\n  onChange: (value: number) => void;\n  name: string;\n}> = ({ value, onChange, name }) => {\n  const {\n    errors,\n    formState: { touched },\n    register,\n    unregister,\n    setValue,\n    triggerValidation,\n  } = useFormContext();\n\n  useEffect(() => {\n    register(name, {\n      required: 'Required',\n      pattern: {\n        value: NUMBER_REGEX,\n        message: 'Must be a number',\n      },\n    });\n\n    return () => unregister(name);\n  }, [register, unregister, name]);\n\n  async function handleChange(value: string) {\n    if (await triggerValidation(name)) {\n      onChange(parseFloat(value));\n    }\n  }\n\n  return (\n    <Field\n      label=\"Value\"\n      defaultValue={value}\n      onChange={(e) => {\n        setValue(name, e.currentTarget.value);\n        handleChange(e.currentTarget.value);\n      }}\n      error={touched[name] && errors[name]?.message}\n    />\n  );\n};\n\nexport default NumberEditor;\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  FirestoreAny,\n  FirestoreArray,\n  FirestoreMap,\n  FirestorePrimitive,\n} from '../models';\nimport { isPrimitive as isNativePrimitive } from '../utils';\n\nexport class DocumentPath {\n  constructor(readonly path: string) {}\n}\n\nexport type MapChildren = Array<{\n  readonly uuid: number;\n  name: string;\n  valueId: number;\n}>;\nexport interface MapField {\n  mapChildren: MapChildren;\n}\n\nexport type ArrayChildren = Array<{ readonly uuid: number; valueId: number }>;\nexport interface ArrayField {\n  arrayChildren: ArrayChildren;\n}\n\nexport interface JSONField {\n  isJson: boolean;\n  value: FirestoreAny;\n}\n\nexport type PrimitiveValue = FirestorePrimitive | DocumentPath;\nexport interface PrimitiveField {\n  value: PrimitiveValue;\n}\n\nexport type Field = MapField | ArrayField | JSONField | PrimitiveField;\nexport type Fields = {\n  [uuid: number]: Field;\n};\nexport type Store = {\n  uuid?: number;\n  fields: Fields;\n};\n\nexport function isPrimitive(\n  data: FirestoreAny | DocumentPath\n): data is PrimitiveValue {\n  return isNativePrimitive(data) || data instanceof DocumentPath;\n}\n\nexport function isFirestoreMap(data: FirestoreAny): data is FirestoreMap {\n  return !isFirestoreArray(data) && !isPrimitive(data);\n}\n\nexport function isFirestoreArray(data: FirestoreAny): data is FirestoreArray {\n  return data instanceof Array;\n}\n\nexport function isMapField(field: Field): field is MapField {\n  return 'mapChildren' in field;\n}\n\nexport function isArrayField(field: Field): field is ArrayField {\n  return 'arrayChildren' in field;\n}\n\nexport function isJSONField(field: Field): field is JSONField {\n  return 'isJson' in field;\n}\n\nexport function assertStoreHasRoot(\n  store: Store\n): asserts store is Store & { uuid: number } {\n  if (store.uuid === undefined) {\n    throw new Error('Store has no root');\n  }\n}\n\nexport function assertIsPrimitiveField(\n  field: Field\n): asserts field is PrimitiveField {\n  if (!('value' in field)) {\n    throw new Error('Field is not primitive');\n  }\n}\n\nexport function assertIsMapField(field: Field): asserts field is MapField {\n  if (!isMapField(field)) {\n    throw new Error('Field is not a map');\n  }\n}\n\nexport function assertIsArrayField(field: Field): asserts field is ArrayField {\n  if (!isArrayField(field)) {\n    throw new Error('Field is not an array');\n  }\n}\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useEffect, useState } from 'react';\nimport { useFormContext } from 'react-hook-form';\nimport { useFirestore } from 'reactfire';\n\nimport { Field } from '../../common/Field';\nimport { DocumentPath } from './types';\n\nconst ReferenceEditor: React.FC<{\n  value: DocumentPath;\n  onChange: (value: DocumentPath) => void;\n  name: string;\n}> = ({ value, onChange, name }) => {\n  const [path] = useState(value.path);\n  const firestore = useFirestore();\n  const {\n    errors,\n    formState: { touched },\n    register,\n    unregister,\n    setValue,\n    triggerValidation,\n  } = useFormContext();\n\n  useEffect(() => {\n    register(name, {\n      validate: (e) => {\n        try {\n          firestore.doc(e);\n          return true;\n        } catch {\n          return 'Must point to a document';\n        }\n      },\n    });\n\n    return () => unregister(name);\n  }, [register, unregister, name, firestore]);\n\n  async function handleChange(value: string) {\n    if (await triggerValidation(name)) {\n      onChange(new DocumentPath(value));\n    }\n  }\n\n  return (\n    <Field\n      label=\"Document path\"\n      defaultValue={path}\n      onChange={(e) => {\n        setValue(name, e.currentTarget.value);\n        handleChange(e.currentTarget.value);\n      }}\n      error={touched[name] && errors[name]?.message}\n    />\n  );\n};\n\n// api.doc(path)\n\nexport default ReferenceEditor;\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport firebase from 'firebase';\n\nimport {\n  FieldType,\n  FirestoreAny,\n  FirestoreArray,\n  FirestoreMap,\n  FirestorePrimitive,\n} from '../models';\nimport {\n  ArrayChildren,\n  DocumentPath,\n  Fields,\n  MapChildren,\n  PrimitiveValue,\n  Store,\n  assertStoreHasRoot,\n  isArrayField,\n  isFirestoreArray,\n  isFirestoreMap,\n  isMapField,\n} from './types';\n\nlet uuid = 0;\nexport function getUniqueId() {\n  return uuid++;\n}\n\nfunction normalizeMap(data: FirestoreMap): Store {\n  const uuid = getUniqueId();\n\n  // reducer over object.entries -> childFields\n  const children = Object.entries(data).reduce(\n    (\n      { mapChildren, fields }: { mapChildren: MapChildren; fields: Fields },\n      [name, value]: [string, FirestoreAny]\n    ) => {\n      const child = normalize(value);\n      assertStoreHasRoot(child);\n      mapChildren.push({\n        uuid: getUniqueId(),\n        name,\n        valueId: child.uuid,\n      });\n      return { mapChildren, fields: { ...fields, ...child.fields } };\n    },\n    { mapChildren: [], fields: {} }\n  );\n  return {\n    uuid,\n    fields: {\n      ...children.fields,\n      // add item for current node\n      [uuid]: { mapChildren: children.mapChildren },\n    },\n  };\n}\n\nfunction normalizeArray(data: FirestoreArray): Store {\n  const uuid = getUniqueId();\n\n  // reducer over array elements -> childFields\n  const children = data.reduce(\n    (\n      {\n        arrayChildren,\n        fields,\n      }: { arrayChildren: ArrayChildren; fields: Fields },\n      value: FirestoreMap | FirestorePrimitive\n    ) => {\n      const child = normalize(value);\n      assertStoreHasRoot(child);\n      arrayChildren.push({\n        uuid: getUniqueId(),\n        valueId: child.uuid,\n      });\n      return { arrayChildren, fields: { ...fields, ...child.fields } };\n    },\n    { arrayChildren: [], fields: {} }\n  );\n  return {\n    uuid,\n    fields: {\n      ...children.fields,\n      // add item for current node\n      [uuid]: { arrayChildren: children.arrayChildren },\n    },\n  };\n}\n\nfunction normalizePrimitive(data: FirestorePrimitive): Store {\n  const uuid = getUniqueId();\n\n  if (data instanceof firebase.firestore.DocumentReference) {\n    return {\n      uuid,\n      fields: { [uuid]: { value: new DocumentPath(data.path) } },\n    };\n  }\n  return { uuid, fields: { [uuid]: { value: data } } };\n}\n\nexport function normalize(data: FirestoreAny): Store {\n  if (isFirestoreMap(data)) {\n    return normalizeMap(data);\n  } else if (isFirestoreArray(data)) {\n    return normalizeArray(data);\n  } else {\n    return normalizePrimitive(data);\n  }\n}\n\nexport function denormalize(\n  store: Store,\n  firestore?: firebase.firestore.Firestore\n): FirestoreAny {\n  assertStoreHasRoot(store);\n  const field = store.fields[store.uuid];\n  if (isMapField(field)) {\n    return field.mapChildren.reduce((acc, curr) => {\n      acc[curr.name] = denormalize(\n        {\n          uuid: curr.valueId,\n          fields: store.fields,\n        },\n        firestore\n      );\n      return acc;\n    }, {} as any);\n  } else if (isArrayField(field)) {\n    return field.arrayChildren.reduce((acc, curr) => {\n      acc.push(\n        denormalize({ uuid: curr.valueId, fields: store.fields }, firestore)\n      );\n      return acc;\n    }, [] as any);\n  } else {\n    if (field.value instanceof DocumentPath) {\n      if (!firestore) {\n        // TODO: Trying to reference a Firestore Document without a Firestore instance.\n        return '';\n      }\n      try {\n        return firestore.doc(field.value.path);\n      } catch {\n        // TODO: The store does not always have a valid DocRef, reconsider.\n        return '';\n      }\n    }\n    return field.value;\n  }\n}\n\nexport function defaultValueForPrimitiveType(type: FieldType): PrimitiveValue {\n  switch (type) {\n    case FieldType.BLOB:\n      // TODO\n      return '';\n    case FieldType.BOOLEAN:\n      return true;\n    case FieldType.GEOPOINT:\n      return new firebase.firestore.GeoPoint(0, 0);\n    case FieldType.NULL:\n      return null;\n    case FieldType.NUMBER:\n      return 0;\n    case FieldType.REFERENCE:\n      return new DocumentPath('');\n    case FieldType.STRING:\n      return '';\n    case FieldType.TIMESTAMP:\n      return firebase.firestore.Timestamp.fromDate(new Date());\n  }\n  return '';\n}\n\nexport function getDescendantIds(fields: Fields, ids: number[]): number[] {\n  return ids.reduce((acc, id) => {\n    acc.push(id);\n    const field = fields[id];\n    if (isMapField(field)) {\n      acc.push(\n        ...getDescendantIds(\n          fields,\n          field.mapChildren.map((c) => c.valueId)\n        )\n      );\n    } else if (isArrayField(field)) {\n      acc.push(\n        ...getDescendantIds(\n          fields,\n          field.arrayChildren.map((c) => c.valueId)\n        )\n      );\n    }\n    return acc;\n  }, [] as number[]);\n}\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport produce from 'immer';\nimport * as React from 'react';\nimport { Action, createReducer } from 'typesafe-actions';\n\nimport { FieldType } from '../models';\nimport * as actions from './actions';\nimport {\n  Field,\n  Store,\n  assertIsArrayField,\n  assertIsMapField,\n  assertIsPrimitiveField,\n  assertStoreHasRoot,\n} from './types';\nimport {\n  defaultValueForPrimitiveType,\n  getDescendantIds,\n  getUniqueId,\n  normalize,\n} from './utils';\n\nconst INIT_STATE = { fields: {} };\n\nconst documentStoreContext = React.createContext<{\n  store: Store;\n  dispatch: React.Dispatch<any>;\n}>({ store: INIT_STATE, dispatch: () => {} });\n\nexport const reducer = createReducer<Store, Action>({ fields: {} })\n  .handleAction(\n    actions.addToMap,\n    produce((draft, { payload }) => {\n      const field = draft.fields[payload.uuid];\n      assertIsMapField(field);\n      const normalized = normalize(payload.value);\n      assertStoreHasRoot(normalized);\n      draft.fields = {\n        ...draft.fields,\n        ...normalized.fields,\n      };\n      field.mapChildren.push({\n        uuid: getUniqueId(),\n        name: payload.name,\n        valueId: normalized.uuid,\n      });\n    })\n  )\n  .handleAction(\n    actions.addToArray,\n    produce((draft, { payload }) => {\n      const field = draft.fields[payload.uuid];\n      assertIsArrayField(field);\n      const normalized = normalize(payload.value);\n      assertStoreHasRoot(normalized);\n      draft.fields = {\n        ...draft.fields,\n        ...normalized.fields,\n      };\n      draft.fields[payload.uuid].arrayChildren.push({\n        uuid: getUniqueId(),\n        valueId: normalized.uuid,\n      });\n    })\n  )\n  .handleAction(\n    actions.removeFromMap,\n    produce((draft, { payload }) => {\n      const field = draft.fields[payload.uuid];\n      assertIsMapField(field);\n      const child = field.mapChildren.find((c) => c.uuid === payload.childId);\n      if (!child) {\n        throw new Error('No map-child found with given ID');\n      }\n\n      // Remove any descendants\n      for (const uuid of getDescendantIds(draft.fields, [child.valueId])) {\n        delete draft.fields[uuid];\n      }\n\n      // Remove reference from parent\n      field.mapChildren = field.mapChildren.filter(\n        (c) => c.uuid !== payload.childId\n      );\n    })\n  )\n  .handleAction(\n    actions.removeFromArray,\n    produce((draft, { payload }) => {\n      const field = draft.fields[payload.uuid];\n      assertIsArrayField(field);\n      const child = field.arrayChildren.find((c) => c.uuid === payload.childId);\n      if (!child) {\n        throw new Error('No array-child found with given ID');\n      }\n\n      // Remove any descendants\n      for (const uuid of getDescendantIds(draft.fields, [child.valueId])) {\n        delete draft.fields[uuid];\n      }\n\n      // Remove reference from parent\n      field.arrayChildren = field.arrayChildren.filter(\n        (c) => c.uuid !== payload.childId\n      );\n    })\n  )\n  .handleAction(\n    actions.updateName,\n    produce((draft, { payload }) => {\n      const field = draft.fields[payload.uuid];\n      assertIsMapField(field);\n      const childField = field.mapChildren.find(\n        (c) => c.uuid === payload.childId\n      );\n      if (!childField) {\n        throw new Error('No map-child found with given ID');\n      }\n      childField.name = payload.name;\n    })\n  )\n  .handleAction(\n    actions.updateType,\n    produce((draft, { payload }) => {\n      if (payload.type === FieldType.MAP) {\n        draft.fields[payload.uuid] = { mapChildren: [] };\n      } else if (payload.type === FieldType.ARRAY) {\n        draft.fields[payload.uuid] = { arrayChildren: [] };\n      } else if (payload.type === FieldType.JSON) {\n        draft.fields[payload.uuid] = { isJson: true, value: {} };\n      } else {\n        draft.fields[payload.uuid] = {\n          value: defaultValueForPrimitiveType(payload.type),\n        };\n      }\n    })\n  )\n  .handleAction(\n    actions.updateValue,\n    produce((draft, { payload }) => {\n      const field = draft.fields[payload.uuid];\n      assertIsPrimitiveField(field);\n      field.value = payload.value;\n    })\n  );\n\nexport const storeReducer: React.Reducer<Store, Action> = (state, action) => {\n  return (reducer.handlers as any)[action.type](state, action);\n};\n\nexport const DocumentStore: React.FC<{\n  store: Store;\n  dispatch: React.Dispatch<Action>;\n}> = ({ store, dispatch, children }) => {\n  return (\n    <documentStoreContext.Provider value={{ store, dispatch }}>\n      {children}\n    </documentStoreContext.Provider>\n  );\n};\n\nexport function useDocumentStore(): {\n  store: Store;\n  dispatch: React.Dispatch<Action>;\n} {\n  const context = React.useContext(documentStoreContext);\n  if (context === undefined) {\n    throw new Error('useDocumentStore must be used within a <DocumentStore>');\n  }\n  return context;\n}\n\nexport function useStore(): Store {\n  const { store } = useDocumentStore();\n  return React.useMemo(() => store, [store]);\n}\n\nexport function useDispatch(): React.Dispatch<Action> {\n  const { dispatch } = useDocumentStore();\n  return React.useMemo(() => dispatch, [dispatch]);\n}\n\nexport function useField(uuid: number): Field {\n  const store = useStore();\n  return React.useMemo(() => store.fields[uuid], [store, uuid]);\n}\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { Field } from '../../common/Field';\n\nconst StringEditor: React.FC<{\n  value: string;\n  onChange: (value: string) => void;\n}> = ({ value, onChange }) => {\n  return (\n    <Field\n      value={value}\n      outlined\n      label=\"Value\"\n      onChange={(e) => onChange(e.currentTarget.value)}\n    />\n  );\n};\n\nexport default StringEditor;\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport firebase from 'firebase';\nimport React, { useEffect, useState } from 'react';\nimport { useFormContext } from 'react-hook-form';\n\nimport { Field } from '../../common/Field';\n\nfunction dateToLocale(date: Date): string {\n  const year = date.getFullYear();\n  const month = String(date.getMonth() + 1).padStart(2, '0');\n  const dateOfMonth = String(date.getDate()).padStart(2, '0');\n  const hours = String(date.getHours()).padStart(2, '0');\n  const minutes = String(date.getMinutes()).padStart(2, '0');\n  const seconds = String(date.getSeconds()).padStart(2, '0');\n\n  return `${year}-${month}-${dateOfMonth}T${hours}:${minutes}:${seconds}`;\n}\n\n// TODO: update to a date-picker that potentially supports time-zones\nconst TimestampEditor: React.FC<{\n  value: firebase.firestore.Timestamp;\n  onChange: (value: firebase.firestore.Timestamp) => void;\n  name: string;\n}> = ({ value, onChange, name }) => {\n  const [date, setDate] = useState(value.toDate());\n\n  const {\n    errors,\n    formState: { touched },\n    register,\n    unregister,\n    setValue,\n  } = useFormContext();\n\n  useEffect(() => {\n    register(name, {\n      validate: (e) => !isNaN(e) || 'Must be a date-time',\n    });\n\n    return () => unregister(name);\n  }, [register, unregister, name]);\n\n  useEffect(() => {\n    if (value.toMillis() !== date.getTime()) {\n      onChange(firebase.firestore.Timestamp.fromDate(date));\n    }\n  }, [value, date, onChange]);\n\n  return (\n    <Field\n      label=\"Value\"\n      type=\"datetime-local\"\n      defaultValue={dateToLocale(date)}\n      onChange={(e) => {\n        const timestamp = Date.parse(e.currentTarget.value);\n        setValue(name, timestamp, true);\n        if (!isNaN(timestamp) && timestamp !== date.getTime()) {\n          setDate(new Date(timestamp));\n        }\n      }}\n      error={touched[name] && errors[name]?.message}\n    />\n  );\n};\n\nexport default TimestampEditor;\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './index.scss';\n\nimport { IconButton } from '@rmwc/icon-button';\nimport firebase from 'firebase';\nimport React, { useEffect } from 'react';\nimport { FormContext, useForm, useFormContext } from 'react-hook-form';\n\nimport { Field, SelectField } from '../../common/Field';\nimport { FieldType, FirestoreAny, FirestoreMap } from '../models';\nimport {\n  getFieldType,\n  isBoolean,\n  isGeoPoint,\n  isNumber,\n  isString,\n  isTimestamp,\n} from '../utils';\nimport * as actions from './actions';\nimport BooleanEditor from './BooleanEditor';\nimport GeoPointEditor from './GeoPointEditor';\nimport JsonEditor from './JsonEditor';\nimport NumberEditor from './NumberEditor';\nimport ReferenceEditor from './ReferenceEditor';\nimport {\n  DocumentStore,\n  storeReducer,\n  useDispatch,\n  useField,\n  useStore,\n} from './store';\nimport StringEditor from './StringEditor';\nimport TimestampEditor from './TimestampEditor';\nimport {\n  Field as DocumentField,\n  DocumentPath,\n  MapField,\n  isArrayField,\n  isJSONField,\n  isMapField,\n} from './types';\nimport { denormalize, normalize } from './utils';\n\nconst FIRESTORE_FIELD_TYPES = [\n  FieldType.STRING,\n  FieldType.NUMBER,\n  FieldType.BOOLEAN,\n  FieldType.MAP,\n  FieldType.ARRAY,\n  FieldType.NULL,\n  FieldType.TIMESTAMP,\n  FieldType.GEOPOINT,\n  FieldType.REFERENCE,\n];\n\n/**\n * Firestore does not support nested arrays\n * TODO(tlavelle): consider moving these upstream, and outside\n * of the \"DocumentEditor\"\n */\nconst FIRESTORE_ARRAY_FIELD_TYPES = FIRESTORE_FIELD_TYPES.filter(\n  (ft) => ft !== FieldType.ARRAY\n);\n\nconst RTDB_FIELD_TYPES = [\n  FieldType.STRING,\n  FieldType.NUMBER,\n  FieldType.BOOLEAN,\n  FieldType.MAP,\n  FieldType.ARRAY,\n  FieldType.JSON,\n];\n\nconst supportedFieldTypeSet = new Set(FIRESTORE_FIELD_TYPES);\n\nexport function supportsEditing(value: FirestoreAny): boolean {\n  return supportedFieldTypeSet.has(getFieldType(value));\n}\n\n/**\n * Entry point for a Document/Field editor\n *\n * areRootKeysMutable: can a root key be changed, this is generally not the case\n *     once a field has been persisted via the SDK.\n * areRootFielsMutable: can a root field be added/removed.\n */\nconst DocumentEditor: React.FC<{\n  value: FirestoreAny;\n  onChange?: (value?: FirestoreMap) => void;\n  areRootNamesMutable?: boolean;\n  areRootFieldsMutable?: boolean;\n  rtdb?: boolean;\n  startingIndex?: number;\n  supportNestedArrays?: boolean;\n  firestore?: firebase.firestore.Firestore;\n}> = ({\n  value,\n  onChange,\n  areRootNamesMutable,\n  areRootFieldsMutable,\n  rtdb = false,\n  startingIndex,\n  supportNestedArrays,\n  firestore,\n}) => {\n  const initialState = normalize(value);\n  const [store, dispatch] = React.useReducer(storeReducer, initialState);\n  const methods = useForm({ mode: 'onChange' });\n\n  const denormalizedStore = React.useMemo(() => denormalize(store, firestore), [\n    store,\n    firestore,\n  ]);\n\n  const errorCount = React.useMemo(() => Object.keys(methods.errors).length, [\n    methods,\n  ]);\n\n  useEffect(() => {\n    if (errorCount === 0) {\n      onChange && onChange(denormalizedStore as FirestoreMap);\n    } else {\n      onChange && onChange(undefined);\n    }\n  }, [denormalizedStore, errorCount, onChange]);\n\n  return (\n    <FormContext {...methods}>\n      <DocumentStore store={store} dispatch={dispatch}>\n        <div className=\"DocumentEditor\">\n          {\n            <>\n              {store.uuid !== undefined && (\n                <FieldEditor\n                  uuid={store.uuid}\n                  isRtdb={rtdb}\n                  areNamesMutable={areRootNamesMutable}\n                  areFieldsMutable={areRootFieldsMutable}\n                  startingIndex={startingIndex}\n                  supportNestedArrays={supportNestedArrays}\n                />\n              )}\n            </>\n          }\n        </div>\n      </DocumentStore>\n    </FormContext>\n  );\n};\n\n/**\n * Field with call-to-actions for editing as well as rendering applicable child-nodes\n */\nconst FieldEditor: React.FC<{\n  uuid: number;\n  isRtdb: boolean;\n  areNamesMutable?: boolean;\n  areFieldsMutable?: boolean;\n  startingIndex?: number;\n  supportNestedArrays?: boolean;\n  isJson?: boolean;\n}> = ({\n  uuid,\n  isRtdb,\n  areNamesMutable = true,\n  areFieldsMutable = true,\n  startingIndex = 0,\n  supportNestedArrays = true,\n  isJson = false,\n}) => {\n  const store = useStore();\n  const dispatch = useDispatch();\n  const field = useField(uuid);\n\n  if (isMapField(field)) {\n    const allowedChildTypes = isRtdb ? RTDB_FIELD_TYPES : FIRESTORE_FIELD_TYPES;\n\n    return (\n      <div className=\"DocumentEditor-Map\">\n        <div className=\"DocumentEditor-MapEntries\">\n          {field.mapChildren.map((c) => {\n            return (\n              <div className=\"DocumentEditor-MapEntry\" key={c.uuid}>\n                <div className=\"DocumentEditor-MapEntryMetadata\">\n                  <NameEditor\n                    uuid={uuid}\n                    field={field}\n                    childId={c.uuid}\n                    readonly={!areNamesMutable && uuid === store.uuid}\n                  />\n                  <span className=\"Document-TypeSymbol\">=</span>\n                  <ChildTypeSelect\n                    uuid={c.valueId}\n                    allowedTypes={allowedChildTypes}\n                  />\n                </div>\n                <FieldEditor uuid={c.valueId} isRtdb={isRtdb} isJson={isJson} />\n                {areFieldsMutable && (\n                  <IconButton\n                    className=\"DocumentEditor-MapEntryDelete\"\n                    type=\"button\"\n                    icon=\"delete\"\n                    label=\"Remove field\"\n                    onClick={() =>\n                      dispatch(actions.removeFromMap({ uuid, childId: c.uuid }))\n                    }\n                  />\n                )}\n              </div>\n            );\n          })}\n          {areFieldsMutable && (\n            <IconButton\n              label=\"Add field\"\n              type=\"button\"\n              icon=\"add\"\n              onClick={() =>\n                dispatch(\n                  actions.addToMap({\n                    uuid,\n                    name: '',\n                    value: '',\n                  })\n                )\n              }\n            />\n          )}\n        </div>\n      </div>\n    );\n  } else if (isArrayField(field)) {\n    const allowedChildTypes = isRtdb\n      ? RTDB_FIELD_TYPES\n      : supportNestedArrays\n      ? FIRESTORE_FIELD_TYPES\n      : FIRESTORE_ARRAY_FIELD_TYPES;\n\n    return (\n      <div className=\"DocumentEditor-Array\">\n        <div className=\"DocumentEditor-ArrayEntries\">\n          {field.arrayChildren.map((c, index) => {\n            return (\n              <div className=\"DocumentEditor-ArrayEntry\" key={c.uuid}>\n                <div className=\"DocumentEditor-ArrayEntryMetadata\">\n                  <div className=\"DocumentEditor-ArrayIndex\">\n                    <Field\n                      value={index + startingIndex}\n                      label=\"Index\"\n                      disabled\n                    />\n                  </div>\n                  <span className=\"Document-TypeSymbol\">=</span>\n                  <ChildTypeSelect\n                    uuid={c.valueId}\n                    allowedTypes={allowedChildTypes}\n                  />\n                </div>\n                <FieldEditor uuid={c.valueId} isRtdb={isRtdb} />\n                {areFieldsMutable && (\n                  <IconButton\n                    className=\"DocumentEditor-ArrayEntryDelete\"\n                    type=\"button\"\n                    icon=\"delete\"\n                    label=\"Remove field\"\n                    onClick={() =>\n                      dispatch(\n                        actions.removeFromArray({ uuid, childId: c.uuid })\n                      )\n                    }\n                  />\n                )}\n              </div>\n            );\n          })}\n          {areFieldsMutable && (\n            <IconButton\n              label=\"Add field\"\n              type=\"button\"\n              icon=\"add\"\n              onClick={() =>\n                dispatch(\n                  actions.addToArray({\n                    uuid,\n                    value: '',\n                  })\n                )\n              }\n            />\n          )}\n        </div>\n      </div>\n    );\n  } else if (isJSONField(field)) {\n    return (\n      <JsonEditor\n        name={`${uuid}`}\n        value={field.value}\n        onChange={(value) => dispatch(actions.updateValue({ uuid, value }))}\n      />\n    );\n  } else {\n    const valueEditor =\n      field.value instanceof DocumentPath ? (\n        <ReferenceEditor\n          name={`${uuid}`}\n          value={field.value}\n          onChange={(value) => dispatch(actions.updateValue({ uuid, value }))}\n        />\n      ) : isString(field.value) ? (\n        <StringEditor\n          value={field.value}\n          onChange={(value) => dispatch(actions.updateValue({ uuid, value }))}\n        />\n      ) : isBoolean(field.value) ? (\n        <BooleanEditor\n          value={field.value}\n          onChange={(value) => dispatch(actions.updateValue({ uuid, value }))}\n        />\n      ) : isNumber(field.value) ? (\n        <NumberEditor\n          name={`${uuid}`}\n          value={field.value}\n          onChange={(value) => dispatch(actions.updateValue({ uuid, value }))}\n        />\n      ) : isGeoPoint(field.value) ? (\n        <GeoPointEditor\n          name={`${uuid}`}\n          value={field.value}\n          onChange={(value) => dispatch(actions.updateValue({ uuid, value }))}\n        />\n      ) : isTimestamp(field.value) ? (\n        <TimestampEditor\n          name={`${uuid}`}\n          value={field.value}\n          onChange={(value) => dispatch(actions.updateValue({ uuid, value }))}\n        />\n      ) : null;\n\n    return <div className=\"DocumentEditor-Primitive\">{valueEditor}</div>;\n  }\n};\n\nconst ChildTypeSelect: React.FC<{\n  uuid: number;\n  allowedTypes: FieldType[];\n}> = ({ uuid, allowedTypes }) => {\n  const field = useField(uuid);\n  const dispatch = useDispatch();\n\n  return (\n    <SelectField\n      label=\"Type\"\n      outlined\n      options={allowedTypes}\n      value={getDocumentFieldType(field)}\n      onChange={(e) => {\n        dispatch(\n          actions.updateType({ uuid, type: e.currentTarget.value as FieldType })\n        );\n      }}\n    />\n  );\n};\n\nconst NameEditor: React.FC<{\n  uuid: number;\n  field: MapField;\n  childId: number;\n  readonly: boolean;\n}> = ({ uuid, field, childId, readonly }) => {\n  const {\n    register,\n    unregister,\n    errors,\n    clearError,\n    setValue,\n    setError,\n    formState: { touched },\n  } = useFormContext();\n\n  const dispatch = useDispatch();\n  const child = field.mapChildren.find((c) => c.uuid === childId);\n  if (!child) {\n    throw new Error('Tried to render a name-edtior for a non-map-child');\n  }\n\n  const formName = `${childId}`;\n\n  const siblingNames = React.useMemo(() => {\n    return field.mapChildren\n      .filter((c) => c.uuid !== childId)\n      .map((c) => c.name);\n  }, [field, childId]);\n\n  useEffect(() => {\n    register(formName);\n    return () => unregister(formName);\n  }, [register, unregister, formName]);\n\n  useEffect(() => {\n    // Validate `name` when siblings change\n    const isUnique = siblingNames.every((name) => name !== child.name);\n    if (!child.name) {\n      setError(formName, 'required', 'Required');\n    } else if (!isUnique) {\n      setError(formName, 'unique', 'Must be unique');\n    } else {\n      clearError(formName);\n    }\n  }, [child, siblingNames, formName, setError, clearError]);\n\n  return (\n    <Field\n      label=\"Field\"\n      outlined\n      value={child.name}\n      disabled={readonly}\n      onChange={(e) => {\n        setValue(formName, e.currentTarget.value);\n        dispatch(\n          actions.updateName({\n            uuid,\n            childId,\n            name: e.currentTarget.value,\n          })\n        );\n      }}\n      // Show the `unique` error regardless of the field having been\n      // touched; in case another field's name was updated to now conflict\n      error={\n        (touched[formName] || errors[formName]?.type === 'unique') &&\n        errors[formName]?.message\n      }\n    />\n  );\n};\n\nfunction getDocumentFieldType(field: DocumentField): FieldType {\n  if (isMapField(field)) {\n    return FieldType.MAP;\n  } else if (isArrayField(field)) {\n    return FieldType.ARRAY;\n  } else if (isJSONField(field)) {\n    return FieldType.JSON;\n  } else {\n    if (field.value instanceof DocumentPath) {\n      return FieldType.REFERENCE;\n    }\n    return getFieldType(field.value);\n  }\n}\n\n//\nexport default DocumentEditor;\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './InlineEditor.scss';\n\nimport {\n  Card,\n  CardActionButton,\n  CardActionButtons,\n  CardActions,\n} from '@rmwc/card';\nimport { Elevation } from '@rmwc/elevation';\nimport firebase from 'firebase';\nimport React, { useState } from 'react';\nimport { FocusOn } from 'react-focus-on';\n\nimport DocumentEditor from '../DocumentEditor';\nimport { FirestoreAny } from '../models';\n\n/** Editor entry point for a selected field */\nconst InlineEditor: React.FC<{\n  value: FirestoreAny;\n  onCancel: () => void;\n  onSave: (key: string, value: FirestoreAny) => void;\n  areRootKeysMutable: boolean;\n  rtdb?: boolean;\n  startingIndex?: number;\n  firestore?: firebase.firestore.Firestore;\n}> = ({\n  value,\n  onCancel,\n  onSave,\n  areRootKeysMutable,\n  rtdb,\n  startingIndex,\n  firestore,\n}) => {\n  const [internalValue, setInternalValue] = useState<\n    FirestoreAny | undefined\n  >();\n\n  function handleChange(value: FirestoreAny | undefined) {\n    setInternalValue(value);\n  }\n\n  function handleCancel() {\n    onCancel();\n  }\n\n  function handleSubmit(e: React.MouseEvent<HTMLButtonElement>) {\n    e.preventDefault();\n    e.stopPropagation();\n    if (internalValue) {\n      onSave(Object.keys(internalValue)[0], Object.values(internalValue)[0]);\n    }\n  }\n\n  return (\n    <FocusOn\n      className=\"Firestore-InlineEditor-relative-anchor\"\n      onClickOutside={handleCancel}\n      onEscapeKey={handleCancel}\n      scrollLock={false}\n    >\n      <Elevation z={8} wrap>\n        <Card\n          className=\"Firestore-InlineEditor\"\n          tag=\"form\"\n          onSubmit={handleSubmit}\n        >\n          <div className=\"Firestore-InlineEditorContent\">\n            <DocumentEditor\n              value={value}\n              onChange={handleChange}\n              areRootNamesMutable={areRootKeysMutable}\n              areRootFieldsMutable={false}\n              rtdb={rtdb}\n              startingIndex={startingIndex}\n              supportNestedArrays={false}\n              firestore={firestore}\n            />\n          </div>\n          <CardActions className=\"Firestore-InlineEditorActions\">\n            <CardActionButtons>\n              <CardActionButton type=\"button\" onClick={handleCancel}>\n                Cancel\n              </CardActionButton>\n              <CardActionButton\n                type=\"submit\"\n                unelevated\n                disabled={!internalValue}\n              >\n                Save\n              </CardActionButton>\n            </CardActionButtons>\n          </CardActions>\n        </Card>\n      </Elevation>\n    </FocusOn>\n  );\n};\n\nexport default InlineEditor;\n","/**\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './NodeLink.scss';\n\nimport { Typography } from '@rmwc/typography';\nimport firebase from 'firebase';\nimport * as React from 'react';\nimport { Link, matchPath, useRouteMatch } from 'react-router-dom';\n\nimport { getDbRootUrl } from './common/view_model';\n\nexport interface Props {\n  dbRef: firebase.database.Reference;\n}\n\nexport const NodeLink = React.memo<Props>(function NodeLink$({ dbRef }) {\n  const key = dbRef.key || getDbRootUrl(dbRef);\n  const path = new URL(dbRef.toString()).pathname;\n  const href = useHrefWithinSameRoute(path);\n  return (\n    <Typography\n      className=\"NodeLink\"\n      use=\"body1\"\n      aria-label=\"Key name\"\n      tag={Link}\n      to={href}\n    >\n      {key}\n    </Typography>\n  );\n});\n\n/**\n * Creates a href that replaces the `/:path*` part of the current `<Route>`\n *\n * e.g. `/database/sample/data/a/b/c` -> `/database/sample/data/x/y/z`\n */\nfunction useHrefWithinSameRoute(absolutePath: string) {\n  const match = useRouteMatch();\n\n  // remove the wildcard :path param, so we can append it manually\n  const withoutPath = match.path.replace('/:path*', '');\n\n  const result = matchPath(match.url, { path: withoutPath, strict: true });\n  const baseUrl = result?.url || '';\n  return baseUrl === '/' ? absolutePath : `${baseUrl}${absolutePath}`;\n}\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './ValueDisplay.scss';\n\nimport { Typography, TypographyProps } from '@rmwc/typography';\nimport * as React from 'react';\nimport { DOMAttributes } from 'react';\n\nexport interface Props extends DOMAttributes<HTMLSpanElement>, TypographyProps {\n  value: string | number | boolean | null;\n}\n\nexport const ValueDisplay = React.memo<Props>(function ValueDisplay$({\n  value,\n  use,\n  ...otherProps\n}) {\n  const trimmedValue =\n    typeof value === 'string' && value.length >= 24\n      ? `${value.substr(0, 21)}...`\n      : value;\n\n  const getClass = (value: Props['value']) =>\n    `ValueDisplay ValueDisplay__${typeof value}`;\n  return (\n    <Typography\n      use=\"body1\"\n      className={getClass(value)}\n      {...otherProps}\n      aria-label=\"Node value\"\n    >\n      {JSON.stringify(trimmedValue)}\n    </Typography>\n  );\n});\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './NodeLeaf.scss';\n\nimport { IconButton } from '@rmwc/icon-button';\nimport { Tooltip } from '@rmwc/tooltip';\nimport firebase from 'firebase';\nimport * as React from 'react';\nimport { useState } from 'react';\n\nimport InlineEditor from '../../Firestore/DocumentPreview/InlineEditor';\nimport { FirestoreAny } from '../../Firestore/models';\nimport { NodeLink } from './NodeLink';\nimport { ValueDisplay } from './ValueDisplay';\n\nexport interface Props {\n  realtimeRef: firebase.database.Reference;\n  value: string | boolean | number | null;\n}\n\nexport const NodeLeaf = React.memo<Props>(function NodeLeaf$({\n  value,\n  realtimeRef,\n}) {\n  const [isEditing, setIsEditing] = useState(false);\n  const [isAdding, setIsAdding] = useState(false);\n  const handleEdit = () => {\n    setIsEditing(!isEditing);\n  };\n\n  const handleEditSuccess = async (key: string, value: FirestoreAny) => {\n    await realtimeRef.set(value);\n    setIsEditing(false);\n  };\n\n  const handleAdd = () => {\n    setIsAdding(!isAdding);\n  };\n\n  const handleAddSuccess = async (key: string, value: FirestoreAny) => {\n    await realtimeRef.child(key).set(value);\n    setIsAdding(false);\n  };\n\n  const handleDelete = async () => {\n    try {\n      await realtimeRef.remove();\n    } catch (e) {\n      throw e;\n    }\n  };\n\n  const showAddButton = !realtimeRef.parent && value === null;\n  return (\n    <div className=\"NodeLeaf\">\n      <div className=\"NodeLeaf__key\">\n        <NodeLink dbRef={realtimeRef} />\n        {': '}\n        <ValueDisplay use=\"body1\" value={value} onClick={handleEdit} />\n      </div>\n      <span className=\"NodeLeaf__actions\">\n        <Tooltip content=\"Edit value\">\n          <IconButton\n            icon=\"edit\"\n            onClick={handleEdit}\n            aria-label=\"Edit value\"\n          />\n        </Tooltip>\n        {showAddButton && (\n          <Tooltip content=\"Add child\">\n            <IconButton icon=\"add\" onClick={handleAdd} aria-label=\"Add child\" />\n          </Tooltip>\n        )}\n        <Tooltip content=\"Delete value\">\n          <IconButton\n            icon=\"delete\"\n            onClick={handleDelete}\n            aria-label=\"Delete value\"\n          />\n        </Tooltip>\n      </span>\n      <div className=\"NodeLeaf__edit-ui\">\n        {isEditing && (\n          <InlineEditor\n            rtdb\n            value={{\n              [realtimeRef.key || realtimeRef.toString()]:\n                value === null ? '' : value,\n            }}\n            onCancel={() => setIsEditing(false)}\n            onSave={handleEditSuccess}\n            areRootKeysMutable={false}\n          />\n        )}\n        {isAdding && (\n          <InlineEditor\n            rtdb\n            value={{ [realtimeRef.push().key!]: '' }}\n            onCancel={() => setIsAdding(false)}\n            onSave={handleAddSuccess}\n            areRootKeysMutable={true}\n          />\n        )}\n      </div>\n    </div>\n  );\n});\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { ok } from 'assert';\n\nimport { Checkbox } from '@rmwc/checkbox';\nimport {\n  Dialog,\n  DialogActions,\n  DialogButton,\n  DialogContent,\n  DialogTitle,\n} from '@rmwc/dialog';\nimport { TextField } from '@rmwc/textfield';\nimport { Typography } from '@rmwc/typography';\nimport firebase from 'firebase';\nimport * as React from 'react';\nimport { useEffect, useState } from 'react';\n\nimport { Field } from '../../common/Field';\n\nexport interface Props {\n  realtimeRef: firebase.database.Reference;\n  query?: firebase.database.Query;\n  /**\n   * Called when complete, if the data was cloned the key is returned, else\n   * undefined.\n   */\n  onComplete: (string?: string) => void;\n}\n\n/**\n * Strips protocol and domain name (usually http://localhost:9000/)\n * from the ref's path\n * @example \"localhost:9000/todos/one\" -> \"/todos/one\"\n * @param ref\n */\nconst getAbsoluteRefPath = (ref: firebase.database.Reference) => {\n  return new URL(ref.toString()).pathname;\n};\n\n/**\n * Returns a key value that is either a new push id if the current\n * ref's key is a push id or a \"copy\" key if not.\n * @param key\n * @param ref\n */\nconst cloneKey = (key: string, ref: firebase.database.Reference) => {\n  return key.startsWith('-')\n    ? `${getAbsoluteRefPath(ref.parent!)}/${ref.push().key!}`\n    : `${getAbsoluteRefPath(ref)}_copy`;\n};\n\nexport const CloneDialog = React.memo<Props>(function CloneDialog$({\n  realtimeRef,\n  query,\n  onComplete,\n}) {\n  ok(realtimeRef.parent, 'Cannot clone the root node!');\n\n  // queries only exist if queryParams are passed into the dialog\n  let hasQuery = query != null;\n\n  const originalKey = realtimeRef.key!;\n  const [newDestinationPath, setNewDestinationPath] = useState('');\n\n  const [form, setForm] = useState<Record<string, string>>({});\n  const [isLoading, setIsLoading] = useState(true);\n  const [isCloningWithFiltered, setCloningFiltered] = useState(hasQuery);\n\n  useEffect(() => {\n    const loadData = async () => {\n      let snapshot = null;\n      // only apply the query if the user has selected the checkbox\n      // and the query has been passed as a prop\n      if (query != null && isCloningWithFiltered) {\n        snapshot = await query.once('value');\n      } else {\n        snapshot = await realtimeRef.once('value');\n      }\n      const data: Record<string, string> = {};\n      Object.entries(snapshot.val() || {}).forEach(([key, val]) => {\n        data[key] = JSON.stringify(val);\n      });\n      setForm(data);\n      setNewDestinationPath(cloneKey(originalKey, realtimeRef));\n      setIsLoading(false);\n    };\n    loadData();\n  }, [\n    setIsLoading,\n    setForm,\n    setNewDestinationPath,\n    originalKey,\n    realtimeRef,\n    isCloningWithFiltered,\n    query,\n  ]);\n\n  const updateField = (e: React.FormEvent<HTMLInputElement>) => {\n    const target = e.target as HTMLInputElement;\n    setForm({\n      ...form,\n      [target.name]: target.value,\n    });\n  };\n\n  const handleSubmit = (e: React.FormEvent<HTMLElement>) => {\n    e.preventDefault();\n    const data: Record<string, any> = {};\n    Object.entries(form).forEach(([key, value]) => {\n      data[key] = JSON.parse(value);\n    });\n    realtimeRef.root.child(newDestinationPath).set(data);\n\n    onComplete(newDestinationPath);\n  };\n\n  return (\n    <Dialog open>\n      <form onSubmit={handleSubmit}>\n        <DialogTitle>Clone \"{originalKey}\"</DialogTitle>\n        <DialogContent>\n          <Field\n            label=\"New destination path:\"\n            value={newDestinationPath}\n            onChange={(e) =>\n              setNewDestinationPath((e.target as HTMLInputElement).value)\n            }\n            type=\"text\"\n          />\n\n          {hasQuery ? (\n            <div>\n              <Checkbox\n                label=\"Clone filtered data set\"\n                checked={isCloningWithFiltered}\n                onChange={(event) => {\n                  setCloningFiltered(!!event.currentTarget.checked);\n                }}\n              />\n            </div>\n          ) : null}\n\n          <Typography use=\"headline6\">Data</Typography>\n          {isLoading\n            ? 'Loading...'\n            : Object.entries(form).map(([key, val]) => (\n                <div key={key}>\n                  <label>\n                    {key}:\n                    <TextField\n                      name={key}\n                      type=\"text\"\n                      value={val}\n                      onChange={updateField}\n                      placeholder=\"JSON or simple text\"\n                    />\n                  </label>\n                </div>\n              ))}\n        </DialogContent>\n        <DialogActions>\n          <DialogButton\n            type=\"button\"\n            action=\"close\"\n            theme=\"secondary\"\n            onClick={() => onComplete()}\n          >\n            Cancel\n          </DialogButton>\n          <DialogButton unelevated action=\"accept\">\n            Clone\n          </DialogButton>\n        </DialogActions>\n      </form>\n    </Dialog>\n  );\n});\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './InlineQuery.scss';\n\nimport {\n  Card,\n  CardActionButton,\n  CardActionButtons,\n  CardActions,\n} from '@rmwc/card';\nimport keycode from 'keycode';\nimport * as React from 'react';\nimport { useEffect, useRef, useState } from 'react';\n\nimport { Field, SelectField } from '../../common/Field';\nimport {\n  DEFAULT_PAGE_SIZE,\n  DEFAULT_QUERY_PARAMS,\n  QueryParams,\n  jsonIshValue,\n} from './common/view_model';\n\nexport interface Props {\n  params?: QueryParams;\n  onSubmit: (params: QueryParams) => void;\n  onCancel: () => void;\n}\n\ntype FormData = { [K in keyof QueryParams]: string };\n\nexport const InlineQuery = React.memo<Props>(function InlineQuery$({\n  params = {},\n  onSubmit,\n  onCancel,\n}) {\n  const {\n    key = '',\n    operator = '==',\n    value = '',\n    limit = DEFAULT_PAGE_SIZE,\n  } = params;\n\n  const [form, setValues] = useState<FormData>({\n    key,\n    operator,\n    value: JSON.stringify(value),\n    limit: `${limit}`,\n  });\n\n  const updateField = (\n    e: React.FormEvent<HTMLInputElement | HTMLSelectElement>\n  ) => {\n    const target = e.target as HTMLInputElement;\n    setValues({\n      ...form,\n      [target.name]: target.value,\n    });\n  };\n\n  const submitForm = (e: React.FormEvent<HTMLFormElement>) => {\n    e.preventDefault();\n    onSubmit && onSubmit(toParams(form));\n  };\n\n  const cancelOnEscape = (e: React.KeyboardEvent) => {\n    if (e.keyCode === keycode('esc')) {\n      onCancel && onCancel();\n    }\n  };\n\n  const keyInputRef = useRef<HTMLInputElement>(null);\n  const valueInputRef = useRef<HTMLInputElement>(null);\n\n  useEffect(() => {\n    if (key) {\n      valueInputRef.current!.focus();\n      valueInputRef.current!.select();\n    } else {\n      keyInputRef.current!.focus();\n      keyInputRef.current!.select();\n    }\n  }, [key]);\n\n  return (\n    <Card\n      className=\"InlineQuery InlineQuery__card\"\n      tag=\"form\"\n      onSubmit={submitForm}\n      onKeyDown={cancelOnEscape}\n    >\n      <div className=\"InlineQuery__form-fields\">\n        <Field\n          outlined\n          label=\"Key\"\n          name=\"key\"\n          value={form.key}\n          onChange={updateField}\n          inputRef={keyInputRef}\n        />\n        <SelectField\n          label=\"Condition\"\n          name=\"operator\"\n          options={['==', '>=', '<=']}\n          value={form.operator}\n          onChange={updateField}\n        />\n        <Field\n          label=\"Value\"\n          name=\"value\"\n          value={form.value}\n          onChange={updateField}\n          inputRef={valueInputRef}\n          placeholder=\"JSON or plain text\"\n        />\n        <Field\n          label=\"limit\"\n          name=\"limit\"\n          value={form.limit}\n          onChange={updateField}\n        />\n      </div>\n      <CardActions className=\"InlineQuery__actions\">\n        <CardActionButtons>\n          {params !== DEFAULT_QUERY_PARAMS && (\n            <CardActionButton\n              type=\"button\"\n              label=\"Reset\"\n              danger\n              onClick={() => onSubmit(DEFAULT_QUERY_PARAMS)}\n            />\n          )}\n          <CardActionButton\n            theme=\"secondary\"\n            type=\"button\"\n            label=\"Cancel\"\n            onClick={() => onCancel && onCancel()}\n          />\n          <CardActionButton unelevated type=\"submit\" label=\"Search\" />\n        </CardActionButtons>\n      </CardActions>\n    </Card>\n  );\n});\n\nfunction toParams(form: FormData): QueryParams {\n  const { key, operator, value, limit } = form;\n  return {\n    key,\n    operator: operator as QueryParams['operator'],\n    value: jsonIshValue(value || 'null'),\n    limit: Number(limit),\n  };\n}\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Dialog,\n  DialogActions,\n  DialogButton,\n  DialogContent,\n  DialogTitle,\n} from '@rmwc/dialog';\nimport firebase from 'firebase';\nimport * as React from 'react';\nimport { useState } from 'react';\n\nimport { Field } from '../../common/Field';\n\nexport interface Props {\n  realtimeRef: firebase.database.Reference;\n  isOpen: boolean;\n  onComplete: (didRename: boolean) => void;\n}\n\nexport const RenameDialog = React.memo<Props>(function RenameDialog$({\n  realtimeRef,\n  isOpen,\n  onComplete,\n}) {\n  const originalKey = realtimeRef.key!;\n  const [form, setForm] = useState<Record<string, string>>({\n    newKey: originalKey,\n  });\n\n  const updateField = (e: React.FormEvent<HTMLInputElement>) => {\n    const target = e.target as HTMLInputElement;\n    setForm({\n      ...form,\n      [target.name]: target.value,\n    });\n  };\n\n  const onSubmit = async (e: React.FormEvent<HTMLElement>) => {\n    e.preventDefault();\n    const snap = await realtimeRef.once('value');\n    try {\n      await realtimeRef.parent!.update({\n        [form.newKey]: snap.val(),\n        [originalKey]: null,\n      });\n    } catch (e) {\n      // TODO: handle error state\n    }\n    onComplete(true);\n  };\n\n  return (\n    <Dialog open={isOpen} onClose={() => onComplete(false)}>\n      <form onSubmit={onSubmit}>\n        <DialogTitle>Rename \"{originalKey}\"</DialogTitle>\n        <DialogContent onSubmit={onSubmit}>\n          <Field\n            name=\"newKey\"\n            label=\"New key:\"\n            value={form.newKey}\n            onChange={updateField}\n            type=\"text\"\n          />\n        </DialogContent>\n        <DialogActions>\n          <DialogButton action=\"close\" type=\"button\" theme=\"secondary\">\n            Cancel\n          </DialogButton>\n          <DialogButton type=\"submit\" unelevated>\n            Rename\n          </DialogButton>\n        </DialogActions>\n      </form>\n    </Dialog>\n  );\n});\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport '@material/data-table/dist/mdc.data-table.css';\nimport '@rmwc/data-table/styles';\n\nimport './NodeTabularDisplay.scss';\n\nimport { Button } from '@rmwc/button';\nimport {\n  DataTable,\n  DataTableBody,\n  DataTableCell,\n  DataTableContent,\n  DataTableHead,\n  DataTableHeadCell,\n  DataTableRow,\n} from '@rmwc/data-table';\nimport { Typography } from '@rmwc/typography';\nimport firebase from 'firebase';\nimport * as React from 'react';\nimport { useEffect, useState } from 'react';\n\nimport { DEFAULT_PAGE_SIZE } from './common/view_model';\nimport { NodeLink } from './NodeLink';\nimport { ValueDisplay } from './ValueDisplay';\n\nexport interface Props {\n  hasMoreRows?: boolean;\n  query: firebase.database.Query;\n  onLoadMore?: () => void;\n}\n\nenum TableType {\n  KeyValue = 'kvp',\n  KeyObject = 'ko',\n  Array = 'arr',\n}\n\ninterface Table {\n  type: TableType;\n  headers: string[];\n  rows: { pkId: string; value: any }[];\n}\n\nexport const NodeTabularDisplay = React.memo<Props>(\n  function NodeTabularDisplay$({ query, hasMoreRows, onLoadMore }) {\n    const [table, setTable] = useState<Table>({\n      type: TableType.Array,\n      headers: [],\n      rows: [],\n    });\n\n    const raiseOnLoadMore = () => onLoadMore && onLoadMore();\n\n    useEffect(() => {\n      (async () => {\n        setTable(await buildTable(query));\n      })();\n    }, [query]);\n\n    return (\n      <DataTable className=\"NodeTabularDisplay\">\n        <DataTableContent>\n          <DataTableHead>\n            <DataTableRow>\n              {table.headers.map((header, i) => (\n                <DataTableHeadCell key={i}>\n                  <Typography use=\"body1\">{header}</Typography>\n                </DataTableHeadCell>\n              ))}\n            </DataTableRow>\n          </DataTableHead>\n          <DataTableBody>\n            {table.rows.map((row, idx) => (\n              <DataTableRow key={idx}>\n                {table.headers.map((header, i) =>\n                  getColumnValue(table, row, header, i, query.ref)\n                )}\n              </DataTableRow>\n            ))}\n          </DataTableBody>\n          {hasMoreRows && (\n            <DataTableHead>\n              <DataTableRow>\n                <DataTableCell colSpan={table.headers.length}>\n                  <Button onClick={() => raiseOnLoadMore()}>Load More</Button>\n                </DataTableCell>\n              </DataTableRow>\n            </DataTableHead>\n          )}\n        </DataTableContent>\n      </DataTable>\n    );\n  }\n);\n\nfunction getColumnValue(\n  table: Table,\n  row: { pkId: string; value: any },\n  key: string,\n  colIndex: number,\n  ref: firebase.database.Reference\n) {\n  if (colIndex === 0) {\n    return (\n      <DataTableCell key={key}>\n        <Typography use=\"body2\" className=\"NodeTabularDisplay__key\">\n          <NodeLink dbRef={ref.child(row.pkId)} />\n        </Typography>\n      </DataTableCell>\n    );\n  }\n\n  const value =\n    table.type === TableType.KeyValue || table.type === TableType.Array\n      ? row.value\n      : row.value[key];\n\n  switch (typeof value) {\n    case 'undefined':\n      return <DataTableCell className=\"undef\" key={key} />;\n    case 'object':\n      return (\n        <DataTableCell className=\"object\" key={key}>\n          <Typography use=\"body2\">{'{ ... }'}</Typography>\n        </DataTableCell>\n      );\n    default:\n      return (\n        <DataTableCell className={typeof value} key={key}>\n          <ValueDisplay value={value} use=\"body2\" />\n        </DataTableCell>\n      );\n  }\n}\n\nasync function buildTable(query: firebase.database.Query): Promise<Table> {\n  const snap = await query.once('value');\n  const data = snap.val();\n\n  // empty filter results\n  if (data === undefined || data === null) {\n    return {\n      type: TableType.KeyValue,\n      headers: ['No Data Available'],\n      rows: [{ pkId: 'value is undefined', value: 'Value is undefined' }],\n    };\n  }\n\n  const entries = Object.entries(data);\n  const type = getTableType(entries);\n\n  return {\n    type,\n    headers: getHeaders(type, entries),\n    rows: entries.map(([key, value]) => ({ pkId: key, value })),\n  };\n}\n\nfunction getTableType(entries: [string, unknown][]) {\n  const [key, value] = entries[0];\n\n  if (!isNaN(parseInt(key))) {\n    return TableType.Array;\n  } else if (typeof value === 'object') {\n    return TableType.KeyObject;\n  } else {\n    return TableType.KeyValue;\n  }\n}\n\nfunction getHeaders(type: TableType, entries: [string, any][]) {\n  const [, value] = entries[0];\n  switch (type) {\n    case TableType.KeyValue:\n      return ['key', 'value'];\n    case TableType.Array:\n      return ['', 'value'];\n    default:\n      return ['key', ...Object.keys(value)];\n  }\n}\n\nexport function isArrayLike(childKeys: string[]) {\n  if (childKeys.length <= 1) {\n    return false;\n  }\n\n  const halfOfList = childKeys.slice(0, DEFAULT_PAGE_SIZE * 2).sort();\n\n  const isArrayIndex = (v: string, i: number) => v === i.toString();\n  const isPushId = (v: string) => v.length === 20 && v[0] === '-';\n\n  return halfOfList.every(isPushId) || halfOfList.every(isArrayIndex);\n}\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Icon } from '@rmwc/icon';\nimport { IconButton } from '@rmwc/icon-button';\nimport { MenuItem, SimpleMenu } from '@rmwc/menu';\nimport { Tooltip } from '@rmwc/tooltip';\nimport firebase from 'firebase';\nimport * as React from 'react';\nimport { useState } from 'react';\n\nimport InlineEditor from '../../Firestore/DocumentPreview/InlineEditor';\nimport { FirestoreAny } from '../../Firestore/models';\nimport { CloneDialog } from './CloneDialog';\nimport { applyQuery } from './common/fetch';\nimport {\n  ChildrenDisplayType,\n  DEFAULT_QUERY_PARAMS,\n  QueryParams,\n} from './common/view_model';\nimport { InlineQuery } from './InlineQuery';\nimport { RenameDialog } from './RenameDialog';\n\nexport interface Props {\n  realtimeRef: firebase.database.Reference;\n  displayType: ChildrenDisplayType;\n  queryParams?: QueryParams;\n  updateQuery?: (params: QueryParams) => void;\n  onDisplayTypeChange: (displayType: ChildrenDisplayType) => void;\n  onExpandRequested: () => void;\n}\n\nconst getNextDisplayType = (current: ChildrenDisplayType) => {\n  return current === ChildrenDisplayType.Table\n    ? ChildrenDisplayType.TreeView\n    : ChildrenDisplayType.Table;\n};\n\nconst getToggleIcon = (current: ChildrenDisplayType) => {\n  switch (current) {\n    case ChildrenDisplayType.Table:\n      return 'view_comfy';\n    case ChildrenDisplayType.TreeView:\n      return 'view_list';\n    default:\n      throw new Error(`Display type is unrecognized`);\n  }\n};\n\nconst ACTIVE_ICON = { color: '#09d3ac' };\n\nexport const NodeActions = React.memo<Props>(function NodeActions$({\n  displayType,\n  onDisplayTypeChange,\n  realtimeRef,\n  updateQuery,\n  onExpandRequested,\n  queryParams,\n}) {\n  const [isMenuOpen, setMenuOpen] = useState(false);\n  const [isAdding, setIsAdding] = useState(false);\n  const [showQueryUi, setShowQueryUi] = useState(false);\n  const [cloneDialogIsOpen, setCloneDialogIsOpen] = useState(false);\n  const [renameDialogIsOpen, setRenameDialogIsOpen] = useState(false);\n\n  const isActive =\n    isMenuOpen ||\n    isAdding ||\n    showQueryUi ||\n    cloneDialogIsOpen ||\n    renameDialogIsOpen ||\n    queryParams !== DEFAULT_QUERY_PARAMS;\n  const isRoot = realtimeRef.parent === null;\n\n  const pushId = realtimeRef.push().key!;\n  const handleAddSuccess = async (key: string, value: FirestoreAny) => {\n    await realtimeRef.child(key).set(value);\n    setIsAdding(false);\n  };\n  const addChild = () => {\n    onExpandRequested();\n    setIsAdding(!isAdding);\n  };\n\n  const removeNode = async () => {\n    try {\n      await realtimeRef.remove();\n    } catch (e) {\n      throw e;\n    }\n  };\n\n  const showQueryUiAndExpand = () => {\n    onExpandRequested();\n    setShowQueryUi(true);\n  };\n\n  const toggleTable = () => {\n    onDisplayTypeChange(getNextDisplayType(displayType));\n  };\n\n  const potentialQuery = React.useMemo(\n    () => applyQuery(realtimeRef, queryParams || {}),\n    [realtimeRef, queryParams]\n  );\n\n  return (\n    <aside className={'NodeActions' + (isActive ? ' NodeActions--active' : '')}>\n      <Tooltip content=\"Filter children\">\n        <IconButton\n          icon=\"filter_list\"\n          onIcon={<span style={ACTIVE_ICON}>filter_list</span>}\n          onClick={() => showQueryUiAndExpand()}\n          checked={queryParams !== DEFAULT_QUERY_PARAMS}\n        />\n      </Tooltip>\n      <Tooltip content=\"Add child\">\n        <IconButton icon=\"add\" onClick={addChild} />\n      </Tooltip>\n      {!isRoot ? (\n        <Tooltip content=\"Switch view\">\n          <IconButton\n            icon={getToggleIcon(getNextDisplayType(displayType))}\n            onClick={() => toggleTable()}\n          />\n        </Tooltip>\n      ) : null}\n      <SimpleMenu\n        renderToPortal={\n          /*\n           * Actions show on hover, so hoisting has some weird effects, popping\n           * in and out of the top left corner\n           */\n          false\n        }\n        handle={<IconButton icon=\"more_vert\" />}\n        onOpen={() => setMenuOpen(true)}\n        onClose={() => setMenuOpen(false)}\n      >\n        <MenuItem onClick={removeNode}>\n          <Icon icon=\"delete\" /> Remove\n        </MenuItem>\n        {!isRoot && (\n          <MenuItem onClick={() => setCloneDialogIsOpen(true)}>\n            <Icon icon=\"file_copy\" /> Clone\n          </MenuItem>\n        )}\n        {!isRoot && (\n          <MenuItem onClick={() => setRenameDialogIsOpen(true)}>\n            <Icon icon=\"edit\" /> Rename\n          </MenuItem>\n        )}\n      </SimpleMenu>\n\n      {/* Extra UI that shows when actions are triggered */}\n      <div className=\"NodeActions__additional-ui\">\n        {isAdding && (\n          <InlineEditor\n            rtdb\n            value={{ [pushId]: '' }}\n            onCancel={() => setIsAdding(false)}\n            onSave={handleAddSuccess}\n            areRootKeysMutable={true}\n          />\n        )}\n        {showQueryUi && (\n          <InlineQuery\n            params={queryParams}\n            onSubmit={(params) => {\n              updateQuery && updateQuery(params);\n              setShowQueryUi(false);\n            }}\n            onCancel={() => setShowQueryUi(false)}\n          />\n        )}\n        {cloneDialogIsOpen && (\n          <CloneDialog\n            realtimeRef={realtimeRef}\n            query={potentialQuery}\n            onComplete={() => setCloneDialogIsOpen(false)}\n          />\n        )}\n        {!isRoot && (\n          <RenameDialog\n            realtimeRef={realtimeRef}\n            isOpen={renameDialogIsOpen}\n            onComplete={() => setRenameDialogIsOpen(false)}\n          />\n        )}\n      </div>\n    </aside>\n  );\n});\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './NodeParent.scss';\n\nimport { Button } from '@rmwc/button';\nimport firebase from 'firebase';\nimport * as React from 'react';\nimport { useCallback, useState } from 'react';\n\nimport {\n  ChildrenDisplayType,\n  DEFAULT_PAGE_SIZE,\n  QueryParams,\n} from './common/view_model';\nimport { NodeActions } from './NodeActions';\nimport { NodeContainer } from './NodeContainer';\nimport { NodeLink } from './NodeLink';\nimport { NodeTabularDisplay } from './NodeTabularDisplay';\n\nexport interface Props {\n  realtimeRef: firebase.database.Reference;\n  children: string[];\n  isRealtime?: boolean;\n  queryParams?: QueryParams;\n  /**\n   * This node is the top most visible node in viewer (not the same as the real\n   * db root). It will show breadcrumbs of all hidden parent nodes to the root.\n   */\n  isViewRoot?: boolean;\n  updateQuery?: (params: QueryParams) => void;\n  query?: firebase.database.Query;\n}\n\nexport const NodeParent = React.memo<Props>(function NodeParent$({\n  realtimeRef,\n  children,\n  queryParams,\n  updateQuery,\n  isViewRoot,\n  query,\n}) {\n  const isRoot = realtimeRef.parent === null;\n  const hasChildren = !!children.length;\n  const [isExpanded, setIsExpanded] = useState(\n    isRoot || isViewRoot ? true : false\n  );\n  const [displayType, setDisplayType] = useState(ChildrenDisplayType.TreeView);\n\n  const hasMore =\n    queryParams && queryParams.limit\n      ? children.length >= queryParams.limit\n      : children.length >= DEFAULT_PAGE_SIZE;\n\n  const loadMore = () => {\n    const currentPageSize = queryParams\n      ? queryParams.limit || DEFAULT_PAGE_SIZE\n      : DEFAULT_PAGE_SIZE;\n    updateQuery &&\n      updateQuery({\n        ...queryParams,\n        limit: currentPageSize + DEFAULT_PAGE_SIZE,\n      });\n  };\n\n  const toggleExpansion = useCallback(() => setIsExpanded(!isExpanded), [\n    setIsExpanded,\n    isExpanded,\n  ]);\n\n  return (\n    <div className=\"NodeParent\">\n      {/* Label */}\n      <div className=\"NodeParent__label\">\n        {isExpanded ? (\n          <button\n            className=\"NodeParent__tree-button material-icons\"\n            aria-label=\"less\"\n            onClick={toggleExpansion}\n          >\n            arrow_drop_down\n          </button>\n        ) : (\n          <button\n            className=\"NodeParent__tree-button material-icons\"\n            aria-label=\"more\"\n            onClick={toggleExpansion}\n          >\n            arrow_right\n          </button>\n        )}\n        <NodeLink dbRef={realtimeRef} />\n        <NodeActions\n          realtimeRef={realtimeRef}\n          displayType={displayType}\n          onDisplayTypeChange={(type) => {\n            setDisplayType(type);\n            setIsExpanded(true);\n          }}\n          onExpandRequested={() => setIsExpanded(true)}\n          queryParams={queryParams}\n          updateQuery={updateQuery}\n        />\n      </div>\n      <div className=\"NodeParent__children-container\">\n        {hasChildren &&\n          isExpanded &&\n          (displayType === ChildrenDisplayType.Table ? (\n            <NodeTabularDisplay\n              query={query || realtimeRef}\n              hasMoreRows={hasMore}\n              onLoadMore={loadMore}\n            />\n          ) : (\n            <ul className=\"NodeParent__children\">\n              {children.map((key) => (\n                <li key={key}>\n                  <NodeContainer realtimeRef={realtimeRef.child(key)} />\n                </li>\n              ))}\n              {hasMore && (\n                <li className=\"load-more\">\n                  <Button onClick={loadMore}>Load more...</Button>\n                </li>\n              )}\n            </ul>\n          ))}\n      </div>\n    </div>\n  );\n});\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport firebase from 'firebase';\nimport * as React from 'react';\nimport { useEffect, useState } from 'react';\nimport { Subject } from 'rxjs';\n\nimport { canDoRealtime, createViewModel } from './common/fetch';\nimport {\n  DEFAULT_QUERY_PARAMS,\n  QueryParams,\n  ViewModel,\n} from './common/view_model';\nimport { NodeLeaf } from './NodeLeaf';\nimport { NodeParent } from './NodeParent';\n\nexport interface Props {\n  realtimeRef: firebase.database.Reference;\n  /**\n   * This node is the top most visible node in viewer (not the same as the real\n   * db root). It will show breadcrumbs of all hidden parent nodes to the root.\n   */\n  isViewRoot?: boolean;\n}\n\nconst initialState: ViewModel = {\n  isLoading: true,\n  children: [],\n};\n\nexport const NodeContainer = React.memo<Props>(function NodeContainer$({\n  realtimeRef,\n  isViewRoot,\n}) {\n  const [viewModel, setViewModel] = useState<ViewModel>(initialState);\n  const [querySubject, setQuerySubject] = useState<\n    Subject<QueryParams> | undefined\n  >(undefined);\n\n  useEffect(() => {\n    const canDoRealtime$ = canDoRealtime(realtimeRef);\n    const { query, viewModel$ } = createViewModel(realtimeRef, canDoRealtime$);\n    setQuerySubject(query);\n    const sub = viewModel$.subscribe((vm) => setViewModel(vm));\n    return () => sub.unsubscribe();\n  }, [realtimeRef]);\n\n  const updateQuery = (q: QueryParams) => {\n    setQueryParams(q);\n    querySubject && querySubject.next(q);\n  };\n\n  const [queryParams, setQueryParams] = useState(DEFAULT_QUERY_PARAMS);\n\n  const { children, query } = viewModel;\n  const hasChildren = !!children.length;\n  const isFiltered = queryParams !== DEFAULT_QUERY_PARAMS;\n  return !hasChildren && !isFiltered ? (\n    <NodeLeaf realtimeRef={realtimeRef} value={viewModel.value!} />\n  ) : (\n    <NodeParent\n      realtimeRef={realtimeRef}\n      children={children}\n      queryParams={queryParams}\n      updateQuery={updateQuery}\n      isViewRoot={isViewRoot}\n      query={query}\n    />\n  );\n});\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { IconButton } from '@rmwc/icon-button';\nimport { MenuItem, SimpleMenu } from '@rmwc/menu';\nimport firebase from 'firebase';\nimport React, { useEffect, useState } from 'react';\nimport { useDropzone } from 'react-dropzone';\nimport { useHistory } from 'react-router-dom';\n\nimport { initDatabase } from '../../firebase';\nimport { DatabaseConfig } from '../../store/config';\nimport { InteractiveBreadCrumbBar } from '../common/InteractiveBreadCrumbBar';\nimport { DatabaseApi } from './api';\nimport { ImportDialog } from './DataViewer/ImportDialog';\nimport { NodeContainer } from './DataViewer/NodeContainer';\n\nexport interface PropsFromState {\n  namespace: string;\n  path?: string;\n  config: DatabaseConfig;\n}\n\nexport type Props = PropsFromState;\n\nconst getPrefix = (ref: firebase.database.Reference) => {\n  const base = ref.root.toString();\n  return base.substring(0, base.length - 1);\n};\n\nexport const Database: React.FC<Props> = ({ config, namespace, path }) => {\n  const [ref, setRef] = useState<firebase.database.Reference | undefined>(\n    undefined\n  );\n  const [api, setApi] = useState<DatabaseApi | undefined>(undefined);\n\n  const history = useHistory();\n\n  const [importDialogOpen, setImportDialogOpen] = useState(false);\n  const [droppedFile, setDroppedFile] = useState<File | undefined>();\n\n  const closeImportDialog = () => {\n    setDroppedFile(undefined);\n    setImportDialogOpen(false);\n  };\n\n  useEffect(() => {\n    const [db, { cleanup }] = initDatabase(config, namespace);\n    setRef(path ? db.ref(path) : db.ref());\n\n    const api = new DatabaseApi(config, namespace);\n    setApi(api);\n\n    return function cleanupDb() {\n      cleanup();\n      api.delete();\n    };\n  }, [config, namespace, path]);\n\n  const urlBase = `/database/${namespace}/data`;\n  const handleNavigate = (newPath: string) => {\n    if (newPath.startsWith('/')) {\n      newPath = newPath.substr(1);\n    }\n    history.push(`${urlBase}/${newPath}`);\n  };\n\n  return (\n    <div className=\"Database-Database\">\n      {ref && api ? (\n        <>\n          <InteractiveBreadCrumbBar\n            base={urlBase}\n            path={path || '/'}\n            inputPrefix={getPrefix(ref)}\n            onNavigate={handleNavigate}\n          >\n            <SimpleMenu\n              handle={<IconButton icon=\"more_vert\" label=\"Open menu\" />}\n              renderToPortal\n            >\n              <MenuItem onClick={() => setImportDialogOpen(true)}>\n                Import JSON\n              </MenuItem>\n            </SimpleMenu>\n          </InteractiveBreadCrumbBar>\n\n          <DatabaseDropZone onDrop={(f) => setDroppedFile(f)}>\n            <NodeContainer realtimeRef={ref} isViewRoot />\n          </DatabaseDropZone>\n\n          {(importDialogOpen || droppedFile) && (\n            <ImportDialog\n              api={api}\n              reference={ref}\n              droppedFile={droppedFile}\n              onComplete={closeImportDialog}\n            />\n          )}\n        </>\n      ) : (\n        <p>Loading</p>\n      )}\n    </div>\n  );\n};\n\nexport default Database;\n\n/**\n * Renders child content inside a dropzone that will show a scrim and accept\n * JSON files\n */\nconst DatabaseDropZone: React.FC<{ onDrop: (file: File) => void }> = ({\n  onDrop,\n  children,\n}) => {\n  const {\n    getInputProps,\n    getRootProps,\n    isDragActive,\n    isDragAccept,\n  } = useDropzone({\n    onDrop: (files) => onDrop(files[0]),\n    noClick: true,\n    accept: 'application/json',\n  });\n\n  return (\n    <div className=\"Database-Content\" {...getRootProps()}>\n      {children}\n\n      {isDragActive && (\n        <div className=\"Database-Content-Dragging\">\n          {isDragAccept ? (\n            'Drop JSON file to import'\n          ) : (\n            <span className=\"invalid\">\n              Only JSON files are supported for data import.\n            </span>\n          )}\n        </div>\n      )}\n\n      <input {...getInputProps()} />\n    </div>\n  );\n};\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './DatabasePicker.scss';\n\nimport {\n  List,\n  ListDivider,\n  ListGroup,\n  ListGroupSubheader,\n  ListItem,\n  ListItemGraphic,\n  ListItemText,\n} from '@rmwc/list';\nimport { Typography } from '@rmwc/typography';\nimport React from 'react';\nimport { Link } from 'react-router-dom';\n\nimport { DatabaseCircleIcon } from '../common/icons';\n\nexport interface PropsFromState {\n  databases: string[] | undefined;\n}\n\nexport type Props = PropsFromState & {\n  primary: string;\n  current: string;\n  navigation: (db: string) => string;\n};\n\nconst DatabaseListItem: React.FC<{\n  name: string;\n  navigation: (db: string) => string;\n  activated: boolean;\n}> = ({ name, navigation, activated }) => {\n  const to = navigation(name);\n  return (\n    <ListItem\n      activated={activated}\n      tag={Link}\n      to={to}\n      data-testid={`nav-${name}`}\n    >\n      <ListItemGraphic tag={DatabaseCircleIcon} size=\"large\" theme=\"primary\" />\n      <ListItemText>{name}</ListItemText>\n    </ListItem>\n  );\n};\n\nexport const DatabasePicker: React.FC<Props> = ({\n  primary,\n  current,\n  navigation,\n  databases,\n}) => {\n  const secondaryDbs = databases\n    ? databases.filter((db) => db !== primary)\n    : [];\n\n  // Always show current database, which may not be in the list.\n  if (current !== primary && secondaryDbs.indexOf(current) < 0) {\n    secondaryDbs.push(current);\n  }\n\n  let pickerClassName = 'Database-Picker';\n  if (secondaryDbs.length === 0) {\n    pickerClassName += ' Database-Picker--primary-only';\n  }\n\n  return (\n    <div className={pickerClassName}>\n      <List>\n        <ListGroup>\n          <ListGroupSubheader>\n            <Typography use=\"caption\">Databases</Typography>\n          </ListGroupSubheader>\n          <DatabaseListItem\n            activated={current === primary}\n            name={primary}\n            navigation={navigation}\n          />\n          <ListDivider tag=\"div\" />\n          {secondaryDbs.map((db) => (\n            <DatabaseListItem\n              key={db}\n              activated={current === db}\n              name={db}\n              navigation={navigation}\n            />\n          ))}\n        </ListGroup>\n      </List>\n    </div>\n  );\n};\n\nexport default DatabasePicker;\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Button } from '@rmwc/button';\nimport { Card } from '@rmwc/card';\nimport { Elevation } from '@rmwc/elevation';\nimport { GridCell } from '@rmwc/grid';\nimport React, { useState } from 'react';\nimport useSwr from 'swr';\n\nimport { DatabaseConfig } from '../../store/config';\nimport { Callout } from '../common/Callout';\nimport { useEmulatorConfig } from '../common/EmulatorConfigProvider';\nimport DatabasePicker from './DatabasePicker';\n\nexport type Props = {\n  children?: React.ReactNode;\n  databases: string[] | undefined;\n  current: string;\n  primary: string;\n  navigation: (db: string) => string;\n};\n\nexport const DatabaseContainer: React.FC<Props> = ({\n  current,\n  primary,\n  navigation,\n  databases,\n  children,\n}) => {\n  const [dbs, setDbs] = useState(databases);\n\n  let hasNewDbs = false;\n  if (databases !== dbs) {\n    if (\n      dbs === undefined ||\n      databases === undefined ||\n      dbs.join('|') === databases.join('|') // databases are sorted\n    ) {\n      // Don't show reload button for initial data or unchanged.\n      setDbs(databases);\n    } else {\n      hasNewDbs = true;\n    }\n  }\n\n  return (\n    <>\n      <GridCell span={12} className=\"Database-Container\">\n        {hasNewDbs && (\n          <Callout\n            icon=\"info\"\n            actions={\n              <Button theme=\"secondary\" onClick={() => setDbs(databases)}>\n                Reload\n              </Button>\n            }\n          >\n            There are new databases that have been created. Reload the page to\n            view them.\n          </Callout>\n        )}\n        <Elevation z={2} wrap>\n          <Card className=\"canvas-card\">\n            <div className=\"Database\">\n              <DatabasePicker\n                current={current}\n                primary={primary}\n                navigation={navigation}\n                databases={dbs}\n              />\n              {children}\n            </div>\n          </Card>\n        </Elevation>\n      </GridCell>\n    </>\n  );\n};\n\nexport const DatabaseContainerWrapper: React.FC<Omit<Props, 'databases'>> = (\n  props\n) => {\n  const config = useEmulatorConfig('database');\n  const { data } = useSwr(\n    // Put config object in cache key (compared shallowly) so databases will\n    // be cleared on emulator restart as expected (even if ports don't change).\n    ['/dummy/database/databases', config, props.primary],\n    fetchDatabases,\n    { refreshWhenOffline: true, initialData: undefined, refreshInterval: 5000 }\n  );\n  return <DatabaseContainer databases={data} {...props} />;\n};\n\nexport interface DatabaseInfo {\n  name: string;\n}\n\nasync function fetchDatabases(\n  _: string, // dummy path parameter, unused for actual fetching\n  config: DatabaseConfig,\n  primary: string\n): Promise<string[]> {\n  const res = await fetch(\n    `http://${config.hostAndPort}/.inspect/databases.json?ns=${primary}`\n  );\n  if (!res.ok) {\n    throw new Error(`HTTP ${res.status}: ${res.statusText}`);\n  }\n  const databaseInfos: DatabaseInfo[] = await res.json();\n\n  // Sort databases by name to avoid unnecessary \"changes\".\n  return databaseInfos.map((db) => db.name).sort();\n}\n\nexport default DatabaseContainerWrapper;\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './index.scss';\n\nimport React, { Suspense } from 'react';\nimport { Redirect, Route, Switch, useRouteMatch } from 'react-router-dom';\n\nimport {\n  useConfig,\n  useEmulatorConfig,\n  useIsEmulatorDisabled,\n} from '../common/EmulatorConfigProvider';\nimport { EmulatorDisabled } from '../common/EmulatorDisabled';\nimport { Spinner } from '../common/Spinner';\nimport Database from './Database';\nimport DatabaseContainer from './DatabaseContainer';\n\nexport const DatabaseRoute: React.FC = () => {\n  return (\n    <Suspense fallback={<DatabaseRouteSuspended />}>\n      <DatabaseRouteContent />\n    </Suspense>\n  );\n};\n\nexport default DatabaseRoute;\n\nexport const DatabaseRouteContent: React.FC = () => {\n  const config = useEmulatorConfig('database');\n  const primary = useConfig().projectId;\n  let { path, url } = useRouteMatch()!;\n\n  return (\n    <Switch>\n      <Route exact path={path}>\n        <Redirect to={`${url}/${primary}/data`} />;\n      </Route>\n      <Route\n        path={`${path}/:namespace/data/:path*`}\n        render={({ match }: any) => {\n          const current = match.params.namespace;\n          const dbPath = `/${match.params.path || ''}`;\n          return (\n            <DatabaseContainer\n              primary={primary}\n              current={current}\n              navigation={(db) => `${url}/${db}/data`}\n            >\n              <Database namespace={current} path={dbPath} config={config} />\n            </DatabaseContainer>\n          );\n        }}\n      />\n    </Switch>\n  );\n};\n\nconst DatabaseRouteSuspended: React.FC = () => {\n  const isDisabled = useIsEmulatorDisabled('database');\n  return isDisabled ? (\n    <EmulatorDisabled productName=\"Realtime Database\" />\n  ) : (\n    <Spinner span={12} message=\"Realtime Database Emulator Loading...\" />\n  );\n};\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DialogButton } from '@rmwc/dialog';\nimport React from 'react';\n\nimport { confirm } from '../../common/DialogQueue';\n\nexport const promptClearAll = () =>\n  confirm({\n    title: 'Delete all data?',\n    body: `Proceeding will delete all your collections, sub-collections and\n             documents within your database.`,\n    // hide standard buttons so as to use `danger` button\n    acceptLabel: null,\n    cancelLabel: null,\n    footer: (\n      <>\n        <DialogButton type=\"button\" theme=\"secondary\" action=\"close\">\n          Cancel\n        </DialogButton>\n        <DialogButton unelevated action=\"accept\" isDefaultAction danger>\n          Clear\n        </DialogButton>\n      </>\n    ),\n  });\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { IconButton, IconButtonProps } from '@rmwc/icon-button';\nimport { HTMLProps } from '@rmwc/types';\nimport React, { useCallback, useState } from 'react';\n\ninterface CopyButtonProps extends HTMLProps<IconButtonProps> {\n  textToCopy: string;\n  icon?: string;\n}\n\nexport function useClipboard() {\n  const [isTextCopied, setIsTextCopied] = useState(false);\n  return {\n    isTextCopied,\n    writeText: useCallback((text: string) => {\n      return navigator.clipboard\n        .writeText(text)\n        .then(() => setIsTextCopied(true))\n        .catch(() => setIsTextCopied((isTextCopied) => isTextCopied));\n    }, []),\n  };\n}\n\nexport function CopyButton({\n  textToCopy: text,\n  label,\n  theme,\n  icon = 'content_copy',\n}: CopyButtonProps) {\n  label = label || 'Copy';\n  theme = theme || 'textPrimaryOnBackground';\n  const { writeText } = useClipboard();\n  return (\n    <IconButton\n      theme={theme}\n      icon={icon}\n      label={label}\n      onClick={() => writeText(text)}\n    />\n  );\n}\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createAction } from 'typesafe-actions';\n\nimport { CollectionFilter } from './models';\n\nexport const addCollectionFilter = createAction(\n  '@firestore/addCollectionFilter'\n)<\n  {\n    path: string;\n  } & CollectionFilter\n>();\nexport const removeCollectionFilter = createAction(\n  '@firestore/removeCollectionFilter'\n)<{\n  path: string;\n}>();\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport produce from 'immer';\nimport * as React from 'react';\nimport { Action, createReducer } from 'typesafe-actions';\n\nimport * as actions from './actions';\nimport { CollectionFilter } from './models';\n\nexport interface CollectionFilters {\n  [path: string]: CollectionFilter;\n}\n\nexport interface Store {\n  collectionFilters: CollectionFilters;\n}\n\nconst INIT_STATE: Store = { collectionFilters: {} };\n\nconst firestoreStoreContext = React.createContext<{\n  store: Store;\n  dispatch: React.Dispatch<any>;\n}>({ store: INIT_STATE, dispatch: () => {} });\n\nconst reducer = createReducer<Store, Action>(INIT_STATE)\n  .handleAction(\n    actions.addCollectionFilter,\n    produce((draft, { payload }) => {\n      const { path, ...filter } = payload;\n      draft.collectionFilters[payload.path] = filter;\n    })\n  )\n  .handleAction(\n    actions.removeCollectionFilter,\n    produce((draft, { payload }) => {\n      delete draft.collectionFilters[payload.path];\n    })\n  );\n\nconst storeReducer: React.Reducer<Store, Action> = (state, action) => {\n  return (reducer.handlers as any)[action.type](state, action);\n};\n\nexport const FirestoreStore: React.FC<{ initState?: Store }> = ({\n  initState = INIT_STATE,\n  children,\n}) => {\n  const [store, dispatch] = React.useReducer(storeReducer, initState);\n  return (\n    <firestoreStoreContext.Provider value={{ store, dispatch }}>\n      {children}\n    </firestoreStoreContext.Provider>\n  );\n};\n\nexport function useFirestoreStore(): {\n  store: Store;\n  dispatch: React.Dispatch<Action>;\n} {\n  const context = React.useContext(firestoreStoreContext);\n  if (context === undefined) {\n    throw new Error('useFirestoreStore must be used within a <FirestoreStore>');\n  }\n  return context;\n}\n\nexport function useStore(): Store {\n  const { store } = useFirestoreStore();\n  return React.useMemo(() => store, [store]);\n}\n\nexport function useDispatch(): React.Dispatch<Action> {\n  const { dispatch } = useFirestoreStore();\n  return React.useMemo(() => dispatch, [dispatch]);\n}\n\nexport function useCollectionFilter(\n  path: string\n): CollectionFilter | undefined {\n  const { store } = useFirestoreStore();\n  return store.collectionFilters[path];\n}\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useEffect, useState } from 'react';\nimport { Controller, useFormContext } from 'react-hook-form';\n\nimport { Field, SelectField } from '../../../components/common/Field';\nimport { NUMBER_REGEX, isBoolean, isNumber } from '../utils';\nimport styles from './CollectionFilter.module.scss';\n\nfunction getConditionEntryType(value: any) {\n  if (isBoolean(value)) {\n    return 'boolean';\n  }\n  if (isNumber(value)) {\n    return 'number';\n  }\n  return 'string';\n}\n\ninterface ConditionEntryProps {\n  name: string;\n  // Error may be undefined; require consumers to still pass or we might end up\n  // in a state where we validate without showing the error message.\n  error: string | undefined;\n}\n\nexport const ConditionEntry: React.FC<ConditionEntryProps> = React.memo(\n  ({ name, error }) => {\n    const { setValue, watch } = useFormContext();\n    const value = watch(name);\n    const [fieldType, setFieldType] = useState(getConditionEntryType(value));\n\n    useEffect(() => {\n      // Essentially setting the defaultValue of this form-field,\n      // specifically when chaning types between Single <--> Multi\n      if (value === undefined) {\n        setValue(name, '');\n      }\n    }, [value, setValue, name]);\n\n    return (\n      <div className={styles.conditionEntry}>\n        <SelectField\n          options={['string', 'number', 'boolean']}\n          value={fieldType}\n          onChange={(evt) => {\n            setFieldType(evt.currentTarget.value);\n          }}\n          fieldClassName={styles.conditionEntryType}\n        />\n\n        {fieldType === 'string' && (\n          <Controller\n            as={Field}\n            name={name}\n            defaultValue=\"\"\n            error={error}\n            fieldClassName={styles.conditionEntryValue}\n            aria-label=\"Value\"\n          />\n        )}\n\n        {fieldType === 'number' && (\n          <Controller\n            as={Field}\n            name={name}\n            defaultValue={''}\n            rules={{\n              pattern: {\n                value: NUMBER_REGEX,\n                message: 'Must be a number',\n              },\n            }}\n            error={error}\n            onChange={([event]) =>\n              // Cast it back to a number before saving to model\n              event.target.value.match(NUMBER_REGEX)\n                ? parseFloat(event.target.value)\n                : event.target.value\n            }\n            fieldClassName={styles.conditionEntryValue}\n            aria-label=\"Value\"\n          />\n        )}\n\n        {fieldType === 'boolean' && <BooleanCondition name={name} />}\n      </div>\n    );\n  }\n);\n\n// RMWC select-menus do not work well with boolean values, requiring\n// custom-registration w/ the parent form\nconst BooleanCondition: React.FC<{ name: string }> = ({ name }) => {\n  const { register, setValue, unregister, watch } = useFormContext();\n\n  useEffect(() => {\n    register({ name });\n    setValue(name, true);\n\n    return () => unregister(name);\n  }, [register, unregister, setValue, name]);\n\n  const selectValue = watch(name);\n\n  return (\n    <SelectField\n      name={name}\n      options={['true', 'false']}\n      value={selectValue}\n      onChange={(evt) => setValue(name, evt.currentTarget.value === 'true')}\n      fieldClassName={styles.conditionEntryValue}\n      aria-label=\"Value\"\n    />\n  );\n};\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Button } from '@rmwc/button';\nimport { IconButton } from '@rmwc/icon-button';\nimport React, { useEffect } from 'react';\nimport { useFieldArray, useFormContext } from 'react-hook-form';\n\nimport styles from './CollectionFilter.module.scss';\nimport { ConditionEntry } from './ConditionEntry';\n\nexport const ConditionEntries: React.FC<{ name: string }> = ({ name }) => {\n  const {\n    errors,\n    formState: { touched },\n  } = useFormContext();\n\n  const { fields, append, remove } = useFieldArray({\n    name,\n  });\n\n  useEffect(() => {\n    if (fields.length < 1) {\n      append({ _: '' });\n    }\n  }, [append, fields]);\n\n  return (\n    <ul className={styles.conditionEntries}>\n      {fields.map((field, index) => {\n        const conditionName = `${name}[${index}]`;\n        return (\n          <li key={field.id}>\n            <ConditionEntry\n              name={conditionName}\n              error={touched[conditionName] && errors[conditionName]}\n            />\n            <IconButton\n              className={\n                fields.length > 1 ? styles.removeFilter : styles.hidden\n              }\n              icon=\"delete\"\n              label=\"Remove filter\"\n              type=\"button\"\n              onClick={() => remove(index)}\n            />\n          </li>\n        );\n      })}\n      <Button type=\"button\" icon=\"add\" onClick={() => append({ _: '' })}>\n        Add value\n      </Button>\n    </ul>\n  );\n};\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Radio } from '@rmwc/radio';\nimport React, { useEffect } from 'react';\nimport { useFormContext } from 'react-hook-form';\n\nexport const SortRadioGroup: React.FC<{ name: string; disabled: boolean }> = ({\n  name,\n  disabled,\n}) => {\n  const { register, setValue, unregister, watch } = useFormContext();\n\n  useEffect(() => {\n    if (!disabled) {\n      register({ name });\n    } else {\n      setValue(name, undefined);\n    }\n\n    return () => unregister(name);\n  }, [register, unregister, disabled, name, setValue]);\n\n  const sort = watch(name);\n\n  return (\n    <>\n      <Radio\n        value=\"asc\"\n        label=\"Ascending\"\n        checked={sort === 'asc'}\n        onChange={() => setValue(name, 'asc')}\n        disabled={disabled}\n      />\n\n      <Radio\n        value=\"desc\"\n        label=\"Descending\"\n        checked={sort === 'desc'}\n        onChange={() => setValue(name, 'desc')}\n        disabled={disabled}\n      />\n    </>\n  );\n};\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { CardActionButton, CardActionButtons, CardActions } from '@rmwc/card';\nimport { CollapsibleList, SimpleListItem } from '@rmwc/list';\nimport { Theme, ThemeProvider } from '@rmwc/theme';\nimport { Typography } from '@rmwc/typography';\nimport firebase from 'firebase';\nimport React, { useState } from 'react';\nimport { Controller, FormContext, useForm } from 'react-hook-form';\n\nimport { grey100 } from '../../../colors';\nimport { Field, SelectField } from '../../../components/common/Field';\nimport * as actions from '../actions';\nimport {\n  CollectionFilter as CollectionFilterType,\n  isMultiValueCollectionFilter,\n  isSingleValueCollectionFilter,\n  isSortableCollectionFilter,\n} from '../models';\nimport { useCollectionFilter, useDispatch } from '../store';\nimport styles from './CollectionFilter.module.scss';\nimport { ConditionEntries } from './ConditionEntries';\nimport { ConditionEntry } from './ConditionEntry';\nimport { SortRadioGroup } from './SortRadioGroup';\n\nexport const CollectionFilter: React.FC<{\n  className?: string;\n  path: string;\n  onClose?: () => void;\n}> = ({ className, path, onClose }) => {\n  const collectionFilter = useCollectionFilter(path);\n  const dispatch = useDispatch();\n\n  const formMethods = useForm<CollectionFilterType>({\n    mode: 'onChange',\n    defaultValues: collectionFilter,\n  });\n\n  const cf = formMethods.watch({ nest: true });\n\n  const onSubmit = (data: CollectionFilterType) => {\n    dispatch(\n      actions.addCollectionFilter({\n        path,\n        ...data,\n      })\n    );\n    onClose?.();\n  };\n\n  return (\n    <CollectionFilterTheme>\n      <FormContext {...(formMethods as any)}>\n        <form\n          onSubmit={formMethods.handleSubmit(onSubmit)}\n          className={className}\n        >\n          {/* Field entry */}\n          <FilterItem title=\"Filter by field\" preview={cf.field} defaultOpen>\n            <Controller\n              as={Field}\n              name=\"field\"\n              label=\"Enter field\"\n              rules={{ required: 'Required' }}\n              defaultValue=\"\"\n              error={\n                (formMethods.formState.touched as any)['field'] &&\n                (formMethods.errors as any)['field']?.message\n              }\n            />\n          </FilterItem>\n\n          {/* Condition entry */}\n          <FilterItem\n            title=\"Add condition\"\n            preview={<ConditionPreview cf={cf} />}\n            defaultOpen\n          >\n            <ConditionSelect>\n              {cf && isSingleValueCollectionFilter(cf) && (\n                <ConditionEntry\n                  name=\"value\"\n                  error={\n                    (formMethods.formState.touched as any)['value'] &&\n                    (formMethods.errors as any)['value']?.message\n                  }\n                />\n              )}\n\n              {cf && isMultiValueCollectionFilter(cf) && (\n                <ConditionEntries name=\"values\" />\n              )}\n            </ConditionSelect>\n          </FilterItem>\n\n          {/* Sort entry */}\n          <FilterItem\n            title=\"Sort results\"\n            preview={isSortableCollectionFilter(cf) && cf.sort}\n            defaultOpen\n          >\n            <SortRadioGroup\n              name=\"sort\"\n              disabled={!isSortableCollectionFilter(cf)}\n            />\n          </FilterItem>\n\n          <Preview path={path} cf={cf} />\n\n          <CardActions className={styles.actions}>\n            <CardActionButtons>\n              <CardActionButton\n                type=\"button\"\n                onClick={() => {\n                  dispatch(\n                    actions.removeCollectionFilter({\n                      path,\n                    })\n                  );\n                  onClose?.();\n                }}\n              >\n                Clear\n              </CardActionButton>\n            </CardActionButtons>\n            <CardActionButtons>\n              <CardActionButton type=\"button\" onClick={() => onClose?.()}>\n                Cancel\n              </CardActionButton>\n              <CardActionButton\n                unelevated\n                type=\"submit\"\n                disabled={!formMethods.formState.isValid}\n              >\n                Apply\n              </CardActionButton>\n            </CardActionButtons>\n          </CardActions>\n        </form>\n      </FormContext>\n    </CollectionFilterTheme>\n  );\n};\n\nconst CollectionFilterTheme: React.FC = ({ children }) => (\n  <ThemeProvider options={{ background: grey100, surface: '#fff' }}>\n    <Theme use={['background']} tag=\"div\">\n      {children}\n    </Theme>\n  </ThemeProvider>\n);\n\nconst ConditionPreview: React.FC<{ cf: CollectionFilterType }> = ({ cf }) => {\n  const operator = `\"${cf.operator}\"`;\n  if (isSingleValueCollectionFilter(cf)) {\n    return <span>{`${operator}, \"${cf.value}\"`}</span>;\n  }\n  if (isMultiValueCollectionFilter(cf)) {\n    return <span>{`${operator}, ${JSON.stringify(cf.values)}`}</span>;\n  }\n  return null;\n};\n\nconst Preview: React.FC<{ path: string; cf: CollectionFilterType }> = ({\n  path,\n  cf,\n}) => {\n  const collectionId = path.split('/').pop();\n  return (\n    <code className={styles.preview} aria-label=\"Code preview\">\n      <div>.collection({`${JSON.stringify(collectionId)}`})</div>\n      {(isSingleValueCollectionFilter(cf) ||\n        isMultiValueCollectionFilter(cf)) && (\n        <div className={styles.previewFilter}>\n          .where(\"{cf.field}\", <ConditionPreview cf={cf} />)\n        </div>\n      )}\n      {isSortableCollectionFilter(cf) && !!cf.sort && (\n        <div className={styles.previewFilter}>\n          .orderBy({`\"${cf.field}\", \"${cf.sort}\"`})\n        </div>\n      )}\n    </code>\n  );\n};\n\nconst ConditionSelect: React.FC = ({ children }) => {\n  const options: Array<{\n    label: string;\n    value: firebase.firestore.WhereFilterOp;\n  }> = [\n    {\n      label: '(==) equal to',\n      value: '==',\n    },\n    {\n      label: '(!=) not equal to',\n      value: '!=',\n    },\n    {\n      label: '(>) greater than',\n      value: '>',\n    },\n    {\n      label: '(>=) greater than or equal to',\n      value: '>=',\n    },\n    {\n      label: '(<) less than',\n      value: '<',\n    },\n    {\n      label: '(<=) less than or equal to',\n      value: '<=',\n    },\n    {\n      label: '(in) equal to any of the following',\n      value: 'in',\n    },\n    {\n      label: '(not-in) not equal to any of the following',\n      value: 'not-in',\n    },\n    {\n      label: '(array-contains) an array containing',\n      value: 'array-contains',\n    },\n    {\n      label: '(array-contains-any) an array containing any',\n      value: 'array-contains-any',\n    },\n  ];\n\n  return (\n    <>\n      <Controller\n        as={SelectField}\n        name=\"operator\"\n        label=\"Only show documents where the specified field is...\"\n        placeholder=\"No condition\"\n        options={options}\n        onChange={([selected]) => selected.currentTarget.value || undefined}\n      />\n      {children}\n    </>\n  );\n};\n\n// Accordian-view for expanding/collapsing panels in the query-view\nconst FilterItem: React.FC<{\n  title: string;\n  preview?: React.ReactNode;\n  defaultOpen: boolean;\n}> = ({ title, preview, defaultOpen, children }) => {\n  const [expanded, setExpanded] = useState(defaultOpen);\n\n  return (\n    <CollapsibleList\n      className={styles.listItem}\n      defaultOpen={expanded}\n      handle={\n        <SimpleListItem\n          text={\n            <div className={styles.headerTitle}>\n              <Typography use=\"body1\">{title}</Typography>\n              {!expanded && preview && (\n                <Typography use=\"caption\">{preview}</Typography>\n              )}\n            </div>\n          }\n          metaIcon=\"chevron_right\"\n          className={styles.header}\n        />\n      }\n      onOpen={() => setExpanded(true)}\n      onClose={() => setExpanded(false)}\n    >\n      <div className={styles.children}>{children}</div>\n    </CollapsibleList>\n  );\n};\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Dialog,\n  DialogActions,\n  DialogButton,\n  DialogContent,\n  DialogOnCloseEventT,\n  DialogProps,\n  DialogTitle,\n} from '@rmwc/dialog';\nimport firebase from 'firebase';\nimport React, { useCallback, useEffect, useState } from 'react';\n\nimport { Field } from '../../common/Field';\nimport DocumentEditor from '../DocumentEditor';\nimport { FirestoreMap } from '../models';\n\nexport interface AddDocumentDialogValue {\n  id: string;\n  data: any;\n}\n\nexport interface AddDocumentStepProps {\n  collectionRef: firebase.firestore.CollectionReference;\n  onChange: (value: AddDocumentDialogValue) => void;\n}\n\nexport const AddDocumentStep: React.FC<AddDocumentStepProps> = ({\n  collectionRef,\n  onChange,\n}) => {\n  const [id, setId] = useState(collectionRef.doc().id);\n  const [data, setData] = useState<FirestoreMap | undefined>();\n\n  // TODO: Validation\n  const getValue = useCallback(() => {\n    try {\n      return { id, data };\n    } catch (e) {\n      return { id, data: { invalidData: true } };\n    }\n  }, [id, data]);\n\n  // emit initial value immediately (to capture auto generated doc id)\n  useEffect(() => {\n    onChange(getValue());\n  }, [getValue, onChange]);\n\n  const updateId = (evt: React.ChangeEvent<HTMLInputElement>) => {\n    setId(evt.target.value);\n    onChange(getValue());\n  };\n\n  return (\n    <>\n      <Field\n        id=\"add-document-path\"\n        fullwidth\n        disabled\n        label=\"Parent path\"\n        value={collectionRef.path}\n      />\n      <Field\n        id=\"add-document-id\"\n        fullwidth\n        label=\"Document ID\"\n        value={id}\n        onChange={updateId}\n        required\n      />\n      <DocumentEditor value={{ '': '' }} onChange={(data) => setData(data)} />\n    </>\n  );\n};\n\ninterface Props extends DialogProps {\n  collectionRef: firebase.firestore.CollectionReference;\n  onValue: (v: AddDocumentDialogValue | null) => void;\n}\n\nexport const AddDocumentDialog: React.FC<Props> = ({\n  collectionRef,\n  onClose,\n  onValue,\n  ...dialogProps\n}) => {\n  const [document, setDocument] = useState<AddDocumentDialogValue>({\n    id: '',\n    data: undefined,\n  });\n\n  const emitValueAndClose = (evt: DialogOnCloseEventT) => {\n    onValue(evt.detail.action === 'accept' ? document : null);\n    onClose && onClose(evt);\n  };\n\n  return (\n    <Dialog {...dialogProps} onClose={emitValueAndClose}>\n      <DialogTitle>Add a document</DialogTitle>\n\n      <DialogContent>\n        <AddDocumentStep collectionRef={collectionRef} onChange={setDocument} />\n      </DialogContent>\n\n      <DialogActions>\n        <DialogButton action=\"close\" type=\"button\" theme=\"secondary\">\n          Cancel\n        </DialogButton>\n        <DialogButton\n          unelevated\n          action=\"accept\"\n          isDefaultAction\n          disabled={!document.data}\n        >\n          Save\n        </DialogButton>\n      </DialogActions>\n    </Dialog>\n  );\n};\n","/**\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  ListItem,\n  ListItemPrimaryText,\n  ListItemSecondaryText,\n  ListItemText,\n} from '@rmwc/list';\nimport { Theme } from '@rmwc/theme';\nimport classNames from 'classnames';\nimport React from 'react';\nimport { NavLink } from 'react-router-dom';\n\nimport styles from './DocumentListItem.module.scss';\nimport { FirestoreAny } from './models';\nimport { summarize } from './utils';\n\nconst DocumentListItem: React.FC<{\n  docId: string;\n  url: string;\n  queryFieldValue: FirestoreAny | undefined;\n  missing?: boolean;\n}> = ({ docId, url, queryFieldValue, missing }) => {\n  const maxSummaryLen = 20;\n\n  const listItemClass = classNames('Firestore-List-Item', {\n    [styles.missing]: missing,\n  });\n\n  return (\n    <Theme\n      use={[missing ? 'textSecondaryOnBackground' : 'textPrimaryOnBackground']}\n    >\n      <ListItem\n        className={listItemClass}\n        tag={NavLink}\n        to={`${url}/${encodeURIComponent(docId)}`}\n        activeClassName=\"mdc-list-item--activated\"\n        data-testid=\"firestore-document-list-item\"\n      >\n        {queryFieldValue === undefined ? (\n          <ListItemText>{docId}</ListItemText>\n        ) : (\n          <ListItemText data-testid=\"twoLine\">\n            <ListItemPrimaryText>\n              {summarize(queryFieldValue, maxSummaryLen)}\n            </ListItemPrimaryText>\n            <ListItemSecondaryText>{docId}</ListItemSecondaryText>\n          </ListItemText>\n        )}\n      </ListItem>\n    </Theme>\n  );\n};\n\nexport default DocumentListItem;\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport useSwr from 'swr';\n\ninterface RequestOptions {\n  refreshInterval?: number;\n}\n\nexport function useFetcher(\n  options: RequestInit,\n  onSuccess = (r: Response) => r.json()\n) {\n  return async (url: string) => {\n    return await fetch(url, {\n      ...options,\n      headers: {\n        ...options.headers,\n        Authorization: 'Bearer owner',\n      },\n    }).then(onSuccess);\n  };\n}\n\nexport function useRequest<T = unknown>(\n  url: string,\n  options: RequestInit,\n  { refreshInterval = 0 }: RequestOptions\n) {\n  const fetcher = useFetcher(options);\n\n  return useSwr<T>(url, fetcher, {\n    refreshInterval,\n    suspense: true,\n\n    // Emulator UI works fully offline. Even if the browser cannot reach LAN or\n    // any router, this page and the CONFIG_API will still work if they are on\n    // the same physical device (e.g. localhost/127.0.0.1/containers/VMs). See:\n    // https://developer.mozilla.org/en-US/docs/Web/API/NavigatorOnLine/onLine\n    refreshWhenOffline: true,\n  });\n}\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport firebase from 'firebase';\nimport React, { useCallback, useEffect } from 'react';\nimport { FirebaseAppProvider, useFirestore } from 'reactfire';\nimport { mutate } from 'swr';\n\nimport { useEmulatedFirebaseApp } from '../../firebase';\nimport { useConfig, useEmulatorConfig } from '../common/EmulatorConfigProvider';\nimport { useFetcher, useRequest } from '../common/useRequest';\nimport { MissingDocument } from './models';\n\ninterface WindowWithFirestore extends Window {\n  firestore?: firebase.firestore.Firestore;\n}\n\nconst FIRESTORE_OPTIONS = {};\n\n/**\n * Provide a local-FirebaseApp with a FirestoreSDK connected to\n * the Emulator Hub.\n */\nexport const FirestoreEmulatedApiProvider: React.FC<{\n  disableDevTools?: boolean;\n}> = React.memo(({ children, disableDevTools }) => {\n  const config = useEmulatorConfig('firestore');\n  const app = useEmulatedFirebaseApp(\n    'firestore',\n    FIRESTORE_OPTIONS,\n    useCallback(\n      (app) => {\n        app.firestore().useEmulator(config.host, config.port);\n      },\n      [config]\n    )\n  );\n  if (!app) {\n    return null;\n  }\n\n  return (\n    <FirebaseAppProvider firebaseApp={app}>\n      {children}\n      {disableDevTools || <FirestoreDevTools />}\n    </FirebaseAppProvider>\n  );\n});\n\nconst FirestoreDevTools: React.FC = React.memo(() => {\n  const firestore = useFirestore();\n\n  useEffect(() => {\n    const windowWithFirestore = window as WindowWithFirestore;\n    windowWithFirestore.firestore = firestore;\n    console.log(`🔥 Firestore is available at window.firestore.\n\n    Try:\n    firestore.doc('hello/world').set({hello: 'world!'});\n    firestore.doc('hello/world').get().then( snap => console.log(snap.data()) );`);\n\n    return () => {\n      delete windowWithFirestore.firestore;\n    };\n  }, [firestore]);\n\n  return null;\n});\n\nfunction useFirestoreRestApi() {\n  const config = useEmulatorConfig('firestore');\n  const { projectId } = useConfig();\n  const databaseId = '(default)';\n\n  return {\n    baseUrl: `http://${config.hostAndPort}/v1/projects/${projectId}/databases/${databaseId}`,\n    baseEmulatorUrl: `http://${config.hostAndPort}/emulator/v1/projects/${projectId}/databases/${databaseId}`,\n  };\n}\n\nexport function useRootCollections() {\n  const { baseUrl } = useFirestoreRestApi();\n  const firestore = useFirestore();\n  const url = `${baseUrl}/documents:listCollectionIds`;\n\n  const { data } = useRequest<{ collectionIds: string[] }>(\n    url,\n    {\n      method: 'POST',\n    },\n    {\n      refreshInterval: 10_000,\n    }\n  );\n\n  const collectionIds = data?.collectionIds || [];\n  return collectionIds.map((id) => firestore.collection(id));\n}\n\nexport function useSubCollections(\n  docRef: firebase.firestore.DocumentReference\n) {\n  const { baseUrl } = useFirestoreRestApi();\n  const encodedPath = encodePath(docRef.path);\n  const url = `${baseUrl}/documents/${encodedPath}:listCollectionIds`;\n\n  const { data } = useRequest<{ collectionIds: string[] }>(\n    url,\n    {\n      method: 'POST',\n    },\n    {\n      refreshInterval: 10_000,\n    }\n  );\n\n  const collectionIds = data?.collectionIds || [];\n  return collectionIds.map((id) => docRef.collection(id));\n}\n\nconst DOCUMENT_PATH_RE = /projects\\/(?<project>.*)\\/databases\\/(?<database>.*)\\/documents\\/(?<path>.*)/;\n\nexport function useMissingDocuments(\n  collection: firebase.firestore.CollectionReference\n): MissingDocument[] {\n  const { baseUrl } = useFirestoreRestApi();\n  const encodedPath = encodePath(collection.path);\n  const url = `${baseUrl}/documents/${encodedPath}?mask.fieldPaths=_none_&pageSize=300&showMissing=true`;\n\n  const { data } = useRequest<{\n    documents: { name: string; createTime?: string }[];\n  }>(\n    url,\n    {\n      method: 'GET',\n    },\n    {\n      refreshInterval: 10_000,\n    }\n  );\n\n  return (\n    data?.documents\n      ?.filter((d) => !d.createTime)\n      .map((d) => {\n        const match = DOCUMENT_PATH_RE.exec(d.name);\n        if (!match) {\n          throw new Error(\n            `Document path \"${d.name}\" returned by API does not match regex.`\n          );\n        }\n        const [, , , path] = match;\n        return { path };\n      }) || []\n  );\n}\n\nexport function useEjector() {\n  const { baseEmulatorUrl } = useFirestoreRestApi();\n  const url = `${baseEmulatorUrl}/documents`;\n\n  const fetcher = useFetcher({\n    method: 'DELETE',\n  });\n\n  return async () => {\n    mutate('*');\n    return await fetcher(url);\n  };\n}\n\nexport function useRecursiveDelete() {\n  const { baseEmulatorUrl } = useFirestoreRestApi();\n  const fetcher = useFetcher({\n    method: 'DELETE',\n  });\n\n  return async (\n    ref:\n      | firebase.firestore.CollectionReference\n      | firebase.firestore.DocumentReference\n  ) => {\n    mutate('*');\n    const encodedPath = encodePath(ref.path);\n    const url = `${baseEmulatorUrl}/documents/${encodedPath}`;\n    return await fetcher(url);\n  };\n}\n\nfunction encodePath(path: string): string {\n  return path\n    .split('/')\n    .map((uri) => encodeURIComponent(uri))\n    .join('/');\n}\n","/**\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './PanelHeader.scss';\n\nimport { Theme } from '@rmwc/theme';\nimport { Typography } from '@rmwc/typography';\nimport React from 'react';\n\nimport { CardActionBar, CardActionBarActions } from '../common/CardActionBar';\n\nexport const PanelHeader: React.FC<{ id: string; icon: React.ReactNode }> = ({\n  id,\n  icon,\n  children,\n}) => {\n  return (\n    <div className=\"Firestore-PanelHeader\">\n      <CardActionBar>\n        <Theme use=\"secondary\">{icon}</Theme>\n        <Typography use=\"body2\" className=\"Firestore-PanelHeader-title\">\n          {id}\n        </Typography>\n        <CardActionBarActions>{children}</CardActionBarActions>\n      </CardActionBar>\n    </div>\n  );\n};\n\nexport default PanelHeader;\n","/**\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ReactNode, useEffect, useState } from 'react';\nimport React from 'react';\nimport { Redirect, useLocation, useRouteMatch } from 'react-router-dom';\n\nexport const FIRESTORE_DATA_URL = '/firestore/data';\nconst FIRESTORE_DATA_URL_PATH_LENGTH = FIRESTORE_DATA_URL.split('/').length;\n\n/**\n * Given a list of collections or documents, auto select the first item. Only\n * works on root (`/firestore/data`) or top level collections (`/firestore/data/users`)\n * to prevent deep auto selection.\n */\nexport function useAutoSelect<T extends { id: string }>(list?: T[] | null) {\n  const { url } = useRouteMatch()!;\n  const { pathname } = useLocation();\n  const [autoSelect, setAutoSelect] = useState<ReactNode | null>(null);\n\n  useEffect(() => {\n    const isRootOrRootCollection =\n      url === FIRESTORE_DATA_URL ||\n      // /firestore/data/users\n      (url.startsWith(FIRESTORE_DATA_URL) &&\n        url.split('/').length === FIRESTORE_DATA_URL_PATH_LENGTH + 1);\n    const hasNothingSelected = url === pathname;\n    const firstChild = list?.[0];\n    const shouldAutoSelect = isRootOrRootCollection && hasNothingSelected;\n\n    setAutoSelect(\n      shouldAutoSelect && firstChild ? (\n        <Redirect to={`${url}/${encodeURIComponent(firstChild.id)}`} />\n      ) : null\n    );\n  }, [pathname, url, list, setAutoSelect]);\n\n  return autoSelect;\n}\n","/**\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './index.scss';\n\nimport { Button } from '@rmwc/button';\nimport { Icon } from '@rmwc/icon';\nimport { IconButton } from '@rmwc/icon-button';\nimport { List, ListItem } from '@rmwc/list';\nimport { Menu, MenuItem, MenuSurface, MenuSurfaceAnchor } from '@rmwc/menu';\nimport classNames from 'classnames';\nimport firebase from 'firebase';\nimport get from 'lodash.get';\nimport React, { useEffect, useState } from 'react';\nimport { Route, useHistory, useRouteMatch } from 'react-router-dom';\nimport { useFirestoreCollection } from 'reactfire';\n\nimport { CopyButton } from '../common/CopyButton';\nimport { Spinner } from '../common/Spinner';\nimport styles from './Collection.module.scss';\nimport { CollectionFilter } from './CollectionFilter';\nimport {\n  AddDocumentDialog,\n  AddDocumentDialogValue,\n} from './dialogs/AddDocumentDialog';\nimport { promptDeleteCollection } from './dialogs/deleteCollection';\nimport { Document } from './Document';\nimport DocumentListItem from './DocumentListItem';\nimport {\n  useMissingDocuments,\n  useRecursiveDelete,\n} from './FirestoreEmulatedApiProvider';\nimport {\n  CollectionFilter as CollectionFilterType,\n  MissingDocument,\n  isMultiValueCollectionFilter,\n  isSingleValueCollectionFilter,\n  isSortableCollectionFilter,\n} from './models';\nimport PanelHeader from './PanelHeader';\nimport { useCollectionFilter } from './store';\nimport { useAutoSelect } from './useAutoSelect';\n\nconst NO_DOCS: firebase.firestore.QueryDocumentSnapshot<firebase.firestore.DocumentData>[] = [];\n\nexport interface Props {\n  collection: firebase.firestore.CollectionReference;\n}\n\nexport function withCollectionState(\n  Presentation: React.ComponentType<CollectionPresentationProps>\n): React.ComponentType<Props> {\n  return ({ collection }) => {\n    const [newDocumentId, setNewDocumentId] = useState<string>();\n    const collectionFilter = useCollectionFilter(collection.path);\n    const filteredCollection = applyCollectionFilter(\n      collection,\n      collectionFilter\n    );\n    const collectionSnapshot = useFirestoreCollection<unknown>(\n      filteredCollection,\n      {\n        suspense: true,\n      }\n    );\n    const history = useHistory();\n\n    const { url } = useRouteMatch()!;\n\n    const missingDocs = useMissingDocuments(collection);\n\n    const docs = collectionSnapshot.data.docs.length\n      ? collectionSnapshot.data.docs\n      : NO_DOCS;\n    const redirectIfAutoSelectable = useAutoSelect(docs);\n\n    const addDocument = async (value: AddDocumentDialogValue | null) => {\n      if (value && value.id) {\n        await collection.doc(value.id).set(value.data);\n        setNewDocumentId(value.id);\n      }\n    };\n\n    useEffect(() => {\n      if (newDocumentId) {\n        history.push(`${url}/${encodeURIComponent(newDocumentId)}`);\n        setNewDocumentId('');\n      }\n    }, [history, url, newDocumentId, setNewDocumentId]);\n\n    if (newDocumentId) {\n      return null;\n    }\n\n    if (redirectIfAutoSelectable) {\n      return <>{redirectIfAutoSelectable}</>;\n    }\n\n    return (\n      <Presentation\n        collection={collection}\n        collectionFilter={collectionFilter}\n        addDocument={addDocument}\n        docs={docs}\n        missingDocs={missingDocs}\n        url={url}\n      />\n    );\n  };\n}\n\n// TODO: create a CollectionSkeleton that the loading+loaded state can utilize\nexport const CollectionLoading: React.FC<{\n  collection: firebase.firestore.CollectionReference<firebase.firestore.DocumentData>;\n}> = ({ collection }) => (\n  <div className=\"Firestore-Collection\">\n    <PanelHeader\n      id={collection.id}\n      icon={<Icon icon={{ icon: 'collections_bookmark', size: 'small' }} />}\n    />\n    <Spinner message=\"Loading collection\" />\n  </div>\n);\n\ninterface CollectionPresentationProps {\n  collection: firebase.firestore.CollectionReference<firebase.firestore.DocumentData>;\n  collectionFilter: ReturnType<typeof useCollectionFilter>;\n  addDocument: (value: AddDocumentDialogValue | null) => Promise<void>;\n  docs: firebase.firestore.QueryDocumentSnapshot<firebase.firestore.DocumentData>[];\n  missingDocs: MissingDocument[];\n  url: string;\n}\n\nexport const CollectionPresentation: React.FC<CollectionPresentationProps> = ({\n  collection,\n  collectionFilter,\n  addDocument,\n  docs,\n  missingDocs,\n  url,\n}) => {\n  const recursiveDelete = useRecursiveDelete();\n  const [isMenuOpen, setIsMenuOpen] = useState(false);\n  const [isFilterOpen, setIsFilterOpen] = useState(false);\n  const [isAddDocumentDialogOpen, setAddDocumentDialogOpen] = useState(false);\n\n  const handleDeleteCollection = async () => {\n    const shouldDelete = await promptDeleteCollection(collection);\n    shouldDelete && recursiveDelete(collection);\n  };\n\n  return (\n    <>\n      <div className=\"Firestore-Collection\">\n        <PanelHeader\n          id={collection.id}\n          icon={<Icon icon={{ icon: 'collections_bookmark', size: 'small' }} />}\n        >\n          <MenuSurfaceAnchor>\n            <MenuSurface\n              open={isFilterOpen}\n              onClose={() => setIsFilterOpen(false)}\n            >\n              {isFilterOpen && (\n                <CollectionFilter\n                  className={styles['query-panel']}\n                  path={collection.path}\n                  onClose={() => setIsFilterOpen(false)}\n                />\n              )}\n            </MenuSurface>\n            <Menu\n              open={isMenuOpen}\n              onClose={() => setIsMenuOpen(false)}\n              renderToPortal\n            >\n              <MenuItem onClick={handleDeleteCollection}>\n                Delete collection\n              </MenuItem>\n            </Menu>\n\n            <CopyButton textToCopy={collection.id} label=\"Copy collection ID\" />\n            <div\n              className={classNames(\n                styles['button-wrapper'],\n                collectionFilter && styles.badge\n              )}\n            >\n              <IconButton\n                icon=\"filter_list\"\n                label=\"Filter documents in this collection\"\n                onClick={() => setIsFilterOpen(!isFilterOpen)}\n              />\n            </div>\n            <IconButton\n              icon=\"more_vert\"\n              label=\"Menu\"\n              onClick={() => setIsMenuOpen(!isMenuOpen)}\n            />\n          </MenuSurfaceAnchor>\n        </PanelHeader>\n\n        {isAddDocumentDialogOpen && (\n          <AddDocumentDialog\n            collectionRef={collection}\n            open={isAddDocumentDialogOpen}\n            onValue={addDocument}\n            onClose={() => setAddDocumentDialogOpen(false)}\n          />\n        )}\n        <List dense className=\"List-Actions\" tag=\"div\">\n          <ListItem\n            className=\"list-button\"\n            tag={Button}\n            label=\"Add document\"\n            {...{ dense: true, icon: 'add' }} // types get confused\n            onClick={() => setAddDocumentDialogOpen(true)}\n          ></ListItem>\n        </List>\n\n        <List\n          dense\n          className=\"Firestore-Document-List\"\n          tag=\"div\"\n          twoLine={\n            collectionFilter && isSortableCollectionFilter(collectionFilter)\n          }\n        >\n          {docs.map((doc) => (\n            <DocumentListItem\n              key={doc.ref.id}\n              url={url}\n              docId={doc.ref.id}\n              queryFieldValue={\n                collectionFilter && isSortableCollectionFilter(collectionFilter)\n                  ? get(doc.data(), collectionFilter.field)\n                  : undefined\n              }\n            />\n          ))}\n\n          {missingDocs.map((doc: { path: string }) => {\n            const id = doc.path.replace(collection.path, '').split('/')[1];\n\n            return (\n              <DocumentListItem\n                missing\n                key={id}\n                url={url}\n                docId={id}\n                queryFieldValue={undefined}\n              />\n            );\n          })}\n        </List>\n      </div>\n      <Route\n        path={`${url}/:id`}\n        render={({ match }: any) => {\n          const docId = decodeURIComponent(match.params.id);\n          const docRef = collection.doc(docId);\n          return <Document reference={docRef} />;\n        }}\n      ></Route>\n    </>\n  );\n};\n\nfunction applyCollectionFilter(\n  collection: firebase.firestore.Query<firebase.firestore.DocumentData>,\n  collectionFilter?: CollectionFilterType\n): firebase.firestore.Query<firebase.firestore.DocumentData> {\n  let filteredCollection = collection;\n  if (collectionFilter && isSingleValueCollectionFilter(collectionFilter)) {\n    filteredCollection = filteredCollection.where(\n      collectionFilter.field,\n      collectionFilter.operator,\n      collectionFilter.value\n    );\n  }\n  if (collectionFilter && isMultiValueCollectionFilter(collectionFilter)) {\n    filteredCollection = filteredCollection.where(\n      collectionFilter.field,\n      collectionFilter.operator,\n      collectionFilter.values\n    );\n  }\n  if (collectionFilter && isSortableCollectionFilter(collectionFilter)) {\n    filteredCollection = filteredCollection.orderBy(\n      collectionFilter.field,\n      collectionFilter.sort\n    );\n  }\n  return filteredCollection;\n}\n\nexport const Collection = withCollectionState(CollectionPresentation);\n\nexport default Collection;\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Dialog,\n  DialogActions,\n  DialogButton,\n  DialogContent,\n  DialogOnCloseEventT,\n  DialogProps,\n  DialogTitle,\n} from '@rmwc/dialog';\nimport firebase from 'firebase';\nimport React, { useState } from 'react';\nimport { useFirestore } from 'reactfire';\n\nimport { Field } from '../../common/Field';\nimport { AddDocumentDialogValue, AddDocumentStep } from './AddDocumentDialog';\n\ninterface AddCollectionStepProps {\n  documentRef?: firebase.firestore.DocumentReference;\n  onChange: (value: string) => void;\n}\n\nexport const AddCollectionStep = ({\n  documentRef,\n  onChange,\n}: AddCollectionStepProps) => {\n  const [id, setId] = useState('');\n  const updateId = (evt: React.ChangeEvent<HTMLInputElement>) => {\n    setId(evt.target.value);\n    onChange(evt.target.value);\n  };\n\n  return (\n    <>\n      <Field\n        label=\"Parent path\"\n        value={documentRef ? documentRef.path : '/'}\n        disabled\n      />\n\n      <Field label=\"Collection ID\" required value={id} onChange={updateId} />\n    </>\n  );\n};\n\nexport interface AddCollectionDialogValue {\n  collectionId: string;\n  document: AddDocumentDialogValue;\n}\n\ninterface Props extends DialogProps {\n  documentRef?: firebase.firestore.DocumentReference;\n  onValue: (v: AddCollectionDialogValue | null) => void;\n}\n\nenum Step {\n  COLLECTION,\n  DOCUMENT,\n}\n\nexport const AddCollectionDialog: React.FC<Props> = ({\n  documentRef,\n  onValue,\n  onClose,\n  ...dialogProps\n}) => {\n  const firestore = useFirestore();\n  const [step, setStep] = useState(Step.COLLECTION);\n  const [collectionId, setCollectionId] = useState('');\n  const [document, setDocument] = useState<AddDocumentDialogValue>({\n    id: '',\n    data: undefined,\n  });\n\n  const next = () =>\n    step === Step.COLLECTION && collectionId && setStep(step + 1);\n\n  const getValue = () => ({\n    collectionId,\n    document,\n  });\n\n  const emitValueAndClose = (evt: DialogOnCloseEventT) => {\n    onValue(evt.detail.action === 'accept' ? getValue() : null);\n    onClose && onClose(evt);\n  };\n\n  return (\n    <Dialog {...dialogProps} onClose={emitValueAndClose}>\n      <DialogTitle>Start a collection</DialogTitle>\n\n      <DialogContent>\n        {step === Step.COLLECTION ? (\n          <AddCollectionStep\n            documentRef={documentRef}\n            onChange={setCollectionId}\n          />\n        ) : (\n          <AddDocumentStep\n            collectionRef={\n              documentRef\n                ? documentRef.collection(collectionId)\n                : firestore.collection(collectionId)\n            }\n            onChange={setDocument}\n          />\n        )}\n      </DialogContent>\n\n      <DialogActions>\n        <DialogButton action=\"close\" type=\"button\" theme=\"secondary\">\n          Cancel\n        </DialogButton>\n        {step === Step.DOCUMENT ? (\n          <DialogButton\n            unelevated\n            action=\"accept\"\n            isDefaultAction\n            disabled={!document.data}\n          >\n            Save\n          </DialogButton>\n        ) : (\n          <DialogButton unelevated onClick={next}>\n            Next\n          </DialogButton>\n        )}\n      </DialogActions>\n    </Dialog>\n  );\n};\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DialogButton } from '@rmwc/dialog';\nimport firebase from 'firebase';\nimport React from 'react';\n\nimport { Callout } from '../../common/Callout';\nimport { confirm } from '../../common/DialogQueue';\nimport { Field } from '../../common/Field';\n\nexport const promptDeleteCollection = (\n  reference: firebase.firestore.CollectionReference\n) =>\n  confirm({\n    title: 'Delete collection',\n    body: (\n      <div className=\"Firestore--dialog-body\">\n        <Callout aside type=\"warning\">\n          This will permanently delete the collection, including all nested\n          documents and collections.\n        </Callout>\n        <Field\n          label=\"Collection path\"\n          value={`/${reference.path}`}\n          fullwidth\n          disabled\n        />\n        <Callout aside type=\"note\">\n          Cloud Functions triggers <b>will not</b> be executed.\n        </Callout>\n      </div>\n    ),\n    // hide standard buttons so as to use `danger` button\n    acceptLabel: null,\n    cancelLabel: null,\n    footer: (\n      <>\n        <DialogButton action=\"close\" type=\"button\" theme=\"secondary\">\n          Cancel\n        </DialogButton>\n        <DialogButton unelevated action=\"accept\" isDefaultAction danger>\n          Delete\n        </DialogButton>\n      </>\n    ),\n  });\n","/**\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './index.scss';\n\nimport { Button } from '@rmwc/button';\nimport { List, ListItem } from '@rmwc/list';\nimport firebase from 'firebase';\nimport React, { useState } from 'react';\nimport { NavLink, useHistory, useRouteMatch } from 'react-router-dom';\nimport { useFirestore } from 'reactfire';\n\nimport {\n  AddCollectionDialog,\n  AddCollectionDialogValue,\n} from './dialogs/AddCollectionDialog';\nimport {\n  useRootCollections,\n  useSubCollections,\n} from './FirestoreEmulatedApiProvider';\nimport { useAutoSelect } from './useAutoSelect';\n\nexport interface Props {\n  collections: firebase.firestore.CollectionReference[];\n  reference?: firebase.firestore.DocumentReference;\n}\n\nexport const RootCollectionList: React.FC = () => {\n  const rootCollections = useRootCollections();\n  return <CollectionList collections={rootCollections} />;\n};\n\nexport const SubCollectionList: React.FC<{\n  reference: firebase.firestore.DocumentReference;\n}> = ({ reference }) => {\n  const subCollections = useSubCollections(reference);\n  return <CollectionList collections={subCollections} reference={reference} />;\n};\n\nconst CollectionList: React.FC<Props> = ({ collections, reference }) => {\n  const { url } = useRouteMatch()!;\n  const history = useHistory();\n  const firestore = useFirestore();\n  const redirectIfAutoSelectable = useAutoSelect(collections);\n\n  const [isAddCollectionDialogOpen, setAddCollectionDialogOpen] = useState(\n    false\n  );\n\n  const addCollection = async (value: AddCollectionDialogValue | null) => {\n    if (value?.collectionId && value?.document.id) {\n      const ref = reference || firestore;\n      const newCollection = ref.collection(value.collectionId);\n      await newCollection.doc(value.document.id).set(value.document.data);\n\n      // Redirect to the new collection\n      const encodedCollectionId = encodeURIComponent(value.collectionId);\n      if (reference) {\n        const encodedReferencePath = reference.path\n          .split('/')\n          .map((uri) => encodeURIComponent(uri))\n          .join('/');\n        history.push(\n          `/firestore/data/${encodedReferencePath}/${encodedCollectionId}`\n        );\n      } else {\n        history.push(`/firestore/data/${encodedCollectionId}`);\n      }\n    }\n  };\n\n  return (\n    <div className=\"Firestore-CollectionList\" data-testid=\"collection-list\">\n      {redirectIfAutoSelectable}\n\n      {isAddCollectionDialogOpen && (\n        <AddCollectionDialog\n          documentRef={reference}\n          open={isAddCollectionDialogOpen}\n          onValue={addCollection}\n          onClose={() => setAddCollectionDialogOpen(false)}\n        />\n      )}\n      {/* Actions */}\n      <List dense className=\"List-Actions\" tag=\"div\">\n        <ListItem\n          className=\"list-button\"\n          tag={Button}\n          {...{ dense: true, icon: 'add' }} // types get confused\n          label=\"Start collection\"\n          onClick={() => setAddCollectionDialogOpen(true)}\n        ></ListItem>\n      </List>\n\n      <List dense tag=\"div\">\n        {collections &&\n          collections.map((coll) => (\n            <CollectionListItem\n              key={coll.id}\n              collectionId={coll.id}\n              routeMatchUrl={url}\n            />\n          ))}\n      </List>\n    </div>\n  );\n};\n\nexport const CollectionListItem: React.FC<{\n  collectionId: string;\n  routeMatchUrl: string;\n}> = ({ collectionId, routeMatchUrl }) => {\n  return (\n    <ListItem\n      key={collectionId}\n      className=\"Firestore-List-Item\"\n      tag={NavLink}\n      to={`${routeMatchUrl}/${encodeURIComponent(collectionId)}`}\n      activeClassName=\"mdc-list-item--activated\"\n      data-testid=\"firestore-collection-list-item\"\n    >\n      {collectionId}\n    </ListItem>\n  );\n};\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Checkbox } from '@rmwc/checkbox';\nimport {\n  Dialog,\n  DialogActions,\n  DialogButton,\n  DialogContent,\n  DialogOnCloseEventT,\n  DialogProps,\n  DialogTitle,\n} from '@rmwc/dialog';\nimport firebase from 'firebase';\nimport React, { useState } from 'react';\n\nimport { Callout } from '../../common/Callout';\nimport { Field } from '../../common/Field';\n\ninterface DeleteDocumentOptions {\n  recursive: boolean;\n}\n\ninterface Props extends DialogProps {\n  documentRef: firebase.firestore.DocumentReference;\n  onConfirm: (options: DeleteDocumentOptions) => void;\n}\n\nexport const DeleteDocumentDialog: React.FC<Props> = ({\n  documentRef,\n  onConfirm,\n  onClose,\n  ...dialogProps\n}) => {\n  const [recursive, setRecursive] = useState(false);\n  const emitValueAndClose = (evt: DialogOnCloseEventT) => {\n    if (evt.detail.action === 'accept') {\n      onConfirm({ recursive });\n    }\n    onClose && onClose(evt);\n  };\n\n  return (\n    <Dialog {...dialogProps} onClose={emitValueAndClose}>\n      <DialogTitle>Delete document</DialogTitle>\n\n      <DialogContent>\n        <div className=\"Firestore--dialog-body\">\n          <Callout aside type=\"warning\">\n            This will permanently delete the document.\n          </Callout>\n          <Field\n            label=\"Document location\"\n            value={`/${documentRef.path}`}\n            disabled\n          />\n          <div>\n            <Checkbox\n              label=\"Also delete nested collections and documents\"\n              checked={recursive}\n              onChange={(event) => {\n                setRecursive(event.currentTarget.checked);\n              }}\n            />\n          </div>\n          {recursive && (\n            <Callout aside type=\"note\">\n              Cloud Functions triggers <b>will not</b> be executed.\n            </Callout>\n          )}\n        </div>\n      </DialogContent>\n\n      <DialogActions>\n        <DialogButton action=\"close\" type=\"button\" theme=\"secondary\">\n          Cancel\n        </DialogButton>\n        <DialogButton unelevated action=\"accept\" isDefaultAction danger>\n          Delete\n        </DialogButton>\n      </DialogActions>\n    </Dialog>\n  );\n};\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DialogButton } from '@rmwc/dialog';\nimport firebase from 'firebase';\nimport React from 'react';\n\nimport { Callout } from '../../common/Callout';\nimport { confirm } from '../../common/DialogQueue';\nimport { Field } from '../../common/Field';\n\nexport const promptDeleteDocumentFields = (\n  reference: firebase.firestore.DocumentReference\n) =>\n  confirm({\n    title: 'Delete data',\n    body: (\n      <div className=\"Firestore--dialog-body\">\n        <Callout aside type=\"warning\">\n          This will delete all fields of the document, excluding subcollections.\n        </Callout>\n        <Field\n          label=\"Document location\"\n          value={`/${reference.path}`}\n          fullwidth\n          disabled\n        />\n      </div>\n    ),\n    // hide standard buttons so as to use `danger` button\n    acceptLabel: null,\n    cancelLabel: null,\n    footer: (\n      <>\n        <DialogButton action=\"close\" type=\"button\" theme=\"secondary\">\n          Cancel\n        </DialogButton>\n        <DialogButton unelevated action=\"accept\" isDefaultAction danger>\n          Delete\n        </DialogButton>\n      </>\n    ),\n  });\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport firebase from 'firebase';\n\nimport { FirestoreAny, FirestoreMap } from '../models';\nimport { isArray, isMap, withFieldRemoved, withFieldSet } from '../utils';\n\nconst DELETE_FIELD = firebase.firestore.FieldValue.delete();\n\nexport function deleteField(\n  documentRef: firebase.firestore.DocumentReference,\n  documentData: FirestoreMap,\n  path: string[]\n) {\n  const payload = adjustPayloadForArray(documentData, path, DELETE_FIELD);\n  documentRef.update(...payload);\n}\n\nexport function updateField(\n  documentRef: firebase.firestore.DocumentReference,\n  documentData: FirestoreMap,\n  path: string[],\n  value: FirestoreAny\n) {\n  const payload = adjustPayloadForArray(documentData, path, value);\n  documentRef.update(...payload);\n}\n\nexport async function addFieldToMissingDocument(\n  reference: firebase.firestore.DocumentReference,\n  key: string,\n  value: FirestoreAny\n) {\n  const snapshot = await reference.get();\n  if (snapshot.exists) {\n    // TODO: Better surface this to the user.\n    throw new Error('.set() on an existing document would delete other fields');\n  }\n\n  await reference.set({ [key]: value });\n}\n\n/**\n * Firestore does not allow array syntax when updating/deleting fields i.e.\n * .update('obj.array[2]', true)\n *\n * This normalizes a payload's `objectPath` and `updateValue` into a form\n * that writes to the top most array with a reconstructed payload contains the\n * updated (or deleted) value.\n */\nfunction adjustPayloadForArray(\n  doc: FirestoreMap,\n  fieldPath: string[],\n  value: FirestoreAny | firebase.firestore.FieldValue\n): [firebase.firestore.FieldPath, FirestoreAny] {\n  let cur: FirestoreAny | undefined = doc;\n  let parentPath: string[] = [];\n  for (const key of fieldPath) {\n    if (cur === undefined || !isMap(cur)) {\n      throw new Error(`Tried to set field ${key} on non-map value.`);\n    }\n    cur = cur[key];\n    parentPath.push(key);\n    if (parentPath.length < fieldPath.length && isArray(cur)) {\n      // Note: We're avoiding arrayUnion, arrayRemove, etc. since they may\n      // skip adding or / remove all \"equal\" elements. Checking the edge cases\n      // will require implementing Firestore deep equals locally, which is way\n      // beyond the scope of this function and hard to keep in sync.\n      // Instead, just overwrite the whole array, which may touch more data\n      // than needed, but is always correct.\n      const pathToUpdate = new firebase.firestore.FieldPath(...parentPath);\n      const childPath = fieldPath.slice(parentPath.length);\n\n      // Note: FieldValue sentinels are not guaranteed to be\n      // `instanceof FieldValue`, so let's just use type casting here.\n      if (value === DELETE_FIELD || DELETE_FIELD.isEqual(value as any)) {\n        return [pathToUpdate, withFieldRemoved(cur, childPath)];\n      } else {\n        return [pathToUpdate, withFieldSet(cur, childPath, value)];\n      }\n    }\n  }\n  return [new firebase.firestore.FieldPath(...fieldPath), value];\n}\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport firebase from 'firebase';\nimport get from 'lodash.get';\nimport React, { ReactNode } from 'react';\n\nimport { FirestoreAny, FirestoreMap } from '../models';\nimport {\n  compareFirestoreKeys,\n  getFieldType,\n  isArray,\n  isMap,\n  isTimestamp,\n  summarize,\n  summarizeArray,\n  summarizeDate,\n  summarizeLatLng,\n  summarizeMap,\n} from '../utils';\nimport {\n  ExpressionPathSegmentValue,\n  ExpressionValue,\n  SimpleConstraint,\n} from './ExpressionValue';\n\nconst DocumentStateContext = React.createContext<FirestoreMap | undefined>(\n  undefined\n);\n\nexport const DocumentProvider: React.FC<{\n  value: FirestoreMap;\n}> = ({ value, children }) => {\n  return (\n    <DocumentStateContext.Provider value={value}>\n      {children}\n    </DocumentStateContext.Provider>\n  );\n};\n\n// Get the full data of the document. Can only be used within DocumentStateProvider.\nexport function useDocumentState(): FirestoreMap {\n  const context = React.useContext(DocumentStateContext);\n  if (context === undefined) {\n    throw new Error(\n      'useDocumentState must be used within a DocumentStateProvider'\n    );\n  }\n  return context;\n}\n\n// Get the value of the field at path. Can only be used within DocumentStateProvider.\nexport function useFieldState(path: string[]): FirestoreAny {\n  const documentState = useDocumentState();\n  if (path.length === 0) return documentState;\n  return get(documentState, path);\n}\n\nconst ExpressionValueStateContext = React.createContext<\n  ExpressionValue | undefined\n>(undefined);\n\nexport const ExpressionValueStateProvider: React.FC<{\n  value: ExpressionValue;\n}> = ({ value, children }) => {\n  return (\n    <ExpressionValueStateContext.Provider value={value}>\n      {children}\n    </ExpressionValueStateContext.Provider>\n  );\n};\n\n// Get information about field at path. Can be used within DocumentStateProvider\n// (Firestore doc) or ExpressionValueStateProvider (rules value, readonly).\nexport function useFieldInfo(\n  path: string[],\n  options: { maxSummaryLen: number }\n): {\n  title: string;\n  summary: ReactNode;\n  childPaths: string[][] | null;\n  typeDisp: string;\n} {\n  const documentState = React.useContext(DocumentStateContext);\n  const exprState = React.useContext(ExpressionValueStateContext);\n  if (documentState !== undefined) {\n    const value = path.length === 0 ? documentState : get(documentState, path);\n    let childPaths = null;\n\n    if (isMap(value)) {\n      childPaths = Object.keys(value)\n        .sort(compareFirestoreKeys)\n        .map((key) => [...path, key]);\n    } else if (isArray(value)) {\n      childPaths = value.map((_, index) => [...path, `${index}`]);\n    }\n\n    const summary = summarize(value, options.maxSummaryLen);\n    return {\n      title: isTimestamp(value) ? value.toDate().toISOString() : summary,\n      summary: summary,\n      childPaths,\n      typeDisp: getFieldType(value),\n    };\n  } else if (exprState !== undefined) {\n    let value =\n      path.length === 0 ? exprState : (get(exprState, path) as ExpressionValue);\n\n    let childPaths = null;\n\n    if (value.mapValue) {\n      childPaths = Object.keys(value.mapValue.fields ?? {})\n        .sort(compareFirestoreKeys)\n        .map((key) => [...path, 'mapValue', 'fields', key]);\n    } else if (value.listValue) {\n      childPaths = (value.listValue.values ?? []).map((_, index) => [\n        ...path,\n        'listValue',\n        'values',\n        `${index}`,\n      ]);\n    } else if (value.setValue) {\n      childPaths = (value.setValue.values ?? []).map((_, index) => [\n        ...path,\n        'setValue',\n        'values',\n        `${index}`,\n      ]);\n    }\n    if (value.constraintValue) {\n      return {\n        title: '',\n        summary: summarizeConstraint(\n          value.constraintValue,\n          options.maxSummaryLen\n        ),\n        childPaths: null,\n        typeDisp: 'constraint',\n      };\n    } else {\n      const summary = summarizeExp(value, options.maxSummaryLen);\n      return {\n        title: value.timestampValue\n          ? new Date(value.timestampValue).toISOString()\n          : summary,\n        summary: summary,\n        childPaths,\n        typeDisp: value.pathValue\n          ? 'path'\n          : (Object.keys(value)[0] || 'unknown').replace('Value', ''),\n      };\n    }\n  } else {\n    throw new Error(\n      'useFieldInfo must be used within a DocumentStateProvider or ExpressionValueStateProvider'\n    );\n  }\n}\n\nfunction summarizeExp(value: ExpressionValue, maxLen: number): string {\n  if ('nullValue' in value) {\n    return 'null';\n  } else if ('boolValue' in value) {\n    return summarize(value.boolValue || false, maxLen);\n  } else if ('intValue' in value) {\n    return summarizeNumber(value.intValue);\n  } else if ('floatValue' in value) {\n    return summarizeNumber(value.floatValue);\n  } else if ('stringValue' in value) {\n    return summarize(value.stringValue || '', maxLen);\n  } else if ('bytesValue' in value) {\n    return summarize(\n      firebase.firestore.Blob.fromBase64String(value.bytesValue || ''),\n      maxLen\n    );\n  } else if ('durationValue' in value) {\n    return value.durationValue || '0s';\n  } else if ('timestampValue' in value) {\n    const date = new Date(value.timestampValue || 0);\n    return summarizeDate(date, maxLen);\n  } else if ('latlngValue' in value) {\n    return summarizeLatLng(\n      value.latlngValue?.latitude || 0,\n      value.latlngValue?.longitude || 0\n    );\n  } else if ('listValue' in value) {\n    return summarizeArray(value.listValue?.values ?? [], maxLen, summarizeExp);\n  } else if ('setValue' in value) {\n    // TODO: Somehow make this look different than a list.\n    return summarizeArray(value.setValue?.values ?? [], maxLen, summarizeExp);\n  } else if ('mapValue' in value) {\n    return summarizeMap(value.mapValue?.fields ?? {}, maxLen, summarizeExp);\n  } else if ('pathValue' in value) {\n    return '/' + summarizePath(value.pathValue, maxLen);\n  } else if ('constraintValue' in value) {\n    return '(Constraint)';\n  } else if ('mapDiffValue' in value) {\n    return '(MapDiff)'; // TODO\n  } else if ('undefined' in value) {\n    return `(Error: ${value.undefined?.causeMessage || 'unknown'})`; // TODO\n  } else {\n    const json = JSON.stringify(value);\n    console.warn(`Unknown ExpressionValue type: ${json}`);\n    return json;\n  }\n}\n\nfunction summarizeNumber(value: number | string | undefined): string {\n  if (value === undefined) {\n    // JSON converted from protobuf may have default value omitted.\n    return '0';\n  }\n  if (typeof value === 'string') {\n    // int64 string (e.g. \"123\") or float \"NaN\" or \"Infinity\" etc.\n    return value;\n  }\n  return value.toString();\n}\n\nfunction summarizePath(\n  value: ExpressionValue['pathValue'],\n  maxLen: number\n): string {\n  if (!value || !value.segments) return '';\n  return value.segments.map((seg) => summarizeSegment(seg, maxLen)).join('/');\n}\n\nfunction summarizeSegment(\n  value: ExpressionPathSegmentValue,\n  maxLen: number\n): string {\n  if (value.simple) {\n    return value.simple;\n  } else if (value.capture) {\n    return value.capture.boundValue || `{${value.capture.variableName}}`;\n  } else if (value.globCapture) {\n    if (value.globCapture.boundValue) {\n      return summarizePath(value.globCapture.boundValue, maxLen);\n    } else {\n      return `{${value.globCapture.variableName}=**}`;\n    }\n  } else {\n    return '';\n  }\n}\n\nfunction summarizeConstraint(\n  value: ExpressionValue['constraintValue'],\n  maxLen: number\n): ReactNode {\n  const unknown = <span className=\"Constraint-unknown\">χ</span>; // Greek letter x\n  if (!value?.simpleConstraints?.length) {\n    return unknown;\n  }\n\n  let firstCondition = true;\n  const conditions: ReactNode[] = [];\n  for (const constraint of value.simpleConstraints) {\n    if (firstCondition) {\n      conditions.push(<span className=\"Constraint-hint\">where </span>);\n      firstCondition = false;\n    } else {\n      conditions.push(<span className=\"Constraint-and\"> &amp;&amp; </span>);\n    }\n    const { comparator, value } = constraint;\n    if (!value) {\n      throw new Error(\n        `Constraint value unset in ${JSON.stringify(constraint)}`\n      );\n    }\n    const valueStr = summarizeExp(value, maxLen);\n    if (!comparator || comparator === 'UNSET_COMPARATOR') {\n      throw new Error(\n        `Constraint comparator unset in ${JSON.stringify(constraint)}`\n      );\n    } else if (comparator === 'LIST_CONTAINS') {\n      conditions.push(\n        <span>\n          ({valueStr} in {unknown})\n        </span>\n      );\n    } else {\n      conditions.push(\n        <span>\n          {unknown} {COMPARATOR_DISP[comparator] || comparator} {valueStr}\n        </span>\n      );\n    }\n  }\n  return (\n    <span>\n      {unknown} ({conditions})\n    </span>\n  );\n}\n\nconst COMPARATOR_DISP: Record<\n  Exclude<\n    SimpleConstraint['comparator'],\n    undefined | 'UNSET_COMPARATOR' | 'LIST_CONTAINS' // handled separately\n  >,\n  string\n> = {\n  EQ: '==',\n  NEQ: '!=',\n  GT: '>',\n  GTE: '>=',\n  LT: '<',\n  LTE: '<=',\n};\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport enum WebSocketState {\n  DISCONNECTED,\n  CONNECTED,\n  PENDING,\n}\n\nexport class ReconnectingWebSocket {\n  state: WebSocketState = WebSocketState.DISCONNECTED;\n  listener: Function | undefined = undefined;\n  interval: number | undefined = undefined;\n  ws: WebSocket | undefined = undefined;\n\n  constructor(wsUrl: string) {\n    this.connect(wsUrl);\n    // XXX: The Node.js typings for setInterval is leaking in, which causes the\n    // function to be typed to return NodeJS.Timeout and thus the as-any cast.\n    // TODO: Remove Node.js typings from source files for the web.\n    this.interval = setInterval(() => this.connect(wsUrl), 1000) as any;\n  }\n\n  private connect(wsUrl: string) {\n    if (this.state !== WebSocketState.DISCONNECTED) return;\n\n    const ws = new WebSocket(wsUrl);\n    this.ws = ws;\n    this.state = WebSocketState.PENDING;\n\n    ws.onopen = () => {\n      this.state = WebSocketState.CONNECTED;\n    };\n\n    ws.onclose = () => {\n      this.state = WebSocketState.DISCONNECTED;\n    };\n\n    ws.onmessage = (msg) => {\n      const data = JSON.parse(msg.data);\n      this.listener && this.listener(data);\n    };\n  }\n\n  cleanup() {\n    this.listener = undefined;\n    if (this.interval) clearInterval(this.interval);\n    if (this.ws) this.ws.close();\n    this.ws = undefined;\n  }\n}\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './FieldPreview.scss';\n\nimport { Icon } from '@rmwc/icon';\nimport { IconButton } from '@rmwc/icon-button';\nimport { ListItem, ListItemMeta } from '@rmwc/list';\nimport { Theme } from '@rmwc/theme';\nimport classnames from 'classnames';\nimport firebase from 'firebase';\nimport React, { useCallback, useState } from 'react';\n\nimport { supportsEditing } from '../DocumentEditor';\nimport { FirestoreArray } from '../models';\nimport {\n  getParentPath,\n  isArray,\n  isMap,\n  isPrimitive,\n  lastFieldName,\n} from '../utils';\nimport { deleteField, updateField } from './api';\nimport InlineEditor from './InlineEditor';\nimport { useDocumentState, useFieldInfo, useFieldState } from './store';\n\nexport interface CommonPreviewProps {\n  path: string[];\n  maxSummaryLen: number;\n}\n\nexport interface FieldPreviewProps extends CommonPreviewProps {\n  actions?: React.ReactNode;\n  childComponent?: React.ComponentType<CommonPreviewProps>;\n}\n\nexport const FieldPreview: React.FC<FieldPreviewProps> = ({\n  path,\n  maxSummaryLen,\n  children,\n  actions,\n  childComponent: ChildComponent = FieldPreview,\n}) => {\n  const { summary, title, typeDisp, childPaths } = useFieldInfo(path, {\n    maxSummaryLen,\n  });\n  const [isExpanded, setIsExpanded] = useState(\n    !childPaths || childPaths.length > 0\n  );\n\n  return (\n    <>\n      <ListItem\n        onClick={() => path.length && setIsExpanded(!isExpanded)}\n        className={classnames('FieldPreview', {\n          'FieldPreview--primitive': !childPaths,\n          'FieldPreview--expanded': childPaths && isExpanded,\n        })}\n      >\n        <Icon\n          className=\"FieldPreview-expand-icon\"\n          icon={{\n            size: 'xsmall',\n            icon: isExpanded ? 'arrow_drop_down' : 'arrow_right',\n          }}\n        />\n        <Theme use=\"secondary\" tag=\"span\" className=\"FieldPreview-key\">\n          {path[path.length - 1] || ''}\n        </Theme>\n        <span className=\"FieldPreview-summary\" title={title}>\n          {summary}\n        </span>\n        <ListItemMeta className=\"FieldPreview-actions\">\n          <span className=\"FieldPreview-type\">({typeDisp})</span>\n          {actions}\n        </ListItemMeta>\n      </ListItem>\n\n      {children}\n\n      {childPaths && isExpanded && (\n        <div\n          className={\n            path.length\n              ? 'FieldPreview-children'\n              : 'FieldPreview-top-level-fields'\n          }\n        >\n          {childPaths.map((path) => {\n            return (\n              <ChildComponent\n                path={path}\n                key={lastFieldName(path)}\n                maxSummaryLen={maxSummaryLen}\n              />\n            );\n          })}\n        </div>\n      )}\n    </>\n  );\n};\n\nexport const EditableFieldPreview: React.FC<\n  CommonPreviewProps & {\n    documentRef: firebase.firestore.DocumentReference;\n  }\n> = ({ path, documentRef, maxSummaryLen }) => {\n  const documentData = useDocumentState();\n  const parentState = useFieldState(path.slice(0, -1));\n  const state = useFieldState(path);\n  const [isEditing, setIsEditing] = useState(false);\n  const [isAddingField, setIsAddingField] = useState(false);\n  const childComponent = useCallback(\n    (props: CommonPreviewProps) => (\n      <EditableFieldPreview documentRef={documentRef} {...props} />\n    ),\n    [documentRef]\n  );\n\n  return isEditing ? (\n    <>\n      {isArray(parentState) && (\n        <InlineEditor\n          value={[state] as FirestoreArray}\n          onCancel={() => {\n            setIsEditing(false);\n          }}\n          onSave={(key, value) => {\n            updateField(documentRef, documentData, path, value);\n            setIsEditing(false);\n          }}\n          areRootKeysMutable={false}\n          firestore={documentRef.firestore}\n        />\n      )}\n      {isMap(parentState) && (\n        <InlineEditor\n          value={{ [lastFieldName(path)]: state }}\n          onCancel={() => {\n            setIsEditing(false);\n          }}\n          onSave={(key, value) => {\n            updateField(\n              documentRef,\n              documentData,\n              [...getParentPath(path), key],\n              value\n            );\n            setIsEditing(false);\n          }}\n          areRootKeysMutable={false}\n          firestore={documentRef.firestore}\n        />\n      )}\n    </>\n  ) : (\n    <FieldPreview\n      path={path}\n      maxSummaryLen={maxSummaryLen}\n      childComponent={childComponent}\n      actions={\n        <>\n          {isPrimitive(state) && supportsEditing(state) && (\n            <IconButton\n              icon=\"edit\"\n              label=\"Edit field\"\n              onClick={(e) => {\n                e.stopPropagation();\n                setIsEditing(true);\n              }}\n            />\n          )}{' '}\n          {(isArray(state) || isMap(state)) && (\n            <IconButton\n              icon=\"add\"\n              label=\"Add field\"\n              onClick={(e) => {\n                e.stopPropagation();\n                setIsAddingField(true);\n              }}\n            />\n          )}\n          <IconButton\n            icon=\"delete\"\n            label=\"Remove field\"\n            onClick={(e) => {\n              e.stopPropagation();\n              deleteField(documentRef, documentData, path);\n            }}\n          />\n        </>\n      }\n    >\n      {isAddingField && isArray(state) && (\n        <InlineEditor\n          value={['']}\n          onCancel={() => {\n            setIsAddingField(false);\n          }}\n          startingIndex={state.length}\n          onSave={(key, value) => {\n            const newPath = [...path, `${state.length}`];\n            updateField(documentRef, documentData, newPath, value);\n            setIsAddingField(false);\n          }}\n          areRootKeysMutable={!isArray(state)}\n          firestore={documentRef.firestore}\n        />\n      )}\n\n      {isAddingField && isMap(state) && (\n        <InlineEditor\n          value={{ '': '' }}\n          onCancel={() => {\n            setIsAddingField(false);\n          }}\n          onSave={(key, value) => {\n            const newPath = [...path, key];\n            updateField(documentRef, documentData, newPath, value);\n            setIsAddingField(false);\n          }}\n          areRootKeysMutable={!isArray(state)}\n          firestore={documentRef.firestore}\n        />\n      )}\n    </FieldPreview>\n  );\n};\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Button } from '@rmwc/button';\nimport { List, ListItem } from '@rmwc/list';\nimport { Typography } from '@rmwc/typography';\nimport firebase from 'firebase';\nimport React, { useState } from 'react';\nimport { useFirestoreDoc } from 'reactfire';\n\nimport { FirestoreMap } from '../models';\nimport { compareFirestoreKeys } from '../utils';\nimport { addFieldToMissingDocument, updateField } from './api';\nimport { EditableFieldPreview } from './FieldPreview';\nimport InlineEditor from './InlineEditor';\nimport { DocumentProvider } from './store';\n\nexport interface Props {\n  reference: firebase.firestore.DocumentReference;\n  maxSummaryLen?: number;\n}\n\nconst DocumentPreview: React.FC<Props> = ({\n  reference,\n  maxSummaryLen = 20,\n}) => {\n  const snapshot = useFirestoreDoc(reference, { suspense: true }).data;\n  const [isAddingField, setIsAddingField] = useState(false);\n  const docExists = snapshot.exists;\n  const data = docExists ? (snapshot.data() as FirestoreMap) : {};\n  const docEmpty = docExists && Object.keys(data).length === 0;\n\n  return (\n    <>\n      <DocumentProvider value={data || {}}>\n        <List\n          dense\n          className=\"List-Actions Firestore-Document-Fields\"\n          tag=\"div\"\n        >\n          {/* Actions */}\n          <ListItem\n            className=\"list-button\"\n            tag={Button}\n            label=\"Add field\"\n            {...{ dense: true, icon: 'add' }} // types get confused\n            onClick={() => setIsAddingField(true)}\n          ></ListItem>\n\n          {isAddingField && (\n            <InlineEditor\n              value={{ '': '' }}\n              onCancel={() => {\n                setIsAddingField(false);\n              }}\n              onSave={async (key, value) => {\n                if (!docExists) {\n                  await addFieldToMissingDocument(reference, key, value);\n                } else {\n                  updateField(reference, data, [key], value);\n                }\n                setIsAddingField(false);\n              }}\n              areRootKeysMutable={true}\n              firestore={reference.firestore}\n            />\n          )}\n\n          {docExists && !docEmpty && (\n            <div className=\"Firestore-Field-List\">\n              {Object.keys(data)\n                .sort(compareFirestoreKeys)\n                .map((name) => (\n                  <EditableFieldPreview\n                    key={name}\n                    path={[name]}\n                    documentRef={reference}\n                    maxSummaryLen={maxSummaryLen}\n                  />\n                ))}\n            </div>\n          )}\n          {!docExists && (\n            <DocumentWarning>\n              This document does not exist, it will not appear in queries or\n              snapshots\n            </DocumentWarning>\n          )}\n          {docEmpty && (\n            <DocumentWarning>This document has no data</DocumentWarning>\n          )}\n        </List>\n      </DocumentProvider>\n    </>\n  );\n};\n\nconst DocumentWarning: React.FC<{}> = ({ children }) => (\n  <Typography\n    theme=\"secondary\"\n    use=\"body2\"\n    className=\"Firestore-Document-Warning\"\n  >\n    <i>{children}</i>\n  </Typography>\n);\n\nexport default DocumentPreview;\n","/**\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './index.scss';\n\nimport { Icon } from '@rmwc/icon';\nimport { IconButton } from '@rmwc/icon-button';\nimport { ListDivider } from '@rmwc/list';\nimport { MenuItem, SimpleMenu } from '@rmwc/menu';\nimport firebase from 'firebase';\nimport React, { Suspense, useState } from 'react';\nimport { Route, useRouteMatch } from 'react-router-dom';\nimport { useFirestore } from 'reactfire';\n\nimport { CopyButton } from '../common/CopyButton';\nimport { FirestoreIcon } from '../common/icons';\nimport { Spinner } from '../common/Spinner';\nimport Collection, { CollectionLoading } from './Collection';\nimport { RootCollectionList, SubCollectionList } from './CollectionList';\nimport { DeleteDocumentDialog } from './dialogs/DeleteDocumentDialog';\nimport { promptDeleteDocumentFields } from './dialogs/deleteDocumentFields';\nimport DocumentPreview from './DocumentPreview';\nimport { useRecursiveDelete } from './FirestoreEmulatedApiProvider';\nimport PanelHeader from './PanelHeader';\n\nconst Doc: React.FC<{\n  id: string;\n  collectionById: (id: string) => firebase.firestore.CollectionReference;\n  children: React.ReactNode;\n}> = ({ collectionById, children }) => {\n  const { url } = useRouteMatch()!;\n\n  return (\n    <>\n      <div className=\"Firestore-Document\">{children}</div>\n\n      <Route\n        path={`${url}/:id`}\n        render={({ match }: any) => {\n          return (\n            <Suspense\n              fallback={\n                <CollectionLoading\n                  collection={collectionById(\n                    decodeURIComponent(match.params.id)\n                  )}\n                />\n              }\n            >\n              <Collection\n                collection={collectionById(decodeURIComponent(match.params.id))}\n              />\n            </Suspense>\n          );\n        }}\n      ></Route>\n    </>\n  );\n};\n\n/** Root node */\nexport const Root: React.FC = () => {\n  const firestore = useFirestore();\n\n  return (\n    <Doc id={'Root'} collectionById={(id: string) => firestore.collection(id)}>\n      <PanelHeader id=\"Root\" icon={<FirestoreIcon />} />\n      <Suspense fallback={<Spinner message=\"Loading collections\" />}>\n        <RootCollectionList />\n      </Suspense>\n    </Doc>\n  );\n};\n\n/** Document node */\nexport const Document: React.FC<{\n  reference: firebase.firestore.DocumentReference;\n}> = ({ reference }) => {\n  const recursiveDelete = useRecursiveDelete();\n  const [isDeleteDocumentDialogOpen, setDeleteDocumentDialogOpen] = useState(\n    false\n  );\n\n  const handleDeleteFields = async () => {\n    const shouldDelete = await promptDeleteDocumentFields(reference);\n    shouldDelete && reference.set({});\n  };\n\n  return (\n    <Doc\n      id={reference.id}\n      collectionById={(id: string) => reference.collection(id)}\n    >\n      {isDeleteDocumentDialogOpen && (\n        <DeleteDocumentDialog\n          documentRef={reference}\n          open={isDeleteDocumentDialogOpen}\n          onConfirm={({ recursive }) =>\n            recursive ? recursiveDelete(reference) : reference.delete()\n          }\n          onClose={() => setDeleteDocumentDialogOpen(false)}\n        />\n      )}\n      <PanelHeader\n        id={reference.id}\n        icon={<Icon icon={{ icon: 'insert_drive_file', size: 'small' }} />}\n      >\n        <CopyButton textToCopy={reference.id} label=\"Copy document ID\" />\n        <SimpleMenu\n          handle={<IconButton icon=\"more_vert\" label=\"Menu\" />}\n          renderToPortal\n        >\n          <MenuItem onClick={() => setDeleteDocumentDialogOpen(true)}>\n            Delete document\n          </MenuItem>\n          <MenuItem onClick={handleDeleteFields}>Delete all fields</MenuItem>\n        </SimpleMenu>\n      </PanelHeader>\n\n      <Suspense fallback={<Spinner message=\"Loading collections\" />}>\n        <SubCollectionList reference={reference} />\n      </Suspense>\n      <ListDivider tag=\"div\" />\n      <Suspense fallback={<Spinner message=\"Loading document\" />}>\n        <DocumentPreview reference={reference} />\n      </Suspense>\n    </Doc>\n  );\n};\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './index.scss';\n\nimport { Snackbar } from '@rmwc/snackbar';\nimport React from 'react';\n\nexport const SNACKBAR_MESSAGE = 'Request path copied to clipboard';\n\ninterface Props {\n  showCopyNotification: boolean;\n  setShowCopyNotification: (value: boolean) => void;\n  timeout?: number;\n}\n\nconst CopyPathNotification: React.FC<Props> = ({\n  showCopyNotification,\n  setShowCopyNotification,\n  timeout,\n}) => (\n  <Snackbar\n    className=\"Firestore-Requests-Copy-Path-Snackbar\"\n    open={showCopyNotification}\n    onClose={() => setShowCopyNotification(false)}\n    message={SNACKBAR_MESSAGE}\n    icon={{ icon: 'check_circle', size: 'medium' }}\n    timeout={timeout}\n  />\n);\n\nexport default CopyPathNotification;\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useEffect, useState } from 'react';\n\nimport { ReconnectingWebSocket } from '../../../reconnectingWebSocket';\nimport {\n  useConfigOptional,\n  useEmulatorConfig,\n  useOnChangePromise,\n} from '../../common/EmulatorConfigProvider';\nimport { FirestoreRulesEvaluation } from './rules_evaluation_result_model';\n\ninterface FirestoreRequestsState {\n  requests?: FirestoreRulesEvaluation[];\n  promise?: Promise<void>;\n  isRequestsAvailable?: boolean;\n}\n\nconst firestoreRequestsContext = React.createContext<\n  FirestoreRequestsState | undefined\n>(undefined);\n\nexport const FirestoreRequestsProvider: React.FC = ({ children }) => {\n  const [requests, setRequests] = useState<FirestoreRulesEvaluation[]>();\n  const config = useConfigOptional();\n  const projectId = config?.projectId;\n  const firestore = config?.firestore;\n  useEffect(() => {\n    if (\n      !projectId ||\n      !firestore ||\n      !firestore.webSocketHost ||\n      !firestore.webSocketPort\n    ) {\n      setRequests(undefined);\n    } else {\n      const wsUrl = new URL('ws://placeholder/requests');\n      wsUrl.host = firestore.webSocketHost;\n      wsUrl.port = firestore.webSocketPort.toString();\n\n      const webSocket = new ReconnectingWebSocket(wsUrl.toString());\n      webSocket.listener = (\n        newEvaluation: FirestoreRulesEvaluation | FirestoreRulesEvaluation[]\n      ) => {\n        if (newEvaluation instanceof Array) {\n          // This is the initial \"blast\" of prior requests\n          setRequests(newEvaluation.filter(isCurrentProject));\n        } else if (isCurrentProject(newEvaluation)) {\n          setRequests((requests) => [...(requests || []), newEvaluation]);\n        }\n      };\n\n      return () => webSocket.cleanup();\n    }\n\n    function isCurrentProject(evaluation: FirestoreRulesEvaluation): boolean {\n      if (!evaluation.rulesReleaseName) {\n        // Old versions of Firestore Emulator does not send this field.\n        return true; // Let's assume the same project and hope for the best.\n      }\n      return evaluation.rulesReleaseName.startsWith(`projects/${projectId}/`);\n    }\n  }, [projectId, firestore, setRequests]);\n  const promise = useOnChangePromise(requests) as Promise<void>;\n\n  return (\n    <firestoreRequestsContext.Provider value={{ requests, promise }}>\n      {children}\n    </firestoreRequestsContext.Provider>\n  );\n};\n\nexport const TestFirestoreRequestsProvider: React.FC<{\n  state: FirestoreRequestsState;\n}> = ({ state, children }) => {\n  return (\n    <firestoreRequestsContext.Provider value={state}>\n      {children}\n    </firestoreRequestsContext.Provider>\n  );\n};\n\nexport function useFirestoreRequests(): {\n  requests: FirestoreRulesEvaluation[];\n} {\n  const context = React.useContext(firestoreRequestsContext);\n  if (context === undefined) {\n    throw new Error(\n      'useFirestoreRequests must be used within a <FirestoreRequestsProvider>'\n    );\n  }\n  if (!context.requests) {\n    throw context.promise;\n  }\n  return { requests: context.requests };\n}\n\nexport function useIsFirestoreRequestsAvailable(): boolean {\n  const config = useEmulatorConfig('firestore');\n  return !!(config.webSocketHost && config.webSocketPort);\n}\n\nexport function useFirestoreRequest(\n  requestId: string\n): FirestoreRulesEvaluation | undefined {\n  const { requests } = useFirestoreRequests();\n  return requests.find((req) => req.requestId === requestId);\n}\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport debounce from 'lodash.debounce';\nimport { useEffect, useState } from 'react';\n\nimport { RulesOutcome } from './rules_evaluation_result_model';\nimport { OutcomeData } from './types';\n\n// Matches the material-icon name by request outcome\nexport const ICON_SELECTOR = {\n  allow: 'check_circle',\n  deny: 'remove_circle',\n  error: 'report_problem',\n  admin: 'security',\n};\ntype OutcomeDataPicker = {\n  [key in RulesOutcome]: OutcomeData;\n};\nexport const OUTCOME_DATA: OutcomeDataPicker = {\n  allow: { theme: 'success', icon: ICON_SELECTOR['allow'], label: 'ALLOW' },\n  deny: { theme: 'warning', icon: ICON_SELECTOR['deny'], label: 'DENY' },\n  error: { theme: 'warning', icon: ICON_SELECTOR['error'], label: 'ERROR' },\n  admin: { theme: 'success', icon: ICON_SELECTOR['admin'], label: 'ADMIN' },\n};\n\n// Custom hook that returns the width of the path container,\n// a new width is returned after every window resizing is done\nexport function usePathContainerWidth(\n  pathContainerRef: React.RefObject<HTMLDivElement>\n): number | undefined {\n  const [pathContainerWidth, setPathContainerWidth] = useState<\n    number | undefined\n  >();\n\n  useEffect(() => {\n    const getPathContainerWidth = () => {\n      return pathContainerRef?.current?.offsetWidth;\n    };\n    // Update (pathContainerWidth), debounce helps avoiding unnecessary calls\n    const debouncedHandleWindowResize = debounce(() => {\n      setPathContainerWidth(getPathContainerWidth());\n    }, 150);\n\n    // Set the initial width of path-container\n    setPathContainerWidth(getPathContainerWidth());\n    // Starts the subscription to window-resizing, and sends a callback\n    // that updates the (pathContainerWidth) after every resize.\n    window?.addEventListener('resize', debouncedHandleWindowResize);\n    // Remove the subscription when the component unmounts\n    // (to ensure only one subscription to window-resizing is active at a time)\n    return () =>\n      window?.removeEventListener('resize', debouncedHandleWindowResize);\n  }, [setPathContainerWidth, pathContainerRef]);\n\n  return pathContainerWidth;\n}\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './AdminRequest.scss';\n\nimport { Theme } from '@rmwc/theme';\nimport { Typography } from '@rmwc/typography';\nimport React from 'react';\n\nexport const ADMIN_REQUEST_MESSAGE = 'Admin requests bypass Firestore rules';\n\nconst CodeViewerAdminRequest: React.FC = () => {\n  return (\n    <Theme use=\"surface\" wrap>\n      <div className=\"Firestore-Requests-Details-Code-Admin-Request-Container\">\n        <Typography\n          use=\"body2\"\n          theme=\"textSecondaryOnBackground\"\n          className=\"Firestore-Requests-Details-Code-Admin-Request-Message\"\n        >\n          {ADMIN_REQUEST_MESSAGE}\n        </Typography>\n      </div>\n    </Theme>\n  );\n};\n\nexport default CodeViewerAdminRequest;\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n// Based on http://go/codemirror-firebase-rules\n\nimport 'codemirror/addon/mode/simple';\n\nimport CodeMirror from 'codemirror';\n\nconst FIREBASE_RULES_KEYWORD_REGEX = /(?:allow|function|match|service|if|import|as|let|return)\\b/;\nconst FIREBASE_RULES_VARIABLE_REGEX = /[a-z$][\\w$]*/;\n\nconst FIREBASE_RULES_ATOM_REGEX = /true|false|null/;\nconst FIREBASE_RULES_COMMENT_REGEX = /(\\/\\/.*)/;\nconst FIREBASE_RULES_OPERATOR_REGEX = /(?:[-+/*=<>!&|]+)/;\nconst FIREBASE_RULES_NUMBER_REGEX = /(b?\"[^\"]*\")|(b?'[^']*')|[0-9]+(\\.[0-9]+)?/;\n// Creating tokens for these helps code mirror find text marks by mouse position\nconst FIREBASE_RULES_MISC_REGEX = /(?:[.,:[\\]{}()])/;\nconst FIREBASE_RULES_STRING_REGEX = /(?:auth|create|delete|get|headers|method|params|path|read|request|resource|time|uid|update|write|list)\\b/;\n\nexport const MODE_FIREBASE_RULES = 'firebaseRules';\n\nexport function defineFirebaseRulesMode() {\n  CodeMirror.defineSimpleMode(MODE_FIREBASE_RULES, {\n    start: [\n      { regex: FIREBASE_RULES_COMMENT_REGEX, token: 'comment' },\n      { regex: /\\/\\*/, token: 'comment', next: 'comment' },\n      { regex: FIREBASE_RULES_KEYWORD_REGEX, token: 'keyword' },\n      { regex: FIREBASE_RULES_ATOM_REGEX, token: 'atom' },\n      { regex: FIREBASE_RULES_OPERATOR_REGEX, token: 'operator' },\n      { regex: FIREBASE_RULES_STRING_REGEX, token: 'string' },\n      { regex: FIREBASE_RULES_NUMBER_REGEX, token: 'number' },\n      { regex: FIREBASE_RULES_VARIABLE_REGEX, token: 'variable' },\n      { regex: FIREBASE_RULES_MISC_REGEX, token: 'misc' },\n    ],\n    comment: [\n      { regex: /.*?\\*\\//, token: 'comment', next: 'start' },\n      { regex: /.*/, token: 'comment' },\n    ],\n    meta: { dontIndentStates: ['comment'], lineComment: '//' },\n  });\n}\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport 'codemirror/keymap/sublime';\nimport 'codemirror/lib/codemirror.css';\n\nimport './index.scss';\n\nimport CodeMirror from 'codemirror';\nimport React, { useEffect, useRef } from 'react';\n\nimport { textBlackTertiary } from '../../../../../colors';\nimport { errorTheme, successTheme } from '../../../../../themes';\nimport { Callout } from '../../../../common/Callout';\nimport { OutcomeInfo, RulesOutcome } from '../../rules_evaluation_result_model';\nimport { ICON_SELECTOR } from '../../utils';\nimport CodeViewerAdminRequest from './AdminRequest';\nimport { MODE_FIREBASE_RULES, defineFirebaseRulesMode } from './mode';\n\n// TODO: find a way to remove the CSSProperties cast\n// (TypeScript complains if object is not casted)\nconst CODE_VIEWER_CUSTOM_STYLES = {\n  '--emulator-ui-code-success-primary': successTheme.primary,\n  '--emulator-ui-code-success-background': successTheme.background,\n  '--emulator-ui-code-error-primary': errorTheme.primary,\n  '--emulator-ui-code-error-background': errorTheme.background,\n  '--emulator-ui-code-comment-text': textBlackTertiary,\n} as React.CSSProperties;\n\nconst CODE_MIRROR_OPTIONS: CodeMirror.EditorConfiguration = {\n  tabSize: 2,\n  indentUnit: 2,\n  lineNumbers: true,\n  theme: 'devsite-light',\n  keyMap: 'sublime',\n  mode: MODE_FIREBASE_RULES,\n  readOnly: 'nocursor',\n  gutters: ['CodeMirror-gutter-elt'],\n};\n\n// Creates HTMLElement of a Marker containing the outcome icon\nfunction getMarkerElement(outcome: RulesOutcome): HTMLElement {\n  let marker = document.createElement('i');\n  marker.className = `CodeMirror-gutter-icon ${outcome} material-icons`;\n  marker.textContent = ICON_SELECTOR[outcome];\n  return marker;\n}\n\ninterface Props {\n  firestoreRules?: string;\n  linesOutcome?: OutcomeInfo[];\n  isAdminRequest: boolean;\n}\n\nconst RulesCodeViewer: React.FC<Props> = ({\n  firestoreRules,\n  linesOutcome,\n  isAdminRequest,\n}) => {\n  useEffect(defineFirebaseRulesMode, []);\n\n  const ref = useRef<HTMLTextAreaElement>(null);\n  useEffect(() => {\n    if (ref.current) {\n      if (ref.current.style.display === 'none') {\n        // CodeMirror has already initialized and replaced this textarea.\n        return;\n      }\n      // CodeMirror objects don't need to be destroyed manually and will be\n      // collected by GC once the DOM node is removed.\n      const cm = CodeMirror.fromTextArea(ref.current, CODE_MIRROR_OPTIONS);\n      cm.setSize('100%', '100%');\n      // Highlights and adds the proper outcome-gutter to the corresponding lines of\n      // the rules code-viewer.\n      // NOTE: a gutter in CodeMirror is an icon displayed next to the line number\n      // NOTE: this current version of the code won't remove old gutters, nor old highlighted-lines\n      // if the (linesOutcome) array were to change, however, this code is fine because the\n      // (codeMirrorEditor) instance is destroyed / created after the component unmounts / mounts\n      // (therefore reseting all gutters and highlighted-lines). Additionally, there is currently\n      // no way to update the linesOutcome array of an existing request.\n      linesOutcome?.forEach(({ line, outcome }) => {\n        const rulesOutcome: RulesOutcome = outcome ? 'allow' : 'deny';\n        cm.setGutterMarker(\n          line - 1,\n          'CodeMirror-gutter-elt',\n          getMarkerElement(rulesOutcome)\n        );\n        cm.addLineClass(\n          line - 1,\n          '',\n          `highlighted-line-of-code--${rulesOutcome}`\n        );\n      });\n    }\n  }, [ref, firestoreRules, linesOutcome]);\n\n  function renderCodeViewer() {\n    if (isAdminRequest) {\n      return <CodeViewerAdminRequest />;\n    }\n    return <textarea ref={ref} value={firestoreRules} readOnly></textarea>;\n  }\n\n  function renderCallout() {\n    if (!linesOutcome?.length) {\n      return (\n        <Callout type=\"caution\">\n          The request did not match any allow statements, so it was denied by\n          default.\n        </Callout>\n      );\n    } else {\n      return <></>;\n    }\n  }\n\n  return (\n    <div\n      data-testid=\"request-details-code-viewer-section\"\n      className=\"Firestore-Request-Details-Code-Section\"\n      style={CODE_VIEWER_CUSTOM_STYLES}\n    >\n      {renderCallout()}\n      {renderCodeViewer()}\n    </div>\n  );\n};\n\nexport default RulesCodeViewer;\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport '../index.scss';\n\nimport { IconButton } from '@rmwc/icon-button';\nimport { Tooltip } from '@rmwc/tooltip';\nimport React, { useEffect, useRef, useState } from 'react';\n\n// Copies path without spaces to clipboard\n// and triggers copy notification (SnackBar)\nfunction copyPathToClipboard(\n  resourcePath: string,\n  setShowCopyNotification: (value: boolean) => void\n) {\n  if (!navigator?.clipboard?.writeText) {\n    throw new Error('Your browser does not support copying to clipboard');\n  }\n  navigator.clipboard\n    .writeText(resourcePath.replace(/\\s/g, ''))\n    .then(() => setShowCopyNotification(true))\n    .catch((error) => {\n      setShowCopyNotification(false);\n      throw new Error(`Could not copy to clipboard.\\n\\nReason: ${error}`);\n    });\n}\n\n// Function that truncates the request path from the left side of the string.\n// It first calculates the available width of the pathHtmlElement, and how many\n// characters fit inside the width. Based on that, it calculates a new truncated string.\n// For optimization purposes, the truncation is always calculated, but the HTMLElement\n// is only updated when the new truncated string is different than the HTMLElement's textContent.\nfunction truncateRequestPathFromLeft(\n  pathTextElement: React.RefObject<HTMLDivElement>,\n  copyButtonElement: React.RefObject<HTMLButtonElement>,\n  fullRequestPath: string,\n  pathContainerWidth?: number\n): void {\n  const pathHtmlElement = pathTextElement.current;\n  if (!pathHtmlElement || !pathContainerWidth) {\n    return;\n  }\n  const {\n    textContent: pathTextString,\n    offsetWidth: pathTextWidth,\n  } = pathHtmlElement;\n  const copyIconButtonWidth = copyButtonElement.current?.offsetWidth || 0;\n  // Calculate the width in px of a single character: (totalWidth / totalCharacters)\n  // NOTE: Even though the font-family is not monospace (every character may have a different width),\n  // this solution is accepted because the pixel approximation varies by only decimals.\n  const totalPathCharacters = pathTextString?.length || 0;\n  const pathCharacterPxWidth = totalPathCharacters\n    ? pathTextWidth / totalPathCharacters\n    : 0;\n  // End truncation to avoid x/0 division\n  if (!pathCharacterPxWidth) {\n    return;\n  }\n  // Calculate amount of characters that fit inside the pathHtmlElement: (totalWidth / widthPerCharacter)\n  // NOTE: Math.floor is chosen over Math.ceil to ensure there is a small space\n  // between the request-path and the copy-button\n  const pathHtmlElementAvailableWidth =\n    pathContainerWidth - copyIconButtonWidth;\n  const newPathMaxCharacters = Math.floor(\n    pathHtmlElementAvailableWidth / pathCharacterPxWidth\n  );\n  // Calculate where to start the truncated substring\n  const newPathStart = fullRequestPath.length - newPathMaxCharacters;\n  // Truncate the path only if the full path doesn't fit in the HTMLElement,\n  // otherwise just set the new path-string to be the full request-path.\n  // NOTE: If the path will be truncated, a '...' substring is prepended (added at the begining\n  // of the path) and a (+ 3) is added to the substring initial-index to compensate\n  // the space of the '...' characters ('...' replaces the first 3 characters of the truncated path)\n  const newTruncatedPathString =\n    newPathStart > 0\n      ? `...${fullRequestPath.substr(newPathStart + 3)}`\n      : fullRequestPath;\n  // Only update the HTMLElement's inner-text if the string value changed\n  // after truncation (to avoid unnecessary rerenders of component)\n  if (pathHtmlElement.textContent !== newTruncatedPathString) {\n    pathHtmlElement.textContent = newTruncatedPathString;\n  }\n}\n\ninterface Props {\n  resourcePath: string;\n  setShowCopyNotification: (value: boolean) => void;\n  requestPathContainerWidth?: number;\n}\n\nconst RequestPath: React.FC<Props> = ({\n  resourcePath,\n  setShowCopyNotification,\n  requestPathContainerWidth,\n}) => {\n  const pathTextRef = useRef<HTMLDivElement>(null);\n  const copyButtonRef = useRef<HTMLButtonElement>(null);\n  const [prevPathContainerWidth, setPrevPathContainerWidth] = useState<\n    number | undefined\n  >();\n\n  useEffect(() => {\n    // truncate request-path only if the width of the pathContainer changed\n    if (requestPathContainerWidth !== prevPathContainerWidth) {\n      truncateRequestPathFromLeft(\n        pathTextRef,\n        copyButtonRef,\n        resourcePath,\n        requestPathContainerWidth\n      );\n    }\n  }, [\n    pathTextRef,\n    copyButtonRef,\n    resourcePath,\n    requestPathContainerWidth,\n    prevPathContainerWidth,\n  ]);\n\n  // record previous width (useful to identify if the width changed)\n  useEffect(() => {\n    setPrevPathContainerWidth(requestPathContainerWidth);\n  }, [requestPathContainerWidth, setPrevPathContainerWidth]);\n\n  return (\n    <div className=\"Firestore-Request-Path-Container\">\n      <Tooltip content={resourcePath} align=\"bottomLeft\" enterDelay={400}>\n        <div\n          className=\"Firestore-Request-Path-String\"\n          ref={pathTextRef}\n          data-testid=\"request-path-text\"\n        >\n          {resourcePath}\n        </div>\n      </Tooltip>\n      <Tooltip content=\"Copy path\" align=\"bottom\" enterDelay={400}>\n        <IconButton\n          className=\"Firestore-Request-Path-Copy-Button\"\n          ref={copyButtonRef}\n          icon=\"content_copy\"\n          onClick={(event: React.MouseEvent<HTMLElement>) => {\n            event.preventDefault();\n            event.stopPropagation();\n            copyPathToClipboard(resourcePath, setShowCopyNotification);\n          }}\n        />\n      </Tooltip>\n    </div>\n  );\n};\n\nexport default RequestPath;\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './index.scss';\n\nimport { Icon } from '@rmwc/icon';\nimport { IconButton } from '@rmwc/icon-button';\nimport { Theme } from '@rmwc/theme';\nimport { Tooltip } from '@rmwc/tooltip';\nimport React, { useRef } from 'react';\nimport { Link } from 'react-router-dom';\n\nimport { CustomThemeProvider } from '../../../../../themes';\nimport RequestPath from '../../RequestPath';\nimport { OutcomeData } from '../../types';\nimport { usePathContainerWidth } from '../../utils';\n\ninterface Props {\n  requestTimeComplete?: string;\n  requestTimeFormatted?: string;\n  requestMethod?: string;\n  resourcePath?: string;\n  outcomeData?: OutcomeData;\n  setShowCopyNotification: (value: boolean) => void;\n}\n\nconst RequestDetailsHeader: React.FC<Props> = ({\n  requestTimeComplete,\n  requestTimeFormatted,\n  requestMethod,\n  resourcePath,\n  outcomeData,\n  setShowCopyNotification,\n}) => {\n  const pathContainerRef = useRef<HTMLDivElement>(null);\n  const requestPathContainerWidth = usePathContainerWidth(pathContainerRef);\n\n  return (\n    <Theme use=\"surface\" wrap>\n      <div\n        data-testid=\"request-details-header\"\n        className=\"Firestore-Request-Details-Header\"\n      >\n        <div className=\"Firestore-Request-Details-Header-Return\">\n          <Tooltip content=\"Go back to table\" align=\"bottom\" enterDelay={100}>\n            <IconButton\n              className=\"Firestore-Request-Details-Header-Return-Button\"\n              icon={{ icon: 'arrow_back_ios', size: 'small' }}\n              tag={Link}\n              to=\"/firestore/requests\"\n              label=\"header-return-button\"\n            />\n          </Tooltip>\n        </div>\n        <div className=\"Firestore-Request-Details-Header-Info\">\n          <Theme use=\"secondary\">\n            <Tooltip\n              content={requestTimeComplete}\n              align=\"bottom\"\n              enterDelay={300}\n            >\n              <div className=\"Firestore-Request-Date\">\n                {requestTimeFormatted}\n              </div>\n            </Tooltip>\n          </Theme>\n          <CustomThemeProvider use={outcomeData?.theme || 'note'} wrap>\n            <div className=\"Firestore-Request-Outcome\">\n              {outcomeData?.icon && (\n                <Tooltip\n                  content={outcomeData?.label}\n                  align=\"bottom\"\n                  enterDelay={100}\n                >\n                  <Icon\n                    className=\"Firestore-Request-Outcome-Icon\"\n                    icon={{ icon: outcomeData?.icon, size: 'medium' }}\n                  />\n                </Tooltip>\n              )}\n            </div>\n          </CustomThemeProvider>\n          <div className=\"Firestore-Request-Method\">{requestMethod}</div>\n          <div className=\"Firestore-Request-Path\" ref={pathContainerRef}>\n            {resourcePath && (\n              <RequestPath\n                resourcePath={resourcePath}\n                setShowCopyNotification={setShowCopyNotification}\n                requestPathContainerWidth={requestPathContainerWidth}\n              />\n            )}\n          </div>\n        </div>\n      </div>\n    </Theme>\n  );\n};\n\nexport default RequestDetailsHeader;\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './InspectionBlock.scss';\n\nimport { Icon } from '@rmwc/icon';\nimport { Theme, ThemeProvider } from '@rmwc/theme';\nimport classnames from 'classnames';\nimport React, { useState } from 'react';\n\nimport { grey100, textBlackTertiary } from '../../../../../colors';\nimport { ExpressionValue } from '../../../DocumentPreview/ExpressionValue';\nimport { FieldPreview } from '../../../DocumentPreview/FieldPreview';\nimport { ExpressionValueStateProvider } from '../../../DocumentPreview/store';\n\nconst INSPECT_BLOCK_CLASS = 'Firestore-Request-Details-Inspection-Block';\nconst MAIN_INSPECT_BLOCK_CLASS = INSPECT_BLOCK_CLASS + '--Main';\n\nconst MAIN_INSPECT_BLOCK_BACKGROUND_COLOR = '#e2e2e2';\n\ninterface Props {\n  label: string;\n  value: ExpressionValue;\n  isMainBlock?: boolean;\n}\n\nexport const InspectionBlock: React.FC<Props> = ({\n  label,\n  value,\n  isMainBlock,\n  children,\n}) => {\n  // Main inspection-blocks start expanded by default\n  const [isExpanded, setIsExpanded] = useState<boolean>(!!isMainBlock);\n\n  // NOTE: the content of the InspectionBlock could be either a string\n  // (passed through the value property) or HTML children elements.\n  const renderContent = () => {\n    if (children) {\n      return children;\n    }\n\n    return (\n      <Theme use=\"secondary\">\n        <div className={`${INSPECT_BLOCK_CLASS}-Value`}>\n          <ExpressionValueStateProvider value={value}>\n            <div className=\"Firestore-Field-List mdc-list--non-interactive\">\n              <FieldPreview path={[]} maxSummaryLen={20} />\n            </div>\n          </ExpressionValueStateProvider>\n        </div>\n      </Theme>\n    );\n  };\n\n  return (\n    <ThemeProvider\n      options={{\n        surface: isMainBlock ? MAIN_INSPECT_BLOCK_BACKGROUND_COLOR : grey100,\n        textIconOnLight: textBlackTertiary,\n      }}\n    >\n      <Theme use=\"surface\" wrap>\n        <div\n          className={classnames(\n            INSPECT_BLOCK_CLASS,\n            isMainBlock && MAIN_INSPECT_BLOCK_CLASS\n          )}\n          onClick={() => setIsExpanded(!isExpanded)}\n          data-testid={\n            isMainBlock ? 'inspection-main-block' : 'inspection-block'\n          }\n        >\n          <span className={`${INSPECT_BLOCK_CLASS}-Label`}>{label}</span>\n          <Theme use=\"textIconOnLight\">\n            <Icon\n              className={`${INSPECT_BLOCK_CLASS}-Icon`}\n              icon={{ icon: isExpanded ? 'expand_less' : 'expand_more' }}\n            />\n          </Theme>\n        </div>\n      </Theme>\n      {isExpanded && renderContent()}\n    </ThemeProvider>\n  );\n};\n\nexport default InspectionBlock;\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './index.scss';\n\nimport React from 'react';\n\nimport { InspectionElement } from '../../types';\nimport InspectionBlock from './InspectionBlock';\n\nexport const EXPRESSIONS_INSPECTION_LABEL = 'Detailed information';\nexport const NOTHING_TO_SHOW_MESSAGE = 'Nothing to show here';\n\ninterface Props {\n  inspectionExpressions?: InspectionElement[];\n}\n\nconst InspectionSection: React.FC<Props> = ({ inspectionExpressions }) => {\n  const renderInspectionContent = () => {\n    if (!inspectionExpressions?.length) {\n      return (\n        <span className=\"Firestore-Request-Details-Inspection-Nothing-To-Show\">\n          {NOTHING_TO_SHOW_MESSAGE}\n        </span>\n      );\n    }\n    return inspectionExpressions.map(({ label, value }) => (\n      <InspectionBlock key={label} label={label} value={value} />\n    ));\n  };\n\n  return (\n    <div\n      data-testid=\"request-details-inspection-section\"\n      className=\"Firestore-Request-Details-Inspection\"\n    >\n      <InspectionBlock\n        isMainBlock\n        label={EXPRESSIONS_INSPECTION_LABEL}\n        value={{ nullValue: null }}\n      >\n        {renderInspectionContent()}\n      </InspectionBlock>\n    </div>\n  );\n};\n\nexport default InspectionSection;\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './index.scss';\n\nimport React from 'react';\nimport { Redirect } from 'react-router-dom';\n\nimport { useFirestoreRequest } from '../FirestoreRequestsProvider';\nimport { RequestDetailsRouteParams } from '../index';\nimport {\n  FirestoreRulesContext,\n  FirestoreRulesEvaluation,\n  FirestoreRulesIssue,\n  OutcomeInfo,\n  RulesOutcome,\n} from '../rules_evaluation_result_model';\nimport { InspectionElement, OutcomeData } from '../types';\nimport { OUTCOME_DATA } from '../utils';\nimport RequestDetailsCodeViewer from './CodeViewer/index';\nimport RequestDetailsHeader from './Header/index';\nimport RequestDetailsInspectionSection from './InspectionSection/index';\n\n// Combines (granularAllowOutcomes) and (issues) into one array of the same type\nfunction getLinesOutcome(\n  granularAllowOutcomes: OutcomeInfo[],\n  issues?: FirestoreRulesIssue[]\n): OutcomeInfo[] {\n  return [\n    ...granularAllowOutcomes,\n    ...(issues?.map(\n      ({ line }): OutcomeInfo => {\n        return { outcome: 'error', line };\n      }\n    ) || []),\n  ];\n}\n// Transforms the (rulesContext) data into InspectionElements\nfunction getInspectionExpressions(\n  rulesContext: FirestoreRulesContext,\n  outcome: RulesOutcome\n): InspectionElement[] {\n  if (outcome === 'admin') {\n    return [];\n  }\n\n  const inspections: InspectionElement[] = [];\n\n  // List all fields from rules `request.*`. See doc below for details.\n  // https://firebase.google.com/docs/reference/rules/rules.firestore.Request\n  for (const field of ['auth', 'method', 'path', 'query', 'resource', 'time']) {\n    const value = rulesContext.request.mapValue?.fields?.[field];\n    if (value) {\n      inspections.push({\n        label: `request.${field}`,\n        value: value,\n      });\n    }\n  }\n\n  if (rulesContext.resource) {\n    inspections.push({\n      label: 'resource',\n      value: rulesContext.resource,\n    });\n  }\n\n  return inspections;\n}\ninterface DetailedRequestData {\n  requestTimeComplete?: string;\n  requestTimeFormatted?: string;\n  requestMethod?: string;\n  resourcePath?: string;\n  outcome?: RulesOutcome;\n  outcomeData?: OutcomeData;\n  firestoreRules?: string;\n  linesOutcome?: OutcomeInfo[];\n  inspectionExpressions?: InspectionElement[];\n}\n// Outputs (in a clean format) the request data used by the RequestDetails component\nexport function getDetailsRequestData(\n  request?: FirestoreRulesEvaluation\n): DetailedRequestData {\n  if (!request) {\n    return {};\n  }\n  const { rulesContext, granularAllowOutcomes, rules, outcome } = request;\n  // (time * 1000) converts timestamp units from seconds to milliseconds\n  const requestDate = new Date(rulesContext.time);\n  return {\n    requestTimeComplete: requestDate.toLocaleString(),\n    requestTimeFormatted: requestDate.toLocaleTimeString('en-US', {\n      hour12: false,\n    }),\n    requestMethod: rulesContext.method,\n    resourcePath: rulesContext.path.replace(\n      '/databases/(default)/documents',\n      ''\n    ),\n    outcome,\n    outcomeData: OUTCOME_DATA[outcome],\n    firestoreRules: rules,\n    linesOutcome: getLinesOutcome(granularAllowOutcomes),\n    inspectionExpressions: getInspectionExpressions(rulesContext, outcome),\n  };\n}\n\ninterface PropsFromParentComponent extends RequestDetailsRouteParams {\n  setShowCopyNotification: (value: boolean) => void;\n}\n\ninterface Props extends PropsFromParentComponent {\n  selectedRequest: FirestoreRulesEvaluation | undefined;\n}\n\nexport const RequestDetails: React.FC<Props> = ({\n  selectedRequest,\n  requestId,\n  setShowCopyNotification,\n}) => {\n  const {\n    requestTimeComplete,\n    requestTimeFormatted,\n    requestMethod,\n    resourcePath,\n    outcome,\n    outcomeData,\n    firestoreRules,\n    linesOutcome,\n    inspectionExpressions,\n  } = getDetailsRequestData(selectedRequest);\n\n  // Redirect to requests-table if (requestId) did not match any existing request\n  if (requestId && !selectedRequest) {\n    return <Redirect to=\"/firestore/requests\" />;\n  }\n\n  return (\n    <div data-testid=\"request-details\">\n      {selectedRequest && (\n        <>\n          <RequestDetailsHeader\n            requestTimeComplete={requestTimeComplete}\n            requestTimeFormatted={requestTimeFormatted}\n            requestMethod={requestMethod}\n            resourcePath={resourcePath}\n            outcomeData={outcomeData}\n            setShowCopyNotification={setShowCopyNotification}\n          />\n          <div className=\"Firestore-Request-Details-Content\">\n            <RequestDetailsCodeViewer\n              firestoreRules={firestoreRules}\n              linesOutcome={linesOutcome}\n              isAdminRequest={outcome === 'admin'}\n            />\n            <RequestDetailsInspectionSection\n              inspectionExpressions={inspectionExpressions}\n            />\n          </div>\n        </>\n      )}\n    </div>\n  );\n};\n\nexport const RequestDetailsWrapper: React.FC<PropsFromParentComponent> = (\n  props\n) => {\n  const selectedRequest = useFirestoreRequest(props.requestId);\n\n  return <RequestDetails selectedRequest={selectedRequest} {...props} />;\n};\nexport default RequestDetailsWrapper;\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './NoResults.scss';\n\nimport { Typography } from '@rmwc/typography';\nimport React from 'react';\n\nexport const NO_RESULTS_MESSAGE = 'No results';\n\nconst RequestsNoResults: React.FC = () => {\n  return (\n    <Typography\n      use=\"body2\"\n      aria-live=\"polite\"\n      theme=\"textSecondaryOnBackground\"\n      className=\"Firestore-Requests-Table-No-Results\"\n    >\n      {NO_RESULTS_MESSAGE}\n    </Typography>\n  );\n};\n\nexport default RequestsNoResults;\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './index.scss';\n\nimport { DataTableCell, DataTableRow } from '@rmwc/data-table';\nimport { Icon } from '@rmwc/icon';\nimport { Tooltip } from '@rmwc/tooltip';\nimport React from 'react';\nimport { useHistory } from 'react-router-dom';\n\nimport { CustomThemeProvider } from '../../../../../themes';\nimport RequestPath from '../../RequestPath';\nimport { FirestoreRulesEvaluation } from '../../rules_evaluation_result_model';\nimport { OutcomeData } from '../../types';\nimport { OUTCOME_DATA } from '../../utils';\n\ninterface TableRowRequestData {\n  requestTimeComplete: string;\n  requestTimeFormatted: string;\n  requestMethod: string;\n  resourcePath: string;\n  outcomeData: OutcomeData;\n}\n// Outputs (in a clean format) the request data used by the table-row\nfunction getTableRowRequestData(\n  request: FirestoreRulesEvaluation\n): TableRowRequestData {\n  const { rulesContext, outcome, time } = request;\n  const requestDate = new Date(time);\n  return {\n    requestTimeComplete: requestDate.toLocaleString(),\n    requestTimeFormatted: requestDate.toLocaleTimeString('en-US', {\n      hour12: false,\n    }),\n    requestMethod: rulesContext.method,\n    resourcePath: rulesContext.path.replace(\n      '/databases/(default)/documents',\n      ''\n    ),\n    outcomeData: OUTCOME_DATA[outcome],\n  };\n}\n\ninterface Props {\n  request: FirestoreRulesEvaluation;\n  requestId: string;\n  setShowCopyNotification: (value: boolean) => void;\n  requestPathContainerWidth?: number;\n}\n\nconst RequestTableRow: React.FC<Props> = ({\n  request,\n  requestId,\n  setShowCopyNotification,\n  requestPathContainerWidth,\n}) => {\n  const history = useHistory();\n  const {\n    requestTimeComplete,\n    requestTimeFormatted,\n    requestMethod,\n    resourcePath,\n    outcomeData,\n  } = getTableRowRequestData(request);\n\n  return (\n    <DataTableRow\n      onClick={() => history.push(`/firestore/requests/${requestId}`)}\n    >\n      <Tooltip\n        content={requestTimeComplete}\n        align=\"bottomLeft\"\n        enterDelay={300}\n      >\n        <DataTableCell className=\"Firestore-Request-Date\" theme=\"secondary\">\n          {requestTimeFormatted}\n        </DataTableCell>\n      </Tooltip>\n      <CustomThemeProvider use={outcomeData?.theme || 'note'} wrap>\n        <DataTableCell className=\"Firestore-Request-Outcome\">\n          {outcomeData?.icon && (\n            <Tooltip\n              content={outcomeData?.label}\n              align=\"bottom\"\n              enterDelay={100}\n            >\n              <Icon\n                className=\"Firestore-Request-Outcome-Icon\"\n                icon={{ icon: outcomeData?.icon, size: 'medium' }}\n              />\n            </Tooltip>\n          )}\n        </DataTableCell>\n      </CustomThemeProvider>\n      <DataTableCell className=\"Firestore-Request-Method\">\n        {requestMethod}\n      </DataTableCell>\n      <DataTableCell className=\"Firestore-Request-Path\">\n        {resourcePath && (\n          <RequestPath\n            resourcePath={resourcePath}\n            setShowCopyNotification={setShowCopyNotification}\n            requestPathContainerWidth={requestPathContainerWidth}\n          />\n        )}\n      </DataTableCell>\n    </DataTableRow>\n  );\n};\n\nexport default RequestTableRow;\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport './HighlightedJSON.scss';\n\nimport React from 'react';\n\nimport { CompiledGetterCache } from './CompiledGetterCache';\n\nexport enum HierarchyReferenceMode {\n  NONE,\n  DOT,\n  BRACKET,\n  INCREMENT,\n}\n\nexport interface HierarchyReference {\n  mode: HierarchyReferenceMode;\n  key: number | string;\n}\n\nconst toHierarchyStep = (key: string) => {\n  if (key.match(/^[A-Z|_]+$/i)) {\n    return {\n      mode: HierarchyReferenceMode.DOT,\n      key,\n    };\n  } else {\n    return {\n      mode: HierarchyReferenceMode.BRACKET,\n      key,\n    };\n  }\n};\n\nconst toHierarchyJS = (hierarchy: HierarchyReference[]) =>\n  hierarchy\n    .map((ref) => {\n      switch (ref.mode) {\n        case HierarchyReferenceMode.NONE:\n          return ref.key;\n        case HierarchyReferenceMode.BRACKET:\n          return `[\"${ref.key}\"]`;\n        case HierarchyReferenceMode.DOT:\n          return `.${ref.key}`;\n        case HierarchyReferenceMode.INCREMENT:\n          return `[${JSON.stringify(ref.key)}]`;\n      }\n\n      return '';\n    })\n    .join('');\n\nexport interface Props {\n  data: object;\n  appendToQuery: (key: string, value: string) => void;\n  compiledGetters: CompiledGetterCache;\n}\n\nexport const HighlightedJSON: React.FC<Props> = ({\n  data,\n  appendToQuery,\n  compiledGetters,\n}) => {\n  const lines = JSON.stringify(data, null, 2).split('\\n');\n\n  if (lines.length === 1)\n    return <div className=\"log-message-single\">{data}</div>;\n\n  let isObject = false;\n\n  let hierarchy: HierarchyReference[] = [\n    {\n      mode: HierarchyReferenceMode.NONE,\n      key: 'user',\n    },\n  ];\n\n  const pluck = (obj: any, path: string) => {\n    return compiledGetters.getOrCompile(path, { user: obj });\n  };\n\n  const elements = lines.map((line, index) => {\n    const quote_count = line.split('\"').length - 1;\n\n    const isStart = index === 0 && line.startsWith('{');\n    const isEnd = index === lines.length - 1 && line.endsWith('}');\n\n    const isEmptyArray = line.endsWith('[]') || line.endsWith('[],');\n    const isEmptyObj = line.endsWith('{}') || line.endsWith('{},');\n\n    const isKeyedObjStart =\n      quote_count >= 2 && (line.endsWith('{') || isEmptyObj);\n    const isKeyedArrayStart =\n      quote_count >= 2 && (line.endsWith('[') || isEmptyArray);\n\n    const isKeylessArrayStart =\n      !isKeyedArrayStart && (line.endsWith('[') || isEmptyArray);\n    const isKeylessObjStart =\n      !isKeylessArrayStart && (line.endsWith('{') || isEmptyObj);\n\n    const isLiteral =\n      !line.endsWith('[') &&\n      !line.endsWith('{') &&\n      !line.endsWith('}') &&\n      !line.endsWith('},');\n\n    const isObjEnd = line.endsWith('}') || line.endsWith('},');\n    const isArrayEnd = line.endsWith(']') || line.endsWith('],');\n\n    if (isStart) {\n      isObject = true;\n      return (\n        <div key={index} className=\"line start\">\n          {line}\n        </div>\n      );\n    }\n\n    if (isEnd) {\n      return (\n        <div key={index} className=\"line end\">\n          {line}\n        </div>\n      );\n    }\n\n    if (isKeylessObjStart || isKeylessArrayStart || isLiteral) {\n      const ref = hierarchy[hierarchy.length - 1];\n      if (ref.mode === HierarchyReferenceMode.INCREMENT) {\n        (ref as any).key += 1;\n      }\n    }\n\n    if (isKeylessObjStart) {\n      hierarchy.push({ mode: HierarchyReferenceMode.NONE, key: '' });\n    }\n\n    if (isKeylessArrayStart) {\n      hierarchy.push({ mode: HierarchyReferenceMode.NONE, key: '' });\n      hierarchy.push({ mode: HierarchyReferenceMode.INCREMENT, key: -1 });\n    }\n\n    if (isKeyedObjStart || isKeyedArrayStart) {\n      const [start, ...splat] = line.split(':');\n      const [indent, ...key_chunks] = start.split('\"');\n      const key = key_chunks.filter((v: string) => v).join('\"');\n      const value = splat.join(':');\n\n      hierarchy.push(toHierarchyStep(key));\n      const hierarchy_chain = toHierarchyJS(hierarchy);\n\n      if (isKeyedArrayStart) {\n        hierarchy.push({ mode: HierarchyReferenceMode.INCREMENT, key: -1 });\n      }\n\n      if (isArrayEnd) {\n        hierarchy.pop(); // Remove reference with array name (i.e. \"users\")\n        hierarchy.pop(); // Remove reference with array index (i.e. 3)\n      }\n\n      if (isObjEnd) {\n        hierarchy.pop();\n      }\n\n      return (\n        <div key={index} className=\"line object-start\">\n          {indent}\n          <div\n            className=\"clickable key\"\n            onClick={() => appendToQuery(hierarchy_chain, '*')}\n          >\n            \"{key}\"\n          </div>\n          :{value}\n        </div>\n      );\n    }\n\n    if (isObjEnd) {\n      if (\n        hierarchy[hierarchy.length - 1].mode !==\n        HierarchyReferenceMode.INCREMENT\n      ) {\n        hierarchy.pop();\n      }\n      return (\n        <div key={index} className=\"line object-end\">\n          {line}\n        </div>\n      );\n    }\n\n    if (isArrayEnd) {\n      hierarchy.pop(); // Remove reference with array name (i.e. \"users\")\n      hierarchy.pop(); // Remove reference with array index (i.e. 3)\n\n      return (\n        <div key={index} className=\"line array-end\">\n          {line}\n        </div>\n      );\n    }\n\n    if (isLiteral) {\n      if (!isObject) {\n        return (\n          <div key={index} className=\"line literal\">\n            <div className=\"value clickable\">{line}</div>\n          </div>\n        );\n      }\n\n      const [start, ...splat] = line.split(':');\n      const key_chunks = start.split('\"').slice(1);\n      const key = key_chunks.filter((v: string) => v).join('\"');\n      const value = splat.join(':').trim();\n\n      const new_indent = new Array(line.length - line.trim().length + 1).join(\n        ' '\n      );\n      if (key && value) {\n        const hierarchy_chain = toHierarchyJS([\n          ...hierarchy,\n          toHierarchyStep(key),\n        ]);\n        return (\n          <div key={index} className=\"line literal\">\n            {new_indent}\n            <div\n              className=\"key clickable\"\n              onClick={() => appendToQuery(hierarchy_chain, '*')}\n            >\n              \"{key}\"\n            </div>\n            :{' '}\n            <div\n              className=\"clickable value\"\n              onClick={() =>\n                appendToQuery(hierarchy_chain, pluck(data, hierarchy_chain))\n              }\n            >\n              {value}\n            </div>\n          </div>\n        );\n      } else {\n        const hierarchy_chain = toHierarchyJS(hierarchy);\n        return (\n          <div key={index} className=\"line literal\">\n            {new_indent}\n            <div\n              className=\"clickable value\"\n              onClick={() =>\n                appendToQuery(hierarchy_chain, pluck(data, hierarchy_chain))\n              }\n            >\n              {line.trim()}\n            </div>\n          </div>\n        );\n      }\n    }\n\n    return (\n      <div key={index} className={`line generic`}>\n        {line}\n      </div>\n    );\n  });\n\n  return <div className=\"HighlightedJSON\">{elements}</div>;\n};\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './ZeroState.scss';\n\nimport { Typography } from '@rmwc/typography';\nimport React from 'react';\n\nexport const ZERO_STATE_MESSAGE = 'No Firestore requests for this project yet';\n\nconst RequestsZeroState: React.FC = () => {\n  return (\n    <Typography\n      use=\"body2\"\n      theme=\"textSecondaryOnBackground\"\n      className=\"Firestore-Requests-Table-Zero-State\"\n    >\n      {ZERO_STATE_MESSAGE}\n    </Typography>\n  );\n};\n\nexport default RequestsZeroState;\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './index.scss';\n\nimport {\n  DataTable,\n  DataTableBody,\n  DataTableContent,\n  DataTableHead,\n  DataTableHeadCell,\n  DataTableRow,\n} from '@rmwc/data-table';\nimport classnames from 'classnames';\nimport React, { useRef } from 'react';\n\nimport { Callout } from '../../../../common/Callout';\nimport { useFirestoreRequests } from '../../FirestoreRequestsProvider';\nimport { FirestoreRulesEvaluation } from '../../rules_evaluation_result_model';\nimport { usePathContainerWidth } from '../../utils';\nimport RequestsNoResults from './NoResults';\nimport RequestsTableRow from './TableRow';\nimport RequestsZeroState from './ZeroState';\n\nconst TABLE_CLASS = 'Firestore-Requests-Table';\nconst EMPTY_TABLE_CLASS = TABLE_CLASS + '--Empty';\n\ninterface Props {\n  filteredRequests: FirestoreRulesEvaluation[];\n  shouldShowZeroState: boolean;\n  shouldShowZeroResults: boolean;\n  shouldShowTable: boolean;\n  setShowCopyNotification: (show: boolean) => void;\n}\n\nexport const RequestsTable: React.FC<Props> = ({\n  filteredRequests,\n  shouldShowZeroState,\n  shouldShowZeroResults,\n  shouldShowTable,\n  setShowCopyNotification,\n}) => {\n  // References the path header because it has always the same width\n  // as the path column, but it renders only once.\n  const pathContainerRef = useRef<HTMLDivElement>(null);\n  const requestPathContainerWidth = usePathContainerWidth(pathContainerRef);\n\n  return (\n    <div className={`${TABLE_CLASS}-Main-Container`}>\n      <DataTable\n        className={classnames(\n          TABLE_CLASS,\n          !shouldShowTable && EMPTY_TABLE_CLASS\n        )}\n      >\n        <DataTableContent>\n          <DataTableHead theme=\"surface\">\n            <DataTableRow>\n              {/* TODO: add onSortChange to toggle sorting value when sorting functionality is ready */}\n              <DataTableHeadCell className={`${TABLE_CLASS}-Date-Header`}>\n                Time\n              </DataTableHeadCell>\n              <DataTableHeadCell\n                className={`${TABLE_CLASS}-Outcome-Header`}\n              ></DataTableHeadCell>\n              <DataTableHeadCell\n                className={`${TABLE_CLASS}-Method-Header`}\n                theme=\"secondary\"\n              >\n                Method\n              </DataTableHeadCell>\n              <DataTableHeadCell\n                className={`${TABLE_CLASS}-Path-Header`}\n                theme=\"secondary\"\n              >\n                {/*\n                  (ref) is placed on an inner div to avoid the padding of the Table Header\n                  from modifying the returned value of the path container's real width\n                */}\n                <div ref={pathContainerRef}>Path</div>\n              </DataTableHeadCell>\n            </DataTableRow>\n          </DataTableHead>\n          <DataTableBody>\n            {shouldShowTable &&\n              filteredRequests?.map((request: FirestoreRulesEvaluation) => {\n                const { requestId } = request;\n                return (\n                  <RequestsTableRow\n                    key={requestId}\n                    requestId={requestId}\n                    request={request}\n                    setShowCopyNotification={setShowCopyNotification}\n                    requestPathContainerWidth={requestPathContainerWidth}\n                  />\n                );\n              })}\n          </DataTableBody>\n        </DataTableContent>\n      </DataTable>\n      {shouldShowZeroResults && <RequestsNoResults />}\n      {shouldShowZeroState && <RequestsZeroState />}\n      <Callout type=\"note\">\n        Only client requests are shown above.{' '}\n        <a href=\"https://firebase.google.com/docs/admin/setup\">Admin SDK</a>{' '}\n        requests and{' '}\n        <a href=\"https://firebase.google.com/docs/firestore/security/rules-conditions#access_other_documents\">\n          access calls initiated by Security Rules\n        </a>{' '}\n        are not listed because they bypass Security Rules.\n      </Callout>\n    </div>\n  );\n};\n\nexport const RequestsTableWrapper: React.FC<{\n  setShowCopyNotification: (show: boolean) => void;\n}> = ({ setShowCopyNotification }) => {\n  const evaluations = useFirestoreRequests().requests;\n\n  // TODO: Add support for filtering.\n  const filteredEvaluations = evaluations;\n\n  return (\n    <RequestsTable\n      filteredRequests={filteredEvaluations}\n      shouldShowZeroState={evaluations.length === 0}\n      shouldShowZeroResults={\n        evaluations.length > 0 && filteredEvaluations.length === 0\n      }\n      shouldShowTable={filteredEvaluations.length > 0}\n      setShowCopyNotification={setShowCopyNotification}\n    />\n  );\n};\n\nexport default RequestsTableWrapper;\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ThemeProvider } from '@rmwc/theme';\nimport React, { useState } from 'react';\nimport { Redirect, Route, RouteComponentProps, Switch } from 'react-router-dom';\n\nimport { grey100 } from '../../../colors';\nimport { EmulatorOutdated } from '../../common/EmulatorDisabled';\nimport CopyPathNotification from './CopyPathNotification';\nimport { useIsFirestoreRequestsAvailable } from './FirestoreRequestsProvider';\nimport RequestDetails from './RequestDetails';\n// import RequestsHeader from './RequestsCard/Header';\nimport RequestsTable from './RequestsCard/Table';\n\nexport interface RequestDetailsRouteParams {\n  requestId: string;\n}\n\nconst Requests: React.FC = () => {\n  const [showCopyNotification, setShowCopyNotification] = useState<boolean>(\n    false\n  );\n  const isRequestsAvailable = useIsFirestoreRequestsAvailable();\n  if (!isRequestsAvailable) {\n    return <EmulatorOutdated productName=\"Firestore\" />;\n  }\n\n  return (\n    <>\n      <ThemeProvider\n        options={{\n          surface: grey100,\n        }}\n        style={{ flex: 1 }}\n      >\n        <Switch>\n          <Route exact path=\"/firestore/requests\">\n            <div data-testid=\"requests-card\">\n              {/* TODO: Finish developing the RequestsHeader in order to render it */}\n              {/* <RequestsHeader /> */}\n              <RequestsTable\n                setShowCopyNotification={setShowCopyNotification}\n              />\n            </div>\n          </Route>\n          <Route\n            exact\n            path=\"/firestore/requests/:requestId\"\n            render={({\n              match,\n            }: RouteComponentProps<RequestDetailsRouteParams>) => {\n              const requestId = match.params.requestId;\n              return (\n                <RequestDetails\n                  requestId={requestId}\n                  setShowCopyNotification={setShowCopyNotification}\n                />\n              );\n            }}\n          />\n          <Redirect to=\"/firestore/requests\" />\n        </Switch>\n        <CopyPathNotification\n          showCopyNotification={showCopyNotification}\n          setShowCopyNotification={setShowCopyNotification}\n        />\n      </ThemeProvider>\n    </>\n  );\n};\n\nexport default Requests;\n","/**\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './index.scss';\n\nimport { Button } from '@rmwc/button';\nimport { Card } from '@rmwc/card';\nimport { Elevation } from '@rmwc/elevation';\nimport { GridCell } from '@rmwc/grid';\nimport { Tab, TabBar } from '@rmwc/tabs';\nimport React, { Suspense, useState } from 'react';\nimport {\n  Link,\n  Redirect,\n  Route,\n  Switch,\n  matchPath,\n  useHistory,\n  useLocation,\n} from 'react-router-dom';\n\nimport { CustomThemeProvider } from '../../themes';\nimport { useIsEmulatorDisabled } from '../common/EmulatorConfigProvider';\nimport { EmulatorDisabled } from '../common/EmulatorDisabled';\nimport { InteractiveBreadCrumbBar } from '../common/InteractiveBreadCrumbBar';\nimport { Spinner } from '../common/Spinner';\nimport { promptClearAll } from './dialogs/clearAll';\nimport { Root } from './Document';\nimport {\n  FirestoreEmulatedApiProvider,\n  useEjector,\n} from './FirestoreEmulatedApiProvider';\nimport PanelHeader from './PanelHeader';\nimport FirestoreRequests from './Requests';\nimport { FirestoreStore } from './store';\n\nexport const FirestoreRoute: React.FC = () => {\n  return (\n    <Suspense fallback={<FirestoreRouteSuspended />}>\n      <FirestoreEmulatedApiProvider>\n        <Firestore />\n      </FirestoreEmulatedApiProvider>\n    </Suspense>\n  );\n};\n\nexport default FirestoreRoute;\n\ninterface FirestoreTabRoute {\n  path: string;\n  label: string;\n  exact: boolean;\n}\nconst firestoreRoutes: ReadonlyArray<FirestoreTabRoute> = [\n  {\n    path: '/firestore/data',\n    label: 'Data',\n    exact: false,\n  },\n  {\n    path: '/firestore/requests',\n    label: 'Requests',\n    exact: false,\n  },\n];\n\nexport const Firestore: React.FC = React.memo(() => {\n  const location = useLocation();\n  const history = useHistory();\n  const [isRefreshing, setIsRefreshing] = useState(false);\n  const eject = useEjector();\n\n  // TODO: do something better here!\n  const path = location.pathname.replace(/^\\/firestore\\/data/, '');\n  const showCollectionShell = path.split('/').length < 2;\n  const showDocumentShell = path.split('/').length < 3;\n\n  const subTabs = firestoreRoutes.map(({ path, label }: FirestoreTabRoute) => (\n    <Tab\n      key={label}\n      className=\"mdc-tab--min-width\"\n      {...{ tag: Link, to: path }}\n    >\n      {label}\n    </Tab>\n  ));\n  const activeTabIndex = firestoreRoutes.findIndex((r) =>\n    matchPath(location.pathname, {\n      path: r.path,\n      exact: r.exact,\n    })\n  );\n\n  async function handleClearData() {\n    const shouldNuke = await promptClearAll();\n    if (!shouldNuke) return;\n    setIsRefreshing(true);\n    await eject();\n    handleNavigate();\n    setIsRefreshing(false);\n  }\n\n  function handleNavigate(path?: string) {\n    // TODO: move to routing constants\n    const root = '/firestore/data';\n    if (path === undefined) {\n      history.push(root);\n    } else {\n      history.push(`${root}/${path}`);\n    }\n  }\n\n  return isRefreshing ? (\n    <Spinner span={12} data-testid=\"firestore-loading\" />\n  ) : (\n    <FirestoreStore>\n      <GridCell span={12} className=\"Firestore\">\n        <div className=\"Firestore-sub-tabs\">\n          <TabBar theme=\"onSurface\" activeTabIndex={activeTabIndex}>\n            {subTabs}\n          </TabBar>\n        </div>\n\n        <Switch>\n          <Route path=\"/firestore/data\">\n            <FirestoreDataCard\n              path={path}\n              handleClearData={handleClearData}\n              handleNavigate={handleNavigate}\n              showCollectionShell={showCollectionShell}\n              showDocumentShell={showDocumentShell}\n            />\n          </Route>\n          <Route path=\"/firestore/requests\">\n            <FirestoreRequestsCard />\n          </Route>\n          <Redirect from=\"/firestore\" to=\"/firestore/data\" />\n        </Switch>\n      </GridCell>\n    </FirestoreStore>\n  );\n});\n\ninterface FirestoreDataCardProps {\n  path: string;\n  handleClearData: () => void;\n  handleNavigate: (path?: string) => void;\n  showCollectionShell: boolean;\n  showDocumentShell: boolean;\n}\n\nconst FirestoreDataCard: React.FC<FirestoreDataCardProps> = ({\n  path,\n  handleClearData,\n  handleNavigate,\n  showCollectionShell,\n  showDocumentShell,\n}) => (\n  <>\n    <div className=\"Firestore-actions\">\n      <CustomThemeProvider use=\"warning\" wrap>\n        <Button unelevated onClick={() => handleClearData()}>\n          Clear all data\n        </Button>\n      </CustomThemeProvider>\n    </div>\n    <Elevation z=\"2\" wrap>\n      <Card className=\"Firestore-panels-wrapper\">\n        <InteractiveBreadCrumbBar\n          base=\"/firestore/data\"\n          path={path}\n          onNavigate={handleNavigate}\n        />\n        <div className=\"Firestore-panels\">\n          <Root />\n          {showCollectionShell && (\n            <div\n              className=\"Firestore-Collection\"\n              data-testid=\"collection-shell\"\n            >\n              <PanelHeader id=\"\" icon={null} />\n            </div>\n          )}\n          {showDocumentShell && (\n            <div className=\"Firestore-Document\" data-testid=\"document-shell\">\n              <PanelHeader id=\"\" icon={null} />\n            </div>\n          )}\n        </div>\n      </Card>\n    </Elevation>\n  </>\n);\n\nconst FirestoreRequestsCard: React.FC = () => (\n  <Elevation z=\"2\" wrap>\n    <Card className=\"Firestore-panels-wrapper\">\n      <FirestoreRequests />\n    </Card>\n  </Elevation>\n);\n\nconst FirestoreRouteSuspended: React.FC = () => {\n  const isDisabled = useIsEmulatorDisabled('firestore');\n  return isDisabled ? (\n    <EmulatorDisabled productName=\"Firestore\" />\n  ) : (\n    <Spinner span={12} message=\"Firestore Emulator Loading...\" />\n  );\n};\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const storagePath = '/storage/';\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useLocalStorage, writeStorage } from '@rehooks/local-storage';\nimport { Button } from '@rmwc/button';\nimport { GridCell } from '@rmwc/grid';\nimport React from 'react';\n\nimport { Callout } from '../common/Callout';\nimport { CONSOLE_ROOT } from '../common/constants';\n\nconst DISMISS_KEY = 'isLocalWarningCalloutDismissed';\n\nexport const LocalWarningCallout: React.FC<{\n  projectId: string;\n}> = ({ projectId }) => {\n  const [isDismissed] = useLocalStorage<boolean>(DISMISS_KEY);\n\n  if (isDismissed) {\n    return null;\n  }\n\n  return (\n    <GridCell span={12}>\n      <Callout\n        type=\"note\"\n        actions={\n          <>\n            <Button\n              tag=\"a\"\n              href={`${CONSOLE_ROOT}/project/${projectId}/overview`}\n              target=\"_blank\"\n              label=\"View project\"\n            />\n            <Button\n              label=\"Dismiss\"\n              onClick={() => writeStorage(DISMISS_KEY, true)}\n            />\n          </>\n        }\n      >\n        Remember this is a local environment. Visit the production version of{' '}\n        <strong>{projectId}</strong> in the console.\n      </Callout>\n    </GridCell>\n  );\n};\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const CONSOLE_ROOT = 'https://console.firebase.google.com';\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Icon } from '@rmwc/icon';\nimport { Typography } from '@rmwc/typography';\nimport React from 'react';\n\nimport { CustomThemeProvider } from '../../themes';\nimport styles from './StatusLabel.module.scss';\n\nconst ACTIVE_ICON = {\n  icon: 'check_circle',\n  size: 'xsmall',\n};\n\nconst INACTIVE_ICON = {\n  icon: 'block',\n  size: 'xsmall',\n};\n\n/** A basic On/Off label with icon */\nexport const StatusLabel: React.FC<{\n  isActive: boolean;\n}> = ({ isActive }) => {\n  return (\n    <CustomThemeProvider use={isActive ? 'success' : 'note'} wrap>\n      <Typography\n        use=\"headline6\"\n        tag=\"div\"\n        theme={isActive ? 'primary' : 'secondary'}\n        className={styles.container}\n      >\n        {isActive ? 'On' : 'Off'}\n        <Icon\n          icon={isActive ? ACTIVE_ICON : INACTIVE_ICON}\n          className={styles.icon}\n        />\n      </Typography>\n    </CustomThemeProvider>\n  );\n};\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './index.scss';\n\nimport {\n  Card,\n  CardActionButton,\n  CardActionIcons,\n  CardActions,\n} from '@rmwc/card';\nimport { GridCell, GridRow } from '@rmwc/grid';\nimport { ListDivider } from '@rmwc/list';\nimport { Typography } from '@rmwc/typography';\nimport React from 'react';\nimport { Link } from 'react-router-dom';\n\nimport { Config, EmulatorConfig } from '../../store/config';\nimport { useConfigOptional } from '../common/EmulatorConfigProvider';\nimport {\n  AuthIcon,\n  DatabaseIcon,\n  FirestoreIcon,\n  FunctionsIcon,\n  HostingIcon,\n  PubSubIcon,\n  StorageIcon,\n} from '../common/icons';\nimport { Spinner } from '../common/Spinner';\nimport { storagePath } from '../Storage/common/constants';\nimport { LocalWarningCallout } from './LocalWarningCallout';\nimport { StatusLabel } from './StatusLabel';\n\nexport const Home: React.FC = () => {\n  const config = useConfigOptional();\n  if (config === undefined /* initial loading */) {\n    return <Spinner span={12} message=\"Overview Page Loading...\" />;\n  } else {\n    return <Overview config={config || {}} />;\n  }\n};\n\nexport default Home;\n\nconst Overview: React.FC<{\n  config: Partial<Config>;\n}> = ({ config }) => {\n  return (\n    <GridCell span={12}>\n      <GridRow>\n        {config.projectId && (\n          <LocalWarningCallout projectId={config.projectId} />\n        )}\n        <GridCell span={12}>\n          <Typography use=\"headline5\">Emulator overview</Typography>\n        </GridCell>\n        <EmulatorCard\n          name=\"Authentication emulator\"\n          icon={<AuthIcon theme=\"secondary\" />}\n          config={config.auth}\n          linkTo=\"/auth\"\n          testId=\"emulator-info-auth\"\n        />\n        <EmulatorCard\n          name=\"Firestore emulator\"\n          icon={<FirestoreIcon theme=\"secondary\" />}\n          config={config.firestore}\n          linkTo=\"/firestore\"\n          testId=\"emulator-info-firestore\"\n        />\n        <EmulatorCard\n          name=\"Realtime Database emulator\"\n          icon={<DatabaseIcon theme=\"secondary\" />}\n          config={config.database}\n          linkTo=\"/database\"\n          testId=\"emulator-info-database\"\n        />\n        <EmulatorCard\n          name=\"Functions emulator\"\n          icon={<FunctionsIcon theme=\"secondary\" />}\n          config={config.functions}\n          linkTo=\"/functions\"\n          linkLabel=\"View logs\"\n          testId=\"emulator-info-functions\"\n        />\n        <EmulatorCard\n          name=\"Storage emulator\"\n          icon={<StorageIcon />}\n          config={config.storage}\n          linkTo={storagePath}\n          linkLabel=\"Storage\"\n          testId=\"emulator-info-storage\"\n        />\n        <EmulatorCard\n          name=\"Hosting emulator\"\n          icon={<HostingIcon theme=\"secondary\" />}\n          config={config.hosting}\n          testId=\"emulator-info-hosting\"\n          linkToExternal={\n            config.hosting && `http://${config.hosting.hostAndPort}/`\n          }\n          linkLabel=\"View website\"\n        />\n        <EmulatorCard\n          name=\"PubSub emulator\"\n          icon={<PubSubIcon theme=\"secondary\" />}\n          config={config.pubsub}\n          testId=\"emulator-info-pubsub\"\n        />\n      </GridRow>\n    </GridCell>\n  );\n};\n\nexport const EmulatorCard: React.FC<{\n  name: string;\n  icon: React.ReactElement;\n  config: EmulatorConfig | undefined;\n  linkTo?: string;\n  linkToExternal?: string;\n  linkLabel?: string;\n  testId?: string;\n}> = ({ name, icon, config, linkTo, linkLabel, linkToExternal, testId }) => (\n  <GridCell span={4}>\n    <Card className=\"Home-EmulatorCard\" data-testid={testId}>\n      <div className=\"Home-EmulatorCard-Info\">\n        <Typography use=\"headline6\" tag=\"h3\" className=\"title\">\n          {icon} <span>{name}</span>\n        </Typography>\n        <Typography use=\"body2\" tag=\"h4\" theme=\"secondary\">\n          Status\n        </Typography>\n        <StatusLabel isActive={!!config} />\n        <Typography use=\"body2\" tag=\"h4\" theme=\"secondary\">\n          Port number\n        </Typography>\n        <Typography use=\"headline6\" tag=\"div\">\n          {config ? config.port : 'N/A'}\n        </Typography>\n      </div>\n      {(linkToExternal || linkTo) && <ListDivider tag=\"div\" />}\n      <CardActions>\n        <CardActionIcons>\n          {linkToExternal && (\n            <CardActionButton tag=\"a\" href={linkToExternal} target=\"_blank\">\n              {linkLabel}\n            </CardActionButton>\n          )}\n          {linkTo && (\n            <CardActionButton tag={Link} to={linkTo}>\n              {linkLabel || 'Go to emulator'}\n            </CardActionButton>\n          )}\n        </CardActionIcons>\n      </CardActions>\n    </Card>\n  </GridCell>\n);\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport class CompiledGetterCache {\n  getters: { [path: string]: Function } = {};\n\n  getOrCompile(path: string, obj: any) {\n    if (!this.getters[path]) {\n      try {\n        // eslint-disable-next-line no-new-func\n        this.getters[path] = new Function('obj', 'return obj.' + path + ';');\n      } catch (err) {\n        console.warn(err);\n        return undefined;\n      }\n    }\n\n    try {\n      return this.getters[path](obj);\n    } catch (err) {\n      return undefined;\n    }\n  }\n}\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport './QueryBar.scss';\n\nimport { Button } from '@rmwc/button';\nimport React, { useEffect, useState } from 'react';\n\nimport { CompiledGetterCache } from './CompiledGetterCache';\nimport { LogEntry } from './types';\n\nexport const filtersToQueryString = (filters: {\n  [key: string]: string | number;\n}) => {\n  const formattedQueryLines = [];\n  for (const key in filters) {\n    formattedQueryLines.push(`${key}=${JSON.stringify(filters[key])}`);\n  }\n  return formattedQueryLines.sort().join('\\n');\n};\n\nexport const isQueryMatch = (\n  query: { filters: { [key: string]: string } },\n  log: LogEntry,\n  compiledGetters: CompiledGetterCache\n) => {\n  for (const originalFieldPath of Object.keys(query.filters)) {\n    if (originalFieldPath === 'search') {\n      const stringifedLog = JSON.stringify(log).toLowerCase();\n\n      if (\n        stringifedLog.indexOf(\n          query.filters[originalFieldPath].toLowerCase()\n        ) === -1\n      ) {\n        return false;\n      }\n    } else {\n      let fieldPath = originalFieldPath;\n      if (\n        fieldPath.startsWith('user.') ||\n        fieldPath.startsWith('metadata.') ||\n        fieldPath.startsWith('user[') ||\n        fieldPath.startsWith('metadata[')\n      ) {\n        fieldPath = `data.${fieldPath}`;\n      }\n\n      const fieldValue = query.filters[originalFieldPath];\n      const value = compiledGetters.getOrCompile(fieldPath, log);\n      if (\n        !value ||\n        (fieldValue !== undefined &&\n          fieldValue !== '*' &&\n          fieldValue.toString() !== value.toString())\n      ) {\n        return false;\n      }\n    }\n  }\n\n  return true;\n};\n\nexport interface ParsedQuery {\n  elements: JSX.Element[];\n  filters: { [key: string]: string };\n}\n\nconst queryFields = [\n  'level',\n  'search',\n  'metadata.emulator',\n  'metadata.emulator.name',\n  'metadata.function',\n  'metadata.function.name',\n];\nexport function parseQuery(query: string): ParsedQuery {\n  let escapedQuery = '';\n  let isEscaped = false;\n\n  for (const char of query) {\n    if (isEscaped) {\n      escapedQuery += 'ˍ';\n      isEscaped = false;\n    } else {\n      escapedQuery += char;\n\n      if (char === '\\\\') {\n        isEscaped = true;\n      }\n    }\n  }\n\n  const quoted_query = escapedQuery\n    .split('\"')\n    .map((t, i) => (i % 2 ? t.replace(/ /g, 'ˍ') : t))\n    .join('\"');\n\n  const sections: string[] = quoted_query\n    .split('\\n')\n    .reduce((sections, line) => {\n      return [\n        ...sections,\n        ...line.split(/((?:[^\\s]+)\\s?=\\s?(?:[^\\s]+))/),\n        '\\n',\n      ];\n    }, [] as string[]);\n\n  const filters: { [key: string]: string } = {};\n  const queryChunks: string[] = [];\n\n  let position = 0;\n  const elements = sections.map((quoted_section, index) => {\n    const section = query.slice(position, position + quoted_section.length);\n    position += quoted_section.length;\n\n    const equalPosition = section.indexOf('=');\n    const isKeyPair =\n      equalPosition > -1 && section[0] !== '=' && section.slice(-1)[0] !== '=';\n    const isNewline = section === '\\n';\n\n    if (isNewline) {\n      return <br key={index} />;\n    }\n    if (!isKeyPair) {\n      queryChunks.push(section);\n      return (\n        <span key={index} className=\"text\">\n          {section}\n        </span>\n      );\n    }\n\n    const pairKey = section.split('=')[0].trim();\n    if (\n      isKeyPair &&\n      queryFields.indexOf(pairKey) === -1 &&\n      !(pairKey.startsWith('user.') || pairKey.startsWith('user['))\n    ) {\n      return (\n        <span key={index}>\n          <span className=\"invalid_pair\">{section}</span>\n        </span>\n      );\n    }\n\n    const [key, value] = section.split('=');\n    try {\n      filters[key.trim()] = JSON.parse(value);\n    } catch (err) {\n      filters[key.trim()] = value;\n    }\n    return (\n      <span key={index}>\n        <span className=\"key\">{key}=</span>\n        <span className=\"value\">{value}</span>\n      </span>\n    );\n  });\n\n  const search = [\n    filters.search,\n    queryChunks\n      .filter((v) => v)\n      .join(' ')\n      .trim(),\n  ]\n    .filter((v) => v)\n    .join(' ');\n\n  if (search.length) filters.search = search;\n\n  return {\n    elements,\n    filters,\n  };\n}\n\ninterface Props {\n  query: string;\n  setQuery: (query: string) => void;\n  compiledGetters: CompiledGetterCache;\n}\n\nexport const QueryBar: React.FC<Props> = ({ query, setQuery }) => {\n  const [temporaryQuery, setTemporaryQuery] = useState('');\n\n  useEffect(() => {\n    setTemporaryQuery(query);\n  }, [query]);\n\n  const parsedQuery = parseQuery(temporaryQuery);\n\n  return (\n    <div className=\"QueryBar\">\n      <div className=\"QueryBar-render\">{parsedQuery.elements}</div>\n      <textarea\n        rows={1}\n        className=\"QueryBar-input\"\n        spellCheck={false}\n        value={temporaryQuery}\n        onChange={(e) => setTemporaryQuery((e.target as any).value)}\n        placeholder=\"Filter or search logs...\"\n      ></textarea>\n      <div className=\"QueryBar-actions\">\n        <Button\n          unelevated\n          onClick={() => setQuery(temporaryQuery)}\n          disabled={query === temporaryQuery}\n        >\n          Apply\n        </Button>\n        <Button\n          unelevated\n          disabled={!temporaryQuery.length}\n          onClick={() => {\n            setTemporaryQuery('');\n            setQuery('');\n          }}\n        >\n          Reset\n        </Button>\n      </div>\n    </div>\n  );\n};\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './History.scss';\n\nimport { ThemeProvider } from '@rmwc/theme';\nimport React, { useEffect, useRef } from 'react';\n\nimport { grey100 } from '../../colors';\nimport { CompiledGetterCache } from './CompiledGetterCache';\nimport { HighlightedJSON } from './HighlightedJSON';\nimport { ParsedQuery, filtersToQueryString, isQueryMatch } from './QueryBar';\nimport { LogEntry } from './types';\n\nconst FilterTag: React.FC<{ appendToQuery: Function; log: LogEntry }> = ({\n  appendToQuery,\n  log,\n}) => {\n  const metadata = log.data.metadata;\n  let tagButton;\n\n  if (metadata?.function?.name) {\n    tagButton = (\n      <div\n        className=\"log-tag-button\"\n        onClick={() =>\n          appendToQuery('metadata.function.name', metadata.function?.name)\n        }\n      >\n        function[{metadata.function.name}]\n      </div>\n    );\n  } else if (metadata?.emulator?.name) {\n    tagButton = (\n      <div\n        className=\"log-tag-button\"\n        onClick={() =>\n          appendToQuery('metadata.emulator.name', metadata.emulator?.name)\n        }\n      >\n        {metadata.emulator.name}\n      </div>\n    );\n  }\n\n  return <div className=\"log-tag\">{tagButton}</div>;\n};\n\ninterface Props {\n  parsedQuery: ParsedQuery;\n  setQuery: (query: string) => void;\n  compiledGetters: CompiledGetterCache;\n  logs: LogEntry[];\n}\n\nconst MAX_LOG_LINES = 100;\n\nexport const History: React.FC<Props> = ({\n  parsedQuery,\n  setQuery,\n  logs,\n  compiledGetters,\n}) => {\n  const history = logs.filter((log) =>\n    isQueryMatch(parsedQuery, log, compiledGetters)\n  );\n\n  const messagesEndRef = useRef(null);\n\n  const scrollToBottom = () => {\n    if (messagesEndRef && messagesEndRef.current) {\n      (messagesEndRef.current as any).scrollIntoView?.();\n    }\n  };\n\n  useEffect(scrollToBottom, [history]);\n\n  const appendToQuery = (key: string, value: string) => {\n    setQuery(filtersToQueryString({ ...parsedQuery.filters, [key]: value }));\n  };\n\n  const getUserData = (log: LogEntry) =>\n    log?.data?.user && Object.keys(log?.data?.user).length;\n\n  return (\n    <ThemeProvider options={{ surface: grey100 }} className=\"LogHistory\">\n      {history.length ? (\n        history.slice(-MAX_LOG_LINES).map((log, index) => (\n          <div id={`log_${index}`} className=\"log-entry\" key={index}>\n            <span className=\"log-timestamp\">\n              {new Date(log.timestamp).toLocaleTimeString('en-US', {\n                hour12: false,\n              })}\n            </span>\n            <span\n              className={`log-level ${log.level}`}\n              onClick={() => appendToQuery('level', log.level)}\n            >\n              {log.level[0].toUpperCase()}\n            </span>\n            <FilterTag appendToQuery={appendToQuery} log={log} />\n            {getUserData(log) ? (\n              <HighlightedJSON\n                data={log.data.user}\n                appendToQuery={appendToQuery}\n                compiledGetters={compiledGetters}\n              />\n            ) : (\n              <div className=\"log-message-single\">{log.message}</div>\n            )}\n          </div>\n        ))\n      ) : (\n        <div className=\"LogHistoryEmpty\">\n          No logs are found which match your filters.\n        </div>\n      )}\n      <div ref={messagesEndRef} />\n    </ThemeProvider>\n  );\n};\n\nexport default History;\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './index.scss';\n\nimport { Card } from '@rmwc/card';\nimport { Elevation } from '@rmwc/elevation';\nimport { GridCell } from '@rmwc/grid';\nimport React, { useEffect, useMemo, useState } from 'react';\nimport { useLocation } from 'react-router-dom';\n\nimport { ReconnectingWebSocket } from '../../reconnectingWebSocket';\nimport { useConfigOptional } from '../common/EmulatorConfigProvider';\nimport { CompiledGetterCache } from './CompiledGetterCache';\nimport History from './History';\nimport { QueryBar, parseQuery } from './QueryBar';\nimport { LogEntry } from './types';\n\nconst compiledGetters = new CompiledGetterCache();\n\nfunction useQuery() {\n  const { search } = useLocation();\n  return useMemo(() => new URLSearchParams(search), [search]);\n}\n\nexport const LogViewer: React.FC = () => {\n  const qs = useQuery();\n  const [logs, setLogs] = useState<LogEntry[]>([]);\n  const [query, setQuery] = useState(qs.get('q') || '');\n\n  // This component does not suspend. Show empty logs on start and keep previous\n  // logs when emulator stops.\n  const config = useConfigOptional()?.logging;\n\n  useEffect(() => {\n    if (!config) return;\n\n    setLogs([]);\n    const webSocket = new ReconnectingWebSocket(`ws://${config.hostAndPort}`);\n    webSocket.listener = (log: LogEntry) => {\n      setLogs((logs) => [...logs, log]);\n    };\n    return () => webSocket.cleanup();\n  }, [config, setLogs]);\n\n  const parsedQuery = parseQuery(query);\n\n  return (\n    <GridCell span={12}>\n      <Elevation z={2} wrap>\n        <Card className=\"LogViewer\">\n          <QueryBar\n            query={query}\n            setQuery={setQuery}\n            compiledGetters={compiledGetters}\n          />\n          <History\n            parsedQuery={parsedQuery}\n            setQuery={setQuery}\n            compiledGetters={compiledGetters}\n            logs={logs}\n          />\n        </Card>\n      </Elevation>\n    </GridCell>\n  );\n};\n\nexport default LogViewer;\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useHistory, useParams } from 'react-router-dom';\n\nimport { storagePath } from '../common/constants';\nimport { StorageRouterParams } from '../types';\n\nexport type UseBucketResult = [string, (bucket: string) => void];\n\nexport function useBucket(): UseBucketResult {\n  const history = useHistory();\n  const bucket = useParams<StorageRouterParams>().bucket;\n\n  function setBucket(bucket: string) {\n    history.push(storagePath + bucket);\n  }\n\n  return [bucket, setBucket];\n}\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport useSWR from 'swr';\n\nimport { useEmulatorConfig } from '../../common/EmulatorConfigProvider';\nimport { useBucket } from './useBucket';\n\nexport interface Bucket {\n  name: string;\n}\n\nexport function useBuckets() {\n  const config = useEmulatorConfig('storage');\n  const [bucket] = useBucket();\n\n  const fetcher = async () => {\n    const response = await fetch('http://' + config.hostAndPort + '/b');\n    const json = await response.json();\n    return json.items.map((b: Bucket) => b.name);\n  };\n\n  const result = useSWR('storage/buckets/' + bucket, fetcher, {\n    suspense: true,\n  }).data;\n\n  if (!result.includes(bucket)) {\n    return [...result, bucket];\n  }\n\n  return result;\n}\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Select } from '@rmwc/select';\nimport React, { ChangeEvent } from 'react';\n\nimport { StorageIcon } from '../../../common/icons';\nimport { useBucket } from '../../api/useBucket';\nimport { useBuckets } from '../../api/useBuckets';\nimport styles from './BucketPicker.module.scss';\n\nexport const BucketPicker: React.FC = () => {\n  const buckets = useBuckets();\n  const [bucket, setBucket] = useBucket();\n\n  return (\n    <Select\n      icon={<StorageIcon />}\n      className={styles.bucketPicker}\n      value={bucket}\n      aria-label=\"Select bucket\"\n      options={buckets}\n      onChange={(event: ChangeEvent<HTMLSelectElement>) => {\n        setBucket(event.target.value);\n      }}\n    />\n  );\n};\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Asserts that a condition is truthy, or throw an error.\n * @param assertion the condition to be asserted truthy.\n * @param error the error message to be thrown if assertion is falsy.\n */\nexport function assert(\n  assertion: unknown,\n  error: string = 'Assertion error'\n): asserts assertion {\n  if (!assertion) {\n    throw new Error(error);\n  }\n}\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { StorageFile } from '../types';\n\nexport function fileToStorageFile(\n  file: File,\n  bucket: string,\n  folder: string\n): StorageFile {\n  return {\n    type: 'file',\n    name: file.name,\n    size: file.size,\n    contentType: file.type,\n    bucket,\n    fullPath: folder + '/' + file.name,\n    uploading: true,\n    updated: new Date().toUTCString(),\n    timeCreated: new Date().toUTCString(),\n    customMetadata: {},\n  } as StorageFile;\n}\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEmulatorConfig } from '../../common/EmulatorConfigProvider';\nimport { useBucket } from './useBucket';\n\nconst EMPTY_FOLDER_DATA = `--boundary\nContent-Type: application/json\n\n{\"contentType\":\"text/plain\"}\n--boundary\nContent-Type: text/plain\n\n--boundary--`;\n\nexport function useCreateFolder() {\n  const config = useEmulatorConfig('storage');\n  const [bucket] = useBucket();\n\n  async function createFolder(fullPath: string) {\n    const normalizedPath = fullPath.replace(/\\/+/g, '/').replace(/^\\//, '');\n    const encodedPath = encodeURIComponent(normalizedPath);\n\n    await fetch(\n      `http://${\n        config!.hostAndPort\n      }/upload/storage/v1/b/${bucket}/o?name=${encodedPath}/`,\n      {\n        headers: {\n          'Content-Type': 'multipart/related; boundary=boundary',\n        },\n        method: 'POST',\n        body: new Blob([EMPTY_FOLDER_DATA]),\n      }\n    );\n  }\n\n  return {\n    createFolder,\n  };\n}\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useHistory, useParams } from 'react-router-dom';\n\nimport { storagePath } from '../common/constants';\nimport { StorageRouterParams } from '../types';\nimport { useBucket } from './useBucket';\n\nexport function usePath(): [string, (bucket: string) => void] {\n  const { path } = useParams<StorageRouterParams>();\n  const [bucket] = useBucket();\n  const history = useHistory();\n\n  function setPath(path: string) {\n    path = path.replace(/\\/+/g, '/');\n\n    history.push(\n      storagePath + bucket + (path.startsWith('/') ? '' : '/') + path\n    );\n  }\n\n  return [path || '', setPath];\n}\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport firebase from 'firebase';\nimport { useStorage } from 'reactfire';\nimport useSwr from 'swr';\n\nimport { assert } from '../../common/asserts';\nimport { fileToStorageFile } from '../common/fileToStorageFile';\nimport { StorageFile, StorageFolder, StorageItem } from '../types';\nimport { useBucket } from './useBucket';\nimport { useCreateFolder } from './useCreateFolder';\nimport { usePath } from './usePath';\n\nasync function importFile(\n  fileRef: firebase.storage.Reference\n): Promise<StorageFile> {\n  const metadata = await fileRef.getMetadata();\n  return { type: 'file', ...metadata };\n}\n\nfunction importFolder(folder: firebase.storage.Reference): StorageFolder {\n  return {\n    type: 'folder',\n    name: folder.name,\n    fullPath: folder.fullPath,\n  };\n}\n\nexport function useStorageFiles() {\n  const storage = useStorage();\n  const [bucket, setBucket] = useBucket();\n  const [path, setPath] = usePath();\n  const { createFolder } = useCreateFolder();\n\n  function getLocation(path = '') {\n    return `gs://${bucket}/${path}`;\n  }\n\n  function getCurrentRef(folder = path) {\n    return storage.refFromURL(getLocation(folder));\n  }\n\n  const bucketHasAnyFiles = useSwr(\n    `storage/hasFiles/${bucket}/`,\n    async (): Promise<boolean> => {\n      const { items, prefixes } = await getCurrentRef('').listAll();\n      return !!items.length || !!prefixes.length;\n    },\n    { suspense: true }\n  );\n\n  const result = useSwr(\n    `storage/${bucket}/${path}`,\n    async (): Promise<StorageItem[]> => {\n      const { items, prefixes } = await getCurrentRef().listAll();\n\n      return [\n        ...prefixes.map(importFolder),\n        ...(await Promise.all(items.map(importFile))),\n      ];\n    },\n    { suspense: true }\n  );\n\n  const files = result.data || [];\n\n  async function deleteFile(path: string): Promise<void> {\n    return await getCurrentRef('').child(path).delete();\n  }\n\n  async function deleteFolder(path: string): Promise<void> {\n    const { items, prefixes } = await getCurrentRef(path).listAll();\n\n    try {\n      /**\n       * We don't know if physical folder exists, or it is inferred from\n       * nested file path.\n       *\n       * So here we attempt to delete physical representation, but if it does\n       * not exist, we just swallow the error.\n       */\n      await deleteFile(path + '%2f');\n    } catch {\n      // quietly swallow any errors.\n    }\n\n    const prefixesPromise: Promise<void>[] = prefixes.map(async (prefix) => {\n      return await deleteFolder(prefix.fullPath);\n    });\n\n    const filesPromise: Promise<void>[] = items.map(async (file) => {\n      return await file.delete();\n    });\n\n    await Promise.all([...filesPromise, ...prefixesPromise]);\n  }\n\n  async function deleteAllFiles() {\n    return await deleteFolder('');\n  }\n\n  function uploadFiles(files: File[], folder?: string) {\n    return Promise.all(\n      files.map((file) => {\n        const path = folder ? `${folder}/${file.name}` : file.name;\n        return getCurrentRef().child(path).put(file);\n      })\n    );\n  }\n\n  async function deleteFiles(paths: string[]) {\n    return await Promise.all(\n      paths.map(async (path: string) => {\n        const file = files.find((file) => file.fullPath === path);\n        assert(file);\n\n        if (file.type === 'folder') {\n          return await deleteFolder(file.fullPath);\n        } else {\n          return await deleteFile(file.fullPath);\n        }\n      })\n    );\n  }\n\n  async function openAllFiles(paths: string[]) {\n    const links = await Promise.all(\n      paths\n        .map((path) => storage.refFromURL(getLocation() + '/' + path))\n        .map((d) => d.getDownloadURL())\n    );\n\n    links.forEach((url) => {\n      const a: HTMLAnchorElement = document.createElement('a');\n      a.href = url;\n      a.target = '_blank';\n      a.rel = 'noopener';\n      a.click();\n    });\n  }\n\n  return {\n    files,\n    setBucket,\n    bucket,\n    path,\n    setPath,\n    bucketHasAnyFiles: bucketHasAnyFiles.data,\n    getLocation,\n    async uploadFiles(uploadedFiles: File[], folderName?: string) {\n      // Optimistically display new file on top with the loading state.\n      const names = new Set(uploadedFiles.map(({ name }) => name));\n      const oldFiles = files.filter((file) => !names.has(file.name));\n\n      const newFiles = uploadedFiles.map((file) =>\n        fileToStorageFile(file, bucket, path)\n      );\n      result.mutate([...newFiles, ...oldFiles], false);\n\n      await uploadFiles(uploadedFiles, folderName);\n\n      await result.mutate();\n      await bucketHasAnyFiles.mutate();\n    },\n    async deleteAllFiles() {\n      await result.mutate([], false);\n      setPath('');\n      await deleteAllFiles();\n      await result.mutate();\n      await bucketHasAnyFiles.mutate();\n    },\n    openAllFiles,\n    async createFolder(name: string) {\n      createFolder(path + '/' + name);\n      await result.mutate();\n      await bucketHasAnyFiles.mutate();\n    },\n    async deleteFiles(paths: string[]) {\n      // Optimistically hide file\n      const pathsSet = new Set(paths);\n      const remainingFiles = files.filter(\n        (file) => !pathsSet.has(file.fullPath)\n      );\n      result.mutate(remainingFiles, false);\n\n      await deleteFiles(paths);\n      await result.mutate();\n      await bucketHasAnyFiles.mutate();\n    },\n  };\n}\n\nexport type useStorageFilesResult = ReturnType<typeof useStorageFiles>;\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DialogButton } from '@rmwc/dialog';\nimport React from 'react';\n\nimport { Callout } from '../../../common/Callout';\nimport { confirm } from '../../../common/DialogQueue';\n\nexport const confirmDeleteAllFiles = () => {\n  return confirm({\n    title: 'Clear all data?',\n    body: (\n      <div className=\"Firestore--dialog-body\">\n        <Callout aside type=\"warning\">\n          This will delete all files\n        </Callout>\n      </div>\n    ),\n    // hide standard buttons so as to use `danger` button\n    acceptLabel: null,\n    cancelLabel: null,\n    footer: (\n      <>\n        <DialogButton action=\"close\" type=\"button\" theme=\"secondary\">\n          Cancel\n        </DialogButton>\n        <DialogButton unelevated action=\"accept\" isDefaultAction danger>\n          Delete\n        </DialogButton>\n      </>\n    ),\n  });\n};\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Button } from '@rmwc/button';\nimport React, { Suspense } from 'react';\n\nimport { CustomThemeProvider } from '../../../../themes';\nimport { useStorageFiles } from '../../api/useStorageFiles';\nimport { confirmDeleteAllFiles } from './confirmDeleteAllFiles';\nimport styles from './DeleteAllButton.module.scss';\n\nexport const DeleteAllButton: React.FC = () => {\n  return (\n    // While we don't know the state of the button, show it as disabled.\n    <Suspense\n      fallback={\n        <DeleteAllButtonUnwrapped deleteAllFiles={() => {}} disabled={true} />\n      }\n    >\n      <DeleteAllButtonWithHooks />\n    </Suspense>\n  );\n};\n\nconst DeleteAllButtonWithHooks: React.FC = () => {\n  const { deleteAllFiles, bucketHasAnyFiles } = useStorageFiles();\n\n  return (\n    <DeleteAllButtonUnwrapped\n      disabled={!bucketHasAnyFiles}\n      deleteAllFiles={deleteAllFiles}\n    />\n  );\n};\n\ninterface DeleteAllButtonUnwrappedProps {\n  deleteAllFiles: () => void;\n  disabled: boolean;\n}\n\nconst DeleteAllButtonUnwrapped: React.FC<DeleteAllButtonUnwrappedProps> = ({\n  deleteAllFiles,\n  disabled,\n}) => {\n  return (\n    <CustomThemeProvider use=\"warning\" wrap>\n      <Button\n        className={styles.deleteAllFiles}\n        disabled={disabled}\n        unelevated\n        onClick={async () => {\n          if (await confirmDeleteAllFiles()) {\n            deleteAllFiles();\n          }\n        }}\n      >\n        Delete all files\n      </Button>\n    </CustomThemeProvider>\n  );\n};\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport { BucketPicker } from './BucketPicker/BucketPicker';\nimport styles from './Canvas.module.scss';\nimport { DeleteAllButton } from './DeleteAllButton/DeleteAllButton';\n\nexport const StorageCanvas: React.FC = () => (\n  <div className={styles.canvasWrapper}>\n    <BucketPicker />\n    <DeleteAllButton />\n  </div>\n);\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useState } from 'react';\n\nfunction useSelected<T>(options: T[]): [Set<T>, (t: Set<T>) => void] {\n  const [selectedValue, setSelected] = useState(new Set<T>());\n\n  return [\n    new Set(options.filter((path) => selectedValue.has(path))),\n    setSelected,\n  ];\n}\n\n// Takes a list of elements and allow to select multiple like in gmail.\nexport function useMultiselect<T>(options: T[]) {\n  const [selected, setSelected] = useSelected(options);\n\n  /**\n   * Multiple selection is actually pretty tricky.\n   *\n   * Storing just single \"last selected\" value is not enough.\n   *\n   * e.g. user has a pretty complex selection, then selects and deselect\n   * another checkbox. We need stack to know where to get back to have a\n   * reference point.\n   */\n  const [stack, setStack] = useState<T[]>([]);\n\n  function findBetween(item1: T, item2: T) {\n    const index1 = options.indexOf(item1);\n    const index2 = options.indexOf(item2);\n\n    const numberOfItems = Math.abs(index1 - index2) + 1;\n    const firstIndex = index1 < index2 ? index1 : index2;\n    return options.slice(firstIndex, firstIndex + numberOfItems);\n  }\n\n  // We when deselecting the item, we want to remove it from the stack even if\n  // it's in the middle.\n  function removeFromStack(item: T) {\n    setStack(stack.filter((i) => i !== item));\n  }\n\n  function toggleAllItems(items: T[], shouldSelect: boolean) {\n    for (const item of items) {\n      if (shouldSelect) {\n        selected.add(item);\n      } else {\n        selected.delete(item);\n        removeFromStack(item);\n      }\n    }\n\n    setSelected(new Set([...selected]));\n  }\n\n  function addToStack(item: T) {\n    setStack([...stack, item]);\n  }\n\n  return {\n    allSelected: selected.size === options.length && selected.size > 0,\n    allIndeterminate: selected.size > 0 && selected.size < options.length,\n    isSelected(item: T) {\n      return selected.has(item);\n    },\n    selected,\n    toggleSingle(item: T) {\n      if (selected.has(item)) {\n        toggleAllItems([item], false);\n        removeFromStack(item);\n      } else {\n        toggleAllItems([item], true);\n        addToStack(item);\n      }\n    },\n    toggleContinuous(item: T) {\n      if (selected.size === 0 || stack.length === 0) {\n        this.toggleSingle(item);\n      }\n\n      const between = findBetween(stack[stack.length - 1], item);\n\n      toggleAllItems(between, !this.isSelected(item));\n      addToStack(item);\n    },\n    clearAll() {\n      setSelected(new Set());\n      setStack([]);\n    },\n    toggleAll() {\n      if (selected.size === options.length) {\n        setSelected(new Set());\n      } else {\n        toggleAllItems(options, true);\n      }\n    },\n  };\n}\n\nexport type UseMultiselectResult = ReturnType<typeof useMultiselect>;\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// This has been copied as is from firebase-tools\n// https://github.com/FirebasePrivate/firebase-tools/blob/15a582cd2d92ad7477e9364a61bb17a98478fe8e/src/profileReport.js#L77\nconst formatNumber = function (num: number) {\n  var parts = num.toFixed(2).split('.');\n  parts[0] = parts[0].replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\n  if (+parts[1] === 0) {\n    return parts[0];\n  }\n  return parts.join('.');\n};\n\nexport const formatBytes = function (bytes: number) {\n  var threshold = 1000;\n  if (Math.round(bytes) < threshold) {\n    return bytes + ' B';\n  }\n  var units = ['kB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];\n  var u = -1;\n  var formattedBytes = bytes;\n  do {\n    formattedBytes /= threshold;\n    u++;\n  } while (Math.abs(formattedBytes) >= threshold && u < units.length - 1);\n  return formatNumber(formattedBytes) + ' ' + units[u];\n};\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Icon } from '@rmwc/icon';\nimport { Theme } from '@rmwc/theme';\n\nimport styles from './StorageIcon.module.scss';\n\nexport interface StorageIconProps {\n  contentType: string;\n}\n\nconst MIME_TYPE_ICON_MAP: Record<string, string> = {\n  // adobe illustrator\n  'application/illustrator': 'drive_ai',\n  // microsoft word\n  'application/msword': 'drive_ms_word',\n  'application/vnd.openxmlformats-officedocument.wordprocessingml.document':\n    'drive_ms_word',\n  // microsoft powerpoint\n  'application/vnd.ms-powerpoint': 'drive_ms_powerpoint',\n  'application/vnd.openxmlformats-officedocument.presentationml.presentation':\n    'drive_ms_powerpoint',\n  // microsoft excel\n  'application/vnd.ms-excel': 'drive_ms_excel',\n  'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet':\n    'drive_ms_excel',\n  // adobe acrobat\n  'application/pdf': 'drive_pdf',\n  // adobe photoshop\n  'application/photoshop': 'drive_ps',\n  'application/psd': 'drive_ps',\n  'application/x-photoshop': 'drive_ps',\n  'image/photoshop': 'drive_ps',\n  'image/psd': 'drive_ps',\n  'image/x-photoshop': 'drive_ps',\n  'image/x-psd': 'drive_ps',\n  // images\n  'image/gif': 'photo',\n  'image/jpg': 'photo',\n  'image/jpeg': 'photo',\n  'image/png': 'photo',\n  'image/svg+xml': 'photo',\n  'image/webp': 'photo',\n  // audio\n  'audio/m4a': 'drive_audio',\n  'audio/mp3': 'drive_audio',\n  'audio/mpeg': 'drive_audio',\n  'audio/wav': 'drive_audio',\n  'audio/x-ms-wma': 'drive_audio',\n  // video\n  'video/avi': 'drive_video',\n  'video/mp4': 'drive_video',\n  'video/mpeg': 'drive_video',\n  'video/quicktime': 'drive_video',\n  'video/x-ms-wmv': 'drive_video',\n  // zip, csv, tsv\n  'application/zip': 'drive_zip',\n  'application/csv': 'csv',\n  'text/csv': 'csv',\n  'text/tsv': 'tsv',\n  'text/tab-separated-values': 'tsv',\n  // text documents\n  'text/javascript': 'drive_document',\n  'text/plain': 'drive_document',\n  'text/x-log': 'drive_document',\n} as const;\n\nconst DEFAULT_MIME_TYPE_ICON = 'drive_file';\n\nexport function getFileIcon(contentType: string) {\n  return MIME_TYPE_ICON_MAP[contentType] || DEFAULT_MIME_TYPE_ICON;\n}\n\nexport const StorageFileIcon: React.FC<StorageIconProps> = ({\n  contentType,\n}) => {\n  return (\n    <Theme use=\"secondary\">\n      <Icon icon={getFileIcon(contentType)} className={styles.icon} />\n    </Theme>\n  );\n};\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { randomId } from '@rmwc/base';\nimport { Icon } from '@rmwc/icon';\nimport { Typography } from '@rmwc/typography';\nimport React, { useState } from 'react';\n\nimport styles from './Accordion.module.scss';\n\nexport interface AccordionProps {\n  title: string;\n  isExpanded?: boolean;\n}\n\nexport const Accordion: React.FC<AccordionProps> = ({\n  isExpanded = false,\n  title,\n  children,\n}) => {\n  const [isAccordionExpanded, setIsAccordionExpanded] = useState(isExpanded);\n  const contentId = randomId('accordion-content');\n  const headerId = randomId('accordion-header');\n  return (\n    <section className={styles.accordion}>\n      <header\n        tabIndex={0}\n        role=\"button\"\n        id={headerId}\n        aria-controls={contentId}\n        aria-expanded={isAccordionExpanded}\n        onClick={() => setIsAccordionExpanded(!isAccordionExpanded)}\n        onKeyDown={(e) =>\n          (e.key === ' ' || e.key === 'Enter') &&\n          setIsAccordionExpanded(!isAccordionExpanded)\n        }\n        className={styles.header}\n      >\n        <Typography use=\"body1\">{title}</Typography>\n\n        {/* TODO(kirjs): Play animations. */}\n        {isAccordionExpanded ? (\n          <Icon icon=\"expand_less\" className={styles.icon} />\n        ) : (\n          <Icon icon=\"expand_more\" className={styles.icon} />\n        )}\n      </header>\n      {isAccordionExpanded && (\n        <div\n          className={styles.content}\n          aria-labelledby={headerId}\n          id={contentId}\n        >\n          {children}\n        </div>\n      )}\n    </section>\n  );\n};\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Typography } from '@rmwc/typography';\nimport React from 'react';\n\nimport { Accordion } from '../../../../common/Accordion';\nimport styles from './CustomMetadata.module.scss';\n\ninterface SideBarProps {\n  metadata?: Record<string, string>;\n}\n\nexport const CustomMetadata: React.FC<SideBarProps> = ({ metadata }) => {\n  return (\n    <Accordion title=\"Custom metadata\">\n      {metadata ? (\n        <dl className={styles.metadata}>\n          {Object.entries<string>(metadata).map(([key, value]) => (\n            <React.Fragment key={key}>\n              <Typography use=\"body2\" tag=\"dt\" theme=\"secondary\">\n                {key}\n              </Typography>\n              <Typography use=\"body2\" tag=\"dd\">\n                {value}\n              </Typography>\n            </React.Fragment>\n          ))}\n        </dl>\n      ) : (\n        <Typography use=\"body2\" theme=\"secondary\">\n          No custom metadata\n        </Typography>\n      )}\n    </Accordion>\n  );\n};\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Button } from '@rmwc/button';\nimport { IconButton } from '@rmwc/icon-button';\nimport { MenuItem, SimpleMenu } from '@rmwc/menu';\nimport { Tooltip } from '@rmwc/tooltip';\nimport { Typography } from '@rmwc/typography';\nimport React, { KeyboardEvent } from 'react';\n\nimport { Accordion } from '../../../../common/Accordion';\nimport { useClipboard } from '../../../../common/CopyButton';\nimport { useStorageFiles } from '../../../api/useStorageFiles';\nimport { useTokens } from '../../../api/useTokens';\nimport styles from './FileLocation.module.scss';\n\ninterface FileLocationProps {\n  fullPath: string;\n}\n\nexport const FileLocation: React.FC<FileLocationProps> = ({ fullPath }) => {\n  const { tokens, createToken, deleteToken } = useTokens(fullPath);\n  const { getLocation } = useStorageFiles();\n  const { writeText } = useClipboard();\n\n  return (\n    <Accordion title=\"File location\">\n      <dl className={styles.metadata}>\n        <Typography use=\"body2\" tag=\"dt\" theme=\"secondary\">\n          File location\n        </Typography>\n        <Typography use=\"body2\" tag=\"dd\" className={styles.location}>\n          {getLocation(fullPath)}\n        </Typography>\n        {tokens.map((token) => (\n          <div key={token}>\n            <Typography use=\"body2\" tag=\"dt\" theme=\"secondary\">\n              Access token\n              <SimpleMenu\n                handle={<IconButton icon=\"more_vert\" label=\"Open menu\" />}\n                renderToPortal\n              >\n                <MenuItem\n                  onKeyDown={(e: KeyboardEvent<HTMLElement>) => {\n                    if (e.key === 'Enter' || e.key === ' ') {\n                      deleteToken(token);\n                    }\n                  }}\n                  onClick={() => deleteToken(token)}\n                >\n                  Revoke\n                </MenuItem>\n              </SimpleMenu>\n            </Typography>\n            <Typography use=\"body2\" tag=\"dd\">\n              <Tooltip content=\"Click to copy the token to clipboard\">\n                <input\n                  aria-label=\"Token, press Enter to copy\"\n                  className={styles.token}\n                  readOnly\n                  value={token}\n                  onClick={() => writeText(token)}\n                  onKeyDown={(e: KeyboardEvent<HTMLElement>) => {\n                    if (e.key === 'Enter' || e.key === ' ') {\n                      writeText(token);\n                    }\n                  }}\n                />\n              </Tooltip>\n            </Typography>\n          </div>\n        ))}\n      </dl>\n      <Button unelevated onClick={createToken}>\n        Create new access token\n      </Button>\n    </Accordion>\n  );\n};\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport useSWR from 'swr';\n\nimport { useEmulatorConfig } from '../../common/EmulatorConfigProvider';\nimport { useBucket } from './useBucket';\n\nexport function useTokens(fullPath: string) {\n  const config = useEmulatorConfig('storage');\n  const [bucket] = useBucket();\n  const key = `storage/tokens/${bucket}/${fullPath}`;\n\n  const fetcher = async () => {\n    const url = `http://${\n      config.hostAndPort\n    }/v0/b/${bucket}/o/${encodeURIComponent(fullPath)}`;\n\n    const response = await fetch(url, {\n      method: 'GET',\n      headers: { Authorization: 'Bearer owner' },\n    });\n\n    const result = await response.json();\n\n    return (result.downloadTokens || '').split(',').filter((t: string) => !!t);\n  };\n\n  const { data, mutate } = useSWR<string[]>(key, fetcher, {\n    suspense: true,\n  });\n\n  async function createToken() {\n    await fetch(\n      `http://${config!.hostAndPort}/v0/b/${bucket}/o/${encodeURIComponent(\n        fullPath\n      )}?create_token=true`,\n\n      {\n        headers: { Authorization: 'Bearer owner' },\n        method: 'POST',\n      }\n    );\n\n    mutate();\n  }\n\n  async function deleteToken(token: string) {\n    await fetch(\n      `http://${config!.hostAndPort}/v0/b/${bucket}/o/${encodeURIComponent(\n        fullPath\n      )}?delete_token=${token}`,\n      {\n        headers: { Authorization: 'Bearer owner' },\n        method: 'POST',\n      }\n    );\n\n    mutate();\n  }\n\n  return {\n    tokens: data || [],\n    createToken,\n    deleteToken,\n  };\n}\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useStorage } from 'reactfire';\nimport useSWR from 'swr';\n\nimport { useStorageFiles } from '../../../api/useStorageFiles';\nimport { StorageFile } from '../../../types';\n\n/**\n * List of allowed mime types for the preview section\n *\n * This list DOES NOT include image/webp as image/webp requires special handling\n * (it's not available in most browsers yet)\n */\nconst MIME_TYPES_FOR_PREVIEW = [\n  'image/bmp',\n  'image/gif',\n  'image/jpeg',\n  'image/jpg',\n  'image/png',\n  'image/svg+xml',\n];\n\nexport function shouldShowPreview(contentType: string): boolean {\n  return MIME_TYPES_FOR_PREVIEW.includes(contentType);\n}\n\nexport const usePreviewUrl = (file: StorageFile) => {\n  const storage = useStorage();\n  const { getLocation } = useStorageFiles();\n\n  const { data } = useSWR(\n    'storage/downloadUrl/' + file.fullPath,\n    () => {\n      if (!shouldShowPreview(file.contentType)) {\n        return Promise.resolve(undefined);\n      }\n      return storage.refFromURL(getLocation(file.fullPath)).getDownloadURL();\n    },\n    { suspense: true }\n  );\n  return data;\n};\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { Suspense } from 'react';\n\nimport { Spinner } from '../../../../common/Spinner';\nimport { StorageFile } from '../../../types';\nimport styles from './StoragePreview.module.scss';\nimport { shouldShowPreview, usePreviewUrl } from './usePreviewUrl';\n\ninterface StoragePreviewProps {\n  file: StorageFile;\n}\n\nexport const StoragePreview: React.FC<StoragePreviewProps> = ({ file }) => {\n  if (!shouldShowPreview(file.contentType)) {\n    return null;\n  }\n  return (\n    <Suspense fallback={<Spinner />}>\n      <StoragePreviewUnwrapped file={file} />\n    </Suspense>\n  );\n};\n\nexport const StoragePreviewUnwrapped: React.FC<StoragePreviewProps> = ({\n  file,\n}) => {\n  const url = usePreviewUrl(file);\n\n  if (!url) {\n    return null;\n  }\n\n  return <img className={styles.preview} src={url} alt=\"Preview\" />;\n};\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { IconButton } from '@rmwc/icon-button';\nimport { Typography } from '@rmwc/typography';\nimport React, { KeyboardEvent } from 'react';\n\nimport { formatBytes } from '../../../common/formatBytes';\nimport { useStorageFiles } from '../../api/useStorageFiles';\nimport { StorageFileIcon } from '../../common/StorageFileIcon/StorageFileIcon';\nimport { StorageFile } from '../../types';\nimport { CustomMetadata } from './CustomMetadata/CustomMetadata';\nimport { FileLocation } from './FileLocation/FileLocation';\nimport styles from './SideBar.module.scss';\nimport { StoragePreview } from './StoragePreview/StoragePreview';\n\ninterface SideBarProps {\n  file: StorageFile;\n  closeSidebar: () => void;\n}\n\nfunction formatDate(dateString: string) {\n  const date = new Date(dateString);\n  return date.toLocaleDateString() + ', ' + date.toLocaleTimeString();\n}\n\nexport const SideBar: React.FC<SideBarProps> = ({ file, closeSidebar }) => {\n  const { openAllFiles } = useStorageFiles();\n  return (\n    <aside className={styles.sideBarWrapper}>\n      <div className={styles.headerWrapper}>\n        <div className={styles.headerTitleWrapper}>\n          <StorageFileIcon contentType={file.contentType} />\n          <Typography\n            className={styles.fileName}\n            use=\"subtitle1\"\n            title={file.name}\n          >\n            {file.name}\n          </Typography>\n        </div>\n        <IconButton\n          theme=\"secondary\"\n          aria-label=\"Close\"\n          icon=\"close\"\n          onClick={closeSidebar}\n        />\n      </div>\n\n      <StoragePreview file={file} />\n\n      <dl className={styles.metadata}>\n        <Typography use=\"body2\" tag=\"dt\" theme=\"secondary\">\n          Name\n        </Typography>\n        <Typography\n          role=\"button\"\n          tabIndex=\"0\"\n          className={styles.openFileLink}\n          use=\"body2\"\n          tag=\"dd\"\n          onKeyDown={(e: KeyboardEvent<HTMLElement>) => {\n            if (e.key === 'Enter' || e.key === ' ') {\n              return openAllFiles([file.fullPath]);\n            }\n          }}\n          onClick={() => {\n            return openAllFiles([file.fullPath]);\n          }}\n        >\n          {file.name}\n        </Typography>\n\n        <Typography use=\"body2\" tag=\"dt\" theme=\"secondary\">\n          Size\n        </Typography>\n        <Typography use=\"body2\" tag=\"dd\">\n          {formatBytes(file.size)}\n        </Typography>\n\n        <Typography use=\"body2\" tag=\"dt\" theme=\"secondary\">\n          Type\n        </Typography>\n        <Typography use=\"body2\" tag=\"dd\">\n          {file.contentType}\n        </Typography>\n\n        <Typography use=\"body2\" tag=\"dt\" theme=\"secondary\">\n          Created\n        </Typography>\n        <Typography use=\"body2\" tag=\"dd\">\n          {formatDate(file.timeCreated)}\n        </Typography>\n\n        <Typography use=\"body2\" tag=\"dt\" theme=\"secondary\">\n          Last modified\n        </Typography>\n        <Typography use=\"body2\" tag=\"dd\">\n          {formatDate(file.updated)}\n        </Typography>\n      </dl>\n\n      <FileLocation fullPath={file.fullPath}></FileLocation>\n      <CustomMetadata metadata={file.customMetadata}></CustomMetadata>\n    </aside>\n  );\n};\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Button } from '@rmwc/button';\nimport { IconButton } from '@rmwc/icon-button';\nimport { Theme } from '@rmwc/theme';\nimport { Typography } from '@rmwc/typography';\nimport React from 'react';\n\nimport { CardActionBar } from '../../../../../common/CardActionBar';\nimport { useStorageFiles } from '../../../../api/useStorageFiles';\nimport { UseMultiselectResult } from '../../../../common/useMultiselect';\nimport { StorageItem } from '../../../../types';\nimport styles from './ActionHeader.module.scss';\n\ninterface ActionHeaderProps {\n  selection: UseMultiselectResult;\n}\n\nfunction selectionIncludesFolders(\n  files: StorageItem[],\n  selection: Set<string>\n) {\n  return files.some(\n    (file) => selection.has(file.fullPath) && file.type === 'folder'\n  );\n}\n\nexport const ActionHeader: React.FC<ActionHeaderProps> = ({ selection }) => {\n  const { files, openAllFiles, deleteFiles } = useStorageFiles();\n  const areFoldersSelected = selectionIncludesFolders(\n    files,\n    selection.selected as any\n  );\n  const paths = [...(selection.selected as Set<string>)];\n\n  return (\n    <CardActionBar className={styles.actionBar}>\n      <Theme use={'textPrimaryOnDark'}>\n        <div className={styles.actionHeaderWrapper}>\n          <IconButton\n            icon=\"close\"\n            label=\"Unselect all\"\n            onClick={() => selection.clearAll()}\n          />\n          <div className={styles.actionHeaderLabel}>\n            <Typography use=\"body2\">\n              {selection.selected.size} item(s)\n            </Typography>\n          </div>\n          <div>\n            <Button\n              className={styles.openButton}\n              disabled={areFoldersSelected}\n              onClick={() => {\n                return openAllFiles(paths);\n              }}\n              unelevated\n            >\n              Open all files\n            </Button>\n            <Button\n              onClick={() => {\n                selection.clearAll();\n                return deleteFiles(paths);\n              }}\n              className={styles.deleteButton}\n              outlined\n              unelevated\n            >\n              Delete\n            </Button>\n          </div>\n        </div>\n      </Theme>\n    </CardActionBar>\n  );\n};\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Dialog,\n  DialogActions,\n  DialogButton,\n  DialogContent,\n  DialogTitle,\n} from '@rmwc/dialog';\nimport React, { FormEvent, useReducer } from 'react';\n\nimport { Field } from '../../../../../../../common/Field';\n\ninterface NewFolderDialogProps {\n  confirm: (folder: string) => void;\n  close: () => void;\n  isOpen: boolean;\n}\n\n// This is the limit on the back-end.\nconst MAX_FOLDER_NAME_LENGTH = 252;\n\nexport const CreateFolderDialog: React.FC<NewFolderDialogProps> = ({\n  confirm,\n  isOpen,\n  close,\n}) => {\n  const [name, setName] = useReducer(\n    (s: string, value: string) => value.trim(),\n    ''\n  );\n\n  const createFolder = () => {\n    confirm(name);\n    close();\n  };\n\n  return (\n    <Dialog open={isOpen} onClose={() => close()}>\n      <DialogTitle>Create folder</DialogTitle>\n\n      <DialogContent>\n        <form\n          onSubmit={(e: FormEvent) => {\n            e.preventDefault();\n            createFolder();\n          }}\n        >\n          <Field\n            maxLength={MAX_FOLDER_NAME_LENGTH}\n            onChange={(e: FormEvent<HTMLInputElement>) => {\n              setName((e.target as HTMLInputElement).value);\n            }}\n            required\n            label=\"New folder name\"\n          />\n        </form>\n      </DialogContent>\n\n      <DialogActions>\n        <DialogButton type=\"button\" theme=\"secondary\" onClick={close}>\n          Cancel\n        </DialogButton>\n\n        <DialogButton disabled={name === ''} unelevated onClick={createFolder}>\n          Create\n        </DialogButton>\n      </DialogActions>\n    </Dialog>\n  );\n};\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { IconButton } from '@rmwc/icon-button';\nimport React, { useState } from 'react';\n\nimport { useStorageFiles } from '../../../../../api/useStorageFiles';\nimport { CreateFolderDialog } from './CreateFolderDialog/CreateFolderDialog';\n\nexport const CreateFolder: React.FC = () => {\n  const { createFolder } = useStorageFiles();\n  const [shouldShowDialog, setShouldShowDialog] = useState(false);\n\n  return (\n    <>\n      <IconButton\n        icon=\"create_new_folder\"\n        theme=\"secondary\"\n        aria-label=\"Create new folder\"\n        title=\"Create new folder\"\n        onClick={() => setShouldShowDialog(true)}\n      />\n\n      {shouldShowDialog && (\n        <CreateFolderDialog\n          isOpen={shouldShowDialog}\n          close={() => setShouldShowDialog(false)}\n          confirm={(name: string) => createFolder(name)}\n        />\n      )}\n    </>\n  );\n};\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Button } from '@rmwc/button';\nimport React from 'react';\nimport { useDropzone } from 'react-dropzone';\n\nimport { useStorageFiles } from '../../../../../api/useStorageFiles';\nimport styles from './UploadButton.module.scss';\n\nexport const UploadButton: React.FC = () => {\n  const { uploadFiles } = useStorageFiles();\n\n  const { getInputProps, getRootProps } = useDropzone({\n    onDrop: async (files) => {\n      await uploadFiles(files);\n    },\n  });\n\n  return (\n    <div className={styles.uploadButton} {...getRootProps()}>\n      <Button unelevated>Upload file</Button>\n      <input aria-label=\"Upload\" {...getInputProps()} />\n    </div>\n  );\n};\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Tooltip } from '@rmwc/tooltip';\nimport React from 'react';\n\nimport { CardActionBar } from '../../../../../common/CardActionBar';\nimport { CopyButton } from '../../../../../common/CopyButton';\nimport { InteractiveBreadCrumbBar } from '../../../../../common/InteractiveBreadCrumbBar';\nimport { useBucket } from '../../../../api/useBucket';\nimport { usePath } from '../../../../api/usePath';\nimport { storagePath } from '../../../../common/constants';\nimport { CreateFolder } from './CreateFolder/CreateFolder';\nimport styles from './StorageHeader.module.scss';\nimport { UploadButton } from './UploadButton/UploadButton';\n\nexport const StorageHeader: React.FC = () => {\n  const [path, setPath] = usePath();\n  const [bucket] = useBucket();\n\n  const bucketRoot = `gs://${bucket}`;\n\n  return (\n    <div className={styles.storageHeaderActionBarWrapper}>\n      <CardActionBar>\n        <div className={styles.storageHeaderWrapper}>\n          <Tooltip content=\"Copy URL to clipboard\">\n            {/*Without div tooltip is not displayed*/}\n            <div>\n              <CopyButton textToCopy={bucketRoot + '/' + path} icon=\"link\" />\n            </div>\n          </Tooltip>\n          <div className={styles.wrapper}>\n            <div className={styles.breadcrumbWrapper}>\n              <InteractiveBreadCrumbBar\n                inputPrefix={bucketRoot + '/'}\n                onNavigate={setPath}\n                base={storagePath + bucket}\n                path={path}\n                homeElement={bucketRoot}\n              />\n            </div>\n          </div>\n          <CreateFolder />\n          <UploadButton />\n        </div>\n      </CardActionBar>\n    </div>\n  );\n};\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Icon } from '@rmwc/icon';\nimport { Theme } from '@rmwc/theme';\n\nimport styles from './StorageIcon.module.scss';\n\nexport const StorageFolderIcon: React.FC = () => {\n  return (\n    <Theme use=\"secondary\">\n      <Icon icon=\"folder_open\" className={styles.icon} />\n    </Theme>\n  );\n};\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Typography } from '@rmwc/typography';\nimport React from 'react';\nimport { useDropzone } from 'react-dropzone';\n\nimport { useStorageFiles } from '../../../api/useStorageFiles';\nimport styles from './ZeroState.module.scss';\n\nexport const ZeroState: React.FC = () => {\n  const { uploadFiles } = useStorageFiles();\n\n  const { getInputProps, getRootProps, isDragActive } = useDropzone({\n    onDrop: async (files) => {\n      await uploadFiles(files);\n    },\n  });\n\n  return (\n    <div className={styles.zeroStateWrapper} {...getRootProps()}>\n      {isDragActive ? (\n        <Typography use=\"body2\" theme=\"secondary\">\n          Drop files here\n        </Typography>\n      ) : (\n        <div>\n          <Typography use=\"body1\" theme=\"secondary\" tag=\"div\">\n            No files found\n          </Typography>\n          <Typography use=\"body2\" theme=\"secondary\" tag=\"div\">\n            Drag and drop files to upload\n          </Typography>\n        </div>\n      )}\n\n      <input {...getInputProps()} />\n    </div>\n  );\n};\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { randomId } from '@rmwc/base';\nimport { Checkbox } from '@rmwc/checkbox';\nimport {\n  DataTable,\n  DataTableBody,\n  DataTableCell,\n  DataTableContent,\n  DataTableHead,\n  DataTableHeadCell,\n  DataTableRow,\n} from '@rmwc/data-table';\nimport { Typography } from '@rmwc/typography';\nimport React, { ChangeEvent, KeyboardEvent, MouseEvent } from 'react';\n\nimport { formatBytes } from '../../../common/formatBytes';\nimport { Spinner } from '../../../common/Spinner';\nimport { useStorageFiles } from '../../api/useStorageFiles';\nimport { StorageFileIcon } from '../../common/StorageFileIcon/StorageFileIcon';\nimport { StorageFolderIcon } from '../../common/StorageFileIcon/StorageFolderIcon';\nimport { UseMultiselectResult } from '../../common/useMultiselect';\nimport { StorageFile, StorageItem } from '../../types';\nimport styles from './Table.module.scss';\nimport { ZeroState } from './ZeroState/ZeroState';\n\ninterface StorageTableProps {\n  selection: UseMultiselectResult;\n  selectedFile?: StorageFile;\n  selectFile: (file?: StorageFile) => void;\n}\n\nexport const StorageTable: React.FC<StorageTableProps> = ({\n  selection,\n  selectFile,\n  selectedFile,\n}) => {\n  const { files, bucket, setPath } = useStorageFiles();\n\n  return (\n    <div className={styles.tableWrapper}>\n      <DataTable className={styles.tableWrapper}>\n        <DataTableContent>\n          <DataTableHead>\n            <DataTableRow>\n              <DataTableHeadCell\n                hasFormControl\n                className={styles.checkboxColumn}\n              >\n                <Checkbox\n                  disabled={files.length === 0}\n                  checked={selection.allSelected}\n                  indeterminate={selection.allIndeterminate}\n                  onChange={(event: ChangeEvent<HTMLInputElement>) => {\n                    const {\n                      checked,\n                      indeterminate,\n                    } = event.target as HTMLInputElement;\n                    if (\n                      checked !== selection.allSelected ||\n                      indeterminate !== selection.allIndeterminate\n                    ) {\n                      selection.toggleAll();\n                    }\n                  }}\n                  aria-label=\"Select all\"\n                />\n              </DataTableHeadCell>\n              <DataTableHeadCell>Name</DataTableHeadCell>\n              <DataTableHeadCell>Size</DataTableHeadCell>\n              <DataTableHeadCell>Type</DataTableHeadCell>\n              <DataTableHeadCell>Last Modified</DataTableHeadCell>\n            </DataTableRow>\n          </DataTableHead>\n          {files.length > 0 ? (\n            <DataTableBody>\n              {files.map((file) => (\n                <StorageFileTableRow\n                  selectedFile={selectedFile}\n                  bucket={bucket}\n                  key={file.fullPath}\n                  selection={selection}\n                  selectFile={selectFile}\n                  item={file}\n                  setPath={setPath}\n                />\n              ))}\n            </DataTableBody>\n          ) : null}\n        </DataTableContent>\n      </DataTable>\n      {files.length === 0 && <ZeroState />}\n    </div>\n  );\n};\n\ninterface StorageTableRowProps extends StorageTableProps {\n  item: StorageItem;\n  bucket: string;\n  setPath: (path: string) => void;\n}\n\nfunction lastModified(item: StorageItem) {\n  if (item.type === 'folder') {\n    return <>&mdash;</>;\n  }\n\n  // Like in the console, display loading indicator in the last modified column.\n  if (item.uploading) {\n    return (\n      <div className={styles.columnUploading}>\n        <Spinner size={20} />\n        <span>Uploading...</span>\n      </div>\n    );\n  }\n\n  return new Date(item.updated).toLocaleDateString();\n}\n\nexport const StorageFileTableRow: React.FC<StorageTableRowProps> = ({\n  item,\n  selection,\n  selectFile,\n  setPath,\n  selectedFile,\n}) => {\n  const fileNameId = randomId('file');\n\n  function navigate() {\n    if (item.type === 'file') {\n      if (selectedFile === item) {\n        selectFile(undefined);\n      } else {\n        selectFile(item);\n      }\n    } else {\n      selectFile(undefined);\n      setPath(item.fullPath);\n    }\n  }\n\n  return (\n    <DataTableRow\n      tabIndex={0}\n      onKeyDown={(e: KeyboardEvent<HTMLElement>) => {\n        if (e.key === 'Enter') {\n          navigate();\n        }\n      }}\n      onClick={navigate}\n      selected={selectedFile === item}\n      className={styles.row}\n    >\n      <DataTableCell hasFormControl>\n        <Checkbox\n          aria-labelledby={fileNameId}\n          checked={selection.isSelected(item.fullPath)}\n          onClick={(event: MouseEvent<HTMLInputElement>) => {\n            event.stopPropagation();\n          }}\n          onChange={(event: MouseEvent<HTMLInputElement>) => {\n            if (\n              selection.isSelected(item.fullPath) !==\n              (event.target as HTMLInputElement).checked\n            ) {\n              selection.toggleSingle(item.fullPath);\n            }\n          }}\n        />\n      </DataTableCell>\n      <DataTableCell className={styles.name}>\n        {item.type === 'folder' ? (\n          <>\n            <StorageFolderIcon />\n            <Typography\n              use=\"body2\"\n              id={fileNameId}\n              theme=\"textPrimaryOnLight\"\n              className={`${styles.item} ${styles.link}`}\n            >\n              {item.name}/\n            </Typography>\n          </>\n        ) : (\n          <>\n            <StorageFileIcon contentType={item.contentType} />\n            <Typography\n              use=\"body2\"\n              id={fileNameId}\n              className={styles.item}\n              theme=\"textPrimaryOnLight\"\n            >\n              {item.name}\n            </Typography>\n          </>\n        )}\n      </DataTableCell>\n      <DataTableCell>\n        {item.type === 'folder' ? <>&mdash;</> : formatBytes(item.size)}\n      </DataTableCell>\n      <DataTableCell>\n        {item.type === 'folder' ? 'Folder' : item.contentType}\n      </DataTableCell>\n      <DataTableCell>{lastModified(item)}</DataTableCell>\n    </DataTableRow>\n  );\n};\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Typography } from '@rmwc/typography';\nimport React from 'react';\nimport { useDropzone } from 'react-dropzone';\n\nimport { useStorageFiles } from '../../api/useStorageFiles';\nimport styles from './TableDropzoneWrapper.module.scss';\n\nexport const TableDropzoneWrapper: React.FC = ({ children }) => {\n  const { uploadFiles } = useStorageFiles();\n\n  const { getInputProps, getRootProps, isDragActive } = useDropzone({\n    noClick: true,\n    noKeyboard: true,\n    onDrop: async (files) => {\n      await uploadFiles(files);\n    },\n  });\n\n  return (\n    <div {...getRootProps()}>\n      {isDragActive ? (\n        <div className={styles.dropzoneWrapper}>\n          <>{children}</>\n          <Typography\n            use=\"body2\"\n            className={styles.dropWrapper}\n            theme=\"secondary\"\n          >\n            Drop files here\n          </Typography>\n        </div>\n      ) : (\n        <>{children}</>\n      )}\n\n      <input {...getInputProps()} />\n    </div>\n  );\n};\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Card } from '@rmwc/card';\nimport { Elevation } from '@rmwc/elevation';\nimport { GridCell, GridRow } from '@rmwc/grid';\nimport { ThemeProvider } from '@rmwc/theme';\nimport React from 'react';\n\nimport { grey100 } from '../../../colors';\nimport { useStorageFiles } from '../api/useStorageFiles';\nimport { useMultiselect } from '../common/useMultiselect';\nimport { StorageItem } from '../types';\nimport { SideBar } from './SideBar/SideBar';\nimport styles from './StorageCard.module.scss';\nimport { ActionHeader } from './Table/Header/ActionHeader/ActionHeader';\nimport { StorageHeader } from './Table/Header/StorageHeader/StorageHeader';\nimport { StorageTable } from './Table/Table';\nimport { TableDropzoneWrapper } from './TableDropzoneWrapper/TableDropzoneWrapper';\nimport { useSelectedFile } from './useSelectedFile/useSelectedFile';\n\ntype File = StorageItem;\nexport const StorageCard: React.FC = () => {\n  const { files } = useStorageFiles();\n  const paths = files.map((file: File) => file.fullPath);\n  const selection = useMultiselect<string>(paths);\n  const [selectedFile, setSelectedFile] = useSelectedFile(files);\n\n  return (\n    <ThemeProvider options={{ surface: grey100 }}>\n      <Elevation z=\"2\" wrap>\n        <Card>\n          {selection.selected.size === 0 ? (\n            <StorageHeader />\n          ) : (\n            <ActionHeader selection={selection} />\n          )}\n          <div className={styles.tableWrapper}>\n            <GridRow className={styles.gridWrapper}>\n              <GridCell\n                phone={selectedFile ? 1 : 4}\n                tablet={selectedFile ? 4 : 8}\n                desktop={selectedFile ? 8 : 12}\n                className={styles.tableCell}\n              >\n                <ThemeProvider options={{ surface: '#fff' }}>\n                  <TableDropzoneWrapper>\n                    <StorageTable\n                      selection={selection}\n                      selectedFile={selectedFile}\n                      selectFile={setSelectedFile}\n                    />\n                  </TableDropzoneWrapper>\n                </ThemeProvider>\n              </GridCell>\n              {selectedFile && (\n                <GridCell phone={3} tablet={4} desktop={4}>\n                  <SideBar\n                    file={selectedFile}\n                    closeSidebar={() => setSelectedFile(undefined)}\n                  />\n                </GridCell>\n              )}\n            </GridRow>\n          </div>\n        </Card>\n      </Elevation>\n    </ThemeProvider>\n  );\n};\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useState } from 'react';\n\nimport { StorageFile, StorageItem } from '../../types';\n\nexport function useSelectedFile(\n  files: StorageItem[]\n): [StorageFile | undefined, (file: StorageFile | undefined) => void] {\n  const [selectedFile, setSelectedFile] = useState<StorageFile | undefined>(\n    undefined\n  );\n\n  const result = selectedFile\n    ? files.find((file: StorageItem) => file.fullPath === selectedFile.fullPath)\n    : undefined;\n\n  return [result as StorageFile, setSelectedFile];\n}\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useCallback } from 'react';\nimport { FirebaseAppProvider } from 'reactfire';\n\nimport { useEmulatedFirebaseApp } from '../../../firebase';\nimport { useEmulatorConfig } from '../../common/EmulatorConfigProvider';\n\nconst FIREBASE_APP_OPTIONS = {};\n\nexport const StorageFirebaseAppProvider: React.FC = ({ children }) => {\n  const { host, port } = useEmulatorConfig('storage');\n  const app = useEmulatedFirebaseApp(\n    'storage',\n    FIREBASE_APP_OPTIONS,\n    useCallback(\n      (app) => {\n        app.storage().useEmulator(host, port);\n      },\n      [host, port]\n    )\n  );\n\n  if (!app) {\n    return null;\n  }\n\n  return (\n    <FirebaseAppProvider firebaseApp={app}>{children}</FirebaseAppProvider>\n  );\n};\n","/**\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { GridCell } from '@rmwc/grid';\nimport React, { Suspense } from 'react';\nimport { Redirect, Route, Switch } from 'react-router-dom';\n\nimport { useIsEmulatorDisabled } from '../common/EmulatorConfigProvider';\nimport { EmulatorDisabled } from '../common/EmulatorDisabled';\nimport { Spinner } from '../common/Spinner';\nimport { useBuckets } from './api/useBuckets';\nimport { StorageCanvas } from './Canvas/Canvas';\nimport { StorageCard } from './Card/StorageCard';\nimport { storagePath } from './common/constants';\nimport styles from './index.module.scss';\nimport { StorageFirebaseAppProvider } from './providers/StorageFirebaseAppProvider';\n\nexport const Storage: React.FC = () => {\n  return (\n    <Suspense fallback={<StorageRouteSuspended />}>\n      <StorageRoute>\n        <StorageWrapper />\n      </StorageRoute>\n    </Suspense>\n  );\n};\n\nexport const StorageWrapper: React.FC = () => {\n  return (\n    <StorageFirebaseAppProvider>\n      <GridCell span={12} className={styles.storageWrapper}>\n        <StorageCanvas />\n        <Suspense fallback={<Spinner />}>\n          <StorageCard />\n        </Suspense>\n      </GridCell>\n    </StorageFirebaseAppProvider>\n  );\n};\n\nexport const StorageRoute: React.FC = ({ children }) => {\n  const [bucket] = useBuckets();\n\n  return (\n    <Switch>\n      <Route exact path={storagePath + `:bucket/:path*`}>\n        {children}\n      </Route>\n      <Route exact path={storagePath}>\n        <Redirect to={storagePath + bucket} />\n      </Route>\n    </Switch>\n  );\n};\n\nconst StorageRouteSuspended: React.FC = () => {\n  const isDisabled = useIsEmulatorDisabled('storage');\n  return isDisabled ? (\n    <EmulatorDisabled productName=\"Storage\" />\n  ) : (\n    <Spinner span={12} message=\"Storage Emulator Loading...\" />\n  );\n};\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\n\nimport Auth from './components/Auth';\nimport Database from './components/Database';\nimport Firestore from './components/Firestore';\nimport Home from './components/Home';\nimport LogsViewer from './components/LogViewer';\nimport { Storage } from './components/Storage';\n\nexport interface Route {\n  path: string;\n  component: React.FC;\n  label: string;\n  exact: boolean;\n  showInNav: boolean;\n}\n\nexport const routes: ReadonlyArray<Route> = [\n  {\n    path: '/',\n    component: Home,\n    label: 'Overview',\n    exact: true,\n    showInNav: true,\n  },\n  {\n    path: '/auth',\n    component: Auth,\n    label: 'Authentication',\n    exact: false,\n    showInNav: true,\n  },\n  {\n    path: '/firestore',\n    component: Firestore,\n    label: 'Firestore',\n    exact: false,\n    showInNav: true,\n  },\n  {\n    path: '/database',\n    component: Database,\n    label: 'Realtime Database',\n    exact: false,\n    showInNav: true,\n  },\n  {\n    path: '/storage',\n    component: Storage,\n    label: 'Storage',\n    exact: false,\n    showInNav: true,\n  },\n  {\n    path: '/logs',\n    component: LogsViewer as any,\n    label: 'Logs',\n    exact: true,\n    showInNav: true,\n  },\n];\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Icon } from '@rmwc/icon';\nimport React from 'react';\n\nexport const Logo: React.FC = () => (\n  <Icon\n    className=\"Logo\"\n    icon={{\n      strategy: 'component',\n      icon: (\n        <svg\n          xmlns=\"http://www.w3.org/2000/svg\"\n          viewBox=\"0 0 192 192\"\n          style={{ width: '24px', height: '24px' }}\n        >\n          <defs>\n            <clipPath id=\"a\">\n              <path d=\"M143.41 47.34a4 4 0 0 0-6.77-2.16L115.88 66 99.54 34.89a4 4 0 0 0-7.08 0l-8.93 17-22.4-41.77a4 4 0 0 0-7.48 1.28L32 150l57.9 32.46a12 12 0 0 0 11.7 0L160 150z\" />\n            </clipPath>\n            <linearGradient\n              id=\"d\"\n              x1=\"-108.63\"\n              y1=\"-692.24\"\n              x2=\"-58.56\"\n              y2=\"-742.31\"\n              gradientTransform=\"matrix(2.67 0 0 -2.67 317.23 -1808)\"\n              gradientUnits=\"userSpaceOnUse\"\n            >\n              <stop offset=\"0\" stopColor=\"#fff\" stopOpacity=\".1\" />\n              <stop offset=\"1\" stopColor=\"#fff\" stopOpacity=\"0\" />\n            </linearGradient>\n            <linearGradient\n              id=\"b\"\n              x1=\"56.9\"\n              y1=\"102.54\"\n              x2=\"48.9\"\n              y2=\"98.36\"\n              gradientUnits=\"userSpaceOnUse\"\n            >\n              <stop offset=\"0\" stopColor=\"#a52714\" />\n              <stop offset=\".4\" stopColor=\"#a52714\" stopOpacity=\".5\" />\n              <stop offset=\".8\" stopColor=\"#a52714\" stopOpacity=\"0\" />\n            </linearGradient>\n            <linearGradient\n              id=\"c\"\n              x1=\"90.89\"\n              y1=\"90.91\"\n              x2=\"87.31\"\n              y2=\"87.33\"\n              gradientUnits=\"userSpaceOnUse\"\n            >\n              <stop offset=\"0\" stopColor=\"#a52714\" stopOpacity=\".8\" />\n              <stop offset=\".5\" stopColor=\"#a52714\" stopOpacity=\".21\" />\n              <stop offset=\"1\" stopColor=\"#a52714\" stopOpacity=\"0\" />\n            </linearGradient>\n          </defs>\n          <g clipPath=\"url(#a)\">\n            <path\n              d=\"M32 150L53.66 11.39a4 4 0 0 1 7.48-1.27l22.4 41.78 8.93-17a4 4 0 0 1 7.08 0L160 150z\"\n              fill=\"#ffa000\"\n            />\n            <path\n              opacity=\".12\"\n              fill=\"url(#b)\"\n              d=\"M106 9L0 0v192l32-42L106 9z\"\n            />\n            <path\n              d=\"M106.83 96.01l-23.3-44.12L32 150l74.83-53.99z\"\n              fill=\"#f57c00\"\n            />\n            <path opacity=\".2\" fill=\"url(#c)\" d=\"M0 0h192v192H0z\" />\n            <path\n              d=\"M160 150L143.41 47.34a4 4 0 0 0-6.77-2.16L32 150l57.9 32.47a12 12 0 0 0 11.7 0z\"\n              fill=\"#ffca28\"\n            />\n            <path\n              d=\"M143.41 47.34a4 4 0 0 0-6.77-2.16L115.88 66 99.54 34.89a4 4 0 0 0-7.08 0l-8.93 17-22.4-41.77a4 4 0 0 0-7.48 1.28L32 150h-.08l.07.08.57.28L115.83 67l20.78-20.8a4 4 0 0 1 6.78 2.16l16.45 101.74.16-.1zM32.19 149.81L53.66 12.39a4 4 0 0 1 7.48-1.28l22.4 41.78 8.93-17a4 4 0 0 1 7.08 0l16 30.43z\"\n              fill=\"#fff\"\n              fillOpacity=\".2\"\n            />\n            <path\n              d=\"M101.6 181.49a12 12 0 0 1-11.7 0l-57.76-32.4-.14.91 57.9 32.46a12 12 0 0 0 11.7 0L160 150l-.15-.92z\"\n              // style=\"isolation:isolate\"\n              fill=\"#a52714\"\n              opacity=\".2\"\n            />\n            <path\n              d=\"M143.41 47.34a4 4 0 0 0-6.77-2.16L115.88 66 99.54 34.89a4 4 0 0 0-7.08 0l-8.93 17-22.4-41.77a4 4 0 0 0-7.48 1.28L32 150l57.9 32.46a12 12 0 0 0 11.7 0L160 150z\"\n              fill=\"url(#d)\"\n            />\n          </g>\n        </svg>\n      ),\n    }}\n  />\n);\n\nexport default Logo;\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './AppBar.scss';\n\nimport { Tab, TabBar } from '@rmwc/tabs';\nimport { ThemeProvider } from '@rmwc/theme';\nimport { TopAppBar } from '@rmwc/top-app-bar';\nimport { Typography } from '@rmwc/typography';\nimport React from 'react';\nimport { Link, matchPath, useLocation } from 'react-router-dom';\n\nimport { navBarOnSurface, navBarPrimary, navBarSurface } from '../../colors';\nimport { Route } from '../../routes';\nimport Logo from '../common/Logo';\n\ntype Props = {\n  routes: ReadonlyArray<Route>;\n};\n\nexport const AppBar: React.FC<Props> = ({ routes }) => {\n  let location = useLocation();\n\n  const navRoutes = routes.filter((r) => r.showInNav);\n\n  const tabs = navRoutes.map(({ path, label }: Route) => (\n    <Tab\n      key={label}\n      className=\"mdc-tab--min-width\"\n      {...{ tag: Link, to: path }}\n    >\n      {label}\n    </Tab>\n  ));\n\n  const activeTabIndex = navRoutes.findIndex((r) =>\n    matchPath(location.pathname, {\n      path: r.path,\n      exact: r.exact,\n    })\n  );\n\n  return (\n    <ThemeProvider\n      options={{\n        primary: navBarPrimary,\n        surface: navBarSurface,\n        onSurface: navBarOnSurface,\n      }}\n      wrap\n    >\n      <TopAppBar fixed className=\"AppBar\" theme=\"surface\">\n        <div className=\"AppBar-title-row\">\n          <div className=\"AppBar-logo-lockup\">\n            <Logo />\n            <Typography use=\"headline5\" className=\"AppBar-title\" tag=\"h1\">\n              Firebase Emulator Suite\n            </Typography>\n          </div>\n        </div>\n        <TabBar theme=\"onSurface\" activeTabIndex={activeTabIndex}>\n          {tabs}\n        </TabBar>\n      </TopAppBar>\n    </ThemeProvider>\n  );\n};\n\nexport default AppBar;\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Dialog, DialogContent, DialogTitle } from '@rmwc/dialog';\nimport React from 'react';\n\nimport { useIsEmulatorDisabled } from '../common/EmulatorConfigProvider';\n\nexport const AppDisconnected: React.FC = () => {\n  const disabled = useIsEmulatorDisabled();\n  if (!disabled) {\n    return null;\n  }\n\n  return (\n    <Dialog open preventOutsideDismiss>\n      <DialogTitle>Emulator Suite Disconnected</DialogTitle>\n      <DialogContent>\n        All emulators for this project have stopped running. To restart all\n        emulators, at the command line, run{' '}\n        <code>firebase emulators:start</code>.\n      </DialogContent>\n    </Dialog>\n  );\n};\n\nexport default AppDisconnected;\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './index.scss';\n\nimport { Portal } from '@rmwc/base';\nimport { DialogQueue } from '@rmwc/dialog';\nimport { Grid } from '@rmwc/grid';\nimport { Theme } from '@rmwc/theme';\nimport React from 'react';\nimport { Redirect, Route, Switch } from 'react-router-dom';\n\nimport { routes } from '../../routes';\nimport { dialogs } from '../common/DialogQueue';\nimport AppBar from './AppBar';\nimport AppDisconnected from './AppDisconnected';\n\nexport const REDIRECT_LOGS_URL =\n  '/logs?q=metadata.emulator.name%3D%22functions%22';\n\nconst App: React.FC = () => {\n  return (\n    <>\n      <DialogQueue dialogs={dialogs} />\n      <Portal />\n      <AppDisconnected />\n      <Theme use=\"background\" wrap>\n        <div className=\"App\">\n          <AppBar routes={routes} />\n          <Grid className=\"App-main\">\n            <Switch>\n              {routes.map((r) => (\n                <Route\n                  key={r.path}\n                  path={r.path}\n                  component={r.component}\n                  exact={r.exact}\n                />\n              ))}\n              <Redirect from=\"/functions\" to={REDIRECT_LOGS_URL} />\n              <Redirect to=\"/\" /> {/* Fallback to redirect to overview. */}\n            </Switch>\n          </Grid>\n        </div>\n      </Theme>\n    </>\n  );\n};\n\nexport default App;\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport '@rmwc/tooltip/tooltip.css';\n\n// General + library styling. Should come before all local imports to allow\n// local styling to override them.\nimport './index.scss';\n\nimport { RMWCProvider } from '@rmwc/provider';\nimport { ThemeProvider } from '@rmwc/theme';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport { Provider } from 'react-redux';\nimport { BrowserRouter, Route, Switch } from 'react-router-dom';\n\nimport { background, primary, secondary } from './colors';\nimport App from './components/App';\nimport { EmulatorConfigProvider } from './components/common/EmulatorConfigProvider';\nimport { FirestoreRequestsProvider } from './components/Firestore/Requests/FirestoreRequestsProvider';\nimport configureStore from './configureStore';\nimport { error } from './themes';\n\nconst store = configureStore();\n\nconst RouterWithInit = () => {\n  return (\n    <BrowserRouter>\n      <Switch>\n        <Route component={App} />\n      </Switch>\n    </BrowserRouter>\n  );\n};\n\nReactDOM.unstable_createBlockingRoot(document.getElementById('root')!).render(\n  <React.StrictMode>\n    <RMWCProvider\n      // Globally disable ripples\n      ripple={false}\n    >\n      <ThemeProvider\n        options={{\n          background,\n          primary,\n          primaryRgb: '104, 29, 168',\n          secondary,\n          error,\n        }}\n      >\n        <EmulatorConfigProvider refreshInterval={2000}>\n          <FirestoreRequestsProvider>\n            <Provider store={store}>\n              <RouterWithInit />\n            </Provider>\n          </FirestoreRequestsProvider>\n        </EmulatorConfigProvider>\n      </ThemeProvider>\n    </RMWCProvider>\n  </React.StrictMode>\n);\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Store, applyMiddleware, compose, createStore } from 'redux';\nimport createSagaMiddleware from 'redux-saga';\n\nimport { AppState, rootReducer, rootSaga } from './store';\n\nexport default function configureStore(): Store<AppState> {\n  const composeEnhancers =\n    (window as any).__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;\n  const sagaMiddleware = createSagaMiddleware();\n  const store = createStore(\n    rootReducer,\n    composeEnhancers(applyMiddleware(sagaMiddleware))\n  );\n  sagaMiddleware.run(rootSaga);\n  return store;\n}\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"panel\":\"CollectionFilter_panel__3z15Z\",\"header\":\"CollectionFilter_header__1-t0U\",\"headerTitle\":\"CollectionFilter_headerTitle__ebNNW\",\"preview\":\"CollectionFilter_preview__1TWpW\",\"children\":\"CollectionFilter_children__l7ZC9\",\"previewFilter\":\"CollectionFilter_previewFilter__eDMkO\",\"conditionEntries\":\"CollectionFilter_conditionEntries__2CpLn\",\"removeFilter\":\"CollectionFilter_removeFilter__1xNn1\",\"hidden\":\"CollectionFilter_hidden__IoL4U\",\"conditionEntry\":\"CollectionFilter_conditionEntry__xeuMd\",\"conditionEntryType\":\"CollectionFilter_conditionEntryType__3jxWW\",\"conditionEntryValue\":\"CollectionFilter_conditionEntryValue__3N83N\",\"actions\":\"CollectionFilter_actions__1uD4j\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"emailWrapper\":\"controls_emailWrapper__2uj98\",\"error\":\"controls_error__3u2lA\",\"customAttributesWrapper\":\"controls_customAttributesWrapper__3rPpB\",\"customAttributeWrapper\":\"controls_customAttributeWrapper__w-Bmn\",\"signInWrapper\":\"controls_signInWrapper__3GGfU\",\"signInHeader\":\"controls_signInHeader__1CQk8\",\"authKindLabel\":\"controls_authKindLabel__1v_H7\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"tableWrapper\":\"Table_tableWrapper__1qYGf\",\"link\":\"Table_link__3ffTh\",\"checkboxColumn\":\"Table_checkboxColumn__3EV23\",\"name\":\"Table_name__1kRY3\",\"row\":\"Table_row__14jDG\",\"columnUploading\":\"Table_columnUploading__2llJi\",\"item\":\"Table_item__3AKvk\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"noResultsWrapper\":\"UsersTable_noResultsWrapper__2S_XP\",\"tableWrapper\":\"UsersTable_tableWrapper__1Quve\",\"disabled\":\"UsersTable_disabled__2DlIr\"};"],"sourceRoot":""}